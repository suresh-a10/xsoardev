category: Data Enrichment & Threat Intelligence
commonfields:
  id: Cryptocurrency
  version: -1
configuration:
- additionalinfo: Reliability of the source providing the intelligence data. Default
    is B - Usually reliable.
  advanced: true
  defaultvalue: B - Usually reliable
  display: Source Reliability
  name: reliability
  options:
  - A - Completely reliable
  - B - Usually reliable
  - C - Fairly reliable
  - D - Not usually reliable
  - E - Unreliable
  - F - Reliability cannot be judged
  required: false
  section: Collect
  type: 15
- additionalinfo: Reputation for the Cryptocurrency indicators. Default is Suspicious.
  advanced: true
  defaultvalue: Suspicious
  display: Reputation
  name: reputation
  options:
  - None
  - Good
  - Suspicious
  - Bad
  required: false
  section: Collect
  type: 15
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.0.0
    itemVersion: 1.1.55
    packID: Cryptocurrency
    packName: Cryptocurrency
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: Cryptocurrency will help classify Cryptocurrency indicators with the
  configured score when ingested.
detaileddescription: |-
  #### Supported Cryptocurrencies:
  - bitcoin


  ---
  [View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/cryptocurrency)
display: Cryptocurrency
image: data:image/png;base64,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
name: Cryptocurrency
script:
  commands:
  - arguments:
    - default: true
      description: List of cryptocurrency addresses.
      isArray: true
      name: crypto
    - auto: PREDEFINED
      description: The cryptocurrency address type, if known. e.g. 'bitcoin'.
      name: address_type
      predefined:
      - bitcoin
    description: Return Cryptocurrency reputation.
    name: crypto
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The actual score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: Cryptocurrency.Address
      description: The cryptocurrency address.
      type: string
    - contextPath: Cryptocurrency.AddressType
      description: The cryptocurrency type. e.g. 'bitcoin'.
      type: string
  dockerimage: demisto/python3:3.10.14.91134
  runonce: false
  script: |
    register_module_line('Cryptocurrency', 'start', __line__())
    ### pack version: 1.1.55



    import urllib3
    from typing import Dict, List

    # Disable insecure warnings
    urllib3.disable_warnings()

    ''' CONSTANTS '''

    DATE_FORMAT = '%Y-%m-%dT%H:%M:%SZ'
    BITCOIN = 'bitcoin'
    INTEGRATION_NAME = 'Cryptocurrency'
    SCORE = {
        'None': 0,
        'Good': 1,
        'Suspicious': 2,
        'Bad': 3,
    }


    def get_bitcoin_reputation(addresses, reliability, reputation, score) -> List[CommandResults]:
        command_results: List[CommandResults] = []
        for address in addresses:
            dbot_score = Common.DBotScore(
                indicator=address,
                indicator_type=DBotScoreType.CRYPTOCURRENCY,
                integration_name=INTEGRATION_NAME,  # Vendor
                score=score,
                reliability=reliability,
            )
            crypto_context = Common.Cryptocurrency(
                address=address,
                address_type=BITCOIN,
                dbot_score=dbot_score,
            )
            table_data = {
                'Address': address,
                'Cryptocurrency Address Type': BITCOIN,
                'Reputation': reputation,
            }
            table_name = f'{INTEGRATION_NAME} reputation for {address}'
            hr = tableToMarkdown(table_name, table_data)

            command_results.append(CommandResults(
                outputs_prefix='Cryptocurrency',
                readable_output=hr,
                outputs_key_field='Address',
                indicator=crypto_context,
            ))
        return command_results


    def crypto_reputation_command(args: Dict[str, str], reliability: str, reputation: str):
        crypto_addresses = argToList(args.get('crypto', ''))

        # For cases the command was executed by a playbook/user and the addresses received are verified
        # Stripping the `bitcoin` prefix from the given addresses (if exists) then add it to match the convention.
        if args.get('address_type') == BITCOIN:
            bitcoin_addresses = [f'bitcoin:{address.lstrip("bitcoin:")}' for address in crypto_addresses]

        else:
            bitcoin_addresses = [address for address in crypto_addresses if BITCOIN in address]

        score = SCORE[reputation]
        result = get_bitcoin_reputation(bitcoin_addresses, reliability, reputation, score)

        return result


    def main():
        params = demisto.params()
        reliability = params['reliability']
        reputation = params['reputation']

        demisto.info(f'Command being called is {demisto.command()}')
        try:
            if demisto.command() == 'test-module':
                return_results('ok')

            elif demisto.command() == 'crypto':
                return_results(crypto_reputation_command(demisto.args(), reliability, reputation))

        # Log exceptions and return errors
        except Exception as e:
            return_error(f'Failed to execute {demisto.command()} command.\nError:\n{str(e)}')


    ''' ENTRY POINT '''

    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()

    register_module_line('Cryptocurrency', 'end', __line__())
  subtype: python3
  type: python
system: true
