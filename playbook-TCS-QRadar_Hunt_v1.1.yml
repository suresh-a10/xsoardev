contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
hidden: true
id: bb796afc-35ce-42b0-8f15-b97e0b42e7b2
inputs:
- description: ""
  key: IPReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
- description: ""
  key: DomainReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
- description: ""
  key: Hash256ReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
- description: ""
  key: HashMD5ReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
- description: ""
  key: Extracted Domains
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: Domain
      root: ExtractedIndicators
- description: ""
  key: IP Address
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: IP
      root: Address2
- description: ""
  key: File Hash
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: File
      root: ExtractedIndicators
name: TCS-QRadar Hunt v1.1
outputs: []
sourceplaybookid: 4dd9791a-e769-4bbe-8d36-d6c517550365
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ffdca5c2-9677-479b-820f-225d8d6fc5d3
      iscommand: false
      name: ""
      version: -1
    taskid: ffdca5c2-9677-479b-820f-225d8d6fc5d3
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": -170,
          "y": -310
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
      - "27"
      - "28"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a new reference set. If the provided name is already in
        use, this command will fail
      id: b376e707-7977-4a9c-81c2-ec7209986eeb
      iscommand: false
      name: Update existing QRadar IoC detection rule/reference set
      type: title
      version: -1
    taskid: b376e707-7977-4a9c-81c2-ec7209986eeb
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -170,
          "y": -110
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ref_name:
        simple: TCS_MasterIOC_IP
      using:
        simple: QRadar v3_Typosquat Offences
      value:
        complex:
          accessor: IP
          root: Address2
    separatecontext: false
    skipunavailable: false
    task:
      brand: QRadar v3
      description: Adds or updates an element in a reference set.
      id: 479bc0f5-5422-45bd-85eb-5526bf006955
      iscommand: true
      name: Update IP address Reference set "TCS_MasterIOC_IP"
      script: QRadar v3|||qradar-reference-set-value-upsert
      type: regular
      version: -1
    taskid: 479bc0f5-5422-45bd-85eb-5526bf006955
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -620,
          "y": 300
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ref_name:
        simple: TCS_MasterIOC_Domain
      using:
        simple: QRadar v3_Typosquat Offences
      value:
        complex:
          accessor: Domain
          root: ExtractedIndicators
    separatecontext: false
    skipunavailable: false
    task:
      brand: QRadar v3
      description: Adds or updates an element in a reference set.
      id: f4a946b2-35e8-428a-8038-b10f1a9a39e6
      iscommand: true
      name: Update Domain Reference set "TCS_MasterIOC_Domain"
      script: QRadar v3|||qradar-reference-set-value-upsert
      type: regular
      version: -1
    taskid: f4a946b2-35e8-428a-8038-b10f1a9a39e6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -170,
          "y": 300
        }
      }
  "4":
    continueonerror: true
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ref_name:
        simple: TCS_MasterIOC_Hash
      using:
        simple: QRadar v3_Typosquat Offences
      value:
        complex:
          accessor: File
          root: ExtractedIndicators
    separatecontext: false
    skipunavailable: false
    task:
      brand: QRadar v3
      description: Adds or updates an element in a reference set.
      id: 815e8bd8-354e-4b9f-8840-b9b6053e92f4
      iscommand: true
      name: Update Hash Reference set "TCS_MasterIOC_Hash"
      script: QRadar v3|||qradar-reference-set-value-upsert
      type: regular
      version: -1
    taskid: 815e8bd8-354e-4b9f-8840-b9b6053e92f4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 270,
          "y": 300
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fbf9d9a4-0442-478d-8c4d-f94ef3d5ccbb
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: fbf9d9a4-0442-478d-8c4d-f94ef3d5ccbb
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -170,
          "y": 660
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f88f4499-8ae4-40c4-8b1a-a715740e2883
      iscommand: false
      name: 'Phase 3: Identify discovered IOC’s in historical data (30/90)'
      type: title
      version: -1
    taskid: f88f4499-8ae4-40c4-8b1a-a715740e2883
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 750,
          "y": -110
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      query_expression:
        simple: select QIDNAME(qid) as 'Event Name',logsourcename(logSourceId) as
          'Log Source',"eventCount" as 'Event Count',"startTime" as 'Time',categoryname(category)
          as 'Low Level Category',"sourceIP" as 'Source IP',"sourcePort" as 'Source
          Port',"destinationIP" as 'Destination IP',"destinationPort" as 'Destination
          Port',"userName" as 'Username',"magnitude" as 'Magnitude' from events where
          referencesetcontains('TCS_MasterIOC_IP', "sourceIP") order by "startTime"
          desc last 30 days
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Searches in QRadar using AQL. It is highly recommended to use the
        playbook 'QRadarFullSearch' instead of this command - it will execute the
        search, and will return the result.
      id: ae3c7a78-7680-43af-8c27-d6a21b6642e6
      iscommand: true
      name: Query QRadar; IP IOC’s on historical data last 30 days
      script: '|||qradar-searches'
      type: regular
      version: -1
    taskid: ae3c7a78-7680-43af-8c27-d6a21b6642e6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 290
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 293baf59-e3b2-4090-8c87-848d0278ae27
      iscommand: false
      name: 'Phase 4: Send Notifications'
      type: title
      version: -1
    taskid: 293baf59-e3b2-4090-8c87-848d0278ae27
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1500,
          "y": -110
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      cc:
        simple: v.ghule@tcs.com
      htmlBody:
        simple: |-
          <p>** QRadar IOC Detection Alert **</p>
          <p><br /> Positive IoC detected for &lsquo;IoC details go here&rsquo;. Please investigate.<br /> <br /> Regards,<br /> CyberAutoBot</p>
      subject:
        simple: QRadar IOC Detection Alert
      to:
        simple: yogesh.gholap@tcs.com;internalis.cybersecurity@tcs.com
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email
      id: a83e5e23-7dce-4b39-8c8f-6b7bc226b101
      iscommand: true
      name: Send Notification Email to CSOC Manager and Analyst
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: a83e5e23-7dce-4b39-8c8f-6b7bc226b101
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 80
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a9e537b5-a23e-4350-87ae-ab1b70611470
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: a9e537b5-a23e-4350-87ae-ab1b70611470
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1520,
          "y": 890
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      query_expression:
        simple: select QIDNAME(qid) as 'Event Name',logsourcename(logSourceId) as
          'Log Source',"eventCount" as 'Event Count',"startTime" as 'Start Time',categoryname(category)
          as 'Low Level Category',"sourceIP" as 'Source IP',"sourcePort" as 'Source
          Port',"destinationIP" as 'Destination IP',"destinationPort" as 'Destination
          Port',"userName" as 'Username',"URL" as 'URL (custom)',"web_Category" as
          'web_Category (custom)',"ThreatName" as 'ThreatName (custom)' from events
          where referencesetcontains('TCS_MasterIOC_Domain', "URL") order by "startTime"
          desc last  30 days
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Searches in QRadar using AQL. It is highly recommended to use the
        playbook 'QRadarFullSearch' instead of this command - it will execute the
        search, and will return the result.
      id: 7eee1283-e05e-4c9e-8574-6eaa5c56c1a2
      iscommand: true
      name: Query QRadar; Domain IOC’s on historical data last 30 days
      script: '|||qradar-searches'
      type: regular
      version: -1
    taskid: 7eee1283-e05e-4c9e-8574-6eaa5c56c1a2
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 450
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      query_expression:
        simple: select QIDNAME(qid) as 'Event Name',logsourcename(logSourceId) as
          'Log Source',"eventCount" as 'Event Count',"startTime" as 'Start Time',categoryname(category)
          as 'Low Level Category',"sourceIP" as 'Source IP',"sourcePort" as 'Source
          Port',"destinationIP" as 'Destination IP',"destinationPort" as 'Destination
          Port',"userName" as 'Username',"URL" as 'URL (custom)',"web_Category" as
          'web_Category (custom)',"ThreatName" as 'ThreatName (custom)' from events
          where referencesetcontains('TCS_MasterIOC_Domain', "URL") order by "startTime"
          desc last  30 days
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Searches in QRadar using AQL. It is highly recommended to use the
        playbook 'QRadarFullSearch' instead of this command - it will execute the
        search, and will return the result.
      id: d3e68fbd-a520-4352-87eb-00f2853e3d79
      iscommand: true
      name: Query QRadar; SHA256 Hash IOC’s on historical data last 30 days
      script: '|||qradar-searches'
      type: regular
      version: -1
    taskid: d3e68fbd-a520-4352-87eb-00f2853e3d79
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 600
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: f8151b10-02af-4297-87bf-b5cbe11c43cf
      iscommand: true
      name: Close Investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: f8151b10-02af-4297-87bf-b5cbe11c43cf
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1520,
          "y": 1070
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e2b28e9d-1ac2-43d5-8178-b98155ff7580
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: e2b28e9d-1ac2-43d5-8178-b98155ff7580
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1520,
          "y": 1270
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "25"
    note: false
    quietmode: 0
    scriptarguments:
      body:
        simple: "Hello Human,\n\nI found a positive detection for the below IOCs in
          my QRadar  historical search. \n\nDetected Users:  ${QRadar.DetectedUsers}\n\nDetected
          InternalIP's:  ${QRadar.DetectedInternalIPs}\n\nDetected ExternalIP's:  ${QRadar.DetectedExternalIPs}\n\nDetected
          Internal Hosts:  ${QRadar.DetectedInternalHosts}\n\nDetected External Hosts:
          \ ${QRadar.DetectedExternalHosts}\n\n\nRegards,\nCyber AutoBot"
      cc:
        simple: kunal.krushev@tcs.com
      to:
        simple: kunal.krushev@tcs.com
    separatecontext: false
    skipunavailable: false
    task:
      brand: Mail Sender (New)
      description: Send an email
      id: eac69f39-cdce-4681-8b8e-0594274c326e
      iscommand: true
      name: Notify QRadar Findings To CSOC Team
      script: Mail Sender (New)|||send-mail
      type: regular
      version: -1
    taskid: eac69f39-cdce-4681-8b8e-0594274c326e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 750,
          "y": 790
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 235a0415-3c11-4414-81f8-3832a0bca620
      iscommand: false
      name: Report & Notify
      type: title
      version: -1
    taskid: 235a0415-3c11-4414-81f8-3832a0bca620
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 750,
          "y": 590
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b543ffcc-3d42-4628-8959-269c6a22163d
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: b543ffcc-3d42-4628-8959-269c6a22163d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 750,
          "y": 1005
        }
      }
  "26":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: IP
                root: Address2
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ab60fd7e-c7b5-4c18-849f-ce75b615ceb5
      iscommand: false
      name: Is There an IP Address To Update ?
      type: condition
      version: -1
    taskid: ab60fd7e-c7b5-4c18-849f-ce75b615ceb5
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -620,
          "y": 80
        }
      }
  "27":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Domain
                root: ExtractedIndicators
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6bcbed60-62c2-4f29-8722-ca021f5d6f5b
      iscommand: false
      name: Is There a Domain To Update ?
      type: condition
      version: -1
    taskid: 6bcbed60-62c2-4f29-8722-ca021f5d6f5b
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -170,
          "y": 80
        }
      }
  "28":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: File
                root: ExtractedIndicators
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "28"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "4"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8c8b32c7-8033-48a7-8a93-c25128bd0513
      iscommand: false
      name: Is There a Hash To Update ?
      type: condition
      version: -1
    taskid: 8c8b32c7-8033-48a7-8a93-c25128bd0513
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 270,
          "y": 80
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "23"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        simple: ExtractedIndicators.IP
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      MD5:
        complex:
          accessor: File_MD5
          root: ExtractedIndicators
      QradarIPfield:
        simple: sourceip,destinationip
      SHA1:
        complex:
          accessor: File_SHA1
          root: ExtractedIndicators
      SHA256:
        simple: ExtractedIndicators.File_SHA256
      TimeFrame:
        simple: LAST 7 DAYS
      URLDomain:
        simple: ExtractedIndicators.Domain
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b270152e-41ab-40bd-8caf-bc38c4cb2184
      iscommand: false
      name: TCS-QRadar Indicator Hunting V1.2
      playbookId: a8460380-0fca-45bd-8b38-3faa8b39a657
      type: playbook
      version: -1
    taskid: b270152e-41ab-40bd-8caf-bc38c4cb2184
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 750,
          "y": 80
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1645,
        "width": 2800,
        "x": -620,
        "y": -310
      }
    }
  }
