args:
- description: The entry id of the excel file
  name: entryId
  required: true
comment: The automation takes Excel file (entryID) as an input and parses its content
  to the war room and context
commonfields:
  id: 1f1323e5-3729-4a86-8857-a9e8ea8bead5
  version: -1
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
dockerimage: demisto/py3-tools:0.0.1.30715
enabled: true
engineinfo: {}
mainengineinfo: {}
name: ParseExcel_copy
outputs:
- contextPath: ParseExcel
  description: ParseExcel
pswd: ""
runas: DBotWeakRole
runonce: false
script: |
  register_module_line('ParseExcel', 'start', __line__())

  import xlrd



  def parse_excel(file_entry_id):

      res = demisto.getFilePath(file_entry_id)
      file_path = res['path']

      workbook = xlrd.open_workbook(file_path, on_demand=True)
      sheet_names = workbook.sheet_names()
      sheets = []
      context = {}

      for sheetnum in range(workbook.nsheets):
          worksheet = workbook.sheet_by_index(sheetnum)
          first_row = []
          for col in range(worksheet.ncols):
              first_row.append(str(worksheet.cell_value(6, col)))
          data = []
          for row in range(7, worksheet.nrows):
              elm = {}
              for col in range(worksheet.ncols):
                  elm[first_row[col]] = worksheet.cell_value(row, col)
              data.append(elm)
          sheets.append(data)
          context["ParseExcel"] = sheets
          demisto.results({
              'Type': entryTypes['note'],
              'Contents': data,
              'ContentsFormat': formats['json'],
              'HumanReadable': tableToMarkdown(sheet_names[sheetnum], data, first_row),
              'EntryContext': context
          })
      #demisto.results(demisto.executeCommand("ExportToXLSX", {"file_name": "entries.xlsx","sheet_name":"warroom entris","data": {"key":sheets}}))

  def main():
      file_entry_id = demisto.args()['entryId']
      parse_excel(file_entry_id)


  # python2 uses __builtin__ python3 uses builtins
  if __name__ == "__builtin__" or __name__ == "builtins":
      main()

  register_module_line('ParseExcel', 'end', __line__())
scripttarget: 0
subtype: python3
tags: []
type: python
