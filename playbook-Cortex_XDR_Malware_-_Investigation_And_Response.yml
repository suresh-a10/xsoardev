contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.5.0
    itemVersion: 6.1.65
    packID: CortexXDR
    packName: Cortex XDR by Palo Alto Networks
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: "This playbook is part of the 'Malware Investigation And Response' pack.
  For more information, refer to https://xsoar.pan.dev/docs/reference/packs/malware-investigation-and-response.\nThis
  playbook investigates Cortex XDR malware incidents. It uses:\n - Cortex XDR insights
  \n - Command Line Analysis \n - Dedup \n - Sandbox hash search and detonation \n
  - Cortex XDR enrichment \n - Incident Handling (True/False Positive)."
id: Cortex XDR Malware - Investigation And Response
inputs:
- description: Whether the deduplication playbook will be used.
  key: EnableDeduplication
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: Whether endpoint isolation is allowed.
  key: AutoIsolation
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: Whether file retrieval from the endpoint is allowed.
  key: RetrieveFile
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: The name of the ticketing system to use, for example, Jira, or ServiceNow.
    (Used in case incident is classified as True Positive).
  key: TicketingSystemToUse
  playbookInputQuery: null
  required: false
  value: {}
- description: The ticket project name. (Required for Jira).
  key: TicketProjectName
  playbookInputQuery: null
  required: false
  value: {}
- description: The tag to assign for indicators to block.
  key: MaliciousTagName
  playbookInputQuery: null
  required: false
  value:
    simple: MaliciousTagName
- description: Whether the incident will be closed with closure steps or automatically.
  key: EnableClosureSteps
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: A comma-separated list of incident text fields to take into account
    when computing similarity. For example commandline, URL.
  key: DedupSimilarTextField
  playbookInputQuery: null
  required: false
  value:
    simple: agnetsid,users,agentsid,CMDline,Hostnames,filenames,filepaths
- description: Whether automatic un-isolation is allowed.
  key: AutoUnisolation
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: The maximum number of incidents to query and set to context data.
  key: DedupLimit
  playbookInputQuery: null
  required: false
  value:
    simple: "200"
- description: "Defines how to handle Similar incidents. \n Choose between: \"Link\",
    \"Close\", \"Link and Close\".\n Note: Closing incidents requires you to define
    the \"CloseSimilar\" input as well.\n Also, the incidents found by similar indicators
    or fields will be closed if their similarity score is above the CloseSimilar value. "
  key: DedupHandleSimilar
  playbookInputQuery: null
  required: false
  value:
    simple: Link
- description: |-
    Defines the threshold of similarity to close a similar incident. All similar incidents with similarity above this value will be closed.
    For example, if CloseSimilar is set to .8 and an incident has a similarity score of .9, the incident will be closed.
    The value should be between 0 and 1 [0=low similarity , 1=identical].
  key: DedupCloseSimilar
  playbookInputQuery: null
  required: false
  value:
    simple: "0.9"
- description: "Retain incidents with a similarity score greater than the MinimunIncidentSimilarity.
    \   \nValue should be between 0 to 1 [0=low similarity, 1=identical]"
  key: DedupMinimunIncidentSimilarity
  playbookInputQuery: null
  required: false
  value:
    simple: "0.2"
- description: The name of the tag to apply for allowed indicators.
  key: BenignTagName
  playbookInputQuery: null
  required: false
  value:
    simple: BenignTagName
- description: '''Whether to run Advance Hunting queries through your Cortex XDR instance
    using the information on Alert Insights. Note: It may take some time.'''
  key: AdvancedHunting
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: Whether to run the Advanced Hunting section for all Mitre Tactics.
  key: RunAllHuntMitreTactics
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: Whether file detonation is allowed on the sandbox.
  key: DetonateFile
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
name: Cortex XDR Malware - Investigation And Response
outputs:
- contextPath: PaloAltoNetworksXDR.ScriptResult.results
  description: Palo ALto Networks Script reuslts information.
  type: unknown
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "96"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b93c6a4d-ba67-4186-8dda-42474ed3c901
      iscommand: false
      name: ""
      version: -1
    taskid: b93c6a4d-ba67-4186-8dda-42474ed3c901
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 460,
          "y": -110
        }
      }
  "6":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.EnableDeduplication
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "8"
      "yes":
      - "98"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Use deduplication?
      id: 8482ccf3-50ab-45eb-871b-757b4061fbf8
      iscommand: false
      name: Use deduplication?
      type: condition
      version: -1
    taskid: 8482ccf3-50ab-45eb-871b-757b4061fbf8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 315
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "86"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ab357c85-1482-4343-882c-105c9c436963
      iscommand: false
      name: Deduplication Done
      type: title
      version: -1
    taskid: ab357c85-1482-4343-882c-105c9c436963
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 670
        }
      }
  "26":
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "103"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 4ab161b1-b58d-4e35-8c5d-d524332dcd4c
      iscommand: false
      name: Sandbox
      type: title
      version: -1
    taskid: 4ab161b1-b58d-4e35-8c5d-d524332dcd4c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 980
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "31"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6dd40271-6772-4c6e-8f86-8e38e7de80d9
      iscommand: false
      name: Any prevention actions?
      type: title
      version: -1
    taskid: 6dd40271-6772-4c6e-8f86-8e38e7de80d9
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 860,
          "y": 980
        }
      }
  "31":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.action_pretty
          operator: containsString
          right:
            value:
              simple: block
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.action_pretty
          operator: containsString
          right:
            value:
              simple: prevent
      label: Prevention
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      Prevention:
      - "32"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if there were any prevention actions?
      id: 35d91074-aefb-4ac2-8257-c72ef5a06f15
      iscommand: false
      name: Check if there were any prevention Actions?
      type: condition
      version: -1
    taskid: 35d91074-aefb-4ac2-8257-c72ef5a06f15
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1100
        }
      }
  "32":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: alerts.action_pretty
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_sha256
                    operator: in
                    right:
                      iscontext: true
                      value:
                        simple: File(val.Malicious).SHA256
                  - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_wildfire_verdict
                    operator: isEqualString
                    right:
                      value:
                        simple: Malicious
                root: PaloAltoNetworksXDR.Incident
          operator: containsString
          right:
            value:
              simple: Block
        - left:
            iscontext: true
            value:
              complex:
                accessor: alerts.action_pretty
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_sha256
                    operator: in
                    right:
                      iscontext: true
                      value:
                        simple: File(val.Malicious).SHA256
                  - left:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Incident.file_artifacts.file_wildfire_verdict
                    operator: isEqualString
                    right:
                      value:
                        simple: Malicious
                root: PaloAltoNetworksXDR.Incident
          operator: isEqualString
          right:
            value:
              simple: Prevent
      label: "yes"
    continueonerrortype: ""
    id: "32"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "80"
      "yes":
      - "33"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Was the malicious hash Blocked?
      id: 48deb565-d73c-444c-8ba8-f622c8a597a1
      iscommand: false
      name: Was the malicious hash Blocked?
      type: condition
      version: -1
    taskid: 48deb565-d73c-444c-8ba8-f622c8a597a1
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1480
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "54"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6b6a0592-9a71-4320-88cd-1e0333428a02
      iscommand: false
      name: Manual Review if needed to proceed with the investigation
      type: title
      version: -1
    taskid: 6b6a0592-9a71-4320-88cd-1e0333428a02
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1825
        }
      }
  "36":
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Malware Investigation Summary
      output:
        simple: ${InvestigationSummary}
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "116"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieves information from previously run reputation commands and
        aggregates their results.
      id: 9a189ad4-b9e7-4916-8fa8-c1487c4a43a2
      iscommand: false
      name: Parse Finding from the sandboxes
      script: InvestigationSummaryParse
      type: regular
      version: -1
    taskid: 9a189ad4-b9e7-4916-8fa8-c1487c4a43a2
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 2400
        }
      }
  "37":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.RetrieveFile
          operator: isEqualString
          right:
            value:
              simple: "true"
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: Status
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: Endpoint.ID
                    operator: isEqualString
                    right:
                      iscontext: true
                      value:
                        simple: incident.deviceid
                root: Endpoint
          operator: isEqualString
          right:
            value:
              simple: Online
      label: "yes"
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "119"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Is file retrieval allowed?
      id: ebe6bf9b-5500-4c06-832e-8c146bae8cf9
      iscommand: false
      name: Is file retrieval allowed?
      type: condition
      version: -1
    taskid: ebe6bf9b-5500-4c06-832e-8c146bae8cf9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1550
        }
      }
  "38":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: NonFoundHashes
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "41"
      "yes":
      - "42"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Were there any hashes without a verdict?
      id: 3f0c7cc9-00f3-4f6d-883d-347f7e0e2be6
      iscommand: false
      name: Were there any hashes without a verdict?
      type: condition
      version: -1
    taskid: 3f0c7cc9-00f3-4f6d-883d-347f7e0e2be6
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 1250
        }
      }
  "40":
    continueonerrortype: ""
    id: "40"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "36"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a7197a59-6a60-4644-803e-6a6687db6abb
      iscommand: false
      name: Parse Findings
      type: title
      version: -1
    taskid: a7197a59-6a60-4644-803e-6a6687db6abb
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 2270
        }
      }
  "41":
    continueonerrortype: ""
    id: "41"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "40"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6bb09f04-51b8-4f12-8a9c-c4a05e8130dc
      iscommand: false
      name: Known File
      type: title
      version: -1
    taskid: 6bb09f04-51b8-4f12-8a9c-c4a05e8130dc
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 1430
        }
      }
  "42":
    continueonerrortype: ""
    id: "42"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "37"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1857bdf6-77eb-4860-8fdb-a67bdeb01a1b
      iscommand: false
      name: Unknown File
      type: title
      version: -1
    taskid: 1857bdf6-77eb-4860-8fdb-a67bdeb01a1b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1430
        }
      }
  "45":
    continueonerrortype: ""
    id: "45"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      scriptArguments:
        File:
          complex:
            filters:
            - - ignorecase: true
                left:
                  iscontext: true
                  value:
                    simple: File.Extension
                operator: notContainsString
                right:
                  value:
                    simple: gz
            - - ignorecase: true
                left:
                  iscontext: true
                  value:
                    simple: File.Name
                operator: notContainsString
                right:
                  value:
                    simple: Investigation_package_incident
            root: File
      wait: 1
    nexttasks:
      '#none#':
      - "40"
    note: false
    quietmode: 0
    scriptarguments:
      File:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: File.EntryID
              operator: isNotEmpty
          - - left:
                iscontext: true
                value:
                  simple: File.SHA256
              operator: in
              right:
                iscontext: true
                value:
                  simple: NonFoundHashes
          - - left:
                iscontext: true
                value:
                  simple: File.Size
              operator: greaterThan
              right:
                value:
                  simple: "0"
          root: File
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: 'This playbook uploads, detonates, and analyzes files for supported
        sandboxes. Currently supported sandboxes are Falcon Intelligence Sandbox and
        Wildfire. '
      id: 004ff38e-e841-4e64-8d1f-66a778fa2725
      iscommand: false
      name: Detonate and Analyze File - Generic
      playbookId: Detonate and Analyze File - Generic
      type: playbook
      version: -1
    taskid: 004ff38e-e841-4e64-8d1f-66a778fa2725
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 2100
        }
      }
  "47":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.DetonateFile
          operator: isEqualString
          right:
            value:
              simple: "true"
      - - left:
            iscontext: true
            value:
              simple: File.EntryID
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "47"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "45"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Is Detonate Allowed?
      id: 8463ca61-fb65-4f02-832b-f55602e57e3b
      iscommand: false
      name: Is Detonate Allowed?
      type: condition
      version: -1
    taskid: 8463ca61-fb65-4f02-832b-f55602e57e3b
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1940
        }
      }
  "54":
    continueonerrortype: ""
    id: "54"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "97"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 461d7bd4-6605-4f15-8134-4d1bbeb5d06b
      iscommand: false
      name: Conclusion
      type: title
      version: -1
    taskid: 461d7bd4-6605-4f15-8134-4d1bbeb5d06b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2730
        }
      }
  "60":
    continueonerrortype: ""
    id: "60"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: aefe387a-028e-4db2-86bb-de9caa8295f6
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: aefe387a-028e-4db2-86bb-de9caa8295f6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3590
        }
      }
  "62":
    continueonerrortype: ""
    form:
      description: ""
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "0"
        label: ""
        labelarg:
          simple: 'Incident Classification '
        options: []
        optionsarg:
        - simple: Manual
        - simple: True Positive
        - simple: False Positive
        placeholder: ""
        readonly: false
        required: true
        tooltip: ""
        type: singleSelect
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "1"
        label: ""
        labelarg:
          simple: Comment
        options: []
        optionsarg: []
        placeholder: ""
        readonly: false
        required: true
        tooltip: Please enter information
        type: shortText
      sender: ""
      title: Incident Classification
      totalanswers: 0
    id: "62"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body: null
      cc:
        simple: Administrator,Analyst
      format: ""
      methods: []
      replyOptions:
      - True Positive
      - False Positive
      subject:
        simple: Is this incident FP
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to:
        simple: Administrator,Analyst
    nexttasks:
      '#none#':
      - "104"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: False / True Positive
      id: 3def6c4e-c62a-4a42-8f55-77d1e64b25f4
      iscommand: false
      name: False / True Positive
      type: collection
      version: -1
    taskid: 3def6c4e-c62a-4a42-8f55-77d1e64b25f4
    timertriggers: []
    type: collection
    view: |-
      {
        "position": {
          "x": -190,
          "y": 3060
        }
      }
  "78":
    continueonerrortype: ""
    id: "78"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set multiple keys/values to the context.
      id: 325e5a00-138c-49b3-862d-6906c586b023
      iscommand: false
      name: Dedup
      type: title
      version: -1
    taskid: 325e5a00-138c-49b3-862d-6906c586b023
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 190
        }
      }
  "80":
    continueonerrortype: ""
    id: "80"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "54"
    note: false
    quietmode: 0
    scriptarguments:
      appendTags:
        simple: "true"
      severity:
        simple: High
      tags:
        simple: Containment Occured
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 1e7ce1b3-83d5-4a9c-8ff0-9c954cb0aded
      iscommand: true
      name: Raise the incident severity
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 1e7ce1b3-83d5-4a9c-8ff0-9c954cb0aded
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1810
        }
      }
  "86":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Endpoint.Status
          operator: isNotEqualString
          right:
            value:
              simple: Isolated
      label: "yes"
    continueonerrortype: ""
    id: "86"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "26"
      - "27"
      - "91"
      - "112"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if the device is not isolated?
      id: 1ea18ff7-595c-47f4-8402-535a964ba263
      iscommand: false
      name: Check if the device is not isolated?
      type: condition
      version: -1
    taskid: 1ea18ff7-595c-47f4-8402-535a964ba263
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 810
        }
      }
  "91":
    continueonerrortype: ""
    id: "91"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "95"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6fa7ab5e-594e-49b5-8644-f3dbc51a9395
      iscommand: false
      name: Command Line Analysis
      type: title
      version: -1
    taskid: 6fa7ab5e-594e-49b5-8644-f3dbc51a9395
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -20,
          "y": 980
        }
      }
  "92":
    continueonerrortype: ""
    id: "92"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      forEach: true
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "93"
    note: false
    quietmode: 0
    scriptarguments:
      Commandline:
        complex:
          accessor: cmdline
          filters:
          - - left:
                iscontext: true
                value:
                  simple: incident.cmdline
              operator: isNotEmpty
          root: incident
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: incident.parentcmdline
            operator: append
          - args:
              item:
                iscontext: true
                value:
                  simple: incident.processcmd
            operator: append
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: "This playbook takes the command line from the alert and performs
        the following actions:\n - Checks for base64 string and decodes if exists\n
        - Extracts and enriches indicators from the command line\n - Checks specific
        arguments for malicious usage \n\n At the end of the playbook, it sets a possible
        verdict for the command line, based on the finding:\n 1. Indicators found
        in the command line\n 2. Found AMSI techniques\n 3. Found suspicious parameters\n
        4. Usage of malicious tools\n 5. Indication of network activity"
      id: d8afccc1-4ec3-466b-853c-c67a5e4f9612
      iscommand: false
      name: Command-Line Analysis
      playbookId: Command-Line Analysis
      type: playbook
      version: -1
    taskid: d8afccc1-4ec3-466b-853c-c67a5e4f9612
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1290
        }
      }
  "93":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: CommandlineVerdict
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "93"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "94"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Found any suspicious components?
      id: 708210df-2505-465d-8766-91069eb2d3ce
      iscommand: false
      name: Found any suspicious components?
      type: condition
      version: -1
    taskid: 708210df-2505-465d-8766-91069eb2d3ce
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1445
        }
      }
  "94":
    continueonerrortype: ""
    id: "94"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "33"
    note: false
    quietmode: 0
    scriptarguments:
      appendTags:
        simple: "true"
      tags:
        complex:
          root: CommandlineVerdict
          transformers:
          - operator: Stringify
          - args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: '"(\w*)":'
              unpack_matches: {}
            operator: RegexExtractAll
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 19fc3f8e-7fb5-4d74-8203-bf7e17c34744
      iscommand: true
      name: Set Tag `Suspicious Command-line`
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 19fc3f8e-7fb5-4d74-8203-bf7e17c34744
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1635
        }
      }
  "95":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: cmdline
                root: incident
                transformers:
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: incident.parentcmdline
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: incident.processcmd
                  operator: append
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "95"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "92"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Is there a CMD line parameter?
      id: 402f5499-a2d2-4014-8500-99241941201c
      iscommand: false
      name: Is there a CMD line parameter?
      type: condition
      version: -1
    taskid: 402f5499-a2d2-4014-8500-99241941201c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -20,
          "y": 1130
        }
      }
  "96":
    continueonerrortype: ""
    id: "96"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "78"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 09f3defb-3f5d-4a66-8ae5-25d94975adfc
      iscommand: false
      name: Cortex XDR Malware - Incident Enrichment
      playbookId: Cortex XDR Malware - Incident Enrichment
      type: playbook
      version: -1
    taskid: 09f3defb-3f5d-4a66-8ae5-25d94975adfc
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 460,
          "y": 20
        }
      }
  "97":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.EnableClosureSteps
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "97"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "120"
      "yes":
      - "62"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Proceed To Closure Steps?
      id: 60cf2173-58df-4c32-8564-7a61e231ed1a
      iscommand: false
      name: Proceed To Closure Steps?
      type: condition
      version: -1
    taskid: 60cf2173-58df-4c32-8564-7a61e231ed1a
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2890
        }
      }
  "98":
    continueonerrortype: ""
    id: "98"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      CloseSimilar:
        simple: ${inputs.DedupCloseSimilar}
      closeReason:
        simple: Closed by Dedup Playbook within inc ${incident.id}
      fromDate:
        simple: 1 months ago
      handleSimilar:
        simple: ${inputs.DedupHandleSimilar}
      limit:
        simple: ${inputs.DedupLimit}
      method:
        simple: Fields and Indicators
      minimunIncidentSimilarity:
        simple: ${inputs.DedupMinimunIncidentSimilarity}
      query:
        simple: -status:closed -category:job
      showIncidentSimilarityForAllFields:
        simple: "True"
      similarTextField:
        simple: ${inputs.DedupSimilarTextField}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: "This playbook identifies duplicate incidents using the Cortex
        XSOAR machine learning method (script).\nIn this playbook, you can choose
        fields and/or indicators to be compared against other incidents in the Cortex
        XSOAR database. \n\nNote: To identify similar incidents you must *must* properly
        define the playbook inputs. "
      id: 75305d32-d17a-4a42-8505-01569173aee4
      iscommand: false
      name: Dedup - Generic v4
      playbookId: Dedup - Generic v4
      type: playbook
      version: -1
    taskid: 75305d32-d17a-4a42-8505-01569173aee4
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 740,
          "y": 490
        }
      }
  "103":
    continueonerrortype: ""
    id: "103"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "38"
    note: false
    quietmode: 0
    scriptarguments:
      FileSha256:
        simple: ${incident.filesha256}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 5ca9c726-22ff-4ca2-853c-1c19b318d90d
      iscommand: false
      name: Search For Hash In Sandbox - Generic
      playbookId: Search For Hash In Sandbox - Generic
      type: playbook
      version: -1
    taskid: 5ca9c726-22ff-4ca2-853c-1c19b318d90d
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 1090
        }
      }
  "104":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Incident Classification.Answers.0
          operator: containsString
          right:
            value:
              simple: "False"
      label: False Positive
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Incident Classification.Answers.0
          operator: containsString
          right:
            value:
              simple: "true"
      label: True Positive
    continueonerrortype: ""
    id: "104"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "105"
      False Positive:
      - "107"
      True Positive:
      - "106"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check Classification
      id: fcf92b73-092e-49ef-8a19-67515c672c76
      iscommand: false
      name: Check Classification
      type: condition
      version: -1
    taskid: fcf92b73-092e-49ef-8a19-67515c672c76
    timertriggers:
    - action: stop
      fieldname: triagesla
    type: condition
    view: |-
      {
        "position": {
          "x": -190,
          "y": 3220
        }
      }
  "105":
    continueonerrortype: ""
    id: "105"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "60"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manual handling of this incident per your procedures.
      id: 719bc986-7121-480d-8354-22c0aaa60ae7
      iscommand: false
      name: Manual Handling
      type: regular
      version: -1
    taskid: 719bc986-7121-480d-8354-22c0aaa60ae7
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -190,
          "y": 3410
        }
      }
  "106":
    continueonerrortype: ""
    id: "106"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "60"
    note: false
    quietmode: 0
    scriptarguments:
      AutoIsolation:
        simple: ${inputs.AutoIsolation}
      BlockTag:
        simple: ${inputs.MaliciousTagName}
      Classification:
        simple: ${Incident Classification.Answers.0}
      Comment:
        simple: ${Incident Classification.Answers.1}
      TicketProjectName:
        simple: ${inputs.TicketProjectName}
      TicketingSystemToUse:
        simple: ${inputs.TicketingSystemToUse}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: e8cd6314-274d-4efa-834e-751382c736f5
      iscommand: false
      name: Cortex XDR - True Positive Incident Handling
      playbookId: Cortex XDR - True Positive Incident Handling
      type: playbook
      version: -1
    taskid: e8cd6314-274d-4efa-834e-751382c736f5
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -590,
          "y": 3410
        }
      }
  "107":
    continueonerrortype: ""
    id: "107"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "60"
    note: false
    quietmode: 0
    scriptarguments:
      AllowTag:
        simple: ${inputs.BenignTagName}
      AutoUnisolation:
        simple: ${inputs.AutoUnisolation}
      Comment:
        simple: ${Incident Classification.Answers.1}
      FileSha256:
        simple: ${incident.filesha256}
      HostID:
        simple: ${incident.deviceid}
      Reason:
        simple: ${Incident Classification.Answers.0}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 432bd605-be60-4134-8876-13ff94e87f99
      iscommand: false
      name: Cortex XDR - False Positive Incident Handling
      playbookId: Cortex XDR - False Positive Incident Handling
      type: playbook
      version: -1
    taskid: 432bd605-be60-4134-8876-13ff94e87f99
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 220,
          "y": 3410
        }
      }
  "112":
    continueonerrortype: ""
    id: "112"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "115"
      - "118"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0fdf6a06-dba0-4896-8da8-24b713cd7fc4
      iscommand: false
      name: Advanced Hunting
      type: title
      version: -1
    taskid: 0fdf6a06-dba0-4896-8da8-24b713cd7fc4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -680,
          "y": 980
        }
      }
  "113":
    continueonerrortype: ""
    id: "113"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "33"
    note: false
    quietmode: 0
    scriptarguments:
      FileSHA256:
        complex:
          accessor: filesha256
          root: incident
          transformers:
          - operator: uniq
      HuntCnCTechniques:
        simple: "True"
      HuntCollectionTechniques:
        simple: "True"
      HuntDefenseEvasionTechniques:
        simple: "True"
      HuntDiscoveryTechniques:
        simple: "True"
      HuntExecutionTechniques:
        simple: "True"
      HuntImpactTechniques:
        simple: "True"
      HuntInitialAccessTechniques:
        simple: "True"
      HuntLateralMovementTechniques:
        simple: "True"
      HuntPersistenceTechniques:
        simple: "True"
      HuntPrivilegeEscalationTechniques:
        simple: "True"
      HuntReconnaissanceTechniques:
        simple: "True"
      RunAll:
        simple: ${inputs.RunAllHuntMitreTactics}
      agentID:
        complex:
          accessor: deviceid
          root: incident
          transformers:
          - operator: uniq
      timeRange:
        simple: 2 hours ago
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: "This playbook handles all the endpoint investigation actions available
        with Cortex XSIAM, including the following tasks:\n * Pre-defined MITRE Tactics\n
        * Host fields (host ID)\n * Attacker fields (attacker IP, external host)\n
        * MITRE techniques\n * File hash (currently, the playbook supports only SHA256)
        \ \n\n Note: The playbook inputs enable manipulating the execution flow; read
        the input descriptions for details."
      id: 345f6a91-872c-409c-8dae-93d43f0ac554
      iscommand: false
      name: Cortex XDR - Endpoint Investigation
      playbookId: Cortex XDR - Endpoint Investigation
      type: playbook
      version: -1
    taskid: 345f6a91-872c-409c-8dae-93d43f0ac554
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -1140,
          "y": 1310
        }
      }
  "115":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.AdvancedHunting
          operator: isEqualString
          right:
            value:
              simple: "true"
      label: "yes"
    continueonerrortype: ""
    id: "115"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "113"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Should run Advanced Hunting?
      id: 9083ef53-4d2d-4436-8267-bde8dd489537
      iscommand: false
      name: Should run Advanced Hunting?
      type: condition
      version: -1
    taskid: 9083ef53-4d2d-4436-8267-bde8dd489537
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -890,
          "y": 1130
        }
      }
  "116":
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Malware Detailed Investigation Summary
      output:
        simple: ${InvestigationDetailedSummary}
    id: "116"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "54"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Parses attacks from context, and shows them according to the MITRE
        technique they use.
      id: 49983f56-a646-4ac9-8cae-8efcfc60357f
      iscommand: false
      name: Parse Findings From the Sandbox
      script: InvestigationDetailedSummaryParse
      type: regular
      version: -1
    taskid: 49983f56-a646-4ac9-8cae-8efcfc60357f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 2560
        }
      }
  "117":
    continueonerror: true
    continueonerrortype: ""
    id: "117"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "33"
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_ids:
        simple: ${incident.deviceid}
      retry-count:
        simple: "3"
      script_uid:
        simple: 956e8989f67ebcb2c71c4635311e47e4
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Initiates a new endpoint script execution action using a script
        from the script library and returns the results.
      id: 44bbda1c-f785-4912-894a-b99f0c60d0f5
      iscommand: true
      name: Get Device's Process List
      script: '|||xdr-script-run'
      type: regular
      version: -1
    taskid: 44bbda1c-f785-4912-894a-b99f0c60d0f5
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -680,
          "y": 1310
        }
      }
  "118":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: Status
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: Endpoint.ID
                    operator: isEqualString
                    right:
                      iscontext: true
                      value:
                        simple: incident.deviceid
                root: Endpoint
          operator: isEqualString
          right:
            value:
              simple: Online
      label: "yes"
    continueonerrortype: ""
    id: "118"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "117"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if the device is online.
      id: 1f35ed99-bfe2-4acc-8657-15e019a90911
      iscommand: false
      name: Check if the device is online
      type: condition
      version: -1
    taskid: 1f35ed99-bfe2-4acc-8657-15e019a90911
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -470,
          "y": 1130
        }
      }
  "119":
    continueonerrortype: ""
    id: "119"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      forEach: true
      iscommand: false
      max: 100
      wait: 2
    nexttasks:
      '#none#':
      - "47"
    note: false
    quietmode: 0
    scriptarguments:
      Sha256:
        complex:
          root: NonFoundHashes
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        This playbook is part of the 'Malware Investigation And Response' pack. For more information, refer to https://xsoar.pan.dev/docs/reference/packs/malware-investigation-and-response.
        This playbook is a sub-playbook for the Cortex XDR malware investigation flow. In this playbook, we retrieve multiple files from the investigated device (using the Device ID incident field), based on their SHA256 hash.
      id: 88f83c35-be17-4995-8f7c-3795e568ef41
      iscommand: false
      name: Cortex XDR - Retrieve File by sha256
      playbookId: Cortex XDR - Retrieve File by sha256
      type: playbook
      version: -1
    taskid: 88f83c35-be17-4995-8f7c-3795e568ef41
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1775
        }
      }
  "120":
    continueonerrortype: ""
    id: "120"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "60"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: c7d205a3-68cf-476a-887c-6b63c9aaaa3e
      iscommand: false
      name: Stop Triage SLA timer
      type: title
      version: -1
    taskid: c7d205a3-68cf-476a-887c-6b63c9aaaa3e
    timertriggers:
    - action: stop
      fieldname: triagesla
    type: title
    view: |-
      {
        "position": {
          "x": 460,
          "y": 3220
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "31_33_#default#": 0.1,
      "32_33_yes": 0.68,
      "6_8_#default#": 0.5,
      "86_33_#default#": 0.11
    },
    "paper": {
      "dimensions": {
        "height": 3765,
        "width": 3330,
        "x": -1140,
        "y": -110
      }
    }
  }
