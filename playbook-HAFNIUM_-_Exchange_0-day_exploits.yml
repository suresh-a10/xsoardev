contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.5.0
    itemVersion: 1.6.38
    packID: MajorBreachesInvestigationandResponse
    packName: Rapid Breach Response
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: |-
  This playbook includes the following tasks:
  Collect indicators to be used in your threat hunting process Retrieve IOCs related to HAFNIUM and the exploited exchange 0-day vulnerabilities Discover IOCs related to the attack Query firewall logs to detect malicious network activity Search endpoint logs for malicious hashes to detect compromised hosts (Available from Cortex XSOAR 5.5.0). Block indicators Note: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve. Read more about the attack on our Unit42 blog: https://unit42.paloaltonetworks.com/microsoft-exchange-server-vulnerabilities/ Sources: https://www.splunk.com/en_us/blog/security/detecting-hafnium-exchange-server-zero-day-activity-in-splunk.html https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/
id: HAFNIUM - Exchange 0-day exploits
inputs:
- description: "Possible values: True/False.\nWhether to provide user verification
    for blocking IPs. \n\nFalse - No prompt will be displayed to the user.\nTrue -
    The server will ask the user for blocking verification and will display the blocking
    list."
  key: UserVerification
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: |-
    |-
    Should the given indicators be automatically blocked, or should the user be given the option to choose?
    If set to False - no prompt will appear, and all provided indicators will be blocked automatically. If set to True - the user will be prompted to select which indicators to block.
  key: AutoBlockIndicators
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: 'A list of internal IP ranges to check IP addresses against. The comma-separated
    list should be provided in CIDR notation. For example, a list of ranges would
    be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16" (without quotes).'
  key: InternalRange
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: PrivateIPs
      root: lists
      transformers:
      - args:
          error_if_no_match: {}
          ignore_case: {}
          multi_line: {}
          period_matches_newline: {}
          regex:
            value:
              simple: (\b(?:\d{1,3}\.){3}\d{1,3}\b/\d{1,2})
          unpack_matches: {}
        operator: RegexExtractAll
      - args:
          separator:
            value:
              simple: ','
        operator: join
name: HAFNIUM - Exchange 0-day exploits
outputs: []
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 23724197-3ddc-4d4c-86f9-62af787ab59d
      iscommand: false
      name: ""
      version: -1
    taskid: 23724197-3ddc-4d4c-86f9-62af787ab59d
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 470,
          "y": 70
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
      - "6"
      - "34"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: c221171d-22b4-4f75-8a38-e4a296c8a8bc
      iscommand: false
      name: Collect and Enrich IOCs
      type: title
      version: -1
    taskid: c221171d-22b4-4f75-8a38-e4a296c8a8bc
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 470,
          "y": 210
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "73"
    note: false
    quietmode: 0
    reputationcalc: 2
    scriptarguments:
      method:
        simple: GET
      url:
        simple: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sends http request. Returns the response as json to collect the
        indicators from Microsoft blog post
      id: 0851b947-8882-4c02-8cf1-fcead06eec66
      iscommand: false
      name: Retrieve IOCs from Microsoft blog
      script: http
      type: regular
      version: -1
    taskid: 0851b947-8882-4c02-8cf1-fcead06eec66
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 470,
          "y": 370
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "73"
    note: false
    quietmode: 0
    reputationcalc: 2
    scriptarguments:
      method:
        simple: GET
      url:
        simple: https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sends http request. Returns the response as json to collect the
        indicators from Volexity blog post
      id: 5fb7a03a-0f98-4e84-8757-b2b64d3bbce6
      iscommand: false
      name: Retrieve IOCs from Volexity blog
      script: http
      type: regular
      version: -1
    taskid: 5fb7a03a-0f98-4e84-8757-b2b64d3bbce6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 0,
          "y": 370
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "13"
      - "12"
      - "15"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 555f5b82-dd7a-465a-8f88-c83462c87107
      iscommand: false
      name: Tag Indicators
      type: title
      version: -1
    taskid: 555f5b82-dd7a-465a-8f88-c83462c87107
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 470,
          "y": 730
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: CVE
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      tags:
        simple: HAFNIUM, 0Day, ExchangeExploits
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.indicators
      id: f0b1f95e-9ca5-455f-81b0-5aaa35e6e865
      iscommand: true
      name: Tag CVE's indicators
      script: Builtin|||setIndicators
      type: regular
      version: -1
    taskid: f0b1f95e-9ca5-455f-81b0-5aaa35e6e865
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 920,
          "y": 890
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      tags:
        simple: HAFNIUM, 0Day, ExchangeExploits
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.indicators
      id: 088c8c88-7c98-40fa-802a-fe1f126a7522
      iscommand: true
      name: Tag IP's indicators
      script: Builtin|||setIndicators
      type: regular
      version: -1
    taskid: 088c8c88-7c98-40fa-802a-fe1f126a7522
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 470,
          "y": 890
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: File
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      tags:
        simple: HAFNIUM, 0Day, ExchangeExploits
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.indicators
      id: 00aeec53-ca51-4fd9-8741-48256ce90c2c
      iscommand: true
      name: Tag file hashes indicators
      script: Builtin|||setIndicators
      type: regular
      version: -1
    taskid: 00aeec53-ca51-4fd9-8741-48256ce90c2c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 20,
          "y": 890
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "19"
      - "17"
      - "18"
      - "61"
      - "31"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0d74272c-04ef-41a4-84b5-e558e4a36fba
      iscommand: false
      name: Hunt IOCs
      type: title
      version: -1
    taskid: 0d74272c-04ef-41a4-84b5-e558e4a36fba
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1080
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      CVE_ID:
        complex:
          accessor: CVE
          root: ExtractedIndicators
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Hunt for assets with a given CVE using available tools
      id: 912e8f4e-0ee2-42bb-88de-b22cccdbb48b
      iscommand: false
      name: Search Endpoint by CVE - Generic
      playbookId: Search Endpoint by CVE - Generic
      type: playbook
      version: -1
    taskid: 912e8f4e-0ee2-42bb-88de-b22cccdbb48b
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1370
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      MD5Hash:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA1Hash:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "40"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256Hash:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Hunt using available tools
      id: 1fc4b6cb-7580-44cb-86f3-271ae4e6c9df
      iscommand: false
      name: Search Endpoints By Hash - Generic V2
      playbookId: Search Endpoints By Hash - Generic V2
      type: playbook
      version: -1
    taskid: 1fc4b6cb-7580-44cb-86f3-271ae4e6c9df
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 150,
          "y": 1370
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddresses:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: hasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: "This is a multipurpose playbook used for hunting and threat detection.
        The playbook receives inputs based on hashes, IP addresses, or domain names
        provided manually or from outputs by other playbooks. \nWith the received
        indicators, the playbook leverages data received by PANW products including,
        Cortex Data Lake, Autofocus and Pan-OS to search for IP addresses, host names
        and users related to the provided indicators.\nThe output provided by the
        playbook facilitates pivoting searches for possibly affected IP addresses
        or users."
      id: 8c11fd43-d437-4eab-8ed6-5752f9080c74
      iscommand: false
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      version: -1
    taskid: 8c11fd43-d437-4eab-8ed6-5752f9080c74
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1230
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Further investigate the incident (endpoints, the entry point, etc’)
      id: 2e8ee0c9-14be-4281-84ba-205f6d06fdda
      iscommand: false
      name: Investigate further
      type: regular
      version: -1
    taskid: 2e8ee0c9-14be-4281-84ba-205f6d06fdda
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 470,
          "y": 5035
        }
      }
  "24":
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1d312252-568b-479b-87a7-a374268d0594
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 1d312252-568b-479b-87a7-a374268d0594
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 470,
          "y": 5200
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "64"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: xdralerts.name:"Uncommon net group execution" or xdralerts.name:"Multiple
          Discovery Commands" or xdralerts.name:"Exchange process writing aspx files"
          or xdralerts.name:"Behavioral Threat Detected" or xdralerts.name:"Suspicious
          Process Creation" or xdralerts.name:"Uncommon remote service start via sc.exe"
          or xdralerts.name:"Rare SSH Session" or xdralerts.name:"Uncommon ARP cache
          listing via arp.exe" or xdralerts.name:"Uncommon user management via net.exe"
          or xdralerts.name:"WmiPrvSe.exe Rare Child Command Line" or xdralerts.name:"Script
          Connecting to Rare External Host" or xdralerts.name:"Remote process execution
          using WMI" or xdralerts.name:"64-bit PowerShell spawning a 32-bit PowerShell"
          or xdralerts.name:"Suspicious PowerShell Command Line" or xdralerts.name:"Dumping
          Registry hives with passwords"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Search XDR incidents for HAFNIUM
      id: 05318f08-b93b-4eeb-8162-71b9b0bed4d0
      iscommand: false
      name: Search XDR incidents for HAFNIUM activity
      script: SearchIncidentsV2
      type: regular
      version: -1
    taskid: 05318f08-b93b-4eeb-8162-71b9b0bed4d0
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 1985
        }
      }
  "26":
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 99be9722-03ff-4d7f-8b12-96829d11238f
      iscommand: false
      name: 'Remediation '
      type: title
      version: -1
    taskid: 99be9722-03ff-4d7f-8b12-96829d11238f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3260
        }
      }
  "29":
    continueonerrortype: ""
    id: "29"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "30"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 08aa4511-473f-4ead-82d5-bdb7d25ba745
      iscommand: false
      name: Expanse Issues Search
      type: title
      version: -1
    taskid: 08aa4511-473f-4ead-82d5-bdb7d25ba745
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1470,
          "y": 1690
        }
      }
  "30":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: ExpanseV2
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: Active
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "33"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if the Expanse instance is enabled.
      id: 6c41e9e8-a326-44ab-8494-d930b98f249c
      iscommand: false
      name: 'Is Expanse enabled? '
      type: condition
      version: -1
    taskid: 6c41e9e8-a326-44ab-8494-d930b98f249c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1470,
          "y": 1810
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "32"
      - "52"
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a4658468-e6cc-4151-89b6-a43768122dbd
      iscommand: false
      name: Search Activities Related To the 0-Day Exploits
      type: title
      version: -1
    taskid: a4658468-e6cc-4151-89b6-a43768122dbd
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 1540
        }
      }
  "32":
    continueonerrortype: ""
    id: "32"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "46"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7d21b118-b31d-43af-83bc-de2affaa5222
      iscommand: false
      name: XDR Related Incidents
      type: title
      version: -1
    taskid: 7d21b118-b31d-43af-83bc-de2affaa5222
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 890,
          "y": 1690
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "63"
    note: false
    quietmode: 0
    scriptarguments:
      issue_type:
        simple: Microsoft OWA Server, Microsoft Exchange Server, Insecure Microsoft
          Exchange Server
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Retrieve issues
      id: 22319772-3a5f-4319-87ea-293150f8c51e
      iscommand: true
      name: Search issues related to Exchange and OWA
      script: '|||expanse-get-issues'
      type: regular
      version: -1
    taskid: 22319772-3a5f-4319-87ea-293150f8c51e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1730,
          "y": 1985
        }
      }
  "34":
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "73"
    note: false
    quietmode: 0
    scriptarguments:
      method:
        simple: GET
      url:
        simple: https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Sample%20Data/Feeds/MSTICIoCs-ExchangeServerVulnerabilitiesDisclosedMarch2021.csv
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sends http request. Returns the response as json.
      id: d0b29943-dba8-41e6-8a2d-183fdef37261
      iscommand: false
      name: Retrieve indicators from Azure GitHub
      script: http
      type: regular
      version: -1
    taskid: d0b29943-dba8-41e6-8a2d-183fdef37261
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 940,
          "y": 370
        }
      }
  "35":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.AutoBlockIndicators
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "74"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether IOCs associated with the incident can be blocked
        automatically.
      id: 650c74ff-19bc-45ee-8387-f43a89de29f6
      iscommand: false
      name: Block indicators automatically?
      type: condition
      version: -1
    taskid: 650c74ff-19bc-45ee-8387-f43a89de29f6
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3490
        }
      }
  "36":
    continueonerrortype: ""
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "37"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manually block the IOCs in the relevant systems.
      id: 5d7c31c2-5278-4feb-8925-67085c003173
      iscommand: false
      name: Manually block indicators
      type: regular
      version: -1
    taskid: 5d7c31c2-5278-4feb-8925-67085c003173
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 210,
          "y": 3680
        }
      }
  "37":
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "38"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 34307bab-7bbc-4d7b-87db-207786e132f2
      iscommand: false
      name: Check Patch Level
      type: title
      version: -1
    taskid: 34307bab-7bbc-4d7b-87db-207786e132f2
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3850
        }
      }
  "38":
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      "No":
      - "40"
      "Yes":
      - "39"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Is the Exchange patched with the March 2021 security updates?\nIf
        needed, refer to the Microsoft post about the patches: \nhttps://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901\n "
      id: 0da9ab04-aea3-4d68-827e-f4be717d3d33
      iscommand: false
      name: Check patch levels of Exchange Server
      type: condition
      version: -1
    taskid: 0da9ab04-aea3-4d68-827e-f4be717d3d33
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4000
        }
      }
  "39":
    continueonerrortype: ""
    id: "39"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "44"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: ExchangesPatched
      value:
        simple: "True"
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Sets Exchange patched flag to true.
      id: 36f3308c-e690-4d00-8a3d-374e59a53ef0
      iscommand: false
      name: Set Exchange patched flag to true
      script: Set
      type: regular
      version: -1
    taskid: 36f3308c-e690-4d00-8a3d-374e59a53ef0
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 210,
          "y": 4180
        }
      }
  "40":
    continueonerrortype: ""
    id: "40"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "44"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: ExchangesPatched
      value:
        simple: "False"
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Sets Exchange patched flag to false.
      id: 8b7f376b-5b7d-457a-8c87-71b69591f9e3
      iscommand: false
      name: Set Exchange patched flag to false
      script: Set
      type: regular
      version: -1
    taskid: 8b7f376b-5b7d-457a-8c87-71b69591f9e3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 720,
          "y": 4180
        }
      }
  "41":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: ExchangesPatched
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "41"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "42"
      "yes":
      - "23"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks the user answer if the Exchange Server patched
      id: b50533ab-561a-4f4b-86d3-5a7582aaa4f2
      iscommand: false
      name: Is the Exchange Server patched?
      type: condition
      version: -1
    taskid: b50533ab-561a-4f4b-86d3-5a7582aaa4f2
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4510
        }
      }
  "42":
    continueonerrortype: ""
    id: "42"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      "No":
      - "45"
      "Yes":
      - "43"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check whether it is possible to patch the Exchange Server
      id: 9286e773-b14d-430d-8489-b5a0bcc0f36b
      iscommand: false
      name: Is it possible to patch the Exchange Server?
      type: condition
      version: -1
    taskid: 9286e773-b14d-430d-8489-b5a0bcc0f36b
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 4690
        }
      }
  "43":
    continueonerrortype: ""
    id: "43"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "23"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        The March 2021 security patches found here:
        https://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901
      id: 0d7d13b7-690d-464f-8e73-66ac2d7e92f4
      iscommand: false
      name: Install March 2021 Exchange security patches
      type: regular
      version: -1
    taskid: 0d7d13b7-690d-464f-8e73-66ac2d7e92f4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 230,
          "y": 4860
        }
      }
  "44":
    continueonerrortype: ""
    id: "44"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "41"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 11fe1ea6-3119-47b4-82fc-9351b7ae858a
      iscommand: false
      name: Mitigation
      type: title
      version: -1
    taskid: 11fe1ea6-3119-47b4-82fc-9351b7ae858a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4350
        }
      }
  "45":
    continueonerrortype: ""
    id: "45"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "23"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Follow the Microsoft blog post about the interim mitigations.\nThe
        blog post explains how to configure the interim mitigations and their rollback
        if needed. \nhttps://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021/\n\nNotes:\n-
        These mitigations are not a remediation if your Exchange servers have already
        been compromised, nor are they full protection against an attack.\n- This
        should only be used as a temporary mitigation until Exchange servers can be
        fully patched. \n"
      id: 2c9da488-1bb4-44e9-8d41-efa87042f141
      iscommand: false
      name: Interim mitigations
      type: regular
      version: -1
    taskid: 2c9da488-1bb4-44e9-8d41-efa87042f141
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -260,
          "y": 4860
        }
      }
  "46":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Cortex XDR - IR
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "46"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "25"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if the Cortex XDR instance is enabled.
      id: 83b0f1b8-bbb8-4ec2-812f-9b5d05bcdcf3
      iscommand: false
      name: 'Is Cortex XDR enabled? '
      type: condition
      version: -1
    taskid: 83b0f1b8-bbb8-4ec2-812f-9b5d05bcdcf3
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 890,
          "y": 1810
        }
      }
  "47":
    continueonerrortype: ""
    id: "47"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "48"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1ec43324-e0c1-4c72-8875-bd281293fdc0
      iscommand: false
      name: 'Manually Hunt Windows Event Logs '
      type: title
      version: -1
    taskid: 1ec43324-e0c1-4c72-8875-bd281293fdc0
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2210,
          "y": 2000
        }
      }
  "48":
    continueonerrortype: ""
    id: "48"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "49"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Look for Nishang Invoke-PowerShellTcpOneLine in Windows Event Logging:

        SecurityEvent  | where EventID == 4688  | where Process has_any ("powershell.exe", "PowerShell_ISE.exe")  | where CommandLine has "$client = New-Object System.Net.Sockets.TCPClient"

        Splunk query example:

        index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104 Message="* Invoke-PowerShellTCP*"

        index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688 Creator_Process_Name="powershell.exe" System.Net.Sockets.TCPClient
      id: 8a97955f-7d4c-4915-82f6-0538b9481217
      iscommand: false
      name: Nishang PowerShell framework
      type: regular
      version: -1
    taskid: 8a97955f-7d4c-4915-82f6-0538b9481217
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2210,
          "y": 2140
        }
      }
  "49":
    continueonerrortype: ""
    id: "49"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "50"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Look for downloads of PowerCat in cmd and Powershell command line logging in Windows Event Logs:

        SecurityEvent  | where EventID == 4688  | where Process has_any ("cmd.exe", "powershell.exe", "PowerShell_ISE.exe")  | where CommandLine has "https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1"

        Splunk query example:
        index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104 Message="*powercat*"
      id: fedada54-ba62-4843-881c-eb4c74163ad6
      iscommand: false
      name: Powercat detection
      type: regular
      version: -1
    taskid: fedada54-ba62-4843-881c-eb4c74163ad6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2210,
          "y": 2320
        }
      }
  "50":
    continueonerrortype: ""
    id: "50"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "51"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Look for Microsoft Exchange Server’s Unified Messaging service
        creating non-standard content on disk, which could indicate web shells or
        other malicious content, suggesting exploitation of CVE-2021-26858 vulnerability:\n\nDeviceFileEvents
        | where InitiatingProcessFileName == \"UMWorkerProcess.exe\" | where FileName
        != \"CacheCleanup.bin\" | where FileName !endswith \".txt\" | where FileName
        !endswith \".LOG\" | where FileName !endswith \".cfg\" | where FileName !=
        \"cleanup.bin\"\n\nSplunk query example:\nindex=* sourcetype=WinEventLog source=\"WinEventLog:Security\"
        EventCode=4663 Object_Type=\"File\" (Object_Name=\"*.php\" OR Object_Name=\"*.jsp\"
        OR Object_Name=\"*.js\" OR Object_Name=\"*.aspx\" OR Object_Name=\"*.asmx\"
        OR Object_Name=\"*.cfm\" OR Object_Name=\"*.shtml\") (Process_Name=\"*umworkerprocess.exe*\"
        OR Process_Name=\"*UMService.exe*\") \n"
      id: 7bed501c-fcdc-4c76-8236-0775fa91f492
      iscommand: false
      name: UMWorkerProcess.exe in Exchange creating abnormal content
      type: regular
      version: -1
    taskid: 7bed501c-fcdc-4c76-8236-0775fa91f492
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2210,
          "y": 2500
        }
      }
  "51":
    continueonerrortype: ""
    id: "51"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "57"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Look for Microsoft Exchange Server’s Unified Messaging service spawning abnormal subprocesses, suggesting exploitation of CVE-2021-26857 vulnerability:

        DeviceProcessEvents | where InitiatingProcessFileName == "UMWorkerProcess.exe" | where FileName != "wermgr.exe" | where FileName != "WerFault.exe"

        Splunk Query example:
        index=* sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688 (Creator_Process_Name="*umworkerprocess.exe*" OR Creator_Process_Name="*UMService.exe*") NOT New_Process_Name="*UMWorkerProcess.exe*"
      id: af589419-1059-4cd8-85ff-917c122a842e
      iscommand: false
      name: UMWorkerProcess.exe spawning
      type: regular
      version: -1
    taskid: af589419-1059-4cd8-85ff-917c122a842e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2210,
          "y": 2680
        }
      }
  "52":
    continueonerrortype: ""
    id: "52"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "59"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 93265b0c-9f91-465d-8d63-42b1808d5586
      iscommand: false
      name: Hunt Windows Events
      type: title
      version: -1
    taskid: 93265b0c-9f91-465d-8d63-42b1808d5586
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 1690
        }
      }
  "53":
    continueonerrortype: ""
    id: "53"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "60"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104
          Message="* Invoke-PowerShellTCP*"
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches Splunk for events.
      id: 28e4eb5b-e158-4e84-8f50-5fcc25a95952
      iscommand: true
      name: Nishang PowerShell event 4104
      script: '|||splunk-search'
      type: regular
      version: -1
    taskid: 28e4eb5b-e158-4e84-8f50-5fcc25a95952
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 2140
        }
      }
  "54":
    continueonerrortype: ""
    id: "54"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "55"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104
          Message="*powercat*"
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches Splunk for events.
      id: 7cb58baa-5d8a-475f-867a-43ecb6269d3b
      iscommand: true
      name: Powercat detection
      script: '|||splunk-search'
      type: regular
      version: -1
    taskid: 7cb58baa-5d8a-475f-867a-43ecb6269d3b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 2500
        }
      }
  "55":
    continueonerrortype: ""
    id: "55"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "56"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: 'index=* sourcetype=WinEventLog source="WinEventLog:Security" EventCode=4663
          Object_Type="File" (Object_Name="*.php" OR Object_Name="*.jsp" OR Object_Name="*.js"
          OR Object_Name="*.aspx" OR Object_Name="*.asmx" OR Object_Name="*.cfm" OR
          Object_Name="*.shtml") (Process_Name="*umworkerprocess.exe*" OR Process_Name="*UMService.exe*") '
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches Splunk for events.
      id: ba412446-8bf3-476f-869a-42762c873825
      iscommand: true
      name: UMWorkerProcess.exe in Exchange creating abnormal content
      script: '|||splunk-search'
      type: regular
      version: -1
    taskid: ba412446-8bf3-476f-869a-42762c873825
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 2680
        }
      }
  "56":
    continueonerrortype: ""
    id: "56"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "58"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: index=* sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688
          (Creator_Process_Name="*umworkerprocess.exe*" OR Creator_Process_Name="*UMService.exe*")
          NOT New_Process_Name="*UMWorkerProcess.exe*"
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches Splunk for events.
      id: 19b74702-83fd-415b-8cee-49dfc6578c38
      iscommand: true
      name: UMWorkerProcess.exe spawning
      script: '|||splunk-search'
      type: regular
      version: -1
    taskid: 19b74702-83fd-415b-8cee-49dfc6578c38
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 2860
        }
      }
  "57":
    continueonerrortype: ""
    id: "57"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Look for Microsoft Exchange Server’s Unified Messaging service spawning abnormal subprocesses, suggesting exploitation of CVE-2021-26857 vulnerability:

        DeviceProcessEvents | where InitiatingProcessFileName == "UMWorkerProcess.exe" | where FileName != "wermgr.exe" | where FileName != "WerFault.exe"

        Splunk Query example:
        index=* sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688 (Creator_Process_Name="*umworkerprocess.exe*" OR Creator_Process_Name="*UMService.exe*") NOT New_Process_Name="*UMWorkerProcess.exe*"
      id: 4b99ee3e-bd3d-4b62-8838-d921c34e190d
      iscommand: false
      name: IIS authentication bypass vulnerability
      type: regular
      version: -1
    taskid: 4b99ee3e-bd3d-4b62-8838-d921c34e190d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2210,
          "y": 2860
        }
      }
  "58":
    continueonerrortype: ""
    id: "58"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: |-
          index=* sourcetype="ms:iis:auto" http_method=POST uri_path="/owa/auth/Current/themes/resources/*"
          | stats count by src_ip, http_user_agent, uri_path, http_method, uri_query
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches Splunk for events.
      id: 400ec611-fe38-44d3-826b-02e9d747859f
      iscommand: true
      name: IIS authentication bypass vulnerability
      script: '|||splunk-search'
      type: regular
      version: -1
    taskid: 400ec611-fe38-44d3-826b-02e9d747859f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 3050
        }
      }
  "59":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: state
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: SplunkPy
                root: modules
          operator: isEqualString
          right:
            value:
              simple: active
      label: Splunk
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: state
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: QRadar_v2
                root: modules
          operator: isEqualString
          right:
            value:
              simple: active
      label: Qradar
    continueonerrortype: ""
    id: "59"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "47"
      Qradar:
      - "67"
      Splunk:
      - "66"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Returns 'yes' if integration brand is available. Otherwise returns
        'no'
      id: 806e022a-9d4d-408d-8ac7-8a5e174dafa9
      iscommand: false
      name: Is SIEM Enabled?
      type: condition
      version: -1
    taskid: 806e022a-9d4d-408d-8ac7-8a5e174dafa9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 1810
        }
      }
  "60":
    continueonerrortype: ""
    id: "60"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "54"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688
          Creator_Process_Name="powershell.exe" System.Net.Sockets.TCPClient
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches Splunk for events.
      id: 9ebf3494-6f23-4b77-899f-6ae43b3db35c
      iscommand: true
      name: Nishang PowerShell event 4688
      script: '|||splunk-search'
      type: regular
      version: -1
    taskid: 9ebf3494-6f23-4b77-899f-6ae43b3db35c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 2320
        }
      }
  "61":
    continueonerrortype: ""
    id: "61"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "62"
      - "65"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8ba9d00f-6a49-4b48-8f4c-f6a2c0bc3959
      iscommand: false
      name: SIEM Indicators Hunting
      type: title
      version: -1
    taskid: 8ba9d00f-6a49-4b48-8f4c-f6a2c0bc3959
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -110,
          "y": 1540
        }
      }
  "62":
    continueonerrortype: ""
    id: "62"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      IndexName:
        simple: '*'
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SelectFields:
        simple: source,timestamp
      earliest_time:
        simple: -1d
      event_limit:
        simple: "100"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook queries Splunk for indicators such as file hashes,
        IP addresses, domains, or urls. It outputs detected users, ip addresses, and
        hostnames related to the indicators.
      id: 6700d586-5574-490b-8310-835b5fbb402d
      iscommand: false
      name: Splunk Indicator Hunting
      playbookId: Splunk Indicator Hunting
      type: playbook
      version: -1
    taskid: 6700d586-5574-490b-8310-835b5fbb402d
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 120,
          "y": 1690
        }
      }
  "63":
    continueonerrortype: ""
    id: "63"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "64"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: type:"Expanse Issue" and name:Insecure Microsoft IIS Web or name:Microsoft
          Exchange Server or name:Microsoft OWA Server
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches for Expanse related incidents
      id: 2b2f0ced-3b95-4850-88f2-c3d803f14210
      iscommand: false
      name: Search for related Expanse incident
      script: SearchIncidentsV2
      type: regular
      version: -1
    taskid: 2b2f0ced-3b95-4850-88f2-c3d803f14210
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1730,
          "y": 2140
        }
      }
  "64":
    continueonerrortype: ""
    id: "64"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      linkedIncidentIDs:
        complex:
          accessor: id
          root: foundIncidents
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Link related Expanse and Cortex XDR incident to HAFNIUM incident,
      id: 451c142c-b9b4-4c35-8ab7-3be304c8692e
      iscommand: true
      name: Link related incidents
      script: Builtin|||linkIncidents
      type: regular
      version: -1
    taskid: 451c142c-b9b4-4c35-8ab7-3be304c8692e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1420,
          "y": 2320
        }
      }
  "65":
    continueonerrortype: ""
    id: "65"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      InternalRange:
        simple: ${inputs.InternalRange}
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      QradarIPfield:
        simple: sourceip,destinationip
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      TimeFrame:
        simple: LAST 7 DAYS
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: 'The Playbook queries QRadar SIEM for indicators such as file hashes,
        IP addresses, domains, or urls. '
      id: 32533035-a3f1-40e8-856a-3929716ba852
      iscommand: false
      name: QRadar Indicator Hunting V2
      playbookId: QRadar Indicator Hunting V2
      type: playbook
      version: -1
    taskid: 32533035-a3f1-40e8-856a-3929716ba852
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -330,
          "y": 1690
        }
      }
  "66":
    continueonerrortype: ""
    id: "66"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "53"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0aac6bf1-07e7-4a18-8c6a-4f3b03f4cf01
      iscommand: false
      name: Hunt Using Splunk
      type: title
      version: -1
    taskid: 0aac6bf1-07e7-4a18-8c6a-4f3b03f4cf01
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2710,
          "y": 2000
        }
      }
  "67":
    continueonerrortype: ""
    id: "67"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "68"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1790a168-6f54-4824-84e3-236a5875576a
      iscommand: false
      name: Hunt Using Qradar
      type: title
      version: -1
    taskid: 1790a168-6f54-4824-84e3-236a5875576a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 3280,
          "y": 2000
        }
      }
  "68":
    continueonerrortype: ""
    id: "68"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "69"
    note: false
    quietmode: 0
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4688%'  and UTF8(payload)
          LIKE '%powershell.exe%' and UTF8(payload) LIKE '%System.Net.Sockets.TCPClient%'  Last
          7 days
      timeout:
        simple: "600"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      id: 78c25af9-ce4e-4fc3-80ee-5b3a618f20a6
      iscommand: false
      name: QRadarFullSearch
      playbookId: QRadarFullSearch
      type: playbook
      version: -1
    taskid: 78c25af9-ce4e-4fc3-80ee-5b3a618f20a6
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 3280,
          "y": 2140
        }
      }
  "69":
    continueonerrortype: ""
    id: "69"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "70"
    note: false
    quietmode: 0
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4104%' and UTF8(payload)
          LIKE '% Invoke-PowerShellTCP%'  Last 7 days
      timeout:
        simple: "600"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      id: 77bf00db-c194-408f-8320-550fe23f0bbc
      iscommand: false
      name: QRadarFullSearch
      playbookId: QRadarFullSearch
      type: playbook
      version: -1
    taskid: 77bf00db-c194-408f-8320-550fe23f0bbc
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 3280,
          "y": 2320
        }
      }
  "70":
    continueonerrortype: ""
    id: "70"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "71"
    note: false
    quietmode: 0
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4104%' and UTF8(payload)
          LIKE '% powercat%' Last 7 days
      timeout:
        simple: "600"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      id: d9df6e57-2823-451b-8eba-124b6944e91b
      iscommand: false
      name: QRadarFullSearch
      playbookId: QRadarFullSearch
      type: playbook
      version: -1
    taskid: d9df6e57-2823-451b-8eba-124b6944e91b
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 3280,
          "y": 2500
        }
      }
  "71":
    continueonerrortype: ""
    id: "71"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "72"
    note: false
    quietmode: 0
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4633%' and ( UTF8(payload)
          LIKE '%.php%' or UTF8(payload) LIKE '%.jsp%' or UTF8(payload) LIKE '%.js%'
          or UTF8(payload) LIKE '%.aspx%' or UTF8(payload) LIKE '%.asmx%' or UTF8(payload)
          LIKE '%.cfm%' or UTF8(payload) LIKE '%.shtlm%') AND ( UTF8(payload) LIKE
          '%umworkerprocess.exe%' or UTF8(payload) LIKE '%UMService.exe%')  Last 7
          days
      timeout:
        simple: "600"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook runs a QRadar query and return its results to the
        context.
      id: b5541854-af48-45a2-8a12-0833d2723350
      iscommand: false
      name: QRadarFullSearch
      playbookId: QRadarFullSearch
      type: playbook
      version: -1
    taskid: b5541854-af48-45a2-8a12-0833d2723350
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 3280,
          "y": 2680
        }
      }
  "72":
    continueonerrortype: ""
    id: "72"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          IIS' and UTF8(payload) LIKE '%POST%' and UTF8(payload) LIKE '%/owa/auth/Current/themes/resources/*%'
          Last 7 days
      timeout:
        simple: "600"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: This playbook runs a QRadar query and return its results to the
        context.
      id: 22f325df-6b94-47ea-87f0-f8bcecadea52
      iscommand: false
      name: QRadarFullSearch
      playbookId: QRadarFullSearch
      type: playbook
      version: -1
    taskid: 22f325df-6b94-47ea-87f0-f8bcecadea52
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 3280,
          "y": 2860
        }
      }
  "73":
    continueonerrortype: ""
    id: "73"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    scriptarguments:
      text:
        complex:
          accessor: Body
          root: HttpRequest.Response
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.extract.indicators
      id: a9793c85-9c17-4636-8ed6-f225729d602a
      iscommand: true
      name: Extract IOCs from blogs
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: a9793c85-9c17-4636-8ed6-f225729d602a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 470,
          "y": 550
        }
      }
  "74":
    continueonerrortype: ""
    id: "74"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "37"
    note: false
    quietmode: 0
    scriptarguments:
      AutoBlockIndicators:
        complex:
          root: inputs.AutoBlockIndicators
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      IP:
        complex:
          root: ExtractedIndicators.IP
          transformers:
          - operator: uniq
      InputEnrichment:
        simple: "False"
      MD5:
        complex:
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      RuleDirection:
        simple: outbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      SHA256:
        complex:
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      URL:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: url
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      UserVerification:
        complex:
          root: inputs.UserVerification
      Username:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: username
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 1356ae2b-c816-426f-8da5-91e1c68ec65b
      iscommand: false
      name: Block Indicators - Generic v3
      playbookId: Block Indicators - Generic v3
      type: playbook
      version: -1
    taskid: 1356ae2b-c816-426f-8da5-91e1c68ec65b
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 740,
          "y": 3680
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "30_26_#default#": 0.12,
      "41_23_yes": 0.21,
      "41_42_#default#": 0.33,
      "46_26_#default#": 0.16
    },
    "paper": {
      "dimensions": {
        "height": 5195,
        "width": 3990,
        "x": -330,
        "y": 70
      }
    }
  }
