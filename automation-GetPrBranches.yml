comment: Field-display script that gets the branch names from "Pull Request Creation"
  incidents to use in the "Pull Request Branch" incident field.
commonfields:
  id: GetPrBranches
  version: -1
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.0.0
    itemVersion: 1.2.23
    packID: ContentManagement
    packName: XSOAR CI/CD
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
dockerimage: demisto/python3:3.10.13.86272
enabled: true
engineinfo: {}
mainengineinfo: {}
name: GetPrBranches
pswd: ""
runas: DBotWeakRole
runonce: false
script: |
  register_module_line('GetPrBranches', 'start', __line__())
  ### pack version: 1.2.23




  ''' MAIN FUNCTION '''


  def main():
      try:
          branches = ['']

          res = execute_command('GetIncidentsByQuery', {'incidentTypes': "Pull Request Creation"})

          incidents_from_query = json.loads(res)
          for incident in incidents_from_query:
              branch = incident.get('CustomFields', {}).get('cicdbranch')
              if branch:
                  branches.append(branch)

          output = {"hidden": False, "options": sorted(branches)}
          return_results(output)

      except Exception as ex:
          demisto.error(str(ex))  # print the traceback
          return_error(f'Failed to execute script. Error: {ex}', error=ex)


  ''' ENTRY POINT '''


  if __name__ in ('__main__', '__builtin__', 'builtins'):
      main()

  register_module_line('GetPrBranches', 'end', __line__())
scripttarget: 0
subtype: python3
system: true
tags:
- field-display
type: python
