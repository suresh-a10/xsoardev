contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.5.0
    itemVersion: 3.0.2
    packID: qualys
    packName: Qualys
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: |-
  Use the latest Qualys report to manage vulnerabilities.

  This playbook runs as a job, and by default creates incidents of type "Vulnerability" based on assets and vulnerabilities.
  The incidents are created from the latest version of the report determined by the report timestamp.
  You can define the minimum severity (minSeverity) that incidents are created for.
  Duplicate incidents are not created for the same asset ID and QID.

  This playbook is a part of a series of playbooks for Qualys vulnerability management and remediation.
  For this series of playbooks to run successfully, create a Job and do the following:
  1. Assign this playbook to the Job
  2. Enter the Qualys XML report name into the "Details" field
  3. Associate the "Vulnerability" type incident to the "Vulnerability Handling - Qualys" playbook.
id: Vulnerability Management - Qualys (Job) - V2
inputs:
- description: "The report title as it appears in Qualys.\nHas to be in XML format. "
  key: QualysReportTitle
  playbookInputQuery: null
  required: true
  value:
    complex:
      accessor: details
      root: incident
- description: The minimum Qualys severity (1 -5) to create incidents for
  key: MinSeverity
  playbookInputQuery: null
  required: true
  value:
    simple: "3"
name: Vulnerability Management - Qualys (Job) - V2
outputs: []
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7f961527-fa7b-45be-89e9-774498cd01d2
      iscommand: false
      name: ""
      version: -1
    taskid: 7f961527-fa7b-45be-89e9-774498cd01d2
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 285,
          "y": 50
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: QualysV2
      description: Get a list of generated reports in the system
      id: 22eb1f09-3413-41f1-8033-d1b9577514e3
      iscommand: true
      name: Get Qualys reports list
      script: QualysV2|||qualys-report-list
      type: regular
      version: -1
    taskid: 22eb1f09-3413-41f1-8033-d1b9577514e3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 397.5,
          "y": 515
        }
      }
  "3":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: ID
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: QualysReport.TITLE
                    operator: isEqualString
                    right:
                      iscontext: true
                      value:
                        simple: inputs.QualysReportTitle
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: QualysReport.STATUS.STATE
                    operator: isEqualString
                    right:
                      value:
                        simple: Finished
                - - left:
                      iscontext: true
                      value:
                        simple: QualysReport.OUTPUT_FORMAT
                    operator: isEqualString
                    right:
                      value:
                        simple: XML
                root: QualysReport
          operator: isExists
      label: "YES"
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "5"
      "YES":
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if there's a Qualys report that matches the input report
        name and is in XML format.
      id: 7dff1f52-0355-446f-8ddd-55fb208102bf
      iscommand: false
      name: Is there a valid report?
      type: condition
      version: -1
    taskid: 7dff1f52-0355-446f-8ddd-55fb208102bf
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 510,
          "y": 1040
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6d394517-98d9-4c1d-875f-ef64434a182c
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 6d394517-98d9-4c1d-875f-ef64434a182c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 285,
          "y": 1885
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: d06386dc-5eb7-4039-8202-28a535bc1b2a
      iscommand: false
      name: Create incidents from the Qualys report
      type: title
      version: -1
    taskid: d06386dc-5eb7-4039-8202-28a535bc1b2a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 622.5,
          "y": 1390
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      entryID:
        complex:
          accessor: EntryID
          filters:
          - - left:
                iscontext: true
                value:
                  simple: InfoFile.Info
              operator: isEqualString
              right:
                value:
                  simple: application/xml
            - left:
                iscontext: true
                value:
                  simple: InfoFile.Info
              operator: isEqualString
              right:
                value:
                  simple: text/xml; charset=utf-8
          root: InfoFile
      minSeverity:
        simple: ${inputs.MinSeverity}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Create incidents from a Qualys report (XML), based on the Qualys asset ID and vulnerability ID (QID).
        Duplicate incidents are not created for the same asset ID and QID.
      id: c6fd6734-160c-4750-8710-663831ff092b
      iscommand: false
      name: Create incidents from the Qualys report
      script: QualysCreateIncidentFromReport
      type: regular
      version: -1
    taskid: c6fd6734-160c-4750-8710-663831ff092b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 622.5,
          "y": 1535
        }
      }
  "10":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: QualysV2
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "16"
      "yes":
      - "15"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Verify that there's a valid instance of Qualys enabled.
      id: a70301a2-a319-4b6d-8edd-17c38b1410f9
      iscommand: false
      name: Is Qualys enabled?
      type: condition
      version: -1
    taskid: a70301a2-a319-4b6d-8edd-17c38b1410f9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 285,
          "y": 195
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    scriptarguments:
      file_format:
        simple: xml
      id:
        complex:
          accessor: ID
          filters:
          - - left:
                iscontext: true
                value:
                  simple: QualysReport.TITLE
              operator: isEqualString
              right:
                iscontext: true
                value:
                  simple: inputs.QualysReportTitle
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: QualysReport.STATUS.STATE
              operator: isEqualString
              right:
                value:
                  simple: Finished
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: QualysReport.OUTPUT_FORMAT
              operator: isEqualString
              right:
                value:
                  simple: XML
          root: QualysReport
          transformers:
          - args:
              index:
                value:
                  simple: "0"
            operator: atIndex
    separatecontext: false
    skipunavailable: false
    task:
      brand: QualysV2
      description: Download report
      id: 5dec9d38-45d4-4310-8164-b2fa5205ee03
      iscommand: true
      name: Get report
      script: QualysV2|||qualys-report-fetch
      type: regular
      version: -1
    taskid: 5dec9d38-45d4-4310-8164-b2fa5205ee03
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 622.5,
          "y": 1215
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: QualysReport
      value:
        complex:
          accessor: Report
          root: Qualys
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: 'Set the Qualys reports list into context. '
      id: 4a963bb8-5c10-4e11-8b9a-8175631ddb97
      iscommand: false
      name: Set context
      script: Set
      type: regular
      version: -1
    taskid: 4a963bb8-5c10-4e11-8b9a-8175631ddb97
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 510,
          "y": 865
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Close the investigation.
      id: b0d591d2-0284-4904-8e79-97e1eaf96134
      iscommand: true
      name: Close Investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: b0d591d2-0284-4904-8e79-97e1eaf96134
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 622.5,
          "y": 1710
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0e767276-5a35-4381-8498-86f7207cfcee
      iscommand: false
      name: Get report from Qualys
      type: title
      version: -1
    taskid: 0e767276-5a35-4381-8498-86f7207cfcee
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 397.5,
          "y": 370
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      message:
        simple: Qualys integration instance is not enabled
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Prints an error entry with a given message
      id: 6915e155-700d-41f3-8416-dd85f2fc79d1
      iscommand: false
      name: PrintErrorEntry
      script: PrintErrorEntry
      type: regular
      version: -1
    taskid: 6915e155-700d-41f3-8416-dd85f2fc79d1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1710
        }
      }
  "17":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: ID
                root: Qualys.Report
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if any report was returned from Qualys
      id: 00b2d65f-9aae-4b06-88c4-ead7b0d26cba
      iscommand: false
      name: Is there any report?
      type: condition
      version: -1
    taskid: 00b2d65f-9aae-4b06-88c4-ead7b0d26cba
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 397.5,
          "y": 690
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "17_5_#default#": 0.5,
      "3_5_#default#": 0.9
    },
    "paper": {
      "dimensions": {
        "height": 1900,
        "width": 952.5,
        "x": 50,
        "y": 50
      }
    }
  }
