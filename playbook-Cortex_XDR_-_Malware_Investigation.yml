contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.0.0
    itemVersion: 6.1.65
    packID: CortexXDR
    packName: Cortex XDR by Palo Alto Networks
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: |-
  Investigates a Cortex XDR incident containing internal malware alerts. The playbook:
  - Enriches the infected endpoint details.
  - The analyst can manually retrieve the malicious file.
  - Performs file detonation.

  The playbook is used as a sub- playbook in ‘Cortex XDR Incident Handling - v2’.
id: Cortex XDR - Malware Investigation
inputs:
- description: Unique ID for the XDR alert.
  key: xdr_alert_id
  playbookInputQuery: null
  required: false
  value: {}
- description: Host IP involved in the alert.
  key: host_ip
  playbookInputQuery: null
  required: false
  value: {}
- description: The name of the malicious file.
  key: file_name
  playbookInputQuery: null
  required: false
  value: {}
- description: SHA-256 hash of the file.
  key: file_sha256
  playbookInputQuery: null
  required: false
  value: {}
- description: Full Path of the file.
  key: file_path
  playbookInputQuery: null
  required: false
  value: {}
- description: the endpoint_id
  key: endpoint_id
  playbookInputQuery: null
  required: false
  value: {}
name: Cortex XDR - Malware Investigation
outputs:
- contextPath: Joe.Analysis
  description: The Analysis object.
  type: unknown
- contextPath: File
  description: The File's object.
  type: unknown
- contextPath: File.Malicious
  description: The malicious file's description.
  type: unknown
- contextPath: DBotScore
  description: The indicator's object.
  type: unknown
- contextPath: IP
  description: IP objects.
  type: unknown
- contextPath: DBotScore.Malicious
  description: Dbot Score malicious information.
  type: unknown
- contextPath: Sample
  description: Sample data object.
  type: unknown
- contextPath: InfoFile
  description: The report file's object.
  type: unknown
- contextPath: WildFire
  description: Wildfire analysis object.
  type: unknown
- contextPath: WildFire.Report
  description: The submission object.
  type: unknown
- contextPath: Joe
  description: Joe Sandbox analysis object.
  type: unknown
- contextPath: Cuckoo.Task
  description: Cuckoo task object.
  type: unknown
- contextPath: SNDBOX.Analysis
  description: SNDBOX analysis.
  type: unknown
- contextPath: HybridAnalysis.Submit
  description: The HybridAnalysis object.
  type: unknown
- contextPath: ANYRUN.Task
  description: ANYRUN task object.
  type: unknown
- contextPath: ANYRUN.Task.Behavior
  description: ANYRUN task behavior.
  type: unknown
- contextPath: ANYRUN.Task.Connection
  description: ANYRUN task connection.
  type: unknown
- contextPath: ANYRUN.Task.DnsRequest
  description: ANYRUN task DNS request.
  type: unknown
- contextPath: ANYRUN.Task.Threat
  description: ANYRUN task threat.
  type: unknown
- contextPath: ANYRUN.Task.HttpRequest
  description: ANYRUN task HTTP request.
  type: unknown
- contextPath: ANYRUN.Task.Process
  description: ANYRUN task process information.
  type: unknown
- contextPath: ANYRUN.Task.Process.Version
  description: ANYRUN task process version.
  type: unknown
- contextPath: PaloAltoNetworksXDR.Incident.shouldRetrieveFile
  description: Files hashes which are not present and were marked as "not retrieve"
    by the user.
  type: unknown
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7013d486-d71b-4117-8551-801797af55ca
      iscommand: false
      name: ""
      version: -1
    taskid: 7013d486-d71b-4117-8551-801797af55ca
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 880,
          "y": 30
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "118"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6496fddc-17e5-49d0-8dcc-2372d4b75188
      iscommand: false
      name: File Detonation
      type: title
      version: -1
    taskid: 6496fddc-17e5-49d0-8dcc-2372d4b75188
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 880,
          "y": 495
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "91"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ff288863-5690-432a-86ca-3a86d8350faa
      iscommand: false
      name: Endpoint Enrichment
      type: title
      version: -1
    taskid: ff288863-5690-432a-86ca-3a86d8350faa
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 880,
          "y": 175
        }
      }
  "45":
    continueonerrortype: ""
    id: "45"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 497f868b-82fa-42ab-870f-0af527f51cc1
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 497f868b-82fa-42ab-870f-0af527f51cc1
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 720,
          "y": 1890
        }
      }
  "91":
    continueonerrortype: ""
    id: "91"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      ip_list:
        complex:
          root: inputs.host_ip
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex XDR - IR
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields should be concatenated using the AND condition (OR is not
        supported). Maximum result set size is 100. Offset is the zero-based number
        of endpoint from the start of the result set (start by counting from 0).
      id: 638288f3-a778-44ea-80fe-8bc2f2eda778
      iscommand: true
      name: Cortex XDR - get endpoints
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      version: -1
    taskid: 638288f3-a778-44ea-80fe-8bc2f2eda778
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 880,
          "y": 320
        }
      }
  "98":
    continueonerrortype: ""
    id: "98"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "113"
      "YES":
      - "121"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Manual - Retrieve file from XDR to perform file detonation.
        Alert ID: ${inputs.xdr_alert_id}
        File Name: ${inputs.file_name}
        File Path: ${inputs.file_path}
        File Hash: ${inputs.file_sha256}
      id: 2e3adef2-12c8-49fc-8963-78b8f0cf4295
      iscommand: false
      name: Manual - Retrieve file from XDR?
      type: condition
      version: -1
    taskid: 2e3adef2-12c8-49fc-8963-78b8f0cf4295
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1360
        }
      }
  "111":
    continueonerrortype: ""
    id: "111"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "45"
    note: false
    quietmode: 0
    scriptarguments:
      EntryID:
        complex:
          accessor: EntryID
          root: File
      File:
        complex:
          root: File
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Detonate file through active integrations that support file detonation
      id: 511dc88b-b3ce-4b77-838f-dfbe2d911e27
      iscommand: false
      name: Detonate File - Generic
      playbookId: Detonate File - Generic
      type: playbook
      version: -1
    taskid: 511dc88b-b3ce-4b77-838f-dfbe2d911e27
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1520,
          "y": 1720
        }
      }
  "112":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: EntryID
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: File.SHA256
                    operator: isEqualString
                    right:
                      value:
                        simple: inputs.file_sha256
                root: File
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "112"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "116"
      "yes":
      - "45"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Is the file already present?
      id: 04e226f0-5092-40e7-8312-1d54b7da5d42
      iscommand: false
      name: Is the file already present?
      type: condition
      version: -1
    taskid: 04e226f0-5092-40e7-8312-1d54b7da5d42
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 840
        }
      }
  "113":
    continueonerrortype: ""
    id: "113"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "45"
    note: false
    quietmode: 0
    scriptarguments:
      keys:
        simple: filesha256,userAnswer
      parent:
        simple: shouldRetrieveFile
      values:
        simple: ${inputs.file_sha256}, false
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set multiple keys/values to the context to remember the user"s
        answer
      id: 334523d5-a1b5-449f-83ac-fa191aae5fa5
      iscommand: false
      name: Set the user's answer
      script: SetMultipleValues
      type: regular
      version: -1
    taskid: 334523d5-a1b5-449f-83ac-fa191aae5fa5
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1120,
          "y": 1530
        }
      }
  "115":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.file_sha256
          operator: isEqualString
          right:
            iscontext: true
            value:
              complex:
                accessor: filesha256
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: shouldRetrieveFile.userAnswer
                    operator: isEqualString
                    right:
                      value:
                        simple: "false"
                root: shouldRetrieveFile
      label: "yes"
    continueonerrortype: ""
    id: "115"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "98"
      "yes":
      - "45"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if the user already answered if should retrieve the file
        or not.
      id: d1c3dd2f-ebe5-47e0-802a-4969c6277020
      iscommand: false
      name: Check previous answer for the file sha256
      type: condition
      version: -1
    taskid: d1c3dd2f-ebe5-47e0-802a-4969c6277020
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1090,
          "y": 1190
        }
      }
  "116":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: shouldRetrieveFile
          operator: isExists
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "116"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "98"
      "yes":
      - "115"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if its the first iteration and the shouldRetrieveFile already
        set
      id: 7f87ece8-9360-45a5-81a7-83d9d23e17a8
      iscommand: false
      name: Check if shouldRetrieveFile is defined
      type: condition
      version: -1
    taskid: 7f87ece8-9360-45a5-81a7-83d9d23e17a8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1020
        }
      }
  "118":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.file_name
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "118"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "45"
      "yes":
      - "112"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether a file is present in the alert
      id: c2137aeb-42fe-4a7a-8a03-ee79ca5e60ae
      iscommand: false
      name: Check if alert has a file
      type: condition
      version: -1
    taskid: c2137aeb-42fe-4a7a-8a03-ee79ca5e60ae
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 880,
          "y": 660
        }
      }
  "121":
    continueonerrortype: ""
    id: "121"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "111"
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_ids:
        complex:
          root: inputs.endpoint_id
          transformers:
          - operator: uniq
      file_path:
        complex:
          root: inputs.file_path
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |-
        This playbook retrieves files from selected endpoints. You can retrieve up to 20 files, from 10 endpoints.
        Inputs for this playbook are:
        - A comma-separated list of endpoint IDs.
        - A comma-separated list of file paths for your operating system, either Windows, Linux, or Mac. At least one file path is required.
      id: 65a8eae2-627a-405d-8295-c9478a445092
      iscommand: false
      name: Cortex XDR - Retrieve File v2
      playbookId: Cortex XDR - Retrieve File v2
      type: playbook
      version: -1
    taskid: 65a8eae2-627a-405d-8295-c9478a445092
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1520,
          "y": 1530
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "112_45_yes": 0.21,
      "115_45_yes": 0.25,
      "115_98_#default#": 0.56,
      "118_112_yes": 0.49,
      "118_45_#default#": 0.16,
      "98_113_#default#": 0.66
    },
    "paper": {
      "dimensions": {
        "height": 1925,
        "width": 1180,
        "x": 720,
        "y": 30
      }
    }
  }
