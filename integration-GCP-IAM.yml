category: IT Services
commonfields:
  id: GCP-IAM
  version: -1
configuration:
- display: ""
  displaypassword: Service Account Private Key file content (JSON).
  hiddenusername: true
  name: credentials
  required: true
  type: 9
- display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.0.0
    itemVersion: 1.0.26
    packID: GCP-IAM
    packName: GCP IAM
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: Manage identity and access control for Google Cloud Platform resources.
detaileddescription: "### Authentication\nTo configure an instance of the integration
  in Cortex XSOAR, you need to supply the Service Account Private Key file content.\n\nIn
  order to use the integration, in the first stage, you need to create a project.\nInformation
  about how to create project can be found [here](https://cloud.google.com/resource-manager/docs/creating-managing-projects)\n\n###
  Enable Google Workspace APIs\n\nIn order to use the integration capabilities, you
  need to enable Google Workspace APIs.\n1. Open the [Google Cloud Console](https://console.cloud.google.com/).\n2.
  At the top-left, click the navigation menu > **APIs & Services** > **Library**.\n3.
  In the search field, enter the name of the API you want to enable and press **Enter**.\n
  \  Please enable the following APIs:\n   1. Identity and Access Management (IAM)
  API\n   2. Cloud Resource Manager API\n   3. Cloud Identity API\n4. In the list
  of search results, click the API you want to enable.\n5. Click **Enable**.\n\n###
  Create a Service Account\n\n1. Open the [Service accounts page](https://console.developers.google.com/iam-admin/serviceaccounts).\n2.
  If prompted, select a project, or create a new one.\n3. Click **Create Service Account**.\n4.
  Under Service account details, type a name, ID, and description for the service
  account, then click **Create and Continue**.\n5. Optional: Under *Grant this service
  account access to project*, select the IAM roles to grant to the service account.\n6.
  Click **Continue**.\n7. Optional: Under *Grant users access to this service account*,
  add the users or groups that are allowed to use and manage the service account.\n8.
  Click **Done**.\n\n### Grant Permissions\n\nYou have to grant the required permissions
  to the created Service Account in order to use in the integration command.<br>\nA
  list of the required permissions for every command can be found below.<br>\nYou
  can grant the permissions by predefined roles or by creating a custom role. \n\n####
  Create a Custom Role\n\n1. Open the [Google Cloud Console](https://console.cloud.google.com/).\n2.
  Click the navigation menu and select **IAM & Admin** then **Roles**.\n3. Click **Create
  Role** on the top toolbar.\n4. Add a title, description, and ID and ensure the role
  is marked for General Availability.\n5. Add the required permissions by clicking
  **ADD PERMISSIONS**.\n6. Click **CREATE**.\n\n#### Grant Role Access to Service
  Account\n\n1. Open the [Google Cloud Console](https://console.cloud.google.com/).\n2.
  Select **IAM & Admin** > **IAM**.\n3. Click the down arrow in the top menu bar for
  the project.\n4. From the *Select from* drop-down list, select an organization that
  contains the GCP project(s) that you want the integration to monitor.\n5. Click
  the **ALL** tab and select the required organization.\n6. Click **Add**. Note that
  you must have permission to add members to the organization or project for the **ADD**
  button to be active.\n7. Add a member and roles to a project or organization. In
  the *New members* field, paste the email address of the created service account.\n8.
  From the *Select a role* drop-down list, select the required roles.\n9. Click **Save**.\n\n###
  Command Required Permissions\n\n|Command Name|Permissions|\n|---|---|\n| gcp-iam-projects-get
  | resourcemanager.projects.get |\n| gcp-iam-project-iam-policy-get | resourcemanager.projects.getIamPolicy
  |\n| gcp-iam-project-iam-permission-test | There are no permissions required for
  making this API call. |\n| gcp-iam-project-iam-member-add | resourcemanager.projects.getIamPolicy
  <br> resourcemanager.projects.setIamPolicy |\n| gcp-iam-project-iam-member-remove
  | resourcemanager.projects.getIamPolicy <br> resourcemanager.projects.setIamPolicy
  |\n| gcp-iam-project-iam-policy-set | resourcemanager.projects.getIamPolicy <br>
  resourcemanager.projects.setIamPolicy |\n| gcp-iam-project-iam-policy-create | resourcemanager.projects.getIamPolicy
  <br> resourcemanager.projects.setIamPolicy |\n| gcp-iam-project-iam-policy-remove
  | resourcemanager.projects.getIamPolicy <br> resourcemanager.projects.setIamPolicy
  |\n| gcp-iam-folders-get | resourcemanager.folders.list <br> resourcemanager.folders.get
  |\n| gcp-iam-folder-iam-policy-get | resourcemanager.folders.getIamPolicy |\n| gcp-iam-folder-iam-permission-test
  | There are no permissions required for making this API call. |\n| gcp-iam-folder-iam-member-add
  | resourcemanager.folders.getIamPolicy <br> resourcemanager.folders.setIamPolicy
  |\n| gcp-iam-folder-iam-member-remove | resourcemanager.folders.getIamPolicy <br>
  resourcemanager.folders.setIamPolicy |\n| gcp-iam-folder-iam-policy-set | resourcemanager.folders.getIamPolicy
  <br> resourcemanager.folders.setIamPolicy |\n| gcp-iam-folder-iam-policy-create
  | resourcemanager.folders.getIamPolicy <br> resourcemanager.folders.setIamPolicy
  |\n| gcp-iam-folder-iam-policy-remove | resourcemanager.folders.getIamPolicy <br>
  resourcemanager.folders.setIamPolicy |\n| gcp-iam-organizations-get | resourcemanager.organizations.get
  |\n| gcp-iam-organization-iam-policy-get | resourcemanager.organizations.getIamPolicy
  |\n| gcp-iam-organization-iam-permission-test | There are no permissions required
  for making this API call. |\n| gcp-iam-organization-iam-member-add | resourcemanager.organizations.getIamPolicy
  <br> resourcemanager.organizations.setIamPolicy  |\n| gcp-iam-organization-iam-member-remove
  | resourcemanager.organizations.getIamPolicy <br> resourcemanager.organizations.setIamPolicy
  |\n| gcp-iam-organization-iam-policy-set | resourcemanager.organizations.setIamPolicy
  |\n| gcp-iam-organization-iam-policy-create | resourcemanager.organizations.getIamPolicy
  <br> resourcemanager.organizations.setIamPolicy |\n| gcp-iam-organization-iam-policy-remove
  | resourcemanager.organizations.getIamPolicy <br> resourcemanager.organizations.setIamPolicy
  |\n| gcp-iam-group-create | resourcemanager.organizations.get |\n| gcp-iam-group-list
  | resourcemanager.organizations.get |\n| gcp-iam-group-get | resourcemanager.organizations.get
  |\n| gcp-iam-group-delete | resourcemanager.organizations.get |\n| gcp-iam-group-membership-create
  | resourcemanager.organizations.get |\n| gcp-iam-group-membership-list | resourcemanager.organizations.get
  |\n| gcp-iam-group-membership-get | resourcemanager.organizations.get |\n| gcp-iam-group-membership-role-add
  | resourcemanager.organizations.get |\n| gcp-iam-group-membership-role-remove |
  resourcemanager.organizations.get |\n| gcp-iam-group-membership-delete | resourcemanager.organizations.get
  |\n| gcp-iam-service-account-create | iam.serviceAccounts.create |\n| gcp-iam-service-account-update
  | iam.serviceAccounts.update |\n| gcp-iam-service-accounts-get | iam.serviceAccounts.get
  |\n| gcp-iam-service-account-enable | iam.serviceAccounts.enable |\n| gcp-iam-service-account-disable
  |iam.serviceAccounts.disable  |\n| gcp-iam-service-account-delete | iam.serviceAccounts.delete
  |\n| gcp-iam-service-account-generate-access-token | iam.serviceAccountTokenCreator
  |\n| gcp-iam-service-account-key-create | iam.serviceAccountKeys.create |\n| gcp-iam-service-account-keys-get
  | iam.serviceAccountKeys.get <br> iam.serviceAccountKeys.list |\n| gcp-iam-service-account-key-enable
  | Required grant 'Service Account Key Admin' role permission |\n| gcp-iam-service-account-key-disable
  | Required grant 'Service Account Key Admin' role permission |\n| gcp-iam-service-account-key-delete
  | iam.serviceAccountKeys.delete |\n| gcp-iam-organization-role-create | iam.roles.create
  |\n| gcp-iam-organization-role-update | iam.roles.update |\n| gcp-iam-organization-role-permission-add
  | iam.roles.get iam.roles.update |\n| gcp-iam-organization-role-permission-remove
  | iam.roles.get iam.roles.update |\n| gcp-iam-organization-role-list | iam.roles.list
  |\n| gcp-iam-organization-role-get | resourcemanager.organizations.get |\n| gcp-iam-organization-role-delete
  | iam.roles.delete |\n| gcp-iam-project-role-create | iam.roles.create |\n| gcp-iam-project-role-update
  | iam.roles.update |\n| gcp-iam-project-role-permission-add | iam.roles.get <br>
  iam.roles.update |\n| gcp-iam-project-role-permission-remove | iam.roles.get <br>
  iam.roles.update |\n| gcp-iam-project-role-list | iam.roles.list |\n| gcp-iam-project-role-get
  | iam.roles.get |\n| gcp-iam-project-role-delete | iam.roles.delete |\n| gcp-iam-testable-permission-list
  | There are no permissions required for making this API call. |\n| gcp-iam-grantable-role-list
  | iam.roles.list <br> resourcemanager.organizations.getIamPolicy <br> resourcemanager.projects.getIamPolicy
  <br> resourcemanager.folders.getIamPolicy |\n| gcp-iam-role-get | iam.roles.get
  |\n| gcp-iam-role-list | iam.roles.list |\n\n\n\n### Create a Service Account Key\n\n1.
  Open the [Service accounts page](https://console.developers.google.com/iam-admin/serviceaccounts).\n2.
  If prompted, select a project, or create a new one.\n3. Click the email address
  for the service account you created.\n4. Click **Create key**, then click **Create**.\n5.
  Click the **Keys** tab.\n6. In the *Add key* drop-down list, select **Create new
  key**.\n7. Click **Create**.\n\nYour new public/private key pair is generated and
  downloaded to your machine; it serves as the only copy of the private key. You are
  responsible for storing it securely. If you lose this key pair, you will need to
  generate a new one.\n\nPlease provide the downloaded file content in the integration
  `Service Account Private Key file content (JSON)` instance parameter.\n\nMore information
  about creating the required resources can be found here:\n* [Create a Project](https://cloud.google.com/resource-manager/docs/creating-managing-projects)\n*
  [Enable Google Workspace APIs ](https://developers.google.com/workspace/guides/enable-apis)\n*
  [Create a Service Account & Service Account Key](https://developers.google.com/identity/protocols/oauth2/service-account#creatinganaccount)\n\n---\n[View
  Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/gcp-iam)"
display: GCP-IAM
image: data:image/png;base64,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
name: GCP-IAM
script:
  commands:
  - arguments:
    - description: A comma-separated list of project names to retrieve. For example,
        projects/415104041262. Leave empty to retrieve a list of projects under a
        specified parent resource.
      isArray: true
      name: project_name
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1.
        Maximum value is 100.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    - description: The name of the parent resource to list projects under. For example,
        setting this field to 'folders/1234' would list all projects directly under
        that folder.
      name: parent
    - auto: PREDEFINED
      defaultValue: "False"
      description: If true, projects that have been marked for deletion will also
        be retrieved.
      name: show_deleted
      predefined:
      - "False"
      - "True"
    description: 'Lists project under the specified parent, or retrieves a specific
      project''s information. One of the following arguments must be provided: "parent"
      or "project_name".'
    name: gcp-iam-projects-get
    outputs:
    - contextPath: GCPIAM.Project.createTime
      description: Project creation time.
      type: Date
    - contextPath: GCPIAM.Project.displayName
      description: Project display name.
      type: String
    - contextPath: GCPIAM.Project.name
      description: The unique resource name of the project.
      type: String
    - contextPath: GCPIAM.Project.parent
      description: The project parent resource.
      type: String
    - contextPath: GCPIAM.Project.projectId
      description: The unique, user-assigned ID of the project.
      type: String
    - contextPath: GCPIAM.Project.state
      description: The project lifecycle state.
      type: String
    - contextPath: GCPIAM.Project.updateTime
      description: The most recent time the project was modified.
      type: Date
  - arguments:
    - description: The name of the resource to list tag bindings under. For example,
        setting this field to 'folders/1234' would list all tags directly applied
        to that folder.
      name: parent
      required: true
    description: List tag bindings (key value pair) applied to a project/folder/organization
      object.
    name: gcp-iam-tagbindings-list
    outputs:
    - contextPath: GCPIAM.TagBindings.key
      description: Tag bindings key.
      type: String
    - contextPath: GCPIAM.TagBindings.value
      description: Tag bindings value.
      type: String
  - arguments:
    - description: The project name for which the policy is being requested. For example,
        projects/415104041262.
      name: project_name
      required: true
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    - description: 'A comma-separated list of roles. (Ex: "roles/bigquery.admin, roles/editor,
        roles/owner").'
      isArray: true
      name: roles
    description: Retrieves the IAM access control policy for the specified project.
    name: gcp-iam-project-iam-policy-get
    outputs:
    - contextPath: GCPIAM.Policy.bindings.members
      description: The members who associate to the role.
      type: String
    - contextPath: GCPIAM.Policy.bindings.role
      description: The role that is assigned to the list of members.
      type: String
    - contextPath: GCPIAM.Policy.name
      description: The unique resource name of the project. Note that this output
        was added manually.
      type: String
  - arguments:
    - description: The project name for which the permissions is being tested. For
        example, projects/415104041262.
      name: project_name
      required: true
    - description: A comma-separated list of permission names to validate for the
        resource.
      isArray: true
      name: permissions
      required: true
    description: Returns permissions that a caller has on the specified project. The
      permission list can be obtained by running the 'gcp-iam-testable-permission-list'
      command.
    name: gcp-iam-project-iam-permission-test
    outputs:
    - contextPath: GCPIAM.Permission
      description: The caller allowed permissions.
      type: String
  - arguments:
    - description: The resource for which the policy is being specified. For example,
        projects/415104041262.
      name: project_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members to add to the policy. For example:
        user:mike@example.com, group:admins@example.com, domain:google.com, serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Adds members to the project policy.
    name: gcp-iam-project-iam-member-add
  - arguments:
    - description: The name of the project for which the policy is being specified.
        For example, projects/415104041262.
      name: project_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members to remove from the policy. For
        example: user:mike@example.com, group:admins@example.com, domain:google.com,
        serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Removes members from the project policy.
    name: gcp-iam-project-iam-member-remove
  - arguments:
    - description: The name of the project for which the policy is being specified.
        For example, projects/415104041262.
      name: project_name
      required: true
    - description: |-
        A comma-separated list of JSON policies objects. Every policy item consists of 'role' and 'members'. For example: [
          {
            "role": "roles/resourcemanager.organizationViewer",
            "members": [
              "user:eve@example.com"
            ]
          }
        ]
      isArray: true
      name: policy
      required: true
    description: Sets the IAM access control policy for the specified project. This
      operation will overwrite any existing policy.
    execution: true
    name: gcp-iam-project-iam-policy-set
    outputs:
    - contextPath: GCPIAM.Policy.bindings.members
      description: The members who associate to the role.
      type: String
    - contextPath: GCPIAM.Policy.bindings.role
      description: The role that is assigned to the list of members.
      type: String
    - contextPath: GCPIAM.Policy.name
      description: The unique resource name of the project. Note that this output
        was added manually.
      type: String
  - arguments:
    - description: The name of the project for which the policy is being specified.
        For example, projects/415104041262.
      name: project_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members associated with the role. For
        example: user:mike@example.com, group:admins@example.com, domain:google.com,
        serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Adds a new project IAM policy.
    name: gcp-iam-project-iam-policy-create
  - arguments:
    - description: The name of the project for which the policy is being specified.
        For example, projects/415104041262.
      name: project_name
      required: true
    - description: A comma-separated list of policy role names to remove.
      isArray: true
      name: role
      required: true
    description: Removes the policy from the project IAM policies.
    name: gcp-iam-project-iam-policy-remove
  - arguments:
    - description: A comma-separated list of folder names to retrieve. For example,
        folders/12342. Leave empty to retrieve a list of folders under a specified
        parent resource.
      isArray: true
      name: folder_name
    - description: The name of the parent resource to list folders under. For example,
        setting this field to 'folders/1234' would list all folder directly under
        that folder.
      name: parent
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 100.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    - auto: PREDEFINED
      defaultValue: "False"
      description: If true, folders that have been marked for deletion will also be
        retrieved.
      name: show_deleted
      predefined:
      - "False"
      - "True"
    description: 'Lists folders under the specified parent, or retrieves a specific
      folder information. One of the arguments: ''parent'' or ''folder_name''  must
      be provided.'
    name: gcp-iam-folders-get
    outputs:
    - contextPath: GCPIAM.Folder.createTime
      description: Folder creation time.
      type: Date
    - contextPath: GCPIAM.Folder.displayName
      description: Folder display name.
      type: String
    - contextPath: GCPIAM.Folder.name
      description: The unique resource name of the folder.
      type: String
    - contextPath: GCPIAM.Folder.parent
      description: The folder parent resource.
      type: String
    - contextPath: GCPIAM.Folder.state
      description: The folder lifecycle state.
      type: String
    - contextPath: GCPIAM.Folder.updateTime
      description: The most recent time the folder was modified.
      type: Date
  - arguments:
    - description: The folder name for which the policy is being requested. For example,
        folders/12342.
      name: folder_name
      required: true
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: Retrieves the IAM access control policy for the specified folder.
    name: gcp-iam-folder-iam-policy-get
    outputs:
    - contextPath: GCPIAM.Policy.bindings.members
      description: The members who associate to the role.
      type: String
    - contextPath: GCPIAM.Policy.bindings.role
      description: The role that is assigned to the list of members.
      type: String
    - contextPath: GCPIAM.Policy.name
      description: The unique resource name of the folder. Note that this output was
        added manually.
      type: String
  - arguments:
    - description: The folder name for which the permissions is being tested. For
        example, folders/12342.
      name: folder_name
      required: true
    - description: A comma-separated list of permission names to validate for the
        resource.
      isArray: true
      name: permissions
      required: true
    description: Returns permissions that a caller has on the specified folder. The
      permission list can be obtained by running the 'gcp-iam-testable-permission-list'
      command.
    name: gcp-iam-folder-iam-permission-test
    outputs:
    - contextPath: GCPIAM.Permission
      description: The caller allowed permissions.
      type: String
  - arguments:
    - description: The resource for which the policy is being specified. For example,
        folders/12342.
      name: folder_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members to add to the policy. For example:
        user:mike@example.com, group:admins@example.com, domain:google.com, serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Adds members to the folder policy.
    name: gcp-iam-folder-iam-member-add
  - arguments:
    - description: The name of the folder for which the policy is being specified.
        For example, folders/12342.
      name: folder_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members to remove from the policy. For
        example: user:mike@example.com, group:admins@example.com, domain:google.com,
        serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Removes members from the folder policy.
    name: gcp-iam-folder-iam-member-remove
  - arguments:
    - description: The name of the folder for which the policy is being specified.
        For example, folders/12342.
      name: folder_name
      required: true
    - description: |-
        A comma-separated list of JSON policies objects. Every policy item consists of 'role' and 'members'. For example: [
          {
            "role": "roles/resourcemanager.organizationViewer",
            "members": [
              "user:eve@example.com"
            ]
          }
        ]
      isArray: true
      name: policy
      required: true
    description: Sets the IAM access control policy for the specified folder. This
      operation will overwrite any existing policy.
    execution: true
    name: gcp-iam-folder-iam-policy-set
    outputs:
    - contextPath: GCPIAM.Policy.bindings.members
      description: The members who associate to the role.
      type: String
    - contextPath: GCPIAM.Policy.bindings.role
      description: The role that is assigned to the list of members.
      type: String
    - contextPath: GCPIAM.Policy.name
      description: The unique resource name of the folder. Note that this output was
        added manually.
      type: String
  - arguments:
    - description: The name of the folder for which the policy is being specified.
        For example, folders/12342.
      name: folder_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members associated with the role. For
        example: user:mike@example.com, group:admins@example.com, domain:google.com,
        serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Adds a new folder IAM policy.
    name: gcp-iam-folder-iam-policy-create
  - arguments:
    - description: The name of the folder for which the policy is being specified.
        For example, folders/12342.
      name: folder_name
      required: true
    - description: A comma-separated list of policy role names to remove.
      isArray: true
      name: role
      required: true
    description: Removes a policy from the folder IAM policies.
    name: gcp-iam-folder-iam-policy-remove
  - arguments:
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 50.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    - description: A comma-separated list of organization names to retrieve. For example,
        organizations/3456. Leave empty to retrieve a list of organizations that are
        visible to the caller.
      isArray: true
      name: organization_name
    description: Lists organization resources that are visible to the caller, or retrieves
      an organization's information.
    name: gcp-iam-organizations-get
    outputs:
    - contextPath: GCPIAM.Organization.createTime
      description: Organization creation time.
      type: Date
    - contextPath: GCPIAM.Organization.directoryCustomerId
      description: The G Suite / Workspace customer ID used in the Directory API.
      type: String
    - contextPath: GCPIAM.Organization.displayName
      description: Organization display name.
      type: String
    - contextPath: GCPIAM.Organization.name
      description: The unique resource name of the organization.
      type: String
    - contextPath: GCPIAM.Organization.state
      description: The organization lifecycle state.
      type: String
    - contextPath: GCPIAM.Organization.updateTime
      description: The most recent time the organization was modified.
      type: Date
  - arguments:
    - description: The organization name for which the policy is being requested.
        For example, organizations/3456.
      name: organization_name
      required: true
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: Retrieves the IAM access control policy for the specified organization.
    name: gcp-iam-organization-iam-policy-get
    outputs:
    - contextPath: GCPIAM.Policy.bindings.members
      description: The members who associate to the role.
      type: String
    - contextPath: GCPIAM.Policy.bindings.role
      description: The role that is assigned to the list of members.
      type: String
    - contextPath: GCPIAM.Policy.name
      description: The unique resource name of the organization. Note that this output
        was added manually.
      type: String
  - arguments:
    - description: The organization name for which the permissions is being tested.
        For example, organizations/3456.
      name: organization_name
      required: true
    - description: A comma-separated list of permission names to validate for the
        resource.
      isArray: true
      name: permissions
      required: true
    description: Returns permissions that a caller has on the specified organization.
      The permission list can be obtained by running the 'gcp-iam-testable-permission-list'
      command.
    name: gcp-iam-organization-iam-permission-test
    outputs:
    - contextPath: GCPIAM.Permission
      description: The caller allowed permissions.
      type: String
  - arguments:
    - description: The resource for which the policy is being specified. For example,
        organizations/3456.
      name: organization_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members to add to the policy. For example:
        user:mike@example.com, group:admins@example.com, domain:google.com, serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Adds members to the organization policy.
    name: gcp-iam-organization-iam-member-add
  - arguments:
    - description: The name of the organization for which the policy is being specified.
        For example, organizations/3456.
      name: organization_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members to remove from the policy. For
        example: user:mike@example.com, group:admins@example.com, domain:google.com,
        serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Removes members from the organization policy.
    name: gcp-iam-organization-iam-member-remove
  - arguments:
    - description: The name of the organization for which the policy is being specified.
        For example, organizations/3456.
      name: organization_name
      required: true
    - description: |-
        A comma-separated list of JSON policies objects. Every policy item consists of 'role' and 'members'. For example: [
          {
            "role": "roles/resourcemanager.organizationViewer",
            "members": [
              "user:eve@example.com"
            ]
          }
        ]
      isArray: true
      name: policy
      required: true
    description: Sets the IAM access control policy for the specified organization.
      This operation will overwrite any existing policy.
    execution: true
    name: gcp-iam-organization-iam-policy-set
    outputs:
    - contextPath: GCPIAM.Policy.bindings.members
      description: The members who associate to the role.
      type: String
    - contextPath: GCPIAM.Policy.bindings.role
      description: The role that is assigned to the list of members.
      type: String
    - contextPath: GCPIAM.Policy.name
      description: The unique resource name of the organization. Note that this output
        was added manually.
      type: String
  - arguments:
    - description: The name of the organization for which the policy is being specified.
        For example, organizations/3456.
      name: organization_name
      required: true
    - description: The name of the policy role.
      name: role
      required: true
    - description: 'A comma-separated list of members associated with the role. For
        example: user:mike@example.com, group:admins@example.com, domain:google.com,
        serviceAccount:my-project-id@xsoar.gserviceaccount.com'
      isArray: true
      name: members
      required: true
    description: Adds a new organization IAM policy.
    name: gcp-iam-organization-iam-policy-create
  - arguments:
    - description: The name of the organization for which the policy is being specified.
        For example, organizations/3456.
      name: organization_name
      required: true
    - description: A comma-separated list of policy role names to remove.
      isArray: true
      name: role
      required: true
    description: Removes a policy from the organization IAM policies.
    name: gcp-iam-organization-iam-policy-remove
  - arguments:
    - description: The parent resource of the groups to create. Must be of the form
        identitysources/{identity_source_id} for external- identity-mapped groups
        or customers/{customer_id} for Google Groups. The customer_id must begin with
        "C" (for example, 'C046psxkn'). Customer ID can be obtained by running the
        'gcp-iam-organizations-get' command. The customer ID can be found in the 'directoryCustomerId'
        field.
      name: parent
      required: true
    - description: The description of the group.
      name: description
    - description: The display name of the group.
      name: display_name
      required: true
    - description: The group unique email address. There is no need to set up the
        email in the organization, the command will do this independently.
      name: group_email_address
      required: true
    description: Create a new group. The end user making the request will be added
      as the initial owner of the group.
    name: gcp-iam-group-create
    outputs:
    - contextPath: GCPIAM.Group.createTime
      description: Group creation time.
      type: Date
    - contextPath: GCPIAM.Group.displayName
      description: The display name of the group.
      type: String
    - contextPath: GCPIAM.Group.groupKey.id
      description: The ID of the group.
      type: String
    - contextPath: GCPIAM.Group.name
      description: The resource name of the group.
      type: String
    - contextPath: GCPIAM.Group.parent
      description: The resource name of the entity under which this group resides
        in the Cloud Identity resource hierarchy.
      type: String
    - contextPath: GCPIAM.Group.updateTime
      description: The most recent time the group was modified.
      type: Date
  - arguments:
    - description: The parent resource of the groups to retrieve. This parameter is
        usually equal to the organization customer ID. For example customers/C01234.
      name: parent
      required: true
    - defaultValue: "50"
      description: The maximum number of results to retrieve.Minimum value is 1, maximum
        value is 500.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: Lists groups that are visible to the caller.
    name: gcp-iam-group-list
    outputs:
    - contextPath: GCPIAM.Group.displayName
      description: The display name of the group.
      type: String
    - contextPath: GCPIAM.Group.groupKey.id
      description: The ID of the group.
      type: String
    - contextPath: GCPIAM.Group.name
      description: The resource name of the group.
      type: String
  - arguments:
    - description: The name of the group to retrieve. Must be of the form groups/{group_id}.
      name: group_name
      required: true
    description: Retrieves a group information.
    name: gcp-iam-group-get
    outputs:
    - contextPath: GCPIAM.Group.createTime
      description: Group creation time.
      type: Date
    - contextPath: GCPIAM.Group.displayName
      description: The display name of the group.
      type: String
    - contextPath: GCPIAM.Group.groupKey.id
      description: The ID of the group.
      type: String
    - contextPath: GCPIAM.Group.name
      description: The resource name of the group.
      type: String
    - contextPath: GCPIAM.Group.parent
      description: The resource name of the entity under which this group resides
        in the Cloud Identity resource hierarchy.
      type: String
    - contextPath: GCPIAM.Group.updateTime
      description: The most recent time the group was modified.
      type: Date
  - arguments:
    - description: The name of the group to delete. Must be of the form groups/{group_id}.
      name: group_name
      required: true
    description: Deletes a group.
    name: gcp-iam-group-delete
  - arguments:
    - description: A comma-separated list of group names which will contain the membership.
        Every group name must be of the form groups/{group_id}.
      isArray: true
      name: groups_name
      required: true
    - description: The email address of the member to add to the group.
      name: member_email
      required: true
    - auto: PREDEFINED
      defaultValue: MEMBER
      description: A comma-separated list of membership roles that apply to the membership.
        The 'MEMBER' role must be provided.
      isArray: true
      name: role
      predefined:
      - OWNER
      - MANAGER
      - MEMBER
      required: true
    description: Creates a group membership.
    name: gcp-iam-group-membership-create
    outputs:
    - contextPath: GCPIAM.Membership.name
      description: The resource name of the membership.
      type: String
    - contextPath: GCPIAM.Membership.preferredMemberKey.id
      description: The member key ID.
      type: String
    - contextPath: GCPIAM.Membership.roles.name
      description: The membership roles that apply to the membership.
      type: String
  - arguments:
    - description: The name of the group that contains the membership. Must be of
        the form groups/{group_id}.
      name: group_name
      required: true
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 500.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: Lists group memberships.
    name: gcp-iam-group-membership-list
    outputs:
    - contextPath: GCPIAM.Membership.name
      description: The resource name of the membership.
      type: String
    - contextPath: GCPIAM.Membership.preferredMemberKey.id
      description: The member key ID.
      type: String
    - contextPath: GCPIAM.Membership.roles.name
      description: The membership roles that apply to the membership.
      type: String
  - arguments:
    - description: 'The name of the group membership to retrieve. Must be of the form:
        groups/{group_id}/memberships/{membership_id}.'
      name: membership_name
      required: true
    description: Retrieves group membership information.
    name: gcp-iam-group-membership-get
    outputs:
    - contextPath: GCPIAM.Membership.createTime
      description: The membership creation time.
      type: Date
    - contextPath: GCPIAM.Membership.name
      description: The resource name of the membership.
      type: String
    - contextPath: GCPIAM.Membership.preferredMemberKey.id
      description: The member key ID.
      type: String
    - contextPath: GCPIAM.Membership.roles.name
      description: The membership roles that apply to the membership.
      type: String
    - contextPath: GCPIAM.Membership.updateTime
      description: The most recent time the membership was modified.
      type: Date
  - arguments:
    - description: 'The name of the group membership to update. Must be of the form:
        groups/{group_id}/memberships/{membership_id}.'
      name: membership_name
      required: true
    - auto: PREDEFINED
      description: A comma-separated list of membership roles to add to the membership.
      isArray: true
      name: role
      predefined:
      - MANAGER
      - OWNER
      required: true
    description: Adds a group membership role.
    name: gcp-iam-group-membership-role-add
  - arguments:
    - description: 'The resource name of the membership. Must be of the form: groups/{group_id}/memberships/{membership_id}.'
      name: membership_name
      required: true
    - auto: PREDEFINED
      description: A comma-separated list of membership roles to remove from the membership.
      isArray: true
      name: role
      predefined:
      - OWNER
      - MANAGER
      required: true
    description: Removes a group membership role.
    name: gcp-iam-group-membership-role-remove
  - arguments:
    - description: 'A comma-separated list of resource names of the memberships to
        delete. Must be of the form: groups/{group_id}/memberships/{membership_id}.'
      isArray: true
      name: membership_names
      required: true
    description: Deletes a group membership.
    name: gcp-iam-group-membership-delete
  - arguments:
    - description: The name of the project associated with the service account. Must
        be of the form projects/{project_id}.
      name: project_name
      required: true
    - description: The account ID that is used to generate the service account email
        address and a stable unique ID. It is unique within a project, must be 6-30
        characters long, and match the regular expression [a-z]([-a-z0-9]*[a-z0-9]).
      name: service_account_id
      required: true
    - description: Human readable name for the created service account.
      name: display_name
    - description: Human readable description for the created service account.
      name: description
    description: Creates a service account in project.
    name: gcp-iam-service-account-create
    outputs:
    - contextPath: GCPIAM.ServiceAccount.email
      description: The email address of the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.name
      description: The resource name of the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.oauth2ClientId
      description: The OAuth 2.0 client ID for the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.projectId
      description: The ID of the project that owns the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.uniqueId
      description: The unique, stable numeric ID for the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.disabled
      description: Indicates whether the service account is disabled.
      type: Boolean
  - arguments:
    - description: The name of the service account to update. Must be of the form
        projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}.
      name: service_account_name
      required: true
    - description: Human readable name for the updated service account.
      name: display_name
    - description: Human readable description for the updated service account.
      name: description
    - auto: PREDEFINED
      description: A comma-separated names list of the fields to update.
      name: fields_to_update
      predefined:
      - displayName
      - description
      required: true
    description: Updates a service account.
    name: gcp-iam-service-account-update
  - arguments:
    - description: 'A comma-separated list of service accounts names to retrieve in
        the following format: projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}. Leave
        empty to retrieve a list of service accounts under a specified project resource.'
      isArray: true
      name: service_account_name
    - description: 'The name of the project associated with the service accounts to
        retrieve, for example: projects/my-project-123.'
      name: project_name
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 100.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: 'Lists service accounts in project, or retrieves a specific service
      accounts information. One of the arguments: ''service_account_name'' or ''project_name''  must
      be provided.'
    name: gcp-iam-service-accounts-get
    outputs:
    - contextPath: GCPIAM.ServiceAccount.email
      description: The email address of the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.name
      description: The resource name of the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.oauth2ClientId
      description: The OAuth 2.0 client ID for the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.projectId
      description: The ID of the project that owns the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.uniqueId
      description: The unique, stable numeric ID for the service account.
      type: String
    - contextPath: GCPIAM.ServiceAccount.disabled
      description: Indicates whether the service account is disabled.
      type: Boolean
  - arguments:
    - description: 'A comma-separated list of names of service accounts to enable.
        Every resource name should be in the following format: projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}'
      isArray: true
      name: service_account_name
      required: true
    description: Enables a project service account.
    name: gcp-iam-service-account-enable
  - arguments:
    - description: 'A comma-separated list of names of service accounts to disable.
        Every resource name should be in the following format: projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}'
      isArray: true
      name: service_account_name
      required: true
    description: Disables a project service account.
    name: gcp-iam-service-account-disable
  - arguments:
    - description: The name of the service account associated with the key. Must be
        of the form projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}.
      name: service_account_name
      required: true
    - auto: PREDEFINED
      defaultValue: KEY_ALG_RSA_2048
      description: The RSA key algorithm.
      name: key_algorithm
      predefined:
      - KEY_ALG_RSA_1024
      - KEY_ALG_RSA_2048
    description: Creates a service account key. A service account can have up to 10
      keys. Service account keys that you create don't have an expiry date and stay
      valid until you delete them.
    name: gcp-iam-service-account-key-create
    outputs:
    - contextPath: GCPIAM.ServiceAccountKey.keyAlgorithm
      description: Specifies the algorithm for the key.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.keyOrigin
      description: Service account key origin provider.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.keyType
      description: Indicates the resource managed type.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.name
      description: The resource name of the service account key.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.privateKeyData
      description: The encrypted private key data.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.privateKeyType
      description: The output format for the private key.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.validAfterTime
      description: Indicates the time the key can be used after this timestamp.
      type: Date
    - contextPath: GCPIAM.ServiceAccountKey.validBeforeTime
      description: Indicates the time the key can be used before this timestamp.
      type: Date
    - contextPath: GCPIAM.ServiceAccountKey.disabled
      description: Indicates whether the service account key is disabled.
      type: Boolean
  - arguments:
    - description: 'The resource name of the service account key to retrieve. The
        resource name should be in the following format: projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}/keys/{key}.
        Leave empty to retrieve a list of service account keys that are associated
        with the service account resource.'
      name: key_name
    - description: The name of the service account associated with the keys. Must
        be of the form projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}.
      name: service_account_name
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: 'Lists service account keys, or retrieves a specific service account
      key information. One of the arguments: ''service_account_name'' or ''key_name''  must
      be provided.'
    name: gcp-iam-service-account-keys-get
    outputs:
    - contextPath: GCPIAM.ServiceAccountKey.keyAlgorithm
      description: Specifies the algorithm for the key.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.keyOrigin
      description: Service account key origin provider.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.keyType
      description: Indicates the resource managed type.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.name
      description: The resource name of the service account key.
      type: String
    - contextPath: GCPIAM.ServiceAccountKey.validAfterTime
      description: Indicates the time the key can be used after this timestamp.
      type: Date
    - contextPath: GCPIAM.ServiceAccountKey.validBeforeTime
      description: Indicates the time the key can be used before this timestamp.
      type: Date
    - contextPath: GCPIAM.ServiceAccountKey.disabled
      description: Indicates whether the service account key is disabled.
      type: Boolean
  - arguments:
    - description: 'A comma-separated list of names of resource name of the service
        account key to enable. Every resource name should be in the following format:
        projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}/keys/{key}'
      isArray: true
      name: key_name
      required: true
    description: Enables a service account key.
    name: gcp-iam-service-account-key-enable
  - arguments:
    - description: 'A comma-separated list of names of resource name of the service
        account key to disable. Every resource name should be in the following format:
        projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}/keys/{key}'
      isArray: true
      name: key_name
      required: true
    description: Disables a service account key.
    name: gcp-iam-service-account-key-disable
  - arguments:
    - description: 'A comma-separated list of names of resource name of the service
        account key to delete. Every resource name should be in the following format:
        projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}/keys/{key}'
      isArray: true
      name: key_name
      required: true
    description: Deletes a service account key.
    name: gcp-iam-service-account-key-delete
  - arguments:
    - description: The name of the organization that contains the custom role. For
        example organizations/1234567.
      name: organization_name
      required: true
    - description: The unique ID of the role to create. A role ID may contain alphanumeric
        characters, underscores (_), and periods (.). It must contain a minimum of
        3 characters and a maximum of 64 characters.
      name: role_id
      required: true
    - description: The description of the role to create.
      name: description
    - description: The title of the role to create.
      name: title
    - description: A comma-separated list of names of the permissions the role grants
        when bound in an IAM policy.
      isArray: true
      name: permissions
    - auto: PREDEFINED
      description: 'The launch stage of the role. More information can be found here:
        https://cloud.google.com/iam/docs/reference/rest/v1/organizations.roles#rolelaunchstage'
      name: stage
      predefined:
      - ALPHA
      - BETA
      - GA
      - DEPRECATED
      - DISABLED
      - EAP
    description: Creates a custom organization role.
    name: gcp-iam-organization-role-create
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The name of the role.
      type: String
  - arguments:
    - description: The name of the role to update. Must be in the format of organizations/{ORGANIZATION_ID}/roles/{CUSTOM_ROLE_ID}
      name: role_name
      required: true
    - description: The updated description of the role.
      name: description
    - description: The updated title of the role.
      name: title
    - description: A comma-separated list of names of the permissions the role grants
        when bound in an IAM policy. Note that this command argument will replace
        the existing permissions.
      isArray: true
      name: permissions
    - auto: PREDEFINED
      description: A comma-separated list of names of the fields to update.
      name: fields_to_update
      predefined:
      - description
      - title
      - includedPermissions
      - stage
      required: true
    - auto: PREDEFINED
      description: 'The launch stage of the role. More information can be found here:
        https://cloud.google.com/iam/docs/reference/rest/v1/organizations.roles#rolelaunchstage'
      name: stage
      predefined:
      - ALPHA
      - BETA
      - GA
      - DEPRECATED
      - DISABLED
      - EAP
    description: Updates a custom organization role.
    execution: true
    name: gcp-iam-organization-role-update
  - arguments:
    - description: The resource name of the role. Must be in the format of organizations/{ORGANIZATION_ID}/roles/{CUSTOM_ROLE_ID}
      name: role_name
      required: true
    - description: A comma-separated list of names of the permissions to add to the
        role.
      isArray: true
      name: permissions
      required: true
    description: Adds permissions to a custom organization role.
    name: gcp-iam-organization-role-permission-add
  - arguments:
    - description: The resource name of the role. Must be in the format of organizations/{ORGANIZATION_ID}/roles/{CUSTOM_ROLE_ID}
      name: role_name
      required: true
    - description: A comma-separated list of names of the permissions to remove from
        the role.
      name: permissions
      required: true
    description: Removes permissions from a custom organization role.
    name: gcp-iam-organization-role-permission-remove
  - arguments:
    - description: The name of the organization that contains the custom role. For
        example organizations/12345.
      name: organization_name
      required: true
    - auto: PREDEFINED
      defaultValue: "True"
      description: Indicates whether to include permissions in the response.
      name: include_permissions
      predefined:
      - "True"
      - "False"
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 1,000.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    - auto: PREDEFINED
      defaultValue: "False"
      description: If true, roles that have been deleted will also be retrieved.
      name: show_deleted
      predefined:
      - "False"
      - "True"
    - description: Used to filter the retrieved roles by the rule title. The command
        will retrieve the rules that include the provided argument in their title.
      name: title_filter
    - description: A comma-separated list of role permissions. Used to filter the
        retrieved roles by their permissions. The command will retrieve the rules
        that include all the provided permissions in their permissions list. If the
        argument is provided, the command will include the role permissions in the
        output.
      isArray: true
      name: permission_filter
    description: Lists the organization custom roles.
    name: gcp-iam-organization-role-list
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The resource name of the role.
      type: String
  - arguments:
    - description: 'A comma-separated list of organization roles to retrieve. Every
        role name should be in the following format: organizations/{ORGANIZATION_ID}/roles/{CUSTOM_ROLE_ID}'
      isArray: true
      name: role_name
      required: true
    description: Retrieves the organization role information.
    name: gcp-iam-organization-role-get
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The resource name of the role.
      type: String
  - arguments:
    - description: 'A comma-separated list of organization roles to delete. Every
        role name should be in the following format: organizations/{ORGANIZATION_ID}/roles/{CUSTOM_ROLE_ID}'
      isArray: true
      name: role_name
      required: true
    description: Deletes a custom organization role.
    name: gcp-iam-organization-role-delete
  - arguments:
    - description: The ID of the project that contains the custom role.
      name: project_id
      required: true
    - description: The unique ID of the role to create. A role ID may contain alphanumeric
        characters, underscores (_), and periods (.). It must contain a minimum of
        3 characters and a maximum of 64 characters.
      name: role_id
      required: true
    - description: The description of the role to create.
      name: description
    - description: The title of the role to create.
      name: title
    - description: A comma-separated list of names of the permissions the role grants
        when bound in an IAM policy.
      isArray: true
      name: permissions
    - auto: PREDEFINED
      description: 'The launch stage of the role. More information can be found here:
        https://cloud.google.com/iam/docs/reference/rest/v1/organizations.roles#rolelaunchstage'
      name: stage
      predefined:
      - ALPHA
      - BETA
      - GA
      - DEPRECATED
      - DISABLED
      - EAP
    description: Creates a custom project role.
    name: gcp-iam-project-role-create
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The name of the role.
      type: String
  - arguments:
    - description: 'The name of the role to update. Must be in the format of projects/{PROJECT_ID}/roles/{CUSTOM_ROLE_ID}. '
      name: role_name
      required: true
    - description: The updated description of the role.
      name: description
    - description: The updated title of the role.
      name: title
    - description: A comma-separated list of names of the permissions the role grants
        when bound in an IAM policy. Note that this command argument will replace
        the existing permissions.
      isArray: true
      name: permissions
    - auto: PREDEFINED
      description: 'The launch stage of the role. More information can be found here:
        https://cloud.google.com/iam/docs/reference/rest/v1/organizations.roles#rolelaunchstage'
      name: stage
      predefined:
      - ALPHA
      - BETA
      - GA
      - DEPRECATED
      - DISABLED
      - EAP
    - auto: PREDEFINED
      description: A comma-separated list of names of the fields to update.
      name: fields_to_update
      predefined:
      - description
      - title
      - includedPermissions
      - stage
      required: true
    description: Updates a custom project role.
    name: gcp-iam-project-role-update
  - arguments:
    - description: 'The resource name of the role. Must be in the format of projects/{PROJECT_ID}/roles/{CUSTOM_ROLE_ID}. '
      name: role_name
      required: true
    - description: A comma-separated list of names of the permissions to add to the
        role.
      isArray: true
      name: permissions
      required: true
    description: Adds permissions to a custom project role.
    name: gcp-iam-project-role-permission-add
  - arguments:
    - description: 'The resource name of the role. Must be in the format of projects/{PROJECT_ID}/roles/{CUSTOM_ROLE_ID}. '
      name: role_name
      required: true
    - description: A comma-separated list of names of the permissions to remove from
        the role.
      name: permissions
      required: true
    description: Removes permissions from a custom project role.
    name: gcp-iam-project-role-permission-remove
  - arguments:
    - description: The ID of the project that contains the custom role.
      name: project_id
      required: true
    - auto: PREDEFINED
      defaultValue: "True"
      description: Indicates whether to include permissions in the response.
      name: include_permissions
      predefined:
      - "True"
      - "False"
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 1,000.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    - auto: PREDEFINED
      defaultValue: "False"
      description: If true, roles that have been deleted will also be retrieved.
      name: show_deleted
      predefined:
      - "False"
      - "True"
    - description: Used to filter the retrieved roles by the rule title. The command
        will retrieve the rules that include the provided argument in their title.
      name: title_filter
    - description: A comma-separated list of role permissions. Used to filter the
        retrieved roles by their permissions. The command will retrieve the rules
        that include all the provided permissions in their permissions list. If the
        argument is provided, the command will include the role permissions in the
        output.
      isArray: true
      name: permission_filter
    description: Lists a project custom roles.
    name: gcp-iam-project-role-list
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The resource name of the role.
      type: String
  - arguments:
    - description: 'A comma-separated list of project roles to retrieve. Every role
        name should be in the following format: projects/{PROJECT_ID}/roles/{CUSTOM_ROLE_ID}'
      isArray: true
      name: role_name
      required: true
    description: Retrieves a custom project role.
    name: gcp-iam-project-role-get
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The name of the role.
      type: String
  - arguments:
    - description: 'A comma-separated list of project roles to delete. Every role
        name should be in the following format: projects/{PROJECT_ID}/roles/{CUSTOM_ROLE_ID}'
      isArray: true
      name: role_name
      required: true
    description: Deletes a custom project role.
    name: gcp-iam-project-role-delete
  - arguments:
    - description: The name of the resource to query from the list of testable permissions.
        For a project''s resource, provide "projects/project-ID", and for organizations,
        provide "organizations/organization-ID".
      name: resource_name
      required: true
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 1,000.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: Lists every permission that can be tested on a resource.
    name: gcp-iam-testable-permission-list
    outputs:
    - contextPath: GCPIAM.Permission.name
      description: The name of the permissions.
      type: String
    - contextPath: GCPIAM.Permission.stage
      description: The current launch stage of the permission.
      type: String
  - arguments:
    - description: 'A comma-separated list of names of service accounts to delete.
        Every resource name should be in the following format: projects/{PROJECT_ID}/serviceAccounts/{ACCOUNT}.'
      isArray: true
      name: service_account_name
      required: true
    description: Deletes a service account.
    name: gcp-iam-service-account-delete
  - arguments:
    - description: The resource name to query from the list of grantable roles. For
        a project''s resource, provide "projects/project-ID", and for organizations,
        provide "organizations/organization-ID".
      name: resource_name
      required: true
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 1,000.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    description: Lists roles that can be granted on a Google Cloud resource. A role
      is grantable if the IAM policy for the resource can contain bindings to the
      role.
    name: gcp-iam-grantable-role-list
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The name of the role.
      type: String
  - arguments:
    - description: 'A comma-separated list of GCP IAM predefined roles to retrieve.
        Every role name should be in the following format: roles/{ROLE_NAME}'
      isArray: true
      name: role_name
      required: true
    description: Retrieves the GCP IAM predefined role information.
    name: gcp-iam-role-get
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The resource name of the role.
      type: String
  - arguments:
    - auto: PREDEFINED
      defaultValue: "True"
      description: Indicates whether to include permissions in the response.
      name: include_permissions
      predefined:
      - "True"
      - "False"
    - defaultValue: "50"
      description: The maximum number of results to retrieve. Minimum value is 1,
        maximum value is 1,000.
      name: limit
    - defaultValue: "1"
      description: The page number of the results to retrieve. Minimum value is 1.
      name: page
    - auto: PREDEFINED
      defaultValue: "False"
      description: If true, roles that have been deleted will also be retrieved.
      name: show_deleted
      predefined:
      - "False"
      - "True"
    - description: Used to filter the retrieved roles by the rule title. The command
        will retrieve the rules that include the provided argument in their title.
      name: title_filter
    - description: A comma-separated list of role permissions. Used to filter the
        retrieved roles by their permissions. The command will retrieve the rules
        that include all the provided permissions in their permissions list. If the
        argument is provided, the command will include the role permissions in the
        output.
      isArray: true
      name: permission_filter
    description: Lists every predefined role that IAM supports.
    name: gcp-iam-role-list
    outputs:
    - contextPath: GCPIAM.Role.name
      description: The resource name of the role.
      type: String
  - arguments:
    - description: The email address of the privilege-bearing service account for
        which the short-lived token is created.
      name: service_account_email
      required: true
    - defaultValue: "3600"
      description: Lifetime of the Access Token in seconds.
      name: lifetime
      required: true
    description: Create a short-lived access token for a service account. The generated
      token will be exposed to the context menu and War Room, and can potentially
      be logged.
    execution: true
    name: gcp-iam-service-account-generate-access-token
  dockerimage: demisto/google-api-py3:1.0.0.105788
  runonce: false
  script: |
    register_module_line('GCP-IAM', 'start', __line__())
    ### pack version: 1.0.26



    # pylint: disable=no-member
    import copy
    from collections.abc import Callable
    from googleapiclient import discovery
    from oauth2client import service_account
    import httplib2
    from urllib.parse import urlparse


    class Client:
        def __init__(self, client_secret: str, proxy: bool = False, verify_certificate: bool = False):
            client_secret = json.loads(client_secret)
            scopes = ['https://www.googleapis.com/auth/cloud-platform', 'https://www.googleapis.com/auth/cloud-identity',
                      'https://www.googleapis.com/auth/iam', ]
            credentials = service_account.ServiceAccountCredentials.from_json_keyfile_dict(client_secret, scopes=scopes)

            proxies = handle_proxy()

            if proxy or verify_certificate:
                http_client = credentials.authorize(self.get_http_client_with_proxy(
                    proxies, disable_ssl_certificate=not verify_certificate))
                self.cloud_identity_service = discovery.build('cloudidentity', 'v1', http=http_client)
                self.cloud_resource_manager_service = discovery.build('cloudresourcemanager', 'v3', http=http_client)
                self.iam_service = discovery.build('iam', 'v1', http=http_client)
                self.iam_credentials = discovery.build('iamcredentials', 'v1', http=http_client)

            else:
                self.cloud_identity_service = discovery.build('cloudidentity', 'v1', credentials=credentials)
                self.cloud_resource_manager_service = discovery.build('cloudresourcemanager', 'v3', credentials=credentials)
                self.iam_service = discovery.build('iam', 'v1', credentials=credentials)
                self.iam_credentials = discovery.build('iamcredentials', 'v1', credentials=credentials)

        def get_http_client_with_proxy(self, proxies: dict, disable_ssl_certificate: bool = False):
            proxy_info = None
            if proxies:
                if not proxies or not proxies['https']:
                    raise Exception('https proxy value is empty. Check Demisto server configuration')
                https_proxy = proxies['https']
                if not https_proxy.startswith('https') and not https_proxy.startswith('http'):
                    https_proxy = 'https://' + https_proxy
                parsed_proxy = urlparse(https_proxy)
                proxy_info = httplib2.ProxyInfo(
                    proxy_type=httplib2.socks.PROXY_TYPE_HTTP,  # disable-secrets-detection
                    proxy_host=parsed_proxy.hostname,
                    proxy_port=parsed_proxy.port,
                    proxy_user=parsed_proxy.username,
                    proxy_pass=parsed_proxy.password)
            return httplib2.Http(proxy_info=proxy_info, disable_ssl_certificate_validation=disable_ssl_certificate)

        def gcp_iam_tagbindings_list_request(self, parent: str, limit: int = None) -> dict:
            """
            List tag bindings (key value pair) applied to a project/folder/organization object.
            Args:
                parent (str): The name of the parent resource to list projects under.
                limit (int): The number of results to retrieve.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(parent=parent, pageSize=limit)

            request = self.cloud_resource_manager_service.tagBindings().list(**params)
            response = request.execute()

            return response

        def gcp_iam_tagvalues_get_request(self, name: str) -> dict:
            """
            Retrieves a TagValue.
            Args:
                name (str): Resource name for TagValue in the format `tagValues/456`.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(name=name)

            request = self.cloud_resource_manager_service.tagValues().get(**params)
            response = request.execute()

            return response

        def gcp_iam_tagkeys_get_request(self, name: str) -> dict:
            """
            Retrieves a TagKey.
            Args:
                name (str): A resource name in the format `tagKeys/{id}`, such as `tagKeys/123`.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(name=name)

            request = self.cloud_resource_manager_service.tagKeys().get(**params)
            response = request.execute()

            return response

        def gcp_iam_project_list_request(self, parent: str, limit: int = None, page_token: str = None,
                                         show_deleted: bool = False) -> dict:
            """
            List projects under the specified parent.
            Args:
                parent (str): The name of the parent resource to list projects under.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.
                show_deleted (bool): Indicate that projects in the DELETE_REQUESTED state should also be retrieved.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(parent=parent, pageSize=limit, pageToken=page_token, showDeleted=show_deleted)

            request = self.cloud_resource_manager_service.projects().list(**params)
            response = request.execute()

            return response

        def gcp_iam_project_get_request(self, project_name: str) -> dict:
            """
            Retrieve project information.
            Args:
                project_name (str): The project name to retrieve.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(name=project_name)

            request = self.cloud_resource_manager_service.projects().get(**params)
            response = request.execute()

            return response

        def gcp_iam_project_iam_policy_get_request(self, project_name: str) -> dict:
            """
            Retrieve the IAM access control policy for the specified project.
            Args:
                project_name (str): The project name for which the policy is being requested.

            Returns:
                dict: API response from GCP.

            """

            params = assign_params(resource=project_name)

            request = self.cloud_resource_manager_service.projects().getIamPolicy(**params)
            response = request.execute()

            return response

        def gcp_iam_project_iam_test_permission_request(self, project_name: str, permissions: list) -> dict:
            """
            Returns permissions that a caller has on the specified project.
            Args:
                project_name (str): The project name for which the permissions is being tested.
                permissions (list): Permissions names to validate.

            Returns:
                dict: API response from GCP.

            """
            body = {
                "permissions": permissions
            }

            request = self.cloud_resource_manager_service.projects().testIamPermissions(resource=project_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_project_iam_policy_set_request(self, project_name: str, policy: list) -> dict:
            """
            Sets the IAM access control policy for the specified project.
            Args:
                project_name (str): The name of the project for which the policy is being specified.
                policy (list): Policy objects to set.

            Returns:
                dict: API response from GCP.

            """
            body = {
                "policy": {
                    "bindings": policy
                }
            }

            request = self.cloud_resource_manager_service.projects().setIamPolicy(resource=project_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_folder_list_request(self, parent: str, limit: int = None, page_token: str = None,
                                        show_deleted: bool = False) -> dict:
            """
            List folders under the specified parent.
            Args:
                parent (str): The name of the parent resource to list folders under.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.
                show_deleted (bool): Indicate that folders in the DELETE_REQUESTED state should also be retrieved.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(parent=parent, pageSize=limit, pageToken=page_token, showDeleted=show_deleted)

            request = self.cloud_resource_manager_service.folders().list(**params)
            response = request.execute()

            return response

        def gcp_iam_folder_get_request(self, folder_name: str) -> dict:
            """
            Retrieve folder information.
            Args:
                folder_name (str): The name of the folder to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.cloud_resource_manager_service.folders().get(name=folder_name)
            response = request.execute()

            return response

        def gcp_iam_folder_iam_policy_get_request(self, folder_name: str) -> dict:
            """
            Retrieve the IAM access control policy for the specified folder.
            Args:
                folder_name (str): The folder name for which the policy is being requested.

            Returns:
                dict: API response from GCP.

            """

            params = assign_params(resource=folder_name)

            request = self.cloud_resource_manager_service.folders().getIamPolicy(**params)
            response = request.execute()

            return response

        def gcp_iam_folder_iam_test_permission_request(self, folder_name: str, permissions: list) -> dict:
            """
            Returns permissions that a caller has on the specified folder.
            Args:
                folder_name (str): The folder name for which the permissions is being tested.
                permissions (list): Permissions names to validate.

            Returns:
                dict: API response from GCP.

            """
            body = {
                "permissions": permissions
            }

            request = self.cloud_resource_manager_service.folders().testIamPermissions(resource=folder_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_folder_iam_policy_set_request(self, folder_name: str, policy: list) -> dict:
            """
            Sets the IAM access control policy for the specified folder.
            Args:
                folder_name (str): The name of the folder for which the policy is being specified.
                policy (list): Policy objects to set.

            Returns:
                dict: API response from GCP.

            """
            body = {
                "policy": {
                    "bindings": policy
                }
            }

            request = self.cloud_resource_manager_service.folders().setIamPolicy(resource=folder_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_organization_list_request(self, limit: int = None, page_token: str = None) -> dict:
            """
            List organization resources that are visible to the caller.
            Args:
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(pageSize=limit, pageToken=page_token)

            request = self.cloud_resource_manager_service.organizations().search(**params)
            response = request.execute()

            return response

        def gcp_iam_organization_get_request(self, organization_name: str) -> dict:
            """
            Retrieve organization information.
            Args:
                organization_name (str): The name of the organization to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.cloud_resource_manager_service.organizations().get(name=organization_name)
            response = request.execute()

            return response

        def gcp_iam_organization_iam_policy_get_request(self, organization_name: str) -> dict:
            """
            Retrieve the IAM access control policy for the specified organization.
            Args:
                organization_name (str): The organization name for which the policy is being requested.

            Returns:
                dict: API response from GCP.

            """
            request = self.cloud_resource_manager_service.organizations().getIamPolicy(resource=organization_name)
            response = request.execute()

            return response

        def gcp_iam_organization_iam_test_permission_request(self, organization_name: str, permissions: list) -> dict:
            """
            Returns permissions that a caller has on the specified organization.
            Args:
                organization_name (str): The organization name for which the permissions is being tested.
                permissions (list): Permissions names to validate.

            Returns:
                dict: API response from GCP.

            """
            body = {
                "permissions": permissions
            }

            request = self.cloud_resource_manager_service.organizations().testIamPermissions(resource=organization_name,
                                                                                             body=body)
            response = request.execute()

            return response

        def gcp_iam_organization_iam_policy_set_request(self, organization_name: str, policy: list) -> dict:
            """
            Sets the IAM access control policy for the specified organization.
            Args:
                organization_name (str): The name of the organization for which the policy is being specified.
                policy (list): Policy objects to set.

            Returns:
                dict: API response from GCP.

            """
            body = {
                "policy": {
                    "bindings": policy
                }
            }

            request = self.cloud_resource_manager_service.organizations().setIamPolicy(resource=organization_name,
                                                                                       body=body)
            response = request.execute()

            return response

        def gcp_iam_group_create_request(self, parent: str, display_name: str, group_email_address: str,
                                         description: str = None):
            """
            Create a new group.
            Args:
                parent (str): The parent resource of the groups to create.
                display_name (str): The display name of the group.
                group_email_address (str): The group unique email address.
                description (str): The description of the group.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(initialGroupConfig='WITH_INITIAL_OWNER')

            body = remove_empty_elements({
                "parent": parent,
                "description": description,
                "displayName": display_name,
                "labels": {
                    "cloudidentity.googleapis.com/groups.discussion_forum": ""
                },
                "groupKey": {
                    "id": group_email_address
                }
            })

            request = self.cloud_identity_service.groups().create(**params, body=body)
            response = request.execute()

            return response

        def gcp_iam_group_list_request(self, parent: str, limit: int = None, page_token: str = None) -> dict:
            """
            List groups under the specified parent.
            Args:
                parent (str): The parent resource of the groups to retrieve
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(parent=parent, pageSize=limit, pageToken=page_token)

            request = self.cloud_identity_service.groups().list(**params)
            response = request.execute()

            return response

        def gcp_iam_group_get_request(self, group_name: str) -> dict:
            """
            Retrieve a group information.
            Args:
                group_name (str): The name of the group to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.cloud_identity_service.groups().get(name=group_name)
            response = request.execute()

            return response

        def gcp_iam_group_delete_request(self, group_name: str):
            """
             Delete group.
             Args:
                 group_name (str): The name of the group to delete.

             Returns:
                 dict: API response from GCP.

             """
            request = self.cloud_identity_service.groups().delete(name=group_name)
            response = request.execute()

            return response

        def gcp_iam_group_membership_create_request(self, group_name: str, member_email: str, roles: list) -> dict:
            """
            Create a group membership
            Args:
                group_name (str): The name of the group which will contain the membership.
                member_email (str): The email address of the user to add to the group.
                roles (list): Roles to apply to the membership.

             Returns:
                 dict: API response from GCP.

            """
            body_roles = [{"name": role} for role in roles]
            body = {
                "preferredMemberKey": {
                    "id": member_email
                },
                "roles": body_roles
            }

            request = self.cloud_identity_service.groups().memberships().create(parent=group_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_group_membership_list_request(self, group_name: str, limit: int = None, page_token: str = None) -> dict:
            """
            List group memberships.
            Args:
                group_name (str): The name of the group which contains the membership.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(parent=group_name, pageSize=limit, pageToken=page_token)

            request = self.cloud_identity_service.groups().memberships().list(**params)
            response = request.execute()

            return response

        def gcp_iam_group_membership_get_request(self, membership_name: str):
            """
            Retrieve group membership information.
            Args:
                membership_name (str): The name of the group membership to retrieve.

            Returns:
                dict: API response from GCP.

            """

            request = self.cloud_identity_service.groups().memberships().get(name=membership_name)
            response = request.execute()

            return response

        def gcp_iam_group_membership_role_add_request(self, membership_name: str, roles: list) -> dict:
            """
            Add group membership role.
            Args:
                membership_name (str): The name of the group membership to update.
                roles (list): Membership roles to add to the membership.

            Returns:
                dict: API response from GCP.

            """
            body_roles = [{"name": role} for role in roles]
            body = {
                "addRoles": body_roles
            }

            request = self.cloud_identity_service.groups().memberships().modifyMembershipRoles(name=membership_name,
                                                                                               body=body)
            response = request.execute()

            return response

        def gcp_iam_group_membership_role_remove_request(self, membership_name: str, roles: list) -> dict:
            """
            Remove group membership role.
            Args:
                membership_name (str): The name of the group membership to update.
                roles (list): Membership roles to remove from the membership.

            Returns:
                dict: API response from GCP.

            """
            body = {
                "removeRoles": roles
            }

            request = self.cloud_identity_service.groups().memberships().modifyMembershipRoles(name=membership_name,
                                                                                               body=body)
            response = request.execute()

            return response

        def gcp_iam_group_membership_delete_request(self, membership_name: str) -> dict:
            """
            Delete group membership.
            Args:
                membership_name (str): The resource name of the membership to delete.

            Returns:
                dict: API response from GCP.

            """

            request = self.cloud_identity_service.groups().memberships().delete(name=membership_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_create_request(self, project_name: str, service_account_id: str,
                                                   display_name: str = None, description: str = None):
            """
            Create a service account in project.
            Args:
                project_name (str): The name of the project associated with the service account.
                service_account_id (str): The account ID that is used to generate the service account email address,
                                       and a stable unique ID.
                display_name (str): Human readable name for the created service account.
                description (str): Human readable description for created the service account.

            Returns:
                dict: API response from GCP.

            """
            body = remove_empty_elements({"accountId": service_account_id,
                                          "serviceAccount":
                                              {
                                                  "displayName": display_name,
                                                  "description": description
                                              }
                                          })

            request = self.iam_service.projects().serviceAccounts().create(name=project_name, body=body)

            response = request.execute()

            return response

        def gcp_iam_service_account_update_request(self, service_account_name: str, fields_to_update: str,
                                                   display_name: str = None, description: str = None) -> dict:
            """
            Update service account.
            Args:
                service_account_name (str): The name of the service account to update.
                fields_to_update (str): Comma-separated names of the fields to update.
                display_name (str): Human readable name for the updated service account.
                description (str): Human readable description for updated the service account.

            Returns:
                dict: API response from GCP.

            """
            body = remove_empty_elements({
                "serviceAccount":
                    {"displayName": display_name,
                     "description": description
                     },
                "updateMask": fields_to_update
            })

            request = self.iam_service.projects().serviceAccounts().patch(name=service_account_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_service_account_list_request(self, project_name: str, limit: int = None,
                                                 page_token: str = None) -> dict:
            """
            List service accounts in project.
            Args:
                project_name (str): The name of the project associated with the service accounts to retrieve.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(name=project_name, pageSize=limit, pageToken=page_token)

            request = self.iam_service.projects().serviceAccounts().list(**params)
            response = request.execute()

            return response

        def gcp_iam_service_account_get_request(self, service_account_name: str) -> dict:
            """
            Retrieve project service account information.
            Args:
                service_account_name (str): The name of service account to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().get(name=service_account_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_enable_request(self, service_account_name: str) -> dict:
            """
            Enable project service account.
            Args:
                service_account_name (str): The name of service account to enable.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().enable(name=service_account_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_disable_request(self, service_account_name: str) -> dict:
            """
            Disable project service account.
            Args:
                service_account_name (str): The name of service account to disable.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().disable(name=service_account_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_delete_request(self, service_account_name: str) -> dict:
            """
            Delete service account key.
            Args:
                service_account_name (str): The name of service account to delete.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().delete(name=service_account_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_key_create_request(self, service_account_name: str, key_algorithm: str) -> dict:
            """
            Create a service account key.
            Args:
                service_account_name (str): The name of the service account associated with the key.
                key_algorithm (str): The RSA key algorithm.

            Returns:
                dict: API response from GCP.

            """
            body = assign_params(keyAlgorithm=key_algorithm)

            request = self.iam_service.projects().serviceAccounts().keys().create(name=service_account_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_service_account_key_list_request(self, service_account_name: str) -> dict:
            """
            List service accounts keys.
            Args:
                service_account_name (str): The name of the service account associated with the keys.

            Returns:
                dict: API response from GCP.

            """

            request = self.iam_service.projects().serviceAccounts().keys().list(name=service_account_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_key_get_request(self, key_name: str) -> dict:
            """
            Retrieve service account key information.
            Args:
                key_name (str): The resource name of the service account key to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().keys().get(name=key_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_key_enable_request(self, key_name: str) -> dict:
            """
            Enable service account key.
            Args:
                key_name (str): The resource name of the service account key to enable.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().keys().enable(name=key_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_key_disable_request(self, key_name: str) -> dict:
            """
            Disable service account key.
            Args:
                key_name (str): The resource name of the service account key to disable.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().keys().disable(name=key_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_key_delete_request(self, key_name: str) -> dict:
            """
            Delete service account key.
            Args:
                key_name (str): The resource name of the service account key to delete.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().serviceAccounts().keys().delete(name=key_name)
            response = request.execute()

            return response

        def gcp_iam_service_account_generate_access_token_request(self, service_account_email: str, lifetime: str) -> dict:
            """
            Create a short-lived access token
            Args:
                service_account_email (str): E-Mail of the Service Account for wich the token should be generated

                lifetime (str): Lifetime of the token in seconds. Like 3600

            Returns:
                dict: API response from GCP.

            """
            resource_name = f"projects/-/serviceAccounts/{service_account_email}"
            body = {
                "scope": [
                    "https://www.googleapis.com/auth/cloud-platform"
                ],
                "lifetime": f"{arg_to_number(lifetime, required=True)}s"
            }

            request = self.iam_credentials.projects().serviceAccounts().generateAccessToken(name=resource_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_organization_role_create_request(self, organization_name: str, role_id: str, stage: str = None,
                                                     description: str = None, title: str = None,
                                                     permissions: list = None) -> dict:
            """
            Create a custom organization role.
            Args:
                organization_name (str): The name of the organization which contains the custom role.
                role_id (str): The unique ID of the role to create.
                stage (str): The current launch stage of the role.
                description (str): The description of the role to create.
                title (str): The title of the role to create.
                permissions (list): Permissions the role grants when bound in an IAM policy.

            Returns:
                dict: API response from GCP.

            """
            body = remove_empty_elements({
                "roleId": role_id,
                "role": {
                    "title": title,
                    "description": description,
                    "includedPermissions": permissions,
                    "stage": stage
                }
            })

            request = self.iam_service.organizations().roles().create(parent=organization_name, body=body)
            response = request.execute()

            return response

        def gcp_iam_organization_role_update_request(self, role_name: str, description: str = None,
                                                     title: str = None, permissions: list = None,
                                                     stage: str = None, fields_to_update: str = None) -> dict:
            """
            Update a custom organization role.
            Args:
                role_name (str): The name of the role to update.
                description (str): The updated description of the role.
                title (str): The updated title of the role.
                permissions (list): Permissions the role grants when bound in an IAM policy.
                stage (str): The current launch stage of the role.
                fields_to_update (str): Comma-separated names of the fields to update.

            Returns:
                dict: API response from GCP.

            """
            body = remove_empty_elements({
                "title": title,
                "description": description,
                "includedPermissions": permissions,
                "stage": stage
            })

            request = self.iam_service.organizations().roles().patch(name=role_name, body=body, updateMask=fields_to_update)
            response = request.execute()

            return response

        def gcp_iam_organization_role_list_request(self, parent: str, include_permissions: bool,
                                                   limit: int, page_token: str = None, show_deleted: bool = False) -> dict:
            """
            List organization custom roles.
            Args:
                parent (str): The name of the organization which contains the custom roles.
                include_permissions (bool): Indicates whether to include permissions in the response.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.
                show_deleted (bool): Indicate that roles that have been deleted should also be retrieved.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(parent=parent, pageSize=limit, pageToken=page_token, showDeleted=show_deleted,
                                   view="FULL" if include_permissions else "BASIC")

            request = self.iam_service.organizations().roles().list(**params)
            response = request.execute()

            return response

        def gcp_iam_predefined_role_list_request(self, include_permissions: bool,
                                                 limit: int, page_token: str = None, show_deleted: bool = False) -> dict:
            """
            List GCP IAM predefined roles.
            Args:
                include_permissions (bool): Indicates whether to include permissions in the response.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.
                show_deleted (bool): Indicate that roles that have been deleted should also be retrieved.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(pageSize=limit, pageToken=page_token, showDeleted=show_deleted,
                                   view="FULL" if include_permissions else "BASIC")

            request = self.iam_service.roles().list(**params)
            response = request.execute()

            return response

        def gcp_iam_organization_role_get_request(self, role_name: str) -> dict:
            """
            Retrieve organization role information.
            Args:
                role_name (str): The resource name of the role to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.organizations().roles().get(name=role_name)
            response = request.execute()

            return response

        def gcp_iam_organization_role_delete_request(self, role_name: str) -> dict:
            """
            Delete a custom organization role.
            Args:
                (str): The name of the role to delete.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.organizations().roles().delete(name=role_name)
            response = request.execute()

            return response

        def gcp_iam_project_role_create_request(self, project_id: str, role_id: str, stage: str = None,
                                                description: str = None, title: str = None,
                                                permissions: list = None) -> dict:
            """
            Create a custom project role.
            Args:
                project_id (str): The ID of the project which contains the custom role.
                role_id (str): The unique ID of the role to create.
                stage (str): The current launch stage of the role.
                description (str): The description of the role to create.
                title (str): The title of the role to create.
                permissions (list): Permissions the role grants when bound in an IAM policy.

            Returns:
                dict: API response from GCP.

            """
            body = remove_empty_elements({
                "roleId": role_id,
                "role": {
                    "title": title,
                    "description": description,
                    "includedPermissions": permissions,
                    "stage": stage
                }
            })

            request = self.iam_service.projects().roles().create(parent=f'projects/{project_id}', body=body)
            response = request.execute()

            return response

        def gcp_iam_project_role_update_request(self, role_name: str, description: str = None,
                                                title: str = None, permissions: list = None,
                                                stage: str = None, fields_to_update: str = None) -> dict:
            """
            Update a custom project role.
            Args:
                role_name (str): The name of the role to update.
                description (str): The updated description of the role.
                title (str): The updated title of the role.
                permissions (list): Permissions the role grants when bound in an IAM policy.
                stage (str): The current launch stage of the role.
                fields_to_update (str): Comma-separated names of the fields to update.

            Returns:
                dict: API response from GCP.

            """
            body = remove_empty_elements({
                "title": title,
                "description": description,
                "includedPermissions": permissions,
                "stage": stage
            })

            request = self.iam_service.projects().roles().patch(name=role_name, body=body, updateMask=fields_to_update)
            response = request.execute()

            return response

        def gcp_iam_project_role_list_request(self, parent: str, include_permissions: bool,
                                              limit: int, page_token: str = None, show_deleted: bool = False) -> dict:
            """
            List project custom roles.
            Args:
                parent (str): The ID of the project which contains the custom roles.
                include_permissions (bool): Indicates whether to include permissions in the response.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.
                show_deleted (bool): Indicate that roles that have been deleted should also be retrieved.

            Returns:
                dict: API response from GCP.

            """
            params = assign_params(parent=f'projects/{parent}', pageSize=limit, pageToken=page_token,
                                   showDeleted=show_deleted,
                                   view="FULL" if include_permissions else "BASIC")

            request = self.iam_service.projects().roles().list(**params)
            response = request.execute()

            return response

        def gcp_iam_project_role_get_request(self, role_name: str) -> dict:
            """
            Retrieve project role information.
            Args:
                role_name (str): The resource name of the role to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().roles().get(name=role_name)
            response = request.execute()

            return response

        def gcp_iam_predefined_role_get_request(self, role_name: str) -> dict:
            """
            Retrieve GCP IAM predefined role information.
            Args:
                role_name (str): The resource name of the role to retrieve.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.roles().get(name=role_name)
            response = request.execute()

            return response

        def gcp_iam_project_role_delete_request(self, role_name: str) -> dict:
            """
            Delete a custom project role.
            Args:
                (str): The name of the role to delete.

            Returns:
                dict: API response from GCP.

            """
            request = self.iam_service.projects().roles().delete(name=role_name)
            response = request.execute()

            return response

        def gcp_iam_testable_permission_list_request(self, full_resource_name: str, limit: int = None,
                                                     page_token: str = None) -> dict:
            """
            Lists permissions that can be tested on a resource.
            Args:
                full_resource_name (str): The full resource name to query from the list of testable permissions.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.

            Returns:
                dict: API response from GCP.

            """
            body = assign_params(fullResourceName=full_resource_name, pageSize=limit, pageToken=page_token)

            request = self.iam_service.permissions().queryTestablePermissions(body=body)
            response = request.execute()

            return response

        def gcp_iam_grantable_role_list_request(self, full_resource_name: str, limit: int = None,
                                                page_token: str = None) -> dict:
            """
            Lists roles that can be granted on a Google Cloud resource.
            Args:
                full_resource_name (str): The full resource name to query from the list of grantable roles.
                limit (int): The number of results to retrieve.
                page_token (str): Pagination token returned from a previous request.

            Returns:
                dict: API response from GCP.

            """
            body = assign_params(fullResourceName=full_resource_name, pageSize=limit, pageToken=page_token)

            request = self.iam_service.roles().queryGrantableRoles(body=body)
            response = request.execute()

            return response


    def get_pagination_readable_message(header: str, limit: int, page: int) -> str:
        """
        Generate pagination commands readable message.
        Args:
            header (str): Message header
            limit (int): Number of elements to retrieve.
            page (int): Page number.

        Returns:
            str: Readable message.

        """
        readable_message = f'{header}\n Current page size: {limit}\n Showing page {page} out of others that may exist.'

        return readable_message


    def get_next_page_token(limit: int, page: int, client_request: Callable, args: dict) -> str:
        """
        Get next request page token for request pagination.
        Args:
            limit (int): Number of elements to retrieve.
            page (int): Page number.
            client_request (Callable): Client request function.
            args (dict): Request function arguments.

        Returns:
            str: Continuation token.

        """
        offset = limit * (page - 1)
        response = client_request(limit=offset, **args)
        return response.get('nextPageToken')


    def validate_pagination_arguments(limit: int, page: int) -> None:
        """
        Validate pagination arguments values.
        Args:
            limit (int): Number of elements to retrieve.
            page (int): Page number.

        """
        if page < 1 or limit < 1:
            raise Exception('Page and limit arguments must be greater than 0.')


    def update_time_format(data: Union[dict, list], keys: list) -> list:
        """
        Update dictionary time values to appropriate XSOAR system time format.
        Args:
            data (dict/list): Information to update.
            keys (list): Keys to update.

        Returns:
            list: Updated information.

        """
        if not isinstance(data, list):
            data = [data]

        for item in data:
            for key in keys:
                if key in item:
                    item[key] = arg_to_datetime(item[key]).isoformat()  # type: ignore[union-attr]

        return data


    def generate_iam_policy_command_output(response: dict, resource_name: str = None,
                                           readable_header: str = None, limit: int = None,
                                           page: int = None, roles: list = None) -> CommandResults:
        """
        Generate command output for iam-policy commands.
        Args:
            response (dict): API response from GCP.
            resource_name (str): The resource for which the policy is being specified.
            readable_header (str): Readable message header for XSOAR war room.
            limit (int): Number of elements to retrieve.
            page (int): Page number.
            role (list): List of potential GCP IAM roles

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if not readable_header:
            readable_header = f'{resource_name} IAM policy information:'
        outputs = copy.deepcopy(response)
        outputs['name'] = resource_name
        bindings = outputs.get("bindings", [])
        if roles and bindings:
            bindings_roles_only = []
            for index, entry in enumerate(bindings):
                if entry.get("role") in roles:
                    bindings_roles_only.append(bindings[index])

            bindings = bindings_roles_only

        if limit and page:
            start = (page - 1) * limit
            end = start + limit
            outputs["bindings"] = bindings[start:end]
            if len(bindings) < limit:
                resource_type = readable_header.split(' ')[0]
                readable_header = f'{resource_type} {resource_name} IAM Policy List:\n Current page size: {len(bindings)}'

        readable_output = tableToMarkdown(
            readable_header,
            outputs.get('bindings'),
            headers=['role', 'members'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Policy',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def generate_group_membership_readable_output(outputs: list, readable_header: str) -> str:
        """
        Generate command readable output for group membership commands.
        Args:
            outputs (dict): API response from GCP.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            tableToMarkdown: XSOAR war room output.

        """
        readable_information = []
        for membership in outputs:
            readable_information.append({
                "name": membership.get('name'),
                "roles": [role.get('name') for role in membership.get('roles')],
                "preferredMemberKey": dict_safe_get(membership, ['preferredMemberKey', 'id'])
            })

        headers = ['name', 'roles']

        if len(readable_information) > 0 and readable_information[0].get("preferredMemberKey"):
            headers.append("preferredMemberKey")

        readable_output = tableToMarkdown(readable_header,
                                          readable_information,
                                          headers=headers,
                                          headerTransform=pascalToSpace
                                          )

        return readable_output


    def generate_group_membership_command_output(response: dict, output_key: str = None,
                                                 readable_header: str = 'Membership information:') -> CommandResults:
        """
        Generate command output for group membership commands.
        Args:
            response (dict): API response from GCP.
            output_key (str): Used to access to required data in the response.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if output_key:
            outputs = copy.deepcopy(response.get(output_key, []))
        else:
            outputs = copy.deepcopy(response)

        if not isinstance(outputs, list):
            outputs = [outputs]

        outputs = update_time_format(outputs, ['createTime', 'updateTime'])

        readable_output = generate_group_membership_readable_output(outputs, readable_header)

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Membership',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def remove_members_from_policy(role: str, iam_policy: list, members: list, command_name: str) -> list:
        """
        Remove members from policy role.
        Args:
            role (str): The name of policy role.
            iam_policy (list): IAM policies.
            members (list): Members to remove from policy.
            command_name (str): An alternative  command that will be displayed to the user in case of an error.

        Returns:
            list: Updated policies.

        """
        role_found = False
        for policy in iam_policy:
            if policy.get('role') == role:
                for member in members:
                    try:
                        policy['members'].remove(member)
                    except ValueError:
                        raise Exception(f'The member {member} is not part of the project IAM policies members.'
                                        f'If you wish to add a new policy, consider using the {command_name} command.')
                role_found = True
                break

        if not role_found:
            raise Exception('The provided role is not part of the project IAM policies.'
                            f'If you wish to add a new policy, consider using the {command_name} command.')

        return iam_policy


    def add_members_to_policy(role: str, iam_policy: list, members: list, command_name: str) -> list:
        """
        Append members to policy role members.
        Args:
            role (str): The name of policy role.
            iam_policy (list): IAM policies.
            members (list): Members to append to policy.
            command_name (str): An alternative  command that will be displayed to the user in case of an error.

        Returns:
            list: Updated policies.

        """
        role_found = False
        for policy in iam_policy:
            if policy.get('role') == role:
                policy['members'].extend(members)
                role_found = True
                break

        if not role_found:
            raise Exception('The provided role is not part of the project IAM policies.'
                            f'If you wish to add a new policy, consider using the {command_name} command.')

        return iam_policy


    def generate_service_account_command_output(response: dict, output_key: str = None,
                                                readable_header: str = 'Service account information:') -> CommandResults:
        """
        Generate command output for service account commands.
        Args:
            response (dict): API response from GCP.
            output_key (str): Used to access to required data in the response.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if output_key:
            outputs = copy.deepcopy(response.get(output_key, []))
        else:
            outputs = copy.deepcopy(response)

        if not isinstance(outputs, list):
            outputs = [outputs]

        for output in outputs:
            output["disabled"] = output.get("disabled", False)

        readable_output = tableToMarkdown(readable_header,
                                          outputs,
                                          headers=["name", "displayName", "description", "projectId"],
                                          headerTransform=pascalToSpace
                                          )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.ServiceAccount',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def generate_project_command_output(response: dict, output_key: str = None,
                                        readable_header: str = 'Project information:') -> CommandResults:
        """
        Generate command output for project commands.
        Args:
            response (dict): API response from GCP.
            output_key (str): Used to access to required data in the response.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if output_key:
            outputs = copy.deepcopy(response.get(output_key, []))
        else:
            outputs = copy.deepcopy(response)

        if not isinstance(outputs, list):
            outputs = [outputs]

        outputs = update_time_format(outputs, ['createTime', 'updateTime', 'deleteTime'])

        readable_output = tableToMarkdown(
            readable_header,
            outputs,
            headers=['name', 'parent', 'projectId', 'displayName', 'createTime', 'updateTime'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Project',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def gcp_iam_projects_get_command(client: Client, args: Dict[str, Any]) -> list:
        """
        List projects under the specified parent, or retrieve specific project information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """

        project_name = argToList(args.get('project_name'))

        command_results_list: List[CommandResults] = []

        if project_name:  # Retrieve specific project information.

            for project in project_name:
                readable_message = f'Project {project} information:'
                try:
                    response = client.gcp_iam_project_get_request(project)

                    command_results = generate_project_command_output(response=response, readable_header=readable_message)

                    command_results_list.append(command_results)

                except Exception as exception:
                    error = CommandResults(
                        readable_output=f'An error occurred while retrieving {project}.\n {exception}'
                    )
                    command_results_list.append(error)

        else:  # List project resources.
            parent = args.get('parent')
            show_deleted = argToBoolean(args.get('show_deleted', False))

            if not parent:
                raise Exception("One of the arguments: 'parent' or 'project_name' must be provided.")
            limit = arg_to_number(args.get('limit')) or 50
            page = arg_to_number(args.get('page')) or 1
            max_limit = 100

            validate_pagination_arguments(limit, page)
            if limit > max_limit:
                raise Exception("The limit argument is out of range. It must be between 1 and 100.")

            readable_message = get_pagination_readable_message(header='Projects List:', limit=limit, page=page)

            if page > 1:
                response = get_pagination_request_result(limit, page, max_limit,
                                                         client.gcp_iam_project_list_request,
                                                         parent=parent,
                                                         show_deleted=show_deleted)

            else:
                response = client.gcp_iam_project_list_request(parent=parent, limit=limit, show_deleted=show_deleted)

            command_results = generate_project_command_output(response=response, output_key='projects',
                                                              readable_header=readable_message)

            command_results_list.append(command_results)

        return command_results_list


    def gcp_iam_project_iam_policy_get_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve the IAM access control policy for the specified project.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1
        roles = argToList(args.get('roles', []))
        validate_pagination_arguments(limit, page)

        readable_message = get_pagination_readable_message(header=f'Project {project_name} IAM Policy List:',
                                                           limit=limit, page=page)

        response = client.gcp_iam_project_iam_policy_get_request(project_name)
        return generate_iam_policy_command_output(response, project_name, readable_header=readable_message,
                                                  limit=limit, page=page, roles=roles)


    def generate_test_permission_command_output(response: dict, readable_header: str) -> CommandResults:
        """
        Generate command output for test permission commands.
        Args:
            response (dict): API response from GCP.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        outputs = [{"name": permission} for permission in copy.deepcopy(response.get('permissions', []))]

        readable_output = tableToMarkdown(
            readable_header,
            outputs,
            headers=['name'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Permission',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def gcp_iam_project_iam_test_permission_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve permissions that a caller has on the specified project.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        permissions = argToList(args.get('permissions'))

        response = client.gcp_iam_project_iam_test_permission_request(project_name, permissions)

        return generate_test_permission_command_output(response, readable_header=f'Project {project_name} permissions:')


    def gcp_iam_project_iam_member_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add members to project policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        role = args.get('role', '')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_project_iam_policy_get_request(project_name).get("bindings", [])
        updated_policies = add_members_to_policy(role=role, iam_policy=iam_policy, members=members,
                                                 command_name='gcp-iam-project-iam-policy-create')

        client.gcp_iam_project_iam_policy_set_request(project_name, updated_policies)

        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def gcp_iam_project_iam_member_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove members from project policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        role = args.get('role', '')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_project_iam_policy_get_request(project_name).get("bindings", [])
        updated_policies = remove_members_from_policy(role=role, iam_policy=iam_policy, members=members,
                                                      command_name='gcp-iam-project-iam-policy-create')

        client.gcp_iam_project_iam_policy_set_request(project_name, updated_policies)

        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def gcp_iam_project_iam_policy_set_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Sets the IAM access control policy for the specified project.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        policy = args.get('policy')
        if isinstance(policy, str):
            policy = policy.replace("\'", "\"")
            if policy and not policy.startswith('['):
                policy = '[' + policy + ']'

        policy = safe_load_json(policy)

        response = client.gcp_iam_project_iam_policy_set_request(project_name, policy)
        return generate_iam_policy_command_output(response, project_name,
                                                  readable_header=f'{project_name} IAM policy updated successfully.')


    def gcp_iam_project_iam_policy_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add new project IAM policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        role = args.get('role')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_project_iam_policy_get_request(project_name).get("bindings", [])
        policy = {
            "role": role,
            "members": members
        }

        iam_policy.append(policy)

        client.gcp_iam_project_iam_policy_set_request(project_name, iam_policy)
        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def generate_folder_command_output(response: dict, output_key: str = None,
                                       readable_header: str = 'Folder information:') -> CommandResults:
        """
        Generate command output for folder commands.
        Args:
            response (dict): API response from GCP.
            output_key (str): Used to access to required data in the response.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if output_key:
            outputs = copy.deepcopy(response.get(output_key, []))
        else:
            outputs = copy.deepcopy(response)

        if not isinstance(outputs, list):
            outputs = [outputs]

        outputs = update_time_format(outputs, ['createTime', 'updateTime', 'deleteTime'])

        readable_output = tableToMarkdown(
            readable_header,
            outputs,
            headers=['name', 'parent', 'displayName', 'createTime', 'updateTime'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Folder',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def gcp_iam_folders_get_command(client: Client, args: Dict[str, Any]) -> list:
        """
        List folders under the specified parent, or retrieve specific folder information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = argToList(args.get('folder_name'))

        command_results_list: List[CommandResults] = []

        if folder_name:  # Retrieve specific folder information

            for folder in folder_name:
                readable_message = f'Folder {folder} information:'
                try:
                    response = client.gcp_iam_folder_get_request(folder)

                    command_results = generate_folder_command_output(response=response, readable_header=readable_message)

                    command_results_list.append(command_results)

                except Exception as exception:
                    error = CommandResults(
                        readable_output=f'An error occurred while retrieving {folder}.\n {exception}'
                    )
                    command_results_list.append(error)

        else:  # List folder under the specified parent.

            parent = args.get('parent')
            show_deleted = argToBoolean(args.get('show_deleted', False))

            if not parent:
                raise Exception("One of the arguments: 'parent' or 'folder_name' must be provided.")

            limit = arg_to_number(args.get('limit')) or 50
            page = arg_to_number(args.get('page')) or 1
            max_limit = 100

            validate_pagination_arguments(limit, page)
            if limit > max_limit:
                raise Exception("The limit argument is out of range. It must be between 1 and 100.")

            readable_message = get_pagination_readable_message(header='Folders List:', limit=limit, page=page)

            if page > 1:
                response = get_pagination_request_result(limit, page, max_limit,
                                                         client.gcp_iam_folder_list_request,
                                                         parent=parent,
                                                         show_deleted=show_deleted)

            else:
                response = client.gcp_iam_folder_list_request(parent=parent, limit=limit, show_deleted=show_deleted)

            command_results = generate_folder_command_output(response=response, output_key='folders',
                                                             readable_header=readable_message)

            command_results_list.append(command_results)

        return command_results_list


    def gcp_iam_folder_iam_policy_get_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve the IAM access control policy for the specified folder.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = args.get('folder_name', '')
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1
        validate_pagination_arguments(limit, page)

        readable_message = get_pagination_readable_message(header=f'Folder {folder_name} IAM Policy List:',
                                                           limit=limit, page=page)

        response = client.gcp_iam_folder_iam_policy_get_request(folder_name)
        return generate_iam_policy_command_output(response, folder_name, readable_header=readable_message,
                                                  limit=limit, page=page)


    def gcp_iam_folder_iam_test_permission_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve permissions that a caller has on the specified folder.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = args.get('folder_name', '')
        permissions = argToList(args.get('permissions'))

        response = client.gcp_iam_folder_iam_test_permission_request(folder_name, permissions)
        return generate_test_permission_command_output(response, readable_header=f'Folder {folder_name} permissions:')


    def gcp_iam_folder_iam_member_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add members to folder policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = args.get('folder_name', '')
        role = args.get('role', '')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_folder_iam_policy_get_request(folder_name).get("bindings", [])
        updated_policies = add_members_to_policy(role=role, iam_policy=iam_policy, members=members,
                                                 command_name='gcp-iam-folder-iam-policy-create')

        client.gcp_iam_folder_iam_policy_set_request(folder_name, updated_policies)

        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def gcp_iam_folder_iam_member_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove members from folder policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = args.get('folder_name', '')
        role = args.get('role', '')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_folder_iam_policy_get_request(folder_name).get("bindings", [])
        updated_policies = remove_members_from_policy(role=role, iam_policy=iam_policy, members=members,
                                                      command_name='gcp-iam-folder-iam-policy-create')

        client.gcp_iam_folder_iam_policy_set_request(folder_name, updated_policies)

        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def gcp_iam_folder_iam_policy_set_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Sets the IAM access control policy for the specified folder.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = args.get('folder_name', '')
        policy = args.get('policy')
        if isinstance(policy, str):
            policy = policy.replace("\'", "\"")
            if policy and not policy.startswith('['):
                policy = '[' + policy + ']'

        policy = safe_load_json(policy)

        response = client.gcp_iam_folder_iam_policy_set_request(folder_name, policy)
        return generate_iam_policy_command_output(response, folder_name,
                                                  readable_header=f'{folder_name} IAM policy updated successfully.')


    def gcp_iam_folder_iam_policy_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add new folder IAM policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = args.get('folder_name', '')
        role = args.get('role')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_folder_iam_policy_get_request(folder_name).get("bindings", [])
        policy = {
            "role": role,
            "members": members
        }

        iam_policy.append(policy)

        client.gcp_iam_folder_iam_policy_set_request(folder_name, iam_policy)
        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def generate_organization_command_output(response: dict, output_key: str = None,
                                             readable_header: str = 'Organization information:') -> CommandResults:
        """
        Generate command output for group commands.
        Args:
            response (dict): API response from GCP.
            output_key (str): Used to access to required data in the response.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if output_key:
            outputs = copy.deepcopy(response.get(output_key, []))
        else:
            outputs = copy.deepcopy(response)

        if not isinstance(outputs, list):
            outputs = [outputs]

        outputs = update_time_format(outputs, ['createTime', 'updateTime'])

        readable_output = tableToMarkdown(
            readable_header,
            outputs,
            headers=['name', 'displayName', 'directoryCustomerId', 'createTime', 'updateTime'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Organization',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def gcp_iam_organizations_get_command(client: Client, args: Dict[str, Any]) -> list:
        """
        List organization resources that are visible to the caller, or retrieve organization information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = argToList(args.get('organization_name'))
        command_results_list: List[CommandResults] = []

        if organization_name:  # Retrieve specific organization information

            for organization in organization_name:
                readable_message = f'Organizations {organization} information:'
                try:
                    response = client.gcp_iam_organization_get_request(organization)
                    command_results = generate_organization_command_output(response=response,
                                                                           readable_header=readable_message)

                    command_results_list.append(command_results)

                except Exception as exception:
                    error = CommandResults(
                        readable_output=f'An error occurred while retrieving {organization}.\n {exception}'
                    )
                    command_results_list.append(error)

        else:  # List organization resources that are visible to the caller.
            limit = arg_to_number(args.get('limit')) or 50
            page = arg_to_number(args.get('page')) or 1
            max_limit = 50

            validate_pagination_arguments(limit, page)
            if limit > max_limit:
                raise Exception("The limit argument is out of range. It must be between 1 and 100.")

            readable_message = get_pagination_readable_message(header='Organizations List:', limit=limit, page=page)

            if page > 1:
                response = get_pagination_request_result(limit, page, max_limit,
                                                         client.gcp_iam_organization_list_request)

            else:
                response = client.gcp_iam_organization_list_request(limit=limit)

            command_results = generate_organization_command_output(response=response, output_key='organizations',
                                                                   readable_header=readable_message)

            command_results_list.append(command_results)

        return command_results_list


    def gcp_iam_organization_iam_policy_get_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve the IAM access control policy for the specified organization.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = args.get('organization_name', '')
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1
        validate_pagination_arguments(limit, page)

        readable_message = get_pagination_readable_message(header=f'Organization {organization_name} IAM Policy List:',
                                                           limit=limit, page=page)

        response = client.gcp_iam_organization_iam_policy_get_request(organization_name)

        return generate_iam_policy_command_output(response, organization_name, readable_header=readable_message,
                                                  limit=limit, page=page)


    def gcp_iam_organization_iam_test_permission_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve permissions that a caller has on the specified organization.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = args.get('organization_name', '')
        permissions = argToList(args.get('permissions'))

        response = client.gcp_iam_organization_iam_test_permission_request(organization_name, permissions)

        return generate_test_permission_command_output(response,
                                                       readable_header=f'Organization {organization_name} permissions:')


    def gcp_iam_organization_iam_member_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add members to organization policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = args.get('organization_name', '')
        role = args.get('role', '')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_organization_iam_policy_get_request(organization_name).get("bindings", [])
        updated_policies = add_members_to_policy(role=role, iam_policy=iam_policy, members=members,
                                                 command_name='gcp-iam-organization-iam-policy-create')

        client.gcp_iam_organization_iam_policy_set_request(organization_name, updated_policies)

        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def gcp_iam_organization_iam_member_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove members from organization policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = args.get('organization_name', '')
        role = args.get('role', '')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_organization_iam_policy_get_request(organization_name).get("bindings", [])
        updated_policies = remove_members_from_policy(role=role, iam_policy=iam_policy, members=members,
                                                      command_name='gcp-iam-organization-iam-policy-create')

        client.gcp_iam_organization_iam_policy_set_request(organization_name, updated_policies)

        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def gcp_iam_organization_iam_policy_set_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Sets the IAM access control policy for the specified organization.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = args.get('organization_name', '')
        policy = args.get('policy')
        if isinstance(policy, str):
            policy = policy.replace("\'", "\"")
            if policy and not policy.startswith('['):
                policy = '[' + policy + ']'

        policy = safe_load_json(policy)

        response = client.gcp_iam_organization_iam_policy_set_request(organization_name, policy)
        return generate_iam_policy_command_output(response, organization_name,
                                                  readable_header=f'{organization_name} IAM policy updated successfully.')


    def gcp_iam_organization_iam_policy_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add new organization IAM policy.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = args.get('organization_name', '')
        role = args.get('role')
        members = argToList(args.get('members'))

        iam_policy = client.gcp_iam_organization_iam_policy_get_request(organization_name).get("bindings", [])
        policy = {
            "role": role,
            "members": members
        }

        iam_policy.append(policy)

        client.gcp_iam_organization_iam_policy_set_request(organization_name, iam_policy)
        command_results = CommandResults(
            readable_output=f'Role {role} updated successfully.'
        )
        return command_results


    def gcp_iam_group_create_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Create a new group.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        parent = args.get('parent', '')
        description = args.get('description', '')
        display_name = args.get('display_name', '')
        group_email_address = args.get('group_email_address', '')

        response = client.gcp_iam_group_create_request(parent, display_name, group_email_address, description)

        outputs = copy.deepcopy(response.get('response'))
        created_group_name = outputs.get("name")
        outputs = update_time_format(outputs, ['createTime', 'updateTime'])

        readable_output = tableToMarkdown(
            f'Successfully Created Group "{created_group_name}"',
            outputs,
            headers=['name', 'groupKey', 'parent', 'displayName', 'createTime', 'updateTime'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Group',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def gcp_iam_group_list_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        List groups under the specified parent.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        parent = args.get('parent', '')
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1

        page_token = None
        readable_message = get_pagination_readable_message(header='Groups List:', limit=limit, page=page)

        validate_pagination_arguments(limit, page)
        if limit > 500:
            raise Exception("The limit argument is out of range. It must be between 1 and 500.")

        if page > 1:
            page_token = get_next_page_token(limit, page, client.gcp_iam_group_list_request, args={"parent": parent})

            if not page_token:
                return CommandResults(
                    readable_output=readable_message,
                    outputs_prefix='GCPIAM.Group',
                    outputs=[],
                    raw_response=[]
                )

        response = client.gcp_iam_group_list_request(parent, limit, page_token)

        readable_output = tableToMarkdown(
            readable_message,
            response.get('groups'),
            headers=['name', 'groupKey', 'displayName'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Group',
            outputs_key_field='name',
            outputs=response.get('groups'),
            raw_response=response
        )

        return command_results


    def gcp_iam_group_get_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve group information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        group_name = args.get('group_name', '')

        response = client.gcp_iam_group_get_request(group_name)
        outputs = copy.deepcopy(response)
        outputs = update_time_format(outputs, ['createTime', 'updateTime'])

        readable_output = tableToMarkdown(
            'Group information:',
            outputs,
            headers=['name', 'groupKey', 'parent', 'displayName', 'createTime', 'updateTime'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Group',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def gcp_iam_group_delete_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Delete group.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        group_name = args.get('group_name', '')

        result = client.gcp_iam_group_delete_request(group_name)

        if not result.get('done'):
            raise Exception('Operation failed.')
        readable_output = f'Group {group_name} was successfully deleted.'
        command_results = CommandResults(
            readable_output=readable_output
        )

        return command_results


    def gcp_iam_group_membership_create_command(client: Client, args: Dict[str, Any]) -> List[CommandResults]:
        """
        Create a group membership.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """

        groups_name = argToList(args.get('groups_name'))
        member_email = args.get('member_email', '')
        role = argToList(args.get('role'))

        command_results_list: List[CommandResults] = []
        for name in groups_name:
            try:
                response = client.gcp_iam_group_membership_create_request(name, member_email, role)
                command_results_list.append(generate_group_membership_command_output(response, 'response'))

            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while creating membership in group {name}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_group_membership_list_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        List group memberships.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        group_name = args.get('group_name', '')
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1
        page_token = None
        readable_message = get_pagination_readable_message(header='Membership List:', limit=limit, page=page)

        validate_pagination_arguments(limit, page)
        if limit > 500:
            raise Exception("The limit argument is out of range. It must be between 1 and 500.")

        if page > 1:
            page_token = get_next_page_token(limit, page, client.gcp_iam_group_membership_list_request,
                                             args={"group_name": group_name})

            if not page_token:
                return CommandResults(
                    readable_output=readable_message,
                    outputs_prefix='GCPIAM.Membership',
                    outputs=[],
                    raw_response=[]
                )

        response = client.gcp_iam_group_membership_list_request(group_name, limit, page_token)

        return generate_group_membership_command_output(response, "memberships", readable_message)


    def gcp_iam_group_membership_get_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Retrieve group membership information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        membership_name = args.get('membership_name', '')

        response = client.gcp_iam_group_membership_get_request(membership_name)
        return generate_group_membership_command_output(response)


    def gcp_iam_group_membership_role_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add group membership role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        membership_name = args.get('membership_name', '')
        role = argToList(args.get('role'))

        client.gcp_iam_group_membership_role_add_request(membership_name, role)
        command_results = CommandResults(
            readable_output=f'Membership {membership_name} updated successfully.'
        )
        return command_results


    def gcp_iam_group_membership_role_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove group membership role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        membership_name = args.get('membership_name', '')
        role = argToList(args.get('role'))

        client.gcp_iam_group_membership_role_remove_request(membership_name, role)
        command_results = CommandResults(
            readable_output=f'Membership {membership_name} updated successfully.'
        )
        return command_results


    def gcp_iam_group_membership_delete_command(client: Client, args: Dict[str, Any]) -> List[CommandResults]:
        """
        Delete group membership.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        membership_names = argToList(args.get('membership_names'))
        command_results_list: List[CommandResults] = []

        for membership in membership_names:
            try:
                client.gcp_iam_group_membership_delete_request(membership)
                command_results = CommandResults(
                    readable_output=f'Membership {membership} deleted successfully.'
                )
                command_results_list.append(command_results)
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while deleting the membership {membership}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_service_account_create_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Create a service account in project.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        service_account_id = args.get('service_account_id', '')
        display_name = args.get('display_name', '')
        description = args.get('description', '')

        if not 6 <= len(service_account_id) <= 30:
            raise Exception('Service account ID length has to be between 6-30 characters.')

        response = client.gcp_iam_service_account_create_request(
            project_name, service_account_id, display_name, description)

        return generate_service_account_command_output(response)


    def gcp_iam_service_account_update_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Update service account.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        service_account_name = args.get('service_account_name', '')
        display_name = args.get('display_name', '')
        description = args.get('description', '')
        fields_to_update = args.get('fields_to_update', '')

        client.gcp_iam_service_account_update_request(service_account_name, fields_to_update, display_name, description)
        command_results = CommandResults(
            readable_output=f'Service account {service_account_name} updated successfully.'
        )
        return command_results


    def get_pagination_request_result(limit: int, page: int, max_page_size: int, client_request: Callable,
                                      **kwargs) -> dict:
        """
        Perform API request for pagination utility.
        Args:
            limit (int): The number of results to retrieve.
            page (int): The page number of the results to retrieve.
            max_page_size (int): API maximum page size limitation.
            client_request (int): API Client function.

        Returns:
            dict: API response from GCP.

        """
        offset = (page - 1) * limit
        page_token = None

        steps = max_page_size if offset > max_page_size else offset

        for _i in range(0, offset, steps):
            response = client_request(limit=steps, page_token=page_token, **kwargs)

            page_token = response.get('nextPageToken')

            if not page_token:
                return {}

        return client_request(limit=limit, page_token=page_token, **kwargs)


    def gcp_iam_service_accounts_get_command(client: Client, args: Dict[str, Any]) -> Union[CommandResults, list]:
        """
        List service accounts in project, or retrieve specific project service account information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        service_account_name = argToList(args.get('service_account_name'))

        if service_account_name:  # Retrieve specific service accounts information,
            command_results_list: List[CommandResults] = []
            for account in service_account_name:
                try:
                    response = client.gcp_iam_service_account_get_request(account)
                    command_results_list.append(generate_service_account_command_output(response))
                except Exception as exception:
                    error = CommandResults(
                        readable_output=f'An error occurred while retrieving {account}.\n {exception}'
                    )
                    command_results_list.append(error)

            return command_results_list

        else:  # List service accounts in project.
            project_name = args.get('project_name')

            if not project_name:
                raise Exception("One of the arguments: 'service_account_name' or 'project_name' must be provided.")

            limit = arg_to_number(args.get('limit')) or 50
            page = arg_to_number(args.get('page')) or 1
            max_limit = 100

            validate_pagination_arguments(limit, page)
            if limit > max_limit:
                raise Exception("The limit argument is out of range. It must be between 1 and 100.")

            readable_message = get_pagination_readable_message(header='Service Account List:', limit=limit, page=page)

            if page > 1:
                response = get_pagination_request_result(limit, page, max_limit,
                                                         client.gcp_iam_service_account_list_request,
                                                         project_name=project_name)

            else:
                response = client.gcp_iam_service_account_list_request(project_name=project_name, limit=limit)

            return generate_service_account_command_output(response, output_key="accounts",
                                                           readable_header=readable_message)


    def gcp_iam_service_account_enable_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Enable project service account.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        service_account_name = argToList(args.get('service_account_name'))
        command_results_list: List[CommandResults] = []

        for account in service_account_name:
            try:
                client.gcp_iam_service_account_enable_request(account)
                command_results_list.append(CommandResults(
                    readable_output=f'Service account {account} updated successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to enable {account}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_service_account_disable_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Disable project service account.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        service_account_name = argToList(args.get('service_account_name'))
        command_results_list: List[CommandResults] = []

        for account in service_account_name:
            try:
                client.gcp_iam_service_account_disable_request(account)
                command_results_list.append(CommandResults(
                    readable_output=f'Service account {account} updated successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to disable {account}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_service_account_delete_command(client: Client, args: Dict[str, Any]) -> List[CommandResults]:
        """
        Delete service account key.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        service_account_name = argToList(args.get('service_account_name'))
        command_results_list: List[CommandResults] = []

        for account in service_account_name:
            try:
                client.gcp_iam_service_account_delete_request(account)
                command_results_list.append(CommandResults(
                    readable_output=f'Service account {account} deleted successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to delete {account}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def generate_service_account_key_command_output(response: dict, output_key: str = None,
                                                    readable_header: str = 'Service account key information:') -> CommandResults:
        """
        Generate command output for service account key commands.
        Args:
            response (dict): API response from GCP.
            output_key (str): Used to access to required data in the response.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if output_key:
            outputs = copy.deepcopy(response.get(output_key, []))
        else:
            outputs = copy.deepcopy(response)

        if not isinstance(outputs, list):
            outputs = [outputs]

        for output in outputs:
            output["disabled"] = output.get("disabled", False)

        outputs = update_time_format(outputs, ['validAfterTime', 'validBeforeTime'])

        readable_output = tableToMarkdown(readable_header,
                                          outputs,
                                          headers=["name", "validAfterTime", "validBeforeTime", "disabled", "keyType"],
                                          headerTransform=pascalToSpace
                                          )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.ServiceAccountKey',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def gcp_iam_service_account_key_create_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Create a service account key.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        service_account_name = args.get('service_account_name', '')
        key_algorithm = args.get('key_algorithm', '')

        response = client.gcp_iam_service_account_key_create_request(service_account_name, key_algorithm)
        return generate_service_account_key_command_output(response)


    def gcp_iam_service_account_keys_get_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        List service accounts keys, or retrieve service account key information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        key_name = args.get('key_name')

        if key_name:  # Retrieve specific service account key information.
            response = client.gcp_iam_service_account_key_get_request(key_name)
            return generate_service_account_key_command_output(response)

        else:

            service_account_name = args.get('service_account_name')
            if not service_account_name:
                raise Exception("One of the arguments: 'service_account_name' or 'key_name' must be provided.")

            limit = arg_to_number(args.get('limit')) or 50
            page = arg_to_number(args.get('page')) or 1
            validate_pagination_arguments(limit, page)
            response = client.gcp_iam_service_account_key_list_request(service_account_name)

            readable_message = get_pagination_readable_message(header='Service Account Keys List:', limit=limit, page=page)
            start = (page - 1) * limit
            end = start + limit

            outputs = []

            keys = response.get('keys', [])
            if keys and len(keys) >= start:
                min_index = min(len(keys), end)
                for key in keys[start:min_index]:
                    outputs.append(dict(key))

            for output in outputs:
                output["disabled"] = output.get("disabled", False)

            outputs = update_time_format(outputs, ['validAfterTime', 'validBeforeTime'])

            readable_output = tableToMarkdown(readable_message,
                                              outputs,
                                              headers=["name", "validAfterTime", "validBeforeTime", "disabled", "keyType"],
                                              headerTransform=pascalToSpace
                                              )

            command_results = CommandResults(
                readable_output=readable_output,
                outputs_prefix='GCPIAM.ServiceAccountKey',
                outputs_key_field='name',
                outputs=outputs,
                raw_response=response
            )

            return command_results


    def gcp_iam_service_account_key_enable_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Enable service account key.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        key_name = argToList(args.get('key_name'))
        command_results_list: List[CommandResults] = []

        for key in key_name:
            try:
                client.gcp_iam_service_account_key_enable_request(key)
                command_results_list.append(CommandResults(
                    readable_output=f'Service account key {key} updated successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to enable {key}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_service_account_key_disable_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Disable service account key.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        key_name = argToList(args.get('key_name'))
        command_results_list: List[CommandResults] = []

        for key in key_name:
            try:
                client.gcp_iam_service_account_key_disable_request(key)
                command_results_list.append(CommandResults(
                    readable_output=f'Service account key {key} updated successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to disable {key}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_service_account_generate_access_token_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Create a serivce account short-lived access token

        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        service_account_email = args['service_account_email']
        lifetime = args['lifetime']

        response = client.gcp_iam_service_account_generate_access_token_request(service_account_email, lifetime)

        readable_output = tableToMarkdown(f"Access token for {service_account_email}:",
                                          response,
                                          headers=["accessToken", "expireTime"],
                                          headerTransform=pascalToSpace,
                                          )

        return CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.ServiceAccountAccessToken',
            outputs_key_field='name',
            outputs=response,
            raw_response=response
        )


    def gcp_iam_service_account_key_delete_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Delete service account key.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        key_name = argToList(args.get('key_name'))
        command_results_list: List[CommandResults] = []

        for key in key_name:
            try:
                client.gcp_iam_service_account_key_delete_request(key)
                command_results_list.append(CommandResults(
                    readable_output=f'Service account key {key} deleted successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to delete {key}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def generate_role_command_output(response: dict, output_key: str = None,
                                     readable_header: str = 'Role information:',
                                     outputs: list = None) -> CommandResults:
        """
        Generate command output for role commands.
        Args:
            response (dict): API response from GCP.
            output_key (str): Used to access to required data in the response.
            readable_header (str): Readable message header for XSOAR war room.
            outputs (list): Command output. If not provided, the command will set this argument.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if not outputs and not isinstance(outputs, list):
            if output_key:
                outputs = copy.deepcopy(response.get(output_key, []))
            else:
                outputs = [copy.deepcopy(response)]

        if not isinstance(outputs, list):
            outputs = [outputs]

        for role in outputs:
            role["stage"] = role.get('stage', 'ALPHA')
            role["includedPermissions"] = role.get('includedPermissions', [])
            role["deleted"] = role.get('deleted', False)

        readable_output = tableToMarkdown(readable_header,
                                          outputs,
                                          headers=["name", "includedPermissions", "title", "description"],
                                          headerTransform=pascalToSpace
                                          )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Role',
            outputs_key_field='name',
            outputs=outputs,
            raw_response=response
        )

        return command_results


    def create_custom_role(client_request_method: Callable, resource_identifier_key: str, args: Dict[str, Any]):
        """
        Create a custom role.
        Args:
            client_request_method (Callable): The GCP Client method which create the required resource (organization/project) role.
            resource_identifier_key (str): The ID of the required resource which contains the custom role.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        resource_identifier = args.get(resource_identifier_key)
        role_id = args.get('role_id')
        description = args.get('description')
        title = args.get('title')
        stage = args.get('stage')
        permissions = argToList(args.get('permissions'))

        response = client_request_method(resource_identifier, role_id, stage, description, title, permissions)

        role_name = response.get('name')

        return generate_role_command_output(response, readable_header=f'Role {role_name} information:')


    def update_custom_role(client_request_method: Callable, args: Dict[str, Any]):
        """
        Update custom role.
        Args:
            client_request_method (Callable): The GCP Client method which update the required resource (organization/project) role.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = args.get('role_name')
        description = args.get('description')
        title = args.get('title')
        permissions = argToList(args.get('permissions'))
        stage = args.get('stage')
        fields_to_update = args.get('fields_to_update')

        client_request_method(role_name, description, title, permissions, stage, fields_to_update)
        command_results = CommandResults(
            readable_output=f'Role {role_name} updated successfully.'
        )
        return command_results


    def add_custom_role_permissions(client_request_get_method: Callable, client_request_update_method: Callable,
                                    args: Dict[str, Any]):
        """
        Add permissions to custom role.
        Args:
            client_request_get_method (Callable): The GCP Client method which retrieved
                                                  the required resource (organization/project) role.
            client_request_update_method (Callable): The GCP Client method which update
                                                     the required resource (organization/project) role.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = args.get('role_name')
        permissions = argToList(args.get('permissions'))

        role_permissions = client_request_get_method(role_name).get('includedPermissions', [])

        for permission in permissions:
            role_permissions.append(permission)

        client_request_update_method(role_name, permissions=role_permissions, fields_to_update="includedPermissions")
        command_results = CommandResults(
            readable_output=f'Role {role_name} updated successfully.'
        )
        return command_results


    def remove_custom_role_permissions(client_request_get_method: Callable, client_request_update_method: Callable,
                                       args: Dict[str, Any]):
        """
        Remove permissions from custom project role.
        Args:
            client_request_get_method (Callable): The GCP Client method which retrieved
                                                  the required resource (organization/project) role.
            client_request_update_method (Callable): The GCP Client method which update
                                                     the required resource (organization/project) role.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = args.get('role_name')
        permissions = argToList(args.get('permissions'))

        role_permissions = client_request_get_method(role_name).get('includedPermissions', [])

        for permission in permissions:
            try:
                role_permissions.remove(permission)
            except ValueError:
                raise Exception(f'The permission {permission} is not part of the custom resource permissions.'
                                f'If you wish to add a new permission, '
                                f'consider using gcp-iam-organization-role-permission-add '
                                f'or gcp-iam-project-role-permission-add command.')

        client_request_update_method(role_name, permissions=role_permissions, fields_to_update="includedPermissions")
        command_results = CommandResults(
            readable_output=f'Role {role_name} updated successfully.'
        )
        return command_results


    def list_filtered_role(client_request_method: Callable, command_arguments: dict, limit: int, page: int,
                           max_limit: int, title_filter: str = None, permission_filter: list = None) -> tuple:
        """
        List and filter roles.
        Args:
            client_request_method (Callable): The GCP Client method which list the required resource
                                              (predefined/organization/project) role.
            command_arguments (dict): Client method arguments.
            limit (int): The number of results to retrieve.
            page (int): The page number of the results to retrieve.
            max_limit (int): GCP API max limit.
            title_filter (str): Used to filter the retrieved roles by the rule title.
            permission_filter (list): Used to filter the retrieved roles by their permissions.

        Returns:
            response , outputs.

        """
        if permission_filter:
            command_arguments["include_permissions"] = True

        response = client_request_method(limit=max_limit, **command_arguments)

        max_result_offset = page * limit
        offset = (page - 1) * limit
        outputs = []
        response_roles = response.get("roles", [])

        roles_remain = True

        while roles_remain and response_roles:
            for role in response_roles:
                if (title_filter and title_filter.lower() in role.get("title", "").lower()) or (permission_filter and all(
                        item in role.get("includedPermissions", []) for item in permission_filter)):
                    outputs.append(role)

                if len(outputs) >= max_result_offset:
                    roles_remain = False
                    break

            if roles_remain:
                if response.get('nextPageToken'):
                    response = client_request_method(limit=max_limit, page_token=response.get('nextPageToken'),
                                                     **command_arguments)
                    response_roles = response.get("roles", [])
                else:
                    roles_remain = False

        return response, outputs[offset: max_result_offset]


    def list_roles(client_request_method: Callable, args: Dict[str, Any],
                   readable_header: str, resource_identifier_key: str = None):
        """
        List custom roles.
        Args:
            client_request_method (Callable): The GCP Client method which list the required resource
                                              (predefined/organization/project) role.
            resource_identifier_key (str): The ID of the required resource which contains the custom role.
            args (dict): Command arguments from XSOAR.
            readable_header (str): Readable message header for XSOAR war room.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        if resource_identifier_key:
            resource_identifier = args.get(resource_identifier_key)
        include_permissions = argToBoolean(args.get('include_permissions', True))
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1
        show_deleted = argToBoolean(args.get('show_deleted', False))

        title_filter = args.get('title_filter')
        permission_filter = argToList(args.get('permission_filter'))

        max_limit = 1000

        validate_pagination_arguments(limit, page)
        if limit > max_limit:
            raise Exception("The limit argument is out of range. It must be between 1 and 1000.")

        readable_message = get_pagination_readable_message(header=readable_header, limit=limit, page=page)

        if resource_identifier_key:
            command_arguments = {'parent': resource_identifier, 'include_permissions': include_permissions,
                                 'show_deleted': show_deleted}
        else:
            command_arguments = {'include_permissions': include_permissions, 'show_deleted': show_deleted}

        if title_filter or permission_filter:
            response, outputs = list_filtered_role(client_request_method, command_arguments, limit, page, max_limit,
                                                   title_filter, permission_filter)

            return generate_role_command_output(response, readable_header=readable_message, outputs=outputs)

        if page > 1:
            response = get_pagination_request_result(limit, page, max_limit,
                                                     client_request_method,
                                                     **command_arguments)
        else:
            response = client_request_method(limit=limit, **command_arguments)

        return generate_role_command_output(response, output_key="roles", readable_header=readable_message)


    def gcp_iam_organization_role_create_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Create a custom organization role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return create_custom_role(client_request_method=client.gcp_iam_organization_role_create_request,
                                  resource_identifier_key='organization_name', args=args)


    def gcp_iam_organization_role_update_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Update an organization custom role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return update_custom_role(client_request_method=client.gcp_iam_organization_role_update_request, args=args)


    def gcp_iam_organization_role_permission_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add permissions to custom organization role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return add_custom_role_permissions(client_request_get_method=client.gcp_iam_organization_role_get_request,
                                           client_request_update_method=client.gcp_iam_organization_role_update_request,
                                           args=args)


    def gcp_iam_organization_role_permission_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove permissions from custom organization role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return remove_custom_role_permissions(client_request_get_method=client.gcp_iam_organization_role_get_request,
                                              client_request_update_method=client.gcp_iam_organization_role_update_request,
                                              args=args)


    def gcp_iam_organization_role_list_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        List organization custom roles.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return list_roles(client_request_method=client.gcp_iam_organization_role_list_request,
                          resource_identifier_key='organization_name', args=args,
                          readable_header='Custom Organization Roles list:')


    def gcp_iam_organization_role_get_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Retrieve organization role information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = argToList(args.get('role_name'))
        command_results_list: List[CommandResults] = []

        for role in role_name:
            try:
                response = client.gcp_iam_organization_role_get_request(role)
                retrieved_role_name = response.get('name')
                command_results_list.append(
                    generate_role_command_output(response, readable_header=f'Role {retrieved_role_name} information:'))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while retrieving {role}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_organization_role_delete_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Delete a custom organization role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = argToList(args.get('role_name'))
        command_results_list: List[CommandResults] = []

        for role in role_name:
            try:
                client.gcp_iam_organization_role_delete_request(role)
                command_results_list.append(CommandResults(
                    readable_output=f'Role {role} deleted successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to delete {role}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_project_role_create_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Create a custom project role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return create_custom_role(client_request_method=client.gcp_iam_project_role_create_request,
                                  resource_identifier_key='project_id', args=args)


    def gcp_iam_project_role_update_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Update an project custom role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return update_custom_role(client_request_method=client.gcp_iam_project_role_update_request, args=args)


    def gcp_iam_project_role_permission_add_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Add permissions to custom project role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """

        return add_custom_role_permissions(client_request_get_method=client.gcp_iam_project_role_get_request,
                                           client_request_update_method=client.gcp_iam_project_role_update_request,
                                           args=args)


    def gcp_iam_project_role_permission_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove permissions from custom project role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return remove_custom_role_permissions(client_request_get_method=client.gcp_iam_project_role_get_request,
                                              client_request_update_method=client.gcp_iam_project_role_update_request,
                                              args=args)


    def gcp_iam_project_role_list_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        List custom project roles.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return list_roles(client_request_method=client.gcp_iam_project_role_list_request,
                          resource_identifier_key='project_id', args=args,
                          readable_header='Custom Project Roles list:')


    def gcp_iam_project_role_get_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Retrieve project role information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = argToList(args.get('role_name'))
        command_results_list: List[CommandResults] = []

        for role in role_name:
            try:
                response = client.gcp_iam_project_role_get_request(role)
                retrieved_role_name = response.get('name')
                command_results_list.append(
                    generate_role_command_output(response, readable_header=f'Role {retrieved_role_name} information:'))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while retrieving {role}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_project_role_delete_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Delete custom project role.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = argToList(args.get('role_name'))
        command_results_list: List[CommandResults] = []

        for role in role_name:
            try:
                client.gcp_iam_project_role_delete_request(role)
                command_results_list.append(CommandResults(
                    readable_output=f'Role {role} deleted successfully.'
                ))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while trying to delete {role}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_predefined_role_get_command(client: Client, args: Dict[str, Any]) -> list:
        """
        Retrieve GCP IAM predefined role information.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """
        role_name = argToList(args.get('role_name'))
        command_results_list: List[CommandResults] = []

        for role in role_name:
            try:
                response = client.gcp_iam_predefined_role_get_request(role)
                retrieved_role_name = response.get('name')
                command_results_list.append(
                    generate_role_command_output(response, readable_header=f'Role {retrieved_role_name} information:'))
            except Exception as exception:
                error = CommandResults(
                    readable_output=f'An error occurred while retrieving {role}.\n {exception}'
                )
                command_results_list.append(error)

        return command_results_list


    def gcp_iam_predefined_role_list_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Lists every predefined Role that IAM supports.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        return list_roles(client_request_method=client.gcp_iam_predefined_role_list_request, args=args,
                          readable_header='GCP IAM Predefined Roles list:')


    def gcp_iam_testable_permission_list_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Lists permissions that can be tested on a resource.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        resource_name = args.get('resource_name')
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1
        full_resource_name = f'//cloudresourcemanager.googleapis.com/{resource_name}'
        page_token = None
        readable_message = get_pagination_readable_message(header=f'{resource_name} testable permissions list:',
                                                           limit=limit, page=page)
        max_limit = 1000

        validate_pagination_arguments(limit, page)
        if limit > max_limit:
            raise Exception("The limit argument is out of range. It must be between 1 and 1000.")

        if page > 1:
            page_token = get_next_page_token(limit, page, client.gcp_iam_testable_permission_list_request,
                                             args={"full_resource_name": full_resource_name})

            if not page_token:
                return CommandResults(
                    readable_output=readable_message,
                    outputs_prefix='GCPIAM.Permission',
                    outputs=[],
                    raw_response=[]
                )

        response = client.gcp_iam_testable_permission_list_request(full_resource_name, limit, page_token)

        readable_output = tableToMarkdown(
            readable_message,
            response.get("permissions"),
            headers=['name', 'stage'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Permission',
            outputs_key_field='name',
            outputs=response.get("permissions"),
            raw_response=response
        )

        return command_results


    def gcp_iam_grantable_role_list_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Lists roles that can be granted on a Google Cloud resource.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.
        """
        resource_name = args.get('resource_name')
        limit = arg_to_number(args.get('limit')) or 50
        page = arg_to_number(args.get('page')) or 1
        full_resource_name = f'//cloudresourcemanager.googleapis.com/{resource_name}'
        page_token = None
        readable_message = get_pagination_readable_message(header=f'{resource_name} grantable roles list:',
                                                           limit=limit, page=page)

        max_limit = 1000

        validate_pagination_arguments(limit, page)
        if limit > max_limit:
            raise Exception("The limit argument is out of range. It must be between 1 and 1000.")

        if page > 1:
            page_token = get_next_page_token(limit, page, client.gcp_iam_grantable_role_list_request,
                                             args={"full_resource_name": full_resource_name})

            if not page_token:
                return CommandResults(
                    readable_output=readable_message,
                    outputs_prefix='GCPIAM.Roles',
                    outputs=[],
                    raw_response=[]
                )

        response = client.gcp_iam_grantable_role_list_request(full_resource_name, limit, page_token)

        readable_output = tableToMarkdown(
            readable_message,
            response.get("roles"),
            headers=['name', 'title', 'description'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.Roles',
            outputs_key_field='name',
            outputs=response.get("roles"),
            raw_response=response
        )

        return command_results


    def gcp_iam_project_iam_policy_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove policy from project IAM policies.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        project_name = args.get('project_name', '')
        role = argToList(args.get('role'))

        iam_policy = client.gcp_iam_project_iam_policy_get_request(project_name).get("bindings", [])

        updated_policies = [policy for policy in iam_policy if policy.get('role') not in role]

        client.gcp_iam_project_iam_policy_set_request(project_name, updated_policies)
        command_results = CommandResults(
            readable_output=f'Project {project_name} IAM policies updated successfully.'
        )
        return command_results


    def gcp_iam_organization_iam_policy_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove policy from organization IAM policies.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        organization_name = args.get('organization_name', '')
        role = argToList(args.get('role'))

        iam_policy = client.gcp_iam_organization_iam_policy_get_request(organization_name).get("bindings", [])

        updated_policies = [policy for policy in iam_policy if policy.get('role') not in role]

        client.gcp_iam_organization_iam_policy_set_request(organization_name, updated_policies)
        command_results = CommandResults(
            readable_output=f'Organization {organization_name} IAM policies updated successfully.'
        )
        return command_results


    def gcp_iam_folder_iam_policy_remove_command(client: Client, args: Dict[str, Any]) -> CommandResults:
        """
        Remove policy from folder IAM policies.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            CommandResults: outputs, readable outputs and raw response for XSOAR.

        """
        folder_name = args.get('folder_name', '')
        role = argToList(args.get('role'))

        iam_policy = client.gcp_iam_folder_iam_policy_get_request(folder_name).get("bindings", [])

        updated_policies = [policy for policy in iam_policy if policy.get('role') not in role]

        client.gcp_iam_folder_iam_policy_set_request(folder_name, updated_policies)
        command_results = CommandResults(
            readable_output=f'Folder {folder_name} IAM policies updated successfully.'
        )
        return command_results


    def gcp_iam_tagbindings_list_command(client: Client, args: Dict[str, Any]) -> Union[CommandResults, str]:
        """
        List tag bindings (key value pair) applied to a project/folder/organization object.
        Args:
            client (Client): GCP API client.
            args (dict): Command arguments from XSOAR.

        Returns:
            list[CommandResults]: outputs, readable outputs and raw response for XSOAR.

        """

        parent = args.get('parent')

        if not parent:
            raise Exception("Argument 'parent' must be provided.")
        max_limit = 100

        res_binding = client.gcp_iam_tagbindings_list_request(parent=parent, limit=max_limit)
        if not res_binding:
            return "No tag bindingds found"
        if not res_binding.get('tagBindings', [{}])[0].get('tagValue'):
            return "No tag bindingds found"
        val_list = []
        for value in res_binding.get('tagBindings', {}):
            res_value = client.gcp_iam_tagvalues_get_request(name=value.get('tagValue'))
            res_key = client.gcp_iam_tagkeys_get_request(name=res_value.get('parent', ''))
            kv = {'key': res_key['shortName'], 'value': res_value['shortName']}
            val_list.append(kv)

        readable_output = tableToMarkdown(
            "Keys and Values",
            val_list,
            headers=['key', 'value'],
            headerTransform=pascalToSpace
        )

        command_results = CommandResults(
            readable_output=readable_output,
            outputs_prefix='GCPIAM.TagBindings',
            outputs_key_field='key',
            outputs=val_list,
            raw_response=val_list
        )

        return command_results


    def test_module(service_account_key: str, proxy: bool, verify_certificate: bool) -> None:
        try:
            client: Client = Client(client_secret=service_account_key, proxy=proxy, verify_certificate=verify_certificate)
            client.gcp_iam_predefined_role_list_request(include_permissions=False, limit=1)
        except Exception as e:
            demisto.error(f'Error when running test-module {e}')
            return return_results('Authorization Error: make sure API Service Account Key is valid.')

        return_results('ok')
        return None


    def main() -> None:
        params: Dict[str, Any] = demisto.params()
        args: Dict[str, Any] = demisto.args()

        service_account_key = params['credentials']['password']
        verify_certificate: bool = not argToBoolean(params.get('insecure', False))
        proxy: bool = params.get('proxy', False)
        command = demisto.command()
        demisto.debug(f'Command being called is {command}')

        try:

            if command == 'test-module':
                return test_module(service_account_key, proxy=proxy, verify_certificate=verify_certificate)

            client: Client = Client(client_secret=service_account_key, proxy=proxy, verify_certificate=verify_certificate)

            commands = {
                'gcp-iam-projects-get': gcp_iam_projects_get_command,
                'gcp-iam-project-iam-policy-get': gcp_iam_project_iam_policy_get_command,
                'gcp-iam-project-iam-permission-test': gcp_iam_project_iam_test_permission_command,
                'gcp-iam-project-iam-member-add': gcp_iam_project_iam_member_add_command,
                'gcp-iam-project-iam-member-remove': gcp_iam_project_iam_member_remove_command,
                'gcp-iam-project-iam-policy-set': gcp_iam_project_iam_policy_set_command,
                'gcp-iam-project-iam-policy-create': gcp_iam_project_iam_policy_add_command,
                'gcp-iam-project-iam-policy-remove': gcp_iam_project_iam_policy_remove_command,
                'gcp-iam-folders-get': gcp_iam_folders_get_command,
                'gcp-iam-folder-iam-policy-get': gcp_iam_folder_iam_policy_get_command,
                'gcp-iam-folder-iam-permission-test': gcp_iam_folder_iam_test_permission_command,
                'gcp-iam-folder-iam-member-add': gcp_iam_folder_iam_member_add_command,
                'gcp-iam-folder-iam-member-remove': gcp_iam_folder_iam_member_remove_command,
                'gcp-iam-folder-iam-policy-set': gcp_iam_folder_iam_policy_set_command,
                'gcp-iam-folder-iam-policy-create': gcp_iam_folder_iam_policy_add_command,
                'gcp-iam-folder-iam-policy-remove': gcp_iam_folder_iam_policy_remove_command,
                'gcp-iam-organizations-get': gcp_iam_organizations_get_command,
                'gcp-iam-organization-iam-policy-get': gcp_iam_organization_iam_policy_get_command,
                'gcp-iam-organization-iam-permission-test': gcp_iam_organization_iam_test_permission_command,
                'gcp-iam-organization-iam-member-add': gcp_iam_organization_iam_member_add_command,
                'gcp-iam-organization-iam-member-remove': gcp_iam_organization_iam_member_remove_command,
                'gcp-iam-organization-iam-policy-set': gcp_iam_organization_iam_policy_set_command,
                'gcp-iam-organization-iam-policy-create': gcp_iam_organization_iam_policy_add_command,
                'gcp-iam-organization-iam-policy-remove': gcp_iam_organization_iam_policy_remove_command,
                'gcp-iam-group-create': gcp_iam_group_create_command,
                'gcp-iam-group-list': gcp_iam_group_list_command,
                'gcp-iam-group-get': gcp_iam_group_get_command,
                'gcp-iam-group-delete': gcp_iam_group_delete_command,
                'gcp-iam-group-membership-create': gcp_iam_group_membership_create_command,
                'gcp-iam-group-membership-list': gcp_iam_group_membership_list_command,
                'gcp-iam-group-membership-get': gcp_iam_group_membership_get_command,
                'gcp-iam-group-membership-role-add': gcp_iam_group_membership_role_add_command,
                'gcp-iam-group-membership-role-remove': gcp_iam_group_membership_role_remove_command,
                'gcp-iam-group-membership-delete': gcp_iam_group_membership_delete_command,
                'gcp-iam-service-account-create': gcp_iam_service_account_create_command,
                'gcp-iam-service-account-update': gcp_iam_service_account_update_command,
                'gcp-iam-service-accounts-get': gcp_iam_service_accounts_get_command,
                'gcp-iam-service-account-enable': gcp_iam_service_account_enable_command,
                'gcp-iam-service-account-disable': gcp_iam_service_account_disable_command,
                'gcp-iam-service-account-delete': gcp_iam_service_account_delete_command,
                'gcp-iam-service-account-key-create': gcp_iam_service_account_key_create_command,
                'gcp-iam-service-account-keys-get': gcp_iam_service_account_keys_get_command,
                'gcp-iam-service-account-key-enable': gcp_iam_service_account_key_enable_command,
                'gcp-iam-service-account-key-disable': gcp_iam_service_account_key_disable_command,
                'gcp-iam-service-account-generate-access-token': gcp_iam_service_account_generate_access_token_command,
                'gcp-iam-service-account-key-delete': gcp_iam_service_account_key_delete_command,
                'gcp-iam-organization-role-create': gcp_iam_organization_role_create_command,
                'gcp-iam-organization-role-update': gcp_iam_organization_role_update_command,
                'gcp-iam-organization-role-permission-add': gcp_iam_organization_role_permission_add_command,
                'gcp-iam-organization-role-permission-remove': gcp_iam_organization_role_permission_remove_command,
                'gcp-iam-organization-role-list': gcp_iam_organization_role_list_command,
                'gcp-iam-organization-role-get': gcp_iam_organization_role_get_command,
                'gcp-iam-organization-role-delete': gcp_iam_organization_role_delete_command,
                'gcp-iam-project-role-create': gcp_iam_project_role_create_command,
                'gcp-iam-project-role-update': gcp_iam_project_role_update_command,
                'gcp-iam-project-role-permission-add': gcp_iam_project_role_permission_add_command,
                'gcp-iam-project-role-permission-remove': gcp_iam_project_role_permission_remove_command,
                'gcp-iam-project-role-list': gcp_iam_project_role_list_command,
                'gcp-iam-project-role-get': gcp_iam_project_role_get_command,
                'gcp-iam-project-role-delete': gcp_iam_project_role_delete_command,
                'gcp-iam-testable-permission-list': gcp_iam_testable_permission_list_command,
                'gcp-iam-grantable-role-list': gcp_iam_grantable_role_list_command,
                'gcp-iam-role-get': gcp_iam_predefined_role_get_command,
                'gcp-iam-role-list': gcp_iam_predefined_role_list_command,
                'gcp-iam-tagbindings-list': gcp_iam_tagbindings_list_command
            }

            if command in commands:
                return_results(commands[command](client, args))
            else:
                raise NotImplementedError(f'{command} command is not implemented.')

        except Exception as e:
            return_error(str(e))


    if __name__ in ['__main__', 'builtin', 'builtins']:
        main()

    register_module_line('GCP-IAM', 'end', __line__())
  subtype: python3
  type: python
system: true
