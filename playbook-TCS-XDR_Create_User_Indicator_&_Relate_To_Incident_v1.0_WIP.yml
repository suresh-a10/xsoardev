contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
id: 2fcbbdea-c94f-4797-8fbc-af4490002453
inputs:
- description: ""
  key: emp
  playbookInputQuery: null
  required: false
  value: {}
name: TCS-XDR Create User Indicator & Relate To Incident v1.0_WIP
outputs: []
sourceplaybookid: a8f14eae-50f0-476d-84bb-1c0d7fb01027
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5f0b3a4a-5dde-4703-83b2-a38b244fd446
      iscommand: false
      name: ""
      version: -1
    taskid: 5f0b3a4a-5dde-4703-83b2-a38b244fd446
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": -10,
          "y": 30
        }
      }
  "3":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: indicator
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "4"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e3b0af68-6fa6-460c-86bb-7fa4d0265c32
      iscommand: false
      name: Is Indicator Context Set ?
      type: condition
      version: -1
    taskid: e3b0af68-6fa6-460c-86bb-7fa4d0265c32
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 190
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: indicator
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: 902dcc76-6be0-4d55-839d-061c96562051
      iscommand: false
      name: Delete 'Indicator' Context
      script: DeleteContext
      type: regular
      version: -1
    taskid: 902dcc76-6be0-4d55-839d-061c96562051
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 400
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      extend-context:
        simple: indicator.value=value::indicator.tag=CustomFields.tags
      using:
        simple: InnerServicesModule
      value:
        complex:
          root: inputs.emp
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.find.indicators
      id: a49b874a-e830-45ec-8eb4-9a20a4e6ba4d
      iscommand: true
      name: Check If Indicator Exists
      script: Builtin|||findIndicators
      type: regular
      version: -1
    taskid: a49b874a-e830-45ec-8eb4-9a20a4e6ba4d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 600
        }
      }
  "6":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: value
                root: indicator
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "8"
      "yes":
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f2e1a5e9-1822-46d6-8cd0-4d2d0d02852e
      iscommand: false
      name: Found Indicator ?
      type: condition
      version: -1
    taskid: f2e1a5e9-1822-46d6-8cd0-4d2d0d02852e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 800
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      incidentId:
        complex:
          accessor: id
          root: incident
      value:
        simple: ${inputs.emp}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.associate.indicator
      id: 413bc379-299f-4e29-8eaf-ae3c10af4020
      iscommand: true
      name: Link Indicator To Current Incident
      script: Builtin|||associateIndicatorToIncident
      type: regular
      version: -1
    taskid: 413bc379-299f-4e29-8eaf-ae3c10af4020
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1000
        }
      }
  "8":
    continueonerror: true
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      relateToIncident:
        simple: "true"
      tags:
        simple: ${incident.id}
      type:
        simple: TCS Employee Id
      value:
        complex:
          accessor: xdrhostnames
          root: incident
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.new.indicator
      id: 90a334da-69b9-40e9-8388-0117b8a59c3c
      iscommand: true
      name: Create username Indicator and link to incident
      script: Builtin|||createNewIndicator
      type: regular
      version: -1
    taskid: 90a334da-69b9-40e9-8388-0117b8a59c3c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 220,
          "y": 1160
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: ${incident.id}
      indicatorsValues:
        simple: ${inputs.emp}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.add.values.to.indicator.multi.select.field
      id: 99425dae-90e9-447a-88ea-a8565ab06b51
      iscommand: true
      name: Append The Indicator Tag With Incident ID
      script: Builtin|||appendIndicatorField
      type: regular
      version: -1
    taskid: 99425dae-90e9-447a-88ea-a8565ab06b51
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1160
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0dbcf940-8ff9-41bf-8ec1-6a1bb29e729e
      iscommand: false
      name: Check If User Has Multiple Alerts
      type: title
      version: -1
    taskid: 0dbcf940-8ff9-41bf-8ec1-6a1bb29e729e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1380
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      indicator:
        simple: ${inputs.emp}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Lookup incidents with specified indicator. Use currentIncidentId to omit the existing incident from output.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      id: 175fa0e8-5b6b-4987-82cf-b35bb10000b6
      iscommand: false
      name: Find Incidents With Reported Username
      script: findIncidentsWithIndicator
      type: regular
      version: -1
    taskid: 175fa0e8-5b6b-4987-82cf-b35bb10000b6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1510
        }
      }
  "12":
    continueonerror: true
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    scriptarguments:
      array:
        complex:
          accessor: incidentIDs
          root: IncidentsWithIndicator
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Count an array size
      id: aace8c26-5621-49a0-8170-f4e428568969
      iscommand: false
      name: Count The Number of Incidents
      script: CountArraySize
      type: regular
      version: -1
    taskid: aace8c26-5621-49a0-8170-f4e428568969
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1840
        }
      }
  "13":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: ArraySize
          operator: lessThan
          right:
            value:
              simple: "2"
      label: "yes"
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 256275f0-3802-467c-8af6-dbc9ecb01e9a
      iscommand: false
      name: Is There Only One Incident?
      type: condition
      version: -1
    taskid: 256275f0-3802-467c-8af6-dbc9ecb01e9a
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 2010
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      generalnotification:
        simple: '<h2 style="text-align: center;"><em><span style="color: #008000;">This
          is The User''s First Incident<br/></span><span style="color: #808080;"><strong>Check
          &#39;Related Incidents&#39; In IoC Intel Report Section</strong></span></em></h2>'
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 9eb748ca-a583-46eb-8bb4-22b2dcae7042
      iscommand: true
      name: Set Notification - This is the users first incident
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 9eb748ca-a583-46eb-8bb4-22b2dcae7042
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 2240
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      generalnotification:
        simple: '<h2 style="text-align: center;"><em><span style="color: #008000;">This
          User is Linked To Multiple Incidents<br/></span><span style="color: #808080;"><strong>Check
          &#39;Related Incidents&#39; In IoC Intel Report Section</strong></span></em></h2>'
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: e3f2b590-d3f3-4189-8897-b717614bc27d
      iscommand: true
      name: Set Notification - This is the users first incident
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: e3f2b590-d3f3-4189-8897-b717614bc27d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 410,
          "y": 2240
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f65f532d-2aa9-41d8-87ae-b1d03fa51477
      iscommand: false
      name: The End
      type: title
      version: -1
    taskid: f65f532d-2aa9-41d8-87ae-b1d03fa51477
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -10,
          "y": 2470
        }
      }
  "17":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: incidentIDs
                root: IncidentsWithIndicator
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 55a4d329-0430-4d24-8d0c-5b9e38a60964
      iscommand: false
      name: Check if Context is Defined
      type: condition
      version: -1
    taskid: 55a4d329-0430-4d24-8d0c-5b9e38a60964
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1670
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "6_7_yes": 0.49,
      "6_8_#default#": 0.47
    },
    "paper": {
      "dimensions": {
        "height": 2505,
        "width": 1020,
        "x": -230,
        "y": 30
      }
    }
  }
