contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.10.0
    itemVersion: 1.7.8
    packID: PrismaCloudCompute
    packName: Prisma Cloud Compute by Palo Alto Networks
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: 7.99.99
description: |-
  This is a sub-playbook of the "Prisma Cloud Compute - Compliance Alert v2" playbook.
  It will loop through all of the given compliance issue IDs and will retrieve the following information for each affected container based on the compliance issue ID:
  - Container ID
  - Compliance Issues
  - Compliance Distribution
  - Hostname
  - Image Name
  - Cloud MetaData

  The enriched information will be displayed in the layout in a dedicated table under the "Container Compliance Information" tab.
id: Prisma Cloud Compute - Compliance Alert Container Enrichment Loop
inputs:
- description: A compliance issue ID. This ID is used to filter relevant containers
    for enrichment.
  key: ComplianceIssueID
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    Which ticketing system should be used to create an external ticket.
    Available options:
    - Jira
    - ServiceNow

    If neither of the above are selected, no external ticket will be created.
    For Jira, also set the "JiraProjectName" and "JiraIssueTypeName" playbook inputs.
  key: TicketingSystem
  playbookInputQuery: null
  required: false
  value: {}
- description: 'Issue type name. For example: "Task".'
  key: JiraIssueTypeName
  playbookInputQuery: null
  required: false
  value: {}
- description: The project name with which to associate the issue.
  key: JiraProjectName
  playbookInputQuery: null
  required: false
  value: {}
name: Prisma Cloud Compute - Compliance Alert Container Enrichment Loop
outputs: []
quiet: true
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a32eb95f-96d5-4559-8574-f3b909791cc8
      iscommand: false
      name: ""
      version: -1
    taskid: a32eb95f-96d5-4559-8574-f3b909791cc8
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 440,
          "y": 625
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      all_results:
        simple: "true"
      compliance_ids:
        complex:
          root: inputs.ComplianceIssueID
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieves container scan reports. Maps to Monitor > Compliance
        > Containers in the Console UI.
      id: 55bc50f1-d6e1-496e-8995-ab111a2e6102
      iscommand: true
      name: Get containers information based on compliance ID
      script: '|||prisma-cloud-compute-container-scan-results-list'
      type: regular
      version: -1
    taskid: 55bc50f1-d6e1-496e-8995-ab111a2e6102
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 800
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 69834d56-2201-43a9-8a24-48fcf11d7de5
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 69834d56-2201-43a9-8a24-48fcf11d7de5
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 230,
          "y": 2350
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: EnrichedComplianceIssue
      value:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: PrismaCloudCompute.ContainersScanResults.info.complianceIssues.id
              operator: isEqualString
              right:
                iscontext: true
                value:
                  simple: inputs.ComplianceIssueID
          root: PrismaCloudCompute.ContainersScanResults.info.complianceIssues
          transformers:
          - operator: FirstArrayElement
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: The key "EnrichedComplianceIssue" will hold all of the enriched
        compliance issue information. This will be used in the next task in order
        to create the compliance issues table, which will then be displayed in the
        incident's layout.
      id: 1f1ec0ba-3659-4025-849e-08ee2900787b
      iscommand: false
      name: Set EnrichedComplianceIssue
      script: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 1f1ec0ba-3659-4025-849e-08ee2900787b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1250
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
      - "23"
    note: false
    quietmode: 0
    scriptarguments:
      gridID:
        simple: prismacloudcomputecontainercomplianceissues
      resourceType:
        simple: Container
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This task runs an automation which set the "prismacloudcomputecontainercomplianceissues"
        incident field with the enriched data. When filled, it will be visible in
        the layout.
      id: d7660220-412a-46ea-853b-24bb4db8e310
      iscommand: false
      name: Prepare Compliance Table
      script: PrismaCloudComputeComplianceTable
      type: regular
      version: -1
    taskid: d7660220-412a-46ea-853b-24bb4db8e310
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1430
        }
      }
  "17":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: _id
                root: PrismaCloudCompute.ContainersScanResults
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "27"
      "yes":
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: c415b6d0-18cf-4937-8d4b-dd2a664e0c62
      iscommand: false
      name: Any containers were retrieved?
      type: condition
      version: -1
    taskid: c415b6d0-18cf-4937-8d4b-dd2a664e0c62
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 440,
          "y": 980
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    scriptarguments:
      prismacloudcomputeshowcompliancetab:
        simple: container
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: The Compliance Alert incident layout displays several tabs based
        on different filtering conditions. This task sets a value in the “prismacloudcomputeshowcompliancetab”
        incident field, which will cause the “Container Compliance Information” tab
        to be visible.
      id: 4412f030-0b1a-483f-8c69-616c74584029
      iscommand: true
      name: Show tab in layout
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 4412f030-0b1a-483f-8c69-616c74584029
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1920
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    scriptarguments:
      ComplianceIssueDescription:
        complex:
          accessor: description
          root: EnrichedComplianceIssue
      ComplianceIssueID:
        complex:
          accessor: id
          root: EnrichedComplianceIssue
      ComplianceIssueSeverity:
        complex:
          accessor: severity
          root: EnrichedComplianceIssue
      JiraIssueTypeName:
        complex:
          root: inputs.JiraIssueTypeName
      JiraProjectName:
        complex:
          root: inputs.JiraProjectName
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |
        This playbook is a sub-playbook of the "Prisma Cloud Compute - Compliance Alert Host Enrichment Loop" playbook.
        It creates or updates existing Jira issues for each compliance ID retrieved in the original Prisma Cloud compliance alert, with enriched data for each resource (host, image or container).
      id: 9477361e-b611-4e51-868d-56336a21f72e
      iscommand: false
      name: Prisma Cloud Compute - Jira Compliance Issue
      playbookId: Prisma Cloud Compute - Jira Compliance Issue
      type: playbook
      version: -1
    taskid: 9477361e-b611-4e51-868d-56336a21f72e
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 860,
          "y": 1920
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: aa516b88-4c1c-4b28-8178-7dc376d66964
      iscommand: false
      name: Create external ticket
      type: title
      version: -1
    taskid: aa516b88-4c1c-4b28-8178-7dc376d66964
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1090,
          "y": 1600
        }
      }
  "24":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.TicketingSystem
          operator: isEqualString
          right:
            value:
              simple: Jira
      label: Jira
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.TicketingSystem
          operator: isEqualString
          right:
            value:
              simple: ServiceNow
      label: ServiceNow
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "27"
      Jira:
      - "22"
      ServiceNow:
      - "25"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ff8ff0f0-5b4a-4541-840e-b96d374ed249
      iscommand: false
      name: Which external ticketing system should be used?
      type: condition
      version: -1
    taskid: ff8ff0f0-5b4a-4541-840e-b96d374ed249
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1090,
          "y": 1730
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    scriptarguments:
      AttachFileByDefault:
        simple: "False"
      ComplianceIssueDescription:
        complex:
          accessor: description
          root: EnrichedComplianceIssue
      ComplianceIssueID:
        complex:
          accessor: id
          root: EnrichedComplianceIssue
      ComplianceIssueSeverity:
        complex:
          accessor: severity
          root: EnrichedComplianceIssue
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |-
        This playbook is a sub-playbook of the "Prisma Cloud Compute - Compliance Alert Host Enrichment Loop" playbook.
        It creates a new ServiceNow ticket or updates an existing ServiceNow ticket for each compliance ID retrieved in the original Prisma Cloud compliance alert, with enriched data for each resource (host, image or container).
      id: 0fb55187-77d0-48ce-8ade-325b10fb8275
      iscommand: false
      name: Prisma Cloud Compute - ServiceNow Compliance Ticket
      playbookId: Prisma Cloud Compute - ServiceNow Compliance Ticket
      type: playbook
      version: -1
    taskid: 0fb55187-77d0-48ce-8ade-325b10fb8275
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1330,
          "y": 1920
        }
      }
  "26":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: prismacloudcomputeshowcompliancetab
                root: incident
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "21"
      "yes":
      - "27"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: The Compliance Alert incident layout displays several tabs based
        on different filtering conditions. This task checks if the “Container Compliance
        Information” tab should be visible or not, based on previous tasks results.
      id: 3d070e8f-66e0-477f-85bd-c5832d79cca8
      iscommand: false
      name: Check if compliance tab is already visible
      type: condition
      version: -1
    taskid: 3d070e8f-66e0-477f-85bd-c5832d79cca8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1710
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
      subplaybook:
        simple: auto
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.12/Cortex-XSOAR-Administrator-Guide/Automations
      id: 2f1a4ec0-6308-409b-8ad4-7f603ea622ce
      iscommand: false
      name: Delete context
      script: DeleteContext
      type: regular
      version: -1
    taskid: 2f1a4ec0-6308-409b-8ad4-7f603ea622ce
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 230,
          "y": 2150
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "17_13_yes": 0.46,
      "17_27_#default#": 0.12,
      "24_27_#default#": 0.1,
      "26_21_#default#": 0.33,
      "26_27_yes": 0.3
    },
    "paper": {
      "dimensions": {
        "height": 1790,
        "width": 1480,
        "x": 230,
        "y": 625
      }
    }
  }
