contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
id: 4dd9791a-e769-4bbe-8d36-d6c517550365
inputs:
- description: ""
  key: IPReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
- description: ""
  key: DomainReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
- description: ""
  key: Hash256ReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
- description: ""
  key: HashMD5ReferenceSet
  playbookInputQuery: null
  required: false
  value: {}
name: TCS-QRadar IOC Response-Email v2
outputs: []
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e4fc286d-8111-45dd-89a1-40c4cbd3720e
      iscommand: false
      name: ""
      version: -1
    taskid: e4fc286d-8111-45dd-89a1-40c4cbd3720e
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": -100,
          "y": 170
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a new reference set. If the provided name is already in
        use, this command will fail
      id: bf9fbfd7-6ba9-4b08-8672-d4b3af9c2a34
      iscommand: false
      name: 'Phase 2: Update existing QRadar IoC detection rule/reference set'
      type: title
      version: -1
    taskid: bf9fbfd7-6ba9-4b08-8672-d4b3af9c2a34
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 170
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ref_name:
        simple: TCS_MasterIOC_IP
      value:
        complex:
          root: JoinedFilesUnique
          transformers:
          - args:
              separator:
                value:
                  simple: ','
            operator: join
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Adds or updates a value in a reference set.
      id: 06ad37a0-05fe-445c-841f-4d127d17d5d0
      iscommand: true
      name: Update IP address Reference set "TCS_MasterIOC_IP"
      script: '|||qradar-update-reference-set-value'
      type: regular
      version: -1
    taskid: 06ad37a0-05fe-445c-841f-4d127d17d5d0
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 290
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ref_name:
        simple: TCS_MasterIOC_Domain
      value:
        complex:
          root: EmailedDomainsURLsUnique
          transformers:
          - args:
              delimiter:
                value:
                  simple: |2+

            operator: split
          - args:
              separator:
                value:
                  simple: ','
            operator: join
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Adds or updates a value in a reference set.
      id: 5be95fc4-cfff-499a-8dec-5cc9a7bfb274
      iscommand: true
      name: Update Domain Reference set "TCS_MasterIOC_Domain"
      script: '|||qradar-update-reference-set-value'
      type: regular
      version: -1
    taskid: 5be95fc4-cfff-499a-8dec-5cc9a7bfb274
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 440
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ref_name:
        simple: TCS_MasterIOC_SHA256
      value:
        complex:
          root: EmailedHashs-SHA256
          transformers:
          - args:
              delimiter:
                value:
                  simple: |2+

            operator: split
          - args:
              separator:
                value:
                  simple: ','
            operator: join
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Adds or updates a value in a reference set.
      id: 0c386fa1-5670-42f6-8684-37f8ba791177
      iscommand: true
      name: Update SHA256 Reference set "TCS_MasterIOC_SHA256"
      script: '|||qradar-update-reference-set-value'
      type: regular
      version: -1
    taskid: 0c386fa1-5670-42f6-8684-37f8ba791177
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 590
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1c6b3a36-5ced-4964-83ff-c89f7f24c930
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 1c6b3a36-5ced-4964-83ff-c89f7f24c930
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 900
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: d6182e49-abc0-4ff6-8fe0-0a43425e6fab
      iscommand: false
      name: 'Phase 3: Identify discovered IOC’s in historical data (30/90)'
      type: title
      version: -1
    taskid: d6182e49-abc0-4ff6-8fe0-0a43425e6fab
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 880,
          "y": 170
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      query_expression:
        simple: select QIDNAME(qid) as 'Event Name',logsourcename(logSourceId) as
          'Log Source',"eventCount" as 'Event Count',"startTime" as 'Time',categoryname(category)
          as 'Low Level Category',"sourceIP" as 'Source IP',"sourcePort" as 'Source
          Port',"destinationIP" as 'Destination IP',"destinationPort" as 'Destination
          Port',"userName" as 'Username',"magnitude" as 'Magnitude' from events where
          referencesetcontains('TCS_MasterIOC_IP', "sourceIP") order by "startTime"
          desc last 30 days
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Searches in QRadar using AQL. It is highly recommended to use the
        playbook 'QRadarFullSearch' instead of this command - it will execute the
        search, and will return the result.
      id: 17454d9b-0645-4a8b-8e91-7346c83fb9b9
      iscommand: true
      name: Query QRadar; IP IOC’s on historical data last 30 days
      script: '|||qradar-searches'
      type: regular
      version: -1
    taskid: 17454d9b-0645-4a8b-8e91-7346c83fb9b9
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 290
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 21aeb95e-a023-474d-83a4-bca7043ba627
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 21aeb95e-a023-474d-83a4-bca7043ba627
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 880,
          "y": 900
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 102d3ad8-e720-4d53-8b31-104c980f5b8e
      iscommand: false
      name: 'Phase 4: Send Notifications'
      type: title
      version: -1
    taskid: 102d3ad8-e720-4d53-8b31-104c980f5b8e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 170
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      cc:
        simple: v.ghule@tcs.com
      htmlBody:
        simple: |-
          <p>** QRadar IOC Detection Alert **</p>
          <p><br /> Positive IoC detected for &lsquo;IoC details go here&rsquo;. Please investigate.<br /> <br /> Regards,<br /> CyberAutoBot</p>
      subject:
        simple: QRadar IOC Detection Alert
      to:
        simple: yogesh.gholap@tcs.com;internalis.cybersecurity@tcs.com
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email
      id: 0619cccb-2113-4047-88ec-9d58b55cb301
      iscommand: true
      name: Send Notification Email to CSOC Manager and Analyst
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 0619cccb-2113-4047-88ec-9d58b55cb301
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 290
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9519a313-e12a-485a-8f57-bdf47aee0e6e
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 9519a313-e12a-485a-8f57-bdf47aee0e6e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1330,
          "y": 910
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ref_name:
        simple: TCS_MasterIOC_MD5
      value:
        complex:
          root: EmailedHashs-MD5
          transformers:
          - args:
              delimiter:
                value:
                  simple: |2+

            operator: split
          - args:
              separator:
                value:
                  simple: ','
            operator: join
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Adds or updates a value in a reference set.
      id: 4904f42e-5232-4c68-8930-5825044f8ee1
      iscommand: true
      name: Update MD5 Reference set "TCS_MasterIOC_MD5"
      script: '|||qradar-update-reference-set-value'
      type: regular
      version: -1
    taskid: 4904f42e-5232-4c68-8930-5825044f8ee1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 740
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      query_expression:
        simple: select QIDNAME(qid) as 'Event Name',logsourcename(logSourceId) as
          'Log Source',"eventCount" as 'Event Count',"startTime" as 'Start Time',categoryname(category)
          as 'Low Level Category',"sourceIP" as 'Source IP',"sourcePort" as 'Source
          Port',"destinationIP" as 'Destination IP',"destinationPort" as 'Destination
          Port',"userName" as 'Username',"URL" as 'URL (custom)',"web_Category" as
          'web_Category (custom)',"ThreatName" as 'ThreatName (custom)' from events
          where referencesetcontains('TCS_MasterIOC_Domain', "URL") order by "startTime"
          desc last  30 days
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Searches in QRadar using AQL. It is highly recommended to use the
        playbook 'QRadarFullSearch' instead of this command - it will execute the
        search, and will return the result.
      id: 1aab56d8-d56a-4ed1-88fe-e64cf068eec3
      iscommand: true
      name: Query QRadar; Domain IOC’s on historical data last 30 days
      script: '|||qradar-searches'
      type: regular
      version: -1
    taskid: 1aab56d8-d56a-4ed1-88fe-e64cf068eec3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 450
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      query_expression:
        simple: select QIDNAME(qid) as 'Event Name',logsourcename(logSourceId) as
          'Log Source',"eventCount" as 'Event Count',"startTime" as 'Start Time',categoryname(category)
          as 'Low Level Category',"sourceIP" as 'Source IP',"sourcePort" as 'Source
          Port',"destinationIP" as 'Destination IP',"destinationPort" as 'Destination
          Port',"userName" as 'Username',"URL" as 'URL (custom)',"web_Category" as
          'web_Category (custom)',"ThreatName" as 'ThreatName (custom)' from events
          where referencesetcontains('TCS_MasterIOC_Domain', "URL") order by "startTime"
          desc last  30 days
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Searches in QRadar using AQL. It is highly recommended to use the
        playbook 'QRadarFullSearch' instead of this command - it will execute the
        search, and will return the result.
      id: e881c76c-6944-472f-8c3b-9fb1712274ee
      iscommand: true
      name: Query QRadar; SHA256 Hash IOC’s on historical data last 30 days
      script: '|||qradar-searches'
      type: regular
      version: -1
    taskid: e881c76c-6944-472f-8c3b-9fb1712274ee
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 600
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        simple: ${inputs.IPReferenceSet}
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      MD5:
        simple: ${inputs.HashMD5ReferenceSet}
      QradarIPfield:
        simple: sourceip,destinationip
      QradarMD5Field:
        simple: File Hash
      QradarSHA256Field:
        simple: File Hash
      QradarURLDomainField:
        simple: URL
      SHA256:
        simple: ${inputs.Hash256ReferenceSet}
      TimeFrame:
        simple: LAST 30 DAYS
      URLDomain:
        simple: ${inputs.DomainReferenceSet}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: 'The Playbook queries QRadar SIEM for indicators such as file hashes,
        IP addresses, domains, or urls. '
      id: 741d0559-64c5-4fd6-87a3-2c63a00a7e5d
      iscommand: false
      name: QRadar Indicator Hunting V2
      playbookId: QRadar Indicator Hunting V2
      type: playbook
      version: -1
    taskid: 741d0559-64c5-4fd6-87a3-2c63a00a7e5d
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 890,
          "y": 290
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "18"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cf95ff4f-83e6-4775-8b94-0da46869a744
      iscommand: false
      name: Phase 1:Invoke IOC Blocking Playbooks
      type: title
      version: -1
    taskid: cf95ff4f-83e6-4775-8b94-0da46869a744
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -100,
          "y": 330
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      EmailedFileData:
        simple: ${File.Data}
      File:
        simple: ${File}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: dd840a4d-ed65-4e18-897e-c2c5d45e231e
      iscommand: false
      name: TCS-Generic EDL Upload IP BlockList handler
      playbookId: bcaddc7b-d2e8-46c5-8761-d197e5d28e19
      type: playbook
      version: -1
    taskid: dd840a4d-ed65-4e18-897e-c2c5d45e231e
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -100,
          "y": 505
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: f9d52c59-166c-4c65-8a5a-194e4aa2f537
      iscommand: true
      name: Close Investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: f9d52c59-166c-4c65-8a5a-194e4aa2f537
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1070
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 85bd6611-6577-4e69-8f1c-0cdc661fee3e
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 85bd6611-6577-4e69-8f1c-0cdc661fee3e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 1230
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      body:
        simple: |-
          Hello Human,

          Emailed IOC's are blocked  through XSOAR.


          Regards,
          CSOC Cyber AutoBot
      cc:
        simple: v.ghule@tcs.com,kunal.krushev@tcs.com
      subject:
        simple: IOC 's are blocked through XSOAR
      to:
        simple: InternalIs.CyberSecurityOps@tcs.com
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email
      id: 59925b7e-96e1-4c8f-8c9f-44cba21fa268
      iscommand: true
      name: Send IOC blocking confirmation mail to team
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 59925b7e-96e1-4c8f-8c9f-44cba21fa268
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -100,
          "y": 720
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1125,
        "width": 2280,
        "x": -100,
        "y": 170
      }
    }
  }
