contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.10.0
    itemVersion: 1.7.4
    packID: PrismaCloudCompute
    packName: Prisma Cloud Compute by Palo Alto Networks
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: |-
  This playbook is a sub-playbook of the "Prisma Cloud Compute - Compliance Alert Host Enrichment Loop" playbook.
  It creates a new Jira issue or updates an existing Jira issue for each compliance ID retrieved in the original Prisma Cloud compliance alert, with enriched data for each resource (host, image or container).
id: Prisma Cloud Compute - Jira Compliance Issue
inputs:
- description: The compliance issue ID to open a Jira issue for.
  key: ComplianceIssueID
  playbookInputQuery: null
  required: false
  value: {}
- description: The compliance issue description.
  key: ComplianceIssueDescription
  playbookInputQuery: null
  required: false
  value: {}
- description: The compliance issue severity.
  key: ComplianceIssueSeverity
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    Whether to create the Jira issue with an XLSX file by default.

    Available options:

    False - The playbook will create the issue with a markdown table containing the compliance issues. In case the table is too big (32,000 characters and above), it will create the Jira issue with an attached XLSX file.

    True - The playbook will create the Jira issue with an attached XLSX file by default.
  key: AttachFileByDefault
  playbookInputQuery: null
  required: false
  value: {}
- description: 'Issue type name. For example: "Task".'
  key: JiraProjectName
  playbookInputQuery: null
  required: false
  value: {}
- description: The project name with which to associate the issue.
  key: JiraIssueTypeName
  playbookInputQuery: null
  required: false
  value: {}
name: Prisma Cloud Compute - Jira Compliance Issue
outputs: []
quiet: true
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "34"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7d89d80a-69cf-49d5-8f06-ee2f9cec00ef
      iscommand: false
      name: ""
      version: -1
    taskid: 7d89d80a-69cf-49d5-8f06-ee2f9cec00ef
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 450,
          "y": -520
        }
      }
  "6":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: incident.prismacloudcomputehostcomplianceissues.complianceissues
                    operator: match
                    right:
                      iscontext: true
                      value:
                        simple: filter
                root: incident.prismacloudcomputehostcomplianceissues
                transformers:
                - args:
                    fields:
                      value:
                        simple: complianceissues
                    json_object:
                      value:
                        simple: incident.prismacloudcomputehostcomplianceissues
                  operator: IgnoreFieldsFromJson
                - args:
                    headers: {}
                    is_auto_json_transform: {}
                    json_transform_properties: {}
                    title: {}
                  operator: JsonToTable
                - args:
                    regex:
                      value:
                        simple: <br>
                    replaceWith:
                      value:
                        simple: "\\\\ \n"
                  operator: replaceMatch
                - operator: strLength
          operator: greaterThanOrEqual
          right:
            value:
              simple: "32000"
        - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.AttachFileByDefault
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: XLSX
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "9"
      XLSX:
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        This condition checks if one of the following is true:

        - The markdown table with the compliance issues is too big (32,000 characters long or more)
        - The value of the playbook input "AttachFileByDefault" is "True"

        If one of the above is true, it will create the Jira issue with an attached file and not with a markdown table in the issue's description.
      id: 2d4fc830-4bb3-4756-8beb-10d48f510f4e
      iscommand: false
      name: Verify if Jira issue requires XLSX or a Markdown table
      type: condition
      version: -1
    taskid: 2d4fc830-4bb3-4756-8beb-10d48f510f4e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": 375
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: filter
      value:
        simple: (^|\n)${inputs.ComplianceIssueID} \(
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This task will create a string which will be used as a filter in
        other tasks in order to extract only the relevant resources, based on the
        compliance issue ID, from the full list of affected resources.
      id: 9ced22dd-d7bf-48ad-8e95-4356a601a355
      iscommand: false
      name: Create a filter term for extracting relevant resources
      script: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 9ced22dd-d7bf-48ad-8e95-4356a601a355
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 190
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "36"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 53e40208-e5bb-4250-80b6-e6f574fa5e9f
      iscommand: false
      name: Create/Update a ticket with markdown table
      type: title
      version: -1
    taskid: 53e40208-e5bb-4250-80b6-e6f574fa5e9f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 230,
          "y": 560
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 00fbc82e-8f09-46e0-8045-4aca035f5237
      iscommand: false
      name: Create/Update a ticket with XLSX file
      type: title
      version: -1
    taskid: 00fbc82e-8f09-46e0-8045-4aca035f5237
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 670,
          "y": 560
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7823154f-ebf3-46e5-8628-1fc7513465b2
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 7823154f-ebf3-46e5-8628-1fc7513465b2
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1410
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "29"
      - "37"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 9e6964d3-4856-4dfc-88dc-9e085d5290e5
      iscommand: false
      name: Set ticket info in layout
      type: title
      version: -1
    taskid: 9e6964d3-4856-4dfc-88dc-9e085d5290e5
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 440,
          "y": 895
        }
      }
  "26":
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      ticketnumber:
        complex:
          accessor: Id
          root: Ticket
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: The Compliance Alert incident layout displays several tabs based
        on different filtering conditions. This task sets a value in the “ ticketnumber”
        incident field, which will cause the “Ticketing Information” tab to be visible.
      id: 272b75d3-c647-4449-8f5c-b7a1f75f2ec4
      iscommand: true
      name: Show Ticketing Information tab in the layout
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 272b75d3-c647-4449-8f5c-b7a1f75f2ec4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 650,
          "y": 1230
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
      subplaybook:
        simple: auto
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.12/Cortex-XSOAR-Administrator-Guide/Automations
      id: e7af5051-d8b5-4b6e-8bf3-63238a238cbe
      iscommand: false
      name: Delete Context
      script: DeleteContext
      type: regular
      version: -1
    taskid: e7af5051-d8b5-4b6e-8bf3-63238a238cbe
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 20
        }
      }
  "28":
    continueonerrortype: ""
    id: "28"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      columns:
        simple: Ticketing System,Ticket ID,Ticket Number,Action,Title
      context_path:
        simple: TicketInfo
      grid_id:
        simple: prismacloudcomputeticketsinfo
      keys:
        simple: ticketingsystem,ticketid,ticketnumber,action,title
      overwrite:
        simple: "false"
      sort_by:
        simple: ticketid
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Creates a Grid table from items or key-value pairs.
      id: aad3d9a6-3f9e-44bf-8547-24cf202ba444
      iscommand: false
      name: Set ticket info table grid field
      script: SetGridField
      type: regular
      version: -1
    taskid: aad3d9a6-3f9e-44bf-8547-24cf202ba444
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1230
        }
      }
  "29":
    continueonerrortype: ""
    id: "29"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "28"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: TicketInfo
      value:
        simple: '{"ticketingsystem": "Jira", "ticketid": "${Ticket.Id}", "ticketnumber":
          "${Ticket.Key}",  "action": "${TicketAction}", "title":"Prisma Cloud Compute
          - compliance issues ID: ${inputs.ComplianceIssueID}"}'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Prepare the data which will be displayed under the "Ticketing Information"
        tab in the incident's layout.
      id: 41f1c2b6-7753-4ecf-8a5d-8566f7399a9e
      iscommand: false
      name: Prepare ticket info data
      script: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 41f1c2b6-7753-4ecf-8a5d-8566f7399a9e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1050
        }
      }
  "32":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.ComplianceIssueID
          operator: isNotEmpty
          right:
            value: {}
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.JiraProjectName
          operator: isNotEmpty
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.JiraIssueTypeName
          operator: isNotEmpty
      label: inputs-exist
    continueonerrortype: ""
    id: "32"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      inputs-exist:
      - "27"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 67eba448-770a-462b-81a3-81b3891f28ee
      iscommand: false
      name: Verify inputs
      type: condition
      version: -1
    taskid: 67eba448-770a-462b-81a3-81b3891f28ee
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": -180
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a98c54b8-ed9f-4578-8c91-3c95e03c769c
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: a98c54b8-ed9f-4578-8c91-3c95e03c769c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 900,
          "y": -10
        }
      }
  "34":
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      "no":
      - "33"
      "yes":
      - "32"
    note: false
    quietmode: 0
    scriptarguments:
      brandname:
        simple: Jira V3
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Returns 'yes' if integration brand is available. Otherwise returns
        'no'.
      id: 118ac2f8-72c9-4ff9-8d87-26c26667ab7d
      iscommand: false
      name: Is Jira V3 integration enabled?
      script: IsIntegrationAvailable
      type: condition
      version: -1
    taskid: 118ac2f8-72c9-4ff9-8d87-26c26667ab7d
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": -360
        }
      }
  "35":
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      ComplianceIssueDescription:
        complex:
          root: inputs.ComplianceIssueDescription
      ComplianceIssueID:
        complex:
          root: inputs.ComplianceIssueID
      ComplianceIssueSeverity:
        complex:
          root: inputs.ComplianceIssueSeverity
      Filter:
        complex:
          root: filter
      JiraIssueTypeName:
        complex:
          root: inputs.JiraIssueTypeName
      JiraProjectName:
        complex:
          root: inputs.JiraProjectName
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: ece6c7fa-3118-48f5-8e03-7f100420fb72
      iscommand: false
      name: Prisma Cloud Compute - Jira Ticket (XLSX)
      playbookId: Prisma Cloud Compute - Jira Ticket (XLSX)
      type: playbook
      version: -1
    taskid: ece6c7fa-3118-48f5-8e03-7f100420fb72
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 670,
          "y": 710
        }
      }
  "36":
    continueonerrortype: ""
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      ComplianceIssueDescription:
        complex:
          root: inputs.ComplianceIssueDescription
      ComplianceIssueID:
        complex:
          root: inputs.ComplianceIssueID
      ComplianceIssueSeverity:
        complex:
          root: inputs.ComplianceIssueSeverity
      Filter:
        complex:
          root: filter
      JiraIssueTypeName:
        complex:
          root: inputs.JiraIssueTypeName
      JiraProjectName:
        complex:
          root: inputs.JiraProjectName
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: ecc56a85-bf38-4fe6-8bf4-95cc5a824b6c
      iscommand: false
      name: Prisma Cloud Compute - Jira Ticket (Markdown Table)
      playbookId: Prisma Cloud Compute - Jira Ticket (Markdown Table)
      type: playbook
      version: -1
    taskid: ecc56a85-bf38-4fe6-8bf4-95cc5a824b6c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 230,
          "y": 710
        }
      }
  "37":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: ticketnumber
                root: incident
          operator: isEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "21"
      "yes":
      - "26"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: The Compliance Alert incident layout displays several tabs based
        on different filtering conditions. This task checks if the “Ticketing Information”
        tab is already visible or not, based on the value under the relevant incident
        field.
      id: b8289a7d-dcca-4a73-82a6-e621cd0579f3
      iscommand: false
      name: Check if Ticketing tab is already visible in the layout
      type: condition
      version: -1
    taskid: b8289a7d-dcca-4a73-82a6-e621cd0579f3
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 650,
          "y": 1050
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "32_27_inputs-exist": 0.57,
      "34_32_yes": 0.47,
      "34_33_no": 0.58,
      "37_26_yes": 0.42,
      "6_10_XLSX": 0.6
    },
    "paper": {
      "dimensions": {
        "height": 1995,
        "width": 1050,
        "x": 230,
        "y": -520
      }
    }
  }
