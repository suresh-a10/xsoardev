contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.9.0
    itemVersion: 1.1.20
    packID: AWS-Enrichment-Remediation
    packName: AWS Enrichment and Remediation
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: |-
  ## **AWS Credentials Rotation Playbook**

  ### **Identity Remediation**
  Secure compromised accounts by taking swift action:
  - **Reset Password**: Resets the user password to halt any unauthorized access.

  - **Access Key Deactivation**: Deactivate any suspicious or known-compromised access keys.

  - **Combo Action**: In some cases, you may want to reset both the password and deactivate the access key for absolute security.

  ### **Role Remediation**
  If a role is suspected to be compromised:
  - **Deny Policy Implementation**: Attach a deny-all policy to the compromised role, thus preventing it from performing any further actions.

  - **Role Cloning**: Before outright remediation, clone the role. This ensures that you have a backup with the same permissions, making transition smoother.
id: Cloud Credentials Rotation - AWS
inputs:
- description: |-
    The response playbook provides the following remediation actions for IAM users:

    Reset - By entering "Reset" in the input, the playbook will execute password reset.

    Deactivate - By entering "Deactivate" in the input, the playbook will execute access key deactivation.

    ALL - By entering "ALL" in the input, the playbook will execute both password reset and access key deactivation.
  key: IAMRemediationType
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    Whether to clone the compromised SA before putting a deny policy to it.
    True/False
  key: shouldCloneSA
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    The type of identity involved. Usually mapped to the incident field named 'cloudidentitytype'.
    e.g.
    USER,SERVICE_ACCOUNT,APPLICATION
  key: identityType
  playbookInputQuery: null
  required: false
  value: {}
- description: The new role name to assign in the clone service account flow.
  key: newRoleName
  playbookInputQuery: null
  required: false
  value:
    simple: tempNewRoleName
- description: The new instance profile name to assign in the clone service account
    flow.
  key: newInstanceProfileName
  playbookInputQuery: null
  required: false
  value:
    simple: tempNewInstanceProfileName
- description: The access key ID.
  key: accessKeyID
  playbookInputQuery: null
  required: false
  value: {}
- description: The user name.
  key: username
  playbookInputQuery: null
  required: false
  value: {}
- description: The instance ID.
  key: instanceID
  playbookInputQuery: null
  required: false
  value: {}
- description: If provided, the role will be attached with a deny policy without the
    compute instance analysis flow.
  key: roleNameToRestrict
  playbookInputQuery: null
  required: false
  value: {}
name: Cloud Credentials Rotation - AWS
outputs:
- contextPath: AWS.EC2.Instances
  description: AWS EC2 instance information.
  type: unknown
- contextPath: AWS.IAM.InstanceProfiles
  description: AWS IAM instance profile information.
  type: unknown
- contextPath: AWS.IAM.Roles.AttachedPolicies.Policies
  description: A list of managed policy names.
  type: unknown
- contextPath: AWS.IAM.Roles.RoleName.Policies
  description: A list of policy names.
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "52"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e31893d6-5dc6-4f63-8bea-7e87a3626950
      iscommand: false
      name: ""
      version: -1
    taskid: e31893d6-5dc6-4f63-8bea-7e87a3626950
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 490,
          "y": -490
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "53"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7184e6ea-8ff8-4956-8c4f-7e7d49e44f43
      iscommand: false
      name: Compute
      type: title
      version: -1
    taskid: 7184e6ea-8ff8-4956-8c4f-7e7d49e44f43
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -40,
          "y": -165
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 474544c9-043c-4cfb-8f23-804aadb9ea6f
      iscommand: false
      name: Identity
      type: title
      version: -1
    taskid: 474544c9-043c-4cfb-8f23-804aadb9ea6f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1010,
          "y": -165
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "37"
    note: false
    quietmode: 0
    scriptarguments:
      accessKeyId:
        complex:
          root: inputs.accessKeyID
      status:
        simple: Inactive
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Changes the status of the specified access key from Active to Inactive,
        or vice versa. This operation can be used to disable a user's key as part
        of a key rotation workflow.
      id: 50995c28-10ca-4f42-8c2a-4d7635c60b1f
      iscommand: true
      name: Deactivate the user's access key
      script: '|||aws-iam-update-access-key'
      type: regular
      version: -1
    taskid: 50995c28-10ca-4f42-8c2a-4d7635c60b1f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 280
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "37"
    note: false
    quietmode: 0
    scriptarguments:
      newPassword:
        complex:
          root: NEW_PASSWORD
      passwordResetRequired:
        simple: "True"
      userName:
        complex:
          root: inputs.username
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Changes the password for the specified IAM user.
      id: 346dec85-0477-4f49-819b-701179050d19
      iscommand: true
      name: Force password reset
      script: '|||aws-iam-update-login-profile'
      type: regular
      version: -1
    taskid: 346dec85-0477-4f49-819b-701179050d19
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1660,
          "y": 440
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Describes one or more regions that are currently available to you.
      id: 1f824e1c-2bcf-4204-8806-e89b4d144f97
      iscommand: true
      name: Describe regions
      script: '|||aws-ec2-describe-regions'
      type: regular
      version: -1
    taskid: 1f824e1c-2bcf-4204-8806-e89b4d144f97
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 330
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      filters:
        simple: Name=iam-instance-profile.arn,Values=${AWS.EC2.IamInstanceProfileAssociations.IamInstanceProfile.Arn}
      region:
        complex:
          accessor: RegionName
          root: AWS.Regions
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Describes one or more of your instances.
      id: 33ef6c53-9f17-426e-82b3-756ed55a185e
      iscommand: true
      name: Describe instances
      script: '|||aws-ec2-describe-instances'
      type: regular
      version: -1
    taskid: 33ef6c53-9f17-426e-82b3-756ed55a185e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 500
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "18"
    note: false
    quietmode: 0
    scriptarguments:
      filters:
        simple: Name=instance-id,Values=${inputs.instanceID}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Describes your IAM instance profile associations.
      id: 29547081-1a2e-4a6d-8576-51caf121a64d
      iscommand: true
      name: Describe IAM instance profile associations
      script: '|||aws-ec2-describe-iam-instance-profile-associations'
      type: regular
      version: -1
    taskid: 29547081-1a2e-4a6d-8576-51caf121a64d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 155
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "34"
    note: false
    quietmode: 0
    scriptarguments:
      instanceProfileName:
        complex:
          accessor: Arn
          root: AWS.EC2.Instances.IamInstanceProfile
          transformers:
          - args:
              delimiter:
                value:
                  simple: /
              fields:
                value:
                  simple: "2"
            operator: Cut
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieves information about the specified instance profile.
      id: 78bbcd2c-6182-4122-8a92-0c94bf784f58
      iscommand: true
      name: Get instance profile
      script: '|||aws-iam-get-instance-profile'
      type: regular
      version: -1
    taskid: 78bbcd2c-6182-4122-8a92-0c94bf784f58
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 675
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "55"
    note: false
    quietmode: 0
    scriptarguments:
      roleName:
        complex:
          accessor: RoleName
          root: AWS.IAM.InstanceProfiles.Roles
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: List all managed policies that are attached to the specified IAM
        role.
      id: b4cca9fe-a91c-44fd-86a6-1d8cf0237267
      iscommand: true
      name: List attached role policies
      script: '|||aws-iam-list-attached-role-policies'
      type: regular
      version: -1
    taskid: b4cca9fe-a91c-44fd-86a6-1d8cf0237267
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 170,
          "y": 1300
        }
      }
  "24":
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "54"
    note: false
    quietmode: 0
    scriptarguments:
      roleName:
        complex:
          accessor: RoleName
          root: AWS.IAM.InstanceProfiles.Roles
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Lists the names of the inline policies that are embedded in the
        specified IAM role.
      id: c6a5ddee-9189-4e0e-8ca9-3724362c5632
      iscommand: true
      name: List role inline-policies
      script: '|||aws-iam-list-role-policies'
      type: regular
      version: -1
    taskid: c6a5ddee-9189-4e0e-8ca9-3724362c5632
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -250,
          "y": 1460
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    scriptarguments:
      instanceProfileName:
        complex:
          root: inputs.newInstanceProfileName
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a new instance profile.
      id: d01a4182-b82b-4372-8f46-292de9d16868
      iscommand: true
      name: Create instance profile
      script: '|||aws-iam-create-instance-profile'
      type: regular
      version: -1
    taskid: d01a4182-b82b-4372-8f46-292de9d16868
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 2360
        }
      }
  "26":
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "31"
    note: false
    quietmode: 0
    scriptarguments:
      assumeRolePolicyDocument:
        complex:
          accessor: AssumeRolePolicyDocument
          root: AWS.IAM.InstanceProfiles.Roles
          transformers:
          - operator: Stringify
      roleName:
        complex:
          root: inputs.newRoleName
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a new role for your AWS account.
      id: 397cd3fc-0559-4e90-85dd-17dcc0f0611f
      iscommand: true
      name: Create role
      script: '|||aws-iam-create-role'
      type: regular
      version: -1
    taskid: 397cd3fc-0559-4e90-85dd-17dcc0f0611f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 2520
        }
      }
  "29":
    continueonerrortype: ""
    id: "29"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "48"
      - "47"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 08733be8-8938-4261-8ca4-3634944d8d4e
      iscommand: false
      name: Clone Compromised Service Account
      type: title
      version: -1
    taskid: 08733be8-8938-4261-8ca4-3634944d8d4e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -40,
          "y": 1025
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "33"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a6106476-d3ca-4263-8ea6-7909e43e53eb
      iscommand: false
      name: Change Instance Profile IAM Role
      type: title
      version: -1
    taskid: a6106476-d3ca-4263-8ea6-7909e43e53eb
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -560,
          "y": 3105
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "49"
    note: false
    quietmode: 0
    scriptarguments:
      entityName:
        complex:
          root: inputs.newRoleName
      policyArn:
        complex:
          accessor: PolicyArn
          root: AWS.IAM.Roles.AttachedPolicies.Policies
      type:
        simple: Role
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Attaches the specified managed policy to the specified IAM resource.
      id: 6539d1ad-9593-49b5-804a-13aff5eba217
      iscommand: true
      name: Attach role policy
      script: '|||aws-iam-attach-policy'
      type: regular
      version: -1
    taskid: 6539d1ad-9593-49b5-804a-13aff5eba217
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 2680
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "36"
    note: false
    quietmode: 0
    scriptarguments:
      policyDocument:
        simple: |-
          {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Deny",
                "Action": "*",
                "Resource": "*"
              }
            ]
          }
      policyName:
        simple: XSIAM-DenyPolicy-Alert-${alert.id}
      roleName:
        complex:
          accessor: RoleName
          root: AWS.IAM.InstanceProfiles.Roles
          transformers:
          - args:
              applyIfEmpty: {}
              defaultValue:
                iscontext: true
                value:
                  simple: inputs.roleNameToRestrict
            operator: SetIfEmpty
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Adds or updates an inline policy document that is embedded in the
        specified IAM role.
      id: 8d96c531-4f68-4e75-8264-066143a2d0c1
      iscommand: true
      name: Attach deny policy to a role
      script: '|||aws-iam-put-role-policy'
      type: regular
      version: -1
    taskid: 8d96c531-4f68-4e75-8264-066143a2d0c1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -560,
          "y": 3240
        }
      }
  "34":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.shouldCloneSA
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "Yes"
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "30"
      "Yes":
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether to clone the service account before putting a deny
        policy to it.
      id: da40f794-fe96-4266-852b-65cfe91deb2e
      iscommand: false
      name: Should clone before putting a deny policy?
      type: condition
      version: -1
    taskid: da40f794-fe96-4266-852b-65cfe91deb2e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -40,
          "y": 840
        }
      }
  "35":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.IAMRemediationType
          operator: isEqualString
          right:
            value:
              simple: Deactivate
      label: Deactivate Access Key
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.IAMRemediationType
          operator: isEqualString
          right:
            value:
              simple: Reset
      label: Reset Password
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.IAMRemediationType
          operator: isEqualString
          right:
            value:
              simple: ALL
      label: ALL
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "37"
      ALL:
      - "39"
      Deactivate Access Key:
      - "16"
      Reset Password:
      - "51"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks the remediation type provided by the user.
      id: d072f064-19a3-44cc-8a3c-b69d6cf02efd
      iscommand: false
      name: Check remediation type
      type: condition
      version: -1
    taskid: d072f064-19a3-44cc-8a3c-b69d6cf02efd
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1010,
          "y": -30
        }
      }
  "36":
    continueonerrortype: ""
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 818b1edc-5cab-4940-88fc-4a3a25c547fd
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 818b1edc-5cab-4940-88fc-4a3a25c547fd
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 490,
          "y": 3420
        }
      }
  "37":
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5c0c9617-db02-446a-820c-f43fd368debd
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 5c0c9617-db02-446a-820c-f43fd368debd
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 625
        }
      }
  "39":
    continueonerrortype: ""
    id: "39"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
      - "51"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1015b828-1cf9-45d3-8aca-b2585e0dbd3d
      iscommand: false
      name: ALL
      type: title
      version: -1
    taskid: 1015b828-1cf9-45d3-8aca-b2585e0dbd3d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2040,
          "y": 140
        }
      }
  "41":
    continueonerrortype: ""
    id: "41"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "45"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: attachedPoliciesARN
      value:
        complex:
          accessor: PolicyArn
          root: AWS.IAM.Roles.AttachedPolicies.Policies
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 368e0611-9297-4445-8a8c-89529dcfc92d
      iscommand: false
      name: Set attached policies ARN
      script: Set
      type: regular
      version: -1
    taskid: 368e0611-9297-4445-8a8c-89529dcfc92d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 170,
          "y": 1630
        }
      }
  "42":
    continueonerrortype: ""
    id: "42"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "44"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: policyNames
      value:
        complex:
          accessor: Policies
          root: AWS.IAM.Roles
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 10287654-3015-469a-8a34-df6a48c0504d
      iscommand: false
      name: Set policies name
      script: Set
      type: regular
      version: -1
    taskid: 10287654-3015-469a-8a34-df6a48c0504d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -250,
          "y": 1820
        }
      }
  "43":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: AWS.IAM.Policies.Versions.Document
          operator: isNotEmpty
          right:
            value: {}
        - left:
            iscontext: true
            value:
              simple: AWS.IAM.Roles.PolicyDocument
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "43"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "25"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether managed or inline policies are available.
      id: 37908070-3c4c-4d1e-8203-be5a0d33db00
      iscommand: false
      name: Were role policies document retrieved?
      type: condition
      version: -1
    taskid: 37908070-3c4c-4d1e-8203-be5a0d33db00
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -40,
          "y": 2150
        }
      }
  "44":
    continueonerrortype: ""
    id: "44"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    scriptarguments:
      policyName:
        complex:
          root: policyNames
      roleName:
        complex:
          accessor: RoleName
          root: AWS.IAM.InstanceProfiles.Roles
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieves the specified inline policy document that is embedded
        with the specified IAM role.
      id: 63fb652e-4520-43c8-8d43-2623e816b1c8
      iscommand: true
      name: Get role policies
      script: '|||aws-iam-get-role-policy'
      type: regular
      version: -1
    taskid: 63fb652e-4520-43c8-8d43-2623e816b1c8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -250,
          "y": 1980
        }
      }
  "45":
    continueonerrortype: ""
    id: "45"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "46"
    note: false
    quietmode: 0
    scriptarguments:
      policyArn:
        complex:
          root: attachedPoliciesARN
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Lists information about the versions of the specified managed policy,
        including the version that is currently set as the policy's default version.
      id: 0d3bb8ba-03e1-4a39-8dae-4878f0c16ae8
      iscommand: true
      name: List policy versions
      script: '|||aws-iam-list-policy-versions'
      type: regular
      version: -1
    taskid: 0d3bb8ba-03e1-4a39-8dae-4878f0c16ae8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 170,
          "y": 1820
        }
      }
  "46":
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Policy Details
      output:
        complex:
          accessor: Version
          root: AWS.IAM.Policies.Versions.Document
          transformers:
          - operator: toUpperCase
    id: "46"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    scriptarguments:
      policyArn:
        complex:
          accessor: PolicyArn
          root: AWS.IAM.Policies.Versions
      versionId:
        complex:
          accessor: VersionId
          root: AWS.IAM.Policies.Versions
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieves information about the specified version of the specified
        managed policy, including the policy document.
      id: cfc564cd-cc7a-4706-88f5-16c70d6ca1a3
      iscommand: true
      name: Get policy version
      script: '|||aws-iam-get-policy-version'
      type: regular
      version: -1
    taskid: cfc564cd-cc7a-4706-88f5-16c70d6ca1a3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 170,
          "y": 1980
        }
      }
  "47":
    continueonerrortype: ""
    id: "47"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "23"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 30ba96a4-3837-4635-8375-8a48796db293
      iscommand: false
      name: Managed Policies
      type: title
      version: -1
    taskid: 30ba96a4-3837-4635-8375-8a48796db293
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 170,
          "y": 1170
        }
      }
  "48":
    continueonerrortype: ""
    id: "48"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 89b9042f-b670-4972-8f0a-c739171e1789
      iscommand: false
      name: Inline Policies
      type: title
      version: -1
    taskid: 89b9042f-b670-4972-8f0a-c739171e1789
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -250,
          "y": 1170
        }
      }
  "49":
    continueonerrortype: ""
    id: "49"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "30"
    note: false
    quietmode: 0
    scriptarguments:
      policyDocument:
        complex:
          accessor: Document
          root: AWS.IAM.Policies.Versions
          transformers:
          - operator: Stringify
      policyName:
        complex:
          root: policyNames
      roleName:
        complex:
          root: inputs.newRoleName
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Adds or updates an inline policy document that is embedded in the
        specified IAM role.
      id: 16340052-4dba-49d8-8078-7d20e460351e
      iscommand: true
      name: Put role policy
      script: '|||aws-iam-put-role-policy'
      type: regular
      version: -1
    taskid: 16340052-4dba-49d8-8078-7d20e460351e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 2840
        }
      }
  "51":
    continueonerrortype: ""
    id: "51"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      min_digits:
        simple: "5"
      min_lcase:
        simple: "5"
      min_symbols:
        simple: "2"
      min_ucase:
        simple: "2"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "This function generates a password and allows various parameters
        to customize the properties of the password depending on the use case (e.g.
        password complexity requirements).  The default behavior is to generate a
        password of  *random length* including all four character classes (upper,
        lower, digits, symbols) with at least five and at most ten characters per
        class. \n\nThe min_* values all default to 0. This means that if the command
        is executed in this way:\n!GeneratePassword max_lcase=10\nIt is possible that
        a password of length zero could be generated. It is therefore recommended
        to always include a min_* parameter that matches. \n\nThe debug parameter
        will print certain properties of the command into the WarRoom for easy diagnostics."
      id: c1b5e014-a3fc-4564-88b8-519a2903a86c
      iscommand: false
      name: Generate a temporary password
      script: GeneratePassword
      type: regular
      version: -1
    taskid: c1b5e014-a3fc-4564-88b8-519a2903a86c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1660,
          "y": 280
        }
      }
  "52":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.identityType
          operator: isEqualString
          right:
            value:
              simple: Compute
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.instanceID
          operator: isNotEmpty
      label: ROLE
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.identityType
          operator: isEqualString
          right:
            value:
              simple: User
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.username
          operator: isNotEmpty
        - left:
            iscontext: true
            value:
              complex:
                root: inputs.accessKeyID
          operator: isNotEmpty
      label: USER
    continueonerrortype: ""
    id: "52"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "36"
      ROLE:
      - "1"
      USER:
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks the identity type that was part of the alert.
      id: 0cb9aa20-b9be-490b-871d-0f42d13d6641
      iscommand: false
      name: Check identity type
      type: condition
      version: -1
    taskid: 0cb9aa20-b9be-490b-871d-0f42d13d6641
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 490,
          "y": -350
        }
      }
  "53":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.roleNameToRestrict
          operator: isEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "53"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "21"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if the user provided a role name to put a deny policy to.
      id: 9b78a8bb-3900-4e8c-8276-a0c02edf0f24
      iscommand: false
      name: Should investigate the compromised instance?
      type: condition
      version: -1
    taskid: 9b78a8bb-3900-4e8c-8276-a0c02edf0f24
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -40,
          "y": -30
        }
      }
  "54":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Policies
                root: AWS.IAM.Roles
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "54"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "42"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if inline policies were found for the role.
      id: efee05cd-487f-4c72-87ef-21356f33de71
      iscommand: false
      name: 'Were role inline-policies retrieved? '
      type: condition
      version: -1
    taskid: efee05cd-487f-4c72-87ef-21356f33de71
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -250,
          "y": 1630
        }
      }
  "55":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: PolicyArn
                root: AWS.IAM.Roles.AttachedPolicies.Policies
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "55"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "41"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if managed policies were found for the role.
      id: 4ac0c6ae-8fee-4c34-8bac-c53528d788ef
      iscommand: false
      name: 'Were role managed policies retrieved? '
      type: condition
      version: -1
    taskid: 4ac0c6ae-8fee-4c34-8bac-c53528d788ef
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 170,
          "y": 1460
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "34_29_Yes": 0.39,
      "34_30_#default#": 0.17,
      "35_16_Deactivate Access Key": 0.58,
      "35_37_#default#": 0.35,
      "35_39_ALL": 0.7,
      "35_51_Reset Password": 0.83,
      "43_25_yes": 0.44,
      "43_36_#default#": 0.26,
      "52_10_USER": 0.49,
      "52_1_ROLE": 0.7,
      "52_36_#default#": 0.1,
      "53_21_yes": 0.46,
      "53_30_#default#": 0.12,
      "54_42_yes": 0.36,
      "54_43_#default#": 0.66,
      "55_41_yes": 0.4,
      "55_43_#default#": 0.5
    },
    "paper": {
      "dimensions": {
        "height": 3975,
        "width": 2980,
        "x": -560,
        "y": -490
      }
    }
  }
