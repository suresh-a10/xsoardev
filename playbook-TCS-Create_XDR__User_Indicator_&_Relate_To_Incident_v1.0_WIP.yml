contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
id: c8dfae61-8ae1-4889-8bcc-6152cc6eccc6
inputs:
- description: ""
  key: emp
  playbookInputQuery: null
  required: false
  value: {}
name: TCS-Create XDR  User Indicator & Relate To Incident v1.0_WIP
outputs: []
sourceplaybookid: a8f14eae-50f0-476d-84bb-1c0d7fb01027
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f0f41f0d-4fd6-4dbc-8f8e-98e80eea6dde
      iscommand: false
      name: ""
      version: -1
    taskid: f0f41f0d-4fd6-4dbc-8f8e-98e80eea6dde
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": -10,
          "y": 30
        }
      }
  "3":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: indicator
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "4"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8eadfcd8-cc53-4a08-83b4-49fc11d377c1
      iscommand: false
      name: Is Indicator Context Set ?
      type: condition
      version: -1
    taskid: 8eadfcd8-cc53-4a08-83b4-49fc11d377c1
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 190
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: indicator
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: be08e176-1be1-47d4-89b0-43a0c2ae764d
      iscommand: false
      name: Delete 'Indicator' Context
      script: DeleteContext
      type: regular
      version: -1
    taskid: be08e176-1be1-47d4-89b0-43a0c2ae764d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 400
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      extend-context:
        simple: indicator.value=value::indicator.tag=CustomFields.tags
      using:
        simple: InnerServicesModule
      value:
        complex:
          root: inputs.emp
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.find.indicators
      id: 37153de6-9744-4125-8826-93c32a9fcffe
      iscommand: true
      name: Check If Indicator Exists
      script: Builtin|||findIndicators
      type: regular
      version: -1
    taskid: 37153de6-9744-4125-8826-93c32a9fcffe
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 600
        }
      }
  "6":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: value
                root: indicator
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "8"
      "yes":
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 3258dc84-81de-4723-81f1-4bbfb5fa8353
      iscommand: false
      name: Found Indicator ?
      type: condition
      version: -1
    taskid: 3258dc84-81de-4723-81f1-4bbfb5fa8353
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 800
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      incidentId:
        complex:
          accessor: id
          root: incident
      value:
        simple: ${inputs.emp}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.associate.indicator
      id: 3872fbe1-e158-4b66-8f91-664019bde930
      iscommand: true
      name: Link Indicator To Current Incident
      script: Builtin|||associateIndicatorToIncident
      type: regular
      version: -1
    taskid: 3872fbe1-e158-4b66-8f91-664019bde930
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1000
        }
      }
  "8":
    continueonerror: true
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      relateToIncident:
        simple: "true"
      tags:
        simple: ${incident.id}
      type:
        simple: TCS Employee Id
      value:
        complex:
          accessor: crowdstrikeusername
          root: incident
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.new.indicator
      id: 6df78c31-a140-44d7-8326-8700ffada56a
      iscommand: true
      name: Create username Indicator and link to incident
      script: Builtin|||createNewIndicator
      type: regular
      version: -1
    taskid: 6df78c31-a140-44d7-8326-8700ffada56a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 220,
          "y": 1160
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: ${incident.id}
      indicatorsValues:
        simple: ${inputs.emp}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.add.values.to.indicator.multi.select.field
      id: 51599272-f62e-4188-8f33-533e1bb4c52c
      iscommand: true
      name: Append The Indicator Tag With Incident ID
      script: Builtin|||appendIndicatorField
      type: regular
      version: -1
    taskid: 51599272-f62e-4188-8f33-533e1bb4c52c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1160
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 71d3f41f-8125-4186-8a06-76ba3c36b270
      iscommand: false
      name: Check If User Has Multiple Alerts
      type: title
      version: -1
    taskid: 71d3f41f-8125-4186-8a06-76ba3c36b270
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1380
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      indicator:
        simple: ${inputs.emp}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Lookup incidents with specified indicator. Use currentIncidentId to omit the existing incident from output.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      id: bb399450-0d3d-4bfc-83f9-5525c32ee861
      iscommand: false
      name: Find Incidents With Reported Username
      script: findIncidentsWithIndicator
      type: regular
      version: -1
    taskid: bb399450-0d3d-4bfc-83f9-5525c32ee861
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1510
        }
      }
  "12":
    continueonerror: true
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    scriptarguments:
      array:
        complex:
          accessor: incidentIDs
          root: IncidentsWithIndicator
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Count an array size
      id: 14973d5b-185b-4704-82b4-86da3652f8f4
      iscommand: false
      name: Count The Number of Incidents
      script: CountArraySize
      type: regular
      version: -1
    taskid: 14973d5b-185b-4704-82b4-86da3652f8f4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1840
        }
      }
  "13":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: ArraySize
          operator: lessThan
          right:
            value:
              simple: "2"
      label: "yes"
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 463942ec-6a6d-4747-81c1-69fc65757870
      iscommand: false
      name: Is There Only One Incident?
      type: condition
      version: -1
    taskid: 463942ec-6a6d-4747-81c1-69fc65757870
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 2010
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      generalnotification:
        simple: '<h2 style="text-align: center;"><em><span style="color: #008000;">This
          is The User''s First Incident<br/></span><span style="color: #808080;"><strong>Check
          &#39;Related Incidents&#39; In IoC Intel Report Section</strong></span></em></h2>'
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 9f6bbfa4-3294-4fb9-82ba-354a278445e4
      iscommand: true
      name: Set Notification - This is the users first incident
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 9f6bbfa4-3294-4fb9-82ba-354a278445e4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 2240
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      generalnotification:
        simple: '<h2 style="text-align: center;"><em><span style="color: #008000;">This
          User is Linked To Multiple Incidents<br/></span><span style="color: #808080;"><strong>Check
          &#39;Related Incidents&#39; In IoC Intel Report Section</strong></span></em></h2>'
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 48a6bcaa-97f8-412b-8048-30fed674c0a8
      iscommand: true
      name: Set Notification - This is the users first incident
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 48a6bcaa-97f8-412b-8048-30fed674c0a8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 410,
          "y": 2240
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fb3064f7-033d-4d20-88c4-ef451d7882b4
      iscommand: false
      name: The End
      type: title
      version: -1
    taskid: fb3064f7-033d-4d20-88c4-ef451d7882b4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -10,
          "y": 2470
        }
      }
  "17":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: incidentIDs
                root: IncidentsWithIndicator
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ea2d9669-617f-4d6c-8768-07e275bdcdab
      iscommand: false
      name: Check if Context is Defined
      type: condition
      version: -1
    taskid: ea2d9669-617f-4d6c-8768-07e275bdcdab
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1670
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "6_7_yes": 0.49,
      "6_8_#default#": 0.47
    },
    "paper": {
      "dimensions": {
        "height": 2505,
        "width": 1020,
        "x": -230,
        "y": 30
      }
    }
  }
