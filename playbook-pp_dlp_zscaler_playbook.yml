contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
id: ee1185fc-25a5-4048-861b-499bbdc3b4c6
inputs: []
name: pp_dlp_zscaler_playbook
outputs: []
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cba018cd-4518-44a3-8c08-a500738c8cf4
      iscommand: false
      name: ""
      version: -1
    taskid: cba018cd-4518-44a3-8c08-a500738c8cf4
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 480,
          "y": 65
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      earliest_time:
        simple: -24h
      execution-timeout:
        simple: "900"
      query:
        simple: "index=corp_security_zscaler sourcetype=zscaler_web NOT action=\"Allowed\"
          NOT dlpengine=\"None\" AND dlpengine=\"DLP*\" \n| stats count(dlpidentifier)
          as Total_Events by dlpengine \n| search dlpengine IN (\"DLP Auth Answers
          Engine\",\"DLP Auth Passwords Engine\",\"DLP Company Confidential Documents
          Engine\",\"DLP Compliance Blacklist Engine\",\"DLP PPC Engine\",\"DLP Passport
          Engine\",\"DLP US Drivers License Engine\",\"DLP US SSN Engine\", \"DLP
          PCI DSS Engine\", \"DLP US Tax ID Engine\", \"DLP CCN Engine\", \"DLP Swift
          Codes Engine\", \"DLP Regex for Hostnames Engine\", \"DLP Regex for Passwords
          Engine\") \n| sort -Total_Events \n| eval result=dlpengine+\": \"+Total_Events
          \n| table result \n| stats values(result) as result"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b2bd029d-82d4-40c3-8585-d4f3fc431f04
      iscommand: false
      name: Splunk query for zscaler policy engine
      script: pp_splunk_search_v2
      type: regular
      version: -1
    taskid: b2bd029d-82d4-40c3-8585-d4f3fc431f04
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1390
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      channel:
        simple: ${slack_channel_name}
      message:
        simple: |-
          Monitoring Alert for Block Policies with ZIR turned on:

          ${slack_message}
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Sends a message to a user, group, or channel.
      id: 553cedde-9492-40c2-8959-a923a45d73e4
      iscommand: true
      name: Send splunk results to slack
      script: SlackV2|||send-notification
      type: regular
      version: -1
    taskid: 553cedde-9492-40c2-8959-a923a45d73e4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1915
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      resolution:
        simple: Auto-closed
      resolutionsummary:
        simple: Auto-closed
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 24dd109c-89ab-49c7-8e0b-42157e99668f
      iscommand: false
      name: Close investigation
      script: pp_CloseInvestigation_v2
      type: regular
      version: -1
    taskid: 24dd109c-89ab-49c7-8e0b-42157e99668f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 2440
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: 93ead8f3-198d-400c-8feb-9c0438dae106
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: 93ead8f3-198d-400c-8feb-9c0438dae106
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2090
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: 0412f1a8-a58d-4549-87ce-490f42c6c72f
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: 0412f1a8-a58d-4549-87ce-490f42c6c72f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 400
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      earliest_time:
        simple: -24h
      execution-timeout:
        simple: "900"
      query:
        simple: "index=corp_security_zscaler sourcetype=zscaler_web NOT action=\"Allowed\"NOT
          dlpengine=\"None\"AND dlpengine IN (\"DLP Auth Answers Engine\",\"DLP Auth
          Passwords Engine\",\"DLP Company Confidential Documents Engine\",\"DLP Compliance
          Blacklist Engine\",\"DLP PPC Engine\",\"DLP Passport Engine\",\"DLP US Drivers
          License Engine\",\"DLP US Drivers License Engine\",\"DLP US SSN Engine\",
          \"DLP PCI DSS Engine\", \"DLP US Tax ID Engine\", \"DLP CCN Engine\", \"DLP
          Swift Codes Engine\", \"DLP Regex for Hostnames Engine\", \"DLP Regex for
          Passwords Engine\") \n| stats count(dlpidentifier) as Total_Events | head
          1"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 3cd56d0d-fdd8-4934-8f61-8a1d70fdd503
      iscommand: false
      name: Splunk query for zscaler policy engine (total volume)
      script: pp_splunk_search_v2
      type: regular
      version: -1
    taskid: 3cd56d0d-fdd8-4934-8f61-8a1d70fdd503
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 720
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      channel:
        simple: ${slack_channel_name}
      message:
        simple: |-
          -------------------------------------------------------------------------------------

          Total Volume of Blocked Events in Last 24 Hour: ${Splunk.Result.[0].Total_Events}

          -------------------------------------------------------------------------------------
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Sends a message to a user, group, or channel.
      id: 3f457fd4-a3e1-473c-8ffd-691416559448
      iscommand: true
      name: Send splunk results to slack
      script: SlackV2|||send-notification
      type: regular
      version: -1
    taskid: 3f457fd4-a3e1-473c-8ffd-691416559448
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 895
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: slack_message
      stringify:
        simple: "true"
      value:
        simple: ${Splunk.Result.result}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 949940b6-b831-43b4-83eb-7a631cfbe4f6
      iscommand: false
      name: Move splunk results to slack_message context data
      script: Set
      type: regular
      version: -1
    taskid: 949940b6-b831-43b4-83eb-7a631cfbe4f6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1565
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: slack_message
      value:
        complex:
          root: ${slack_message}
          transformers:
          - args:
              regex:
                value:
                  simple: \["
              replaceWith: {}
            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '","'
              replaceWith:
                value:
                  simple: |2+

            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '"\]'
              replaceWith: {}
            operator: replaceMatch
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 3662ca05-ef15-4a52-8aa9-508b39f8cf53
      iscommand: false
      name: Replace characters in slack_message
      script: Set
      type: regular
      version: -1
    taskid: 3662ca05-ef15-4a52-8aa9-508b39f8cf53
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1740
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: slack_channel_name
      value:
        simple: dlp_alerts_monitoring
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 30508e6d-3a7a-42a2-8d60-95441f0033d7
      iscommand: false
      name: Set slack channel name
      script: Set
      type: regular
      version: -1
    taskid: 30508e6d-3a7a-42a2-8d60-95441f0033d7
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 225
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "18"
    note: false
    quietmode: 0
    scriptarguments:
      earliest_time:
        simple: -24h
      execution-timeout:
        simple: "900"
      query:
        simple: "index=corp_security_zscaler appname=\"OneDrive (Personal)\" NOT dlpengine=\"None\"
          dlpengine=\"DLP*\" \n| stats count(dlpidentifier) as Total_Events by action
          \n| eval result=action+\": \"+Total_Events \n| stats values(result) as result"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 669c6013-b433-4d78-83a3-940673b375e4
      iscommand: false
      name: Splunk query for zscaler policy engine (total volume)
      script: pp_splunk_search_v2
      type: regular
      version: -1
    taskid: 669c6013-b433-4d78-83a3-940673b375e4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1565
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b574ce1a-299b-4ce9-817b-eb422279a615
      iscommand: false
      name: Zscaler DLP policies total volume
      type: title
      version: -1
    taskid: b574ce1a-299b-4ce9-817b-eb422279a615
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 575
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 66a85047-a5ae-4f27-8ed1-810b70782dd0
      iscommand: false
      name: Zscaler volume by DLP policy
      type: title
      version: -1
    taskid: 66a85047-a5ae-4f27-8ed1-810b70782dd0
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1245
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: d170e447-a8cb-44f2-8d58-b392000a8d50
      iscommand: false
      name: OneDrive Personal traffic volume
      type: title
      version: -1
    taskid: d170e447-a8cb-44f2-8d58-b392000a8d50
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1405
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: 578b6cdd-57af-4b77-89f0-87de44ca79de
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: 578b6cdd-57af-4b77-89f0-87de44ca79de
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1070
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: 7d6dca86-dd62-46cb-81ed-a884a770a43c
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: 7d6dca86-dd62-46cb-81ed-a884a770a43c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 2265
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: slack_message
      stringify:
        simple: "true"
      value:
        simple: ${Splunk.Result.result}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 0f68ebb9-e142-431a-8c71-76ff6bf45e5b
      iscommand: false
      name: Move splunk results to slack_message context data
      script: Set
      type: regular
      version: -1
    taskid: 0f68ebb9-e142-431a-8c71-76ff6bf45e5b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1740
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      name:
        simple: test_20211202_1
      type:
        simple: private
      users:
        simple: CDC Bot, lihlim
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Creates a channel in Slack.
      id: 0435bade-0886-4591-893c-0cb5f2e98df6
      iscommand: true
      name: Create channel
      script: SlackV2|||slack-create-channel
      type: regular
      version: -1
    taskid: 0435bade-0886-4591-893c-0cb5f2e98df6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 910,
          "y": 50
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      channel:
        simple: ${slack_channel_name}
      message:
        simple: |-
          ===OneDrive Personal traffic volume===
          ${slack_message}
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Sends a message to a user, group, or channel.
      id: 63ca6a61-84c3-49f8-8b72-d7ad04e14eda
      iscommand: true
      name: Send splunk results to slack
      script: SlackV2|||send-notification
      type: regular
      version: -1
    taskid: 63ca6a61-84c3-49f8-8b72-d7ad04e14eda
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2090
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: slack_message
      value:
        complex:
          root: ${slack_message}
          transformers:
          - args:
              regex:
                value:
                  simple: \["
              replaceWith: {}
            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '","'
              replaceWith:
                value:
                  simple: |2+

            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '"\]'
              replaceWith: {}
            operator: replaceMatch
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 2be2df5f-668d-4d48-8363-1c13b527a39a
      iscommand: false
      name: Replace characters in slack_message
      script: Set
      type: regular
      version: -1
    taskid: 2be2df5f-668d-4d48-8363-1c13b527a39a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1915
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2485,
        "width": 1240,
        "x": 50,
        "y": 50
      }
    }
  }
