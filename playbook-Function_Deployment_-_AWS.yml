contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.10.0
    itemVersion: 1.1.20
    packID: AWS-Enrichment-Remediation
    packName: AWS Enrichment and Remediation
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: |-
  This playbook automates the deployment of an AWS Lambda function to manage resources within an Amazon EKS cluster. It ensures that all necessary configurations are created, updated, and verified.

  ### Setup

  - **Describe EKS Cluster**: Gather essential details of the EKS cluster.
  - **Create IAM Role**: Set up a new IAM role for the Lambda function.
  - **Create and Attach Policy**: Define and attach a policy to the IAM role to grant necessary permissions.

  ### Authentication Mode Check

  - **Verify Authentication Mode**: Ensure the current authentication mode allows API access.
    - **If not**: Update the cluster authentication mode to permit API access.

  ### Access Entry Configuration

  - **Create Access Entry**: Establish a new access entry in the EKS cluster.
  - **Associate Access Policy**: Link the access policy with the created access entry.
  - **Update Access Entry**: Apply the latest configurations to the access entry.

  ### VPC and Security Group Setup

  - **Describe VPCs**: Identify the appropriate VPC for the Lambda function.
  - **Create Security Group**: Define a security group to manage Lambda function traffic.
  - **Set Ingress Rules**: Configure ingress rules for the security group.

  ### VPC Endpoint Creation

  - **Create VPC Endpoint for eks-auth**: Establish a VPC endpoint for EKS authentication.
  - **Check for Errors**: Verify if there are any errors during the creation of the VPC endpoint.
    - **If errors**: Handle and log them.
  - **Verify VPC Endpoint Existence**: Ensure the VPC endpoint already exists.
    - **If exists**: Proceed with the next steps.

  ### Lambda Function Deployment

  - **Download Kubernetes Library**: Fetch the necessary Kubernetes library.
  - **Publish AWS Lambda Layer**: Publish a new layer version for the AWS Lambda function.
  - **Create Lambda Code**: Develop the Lambda function code.
  - **Zip Lambda Code**: Compress the Lambda function code for deployment.
  - **Create AWS Lambda Function**: Deploy the Lambda function using the zipped code.

  ### Resolution

  - **Final Verification**: Ensure all operations have been successfully completed.
  - **Completion**: Confirm the deployment process is finished, ensuring robust management of EKS authentication through AWS Lambda.

  This playbook provides a comprehensive, automated approach to deploying an AWS Lambda function for managing resources within an EKS cluster, efficiently handling all configurations and potential errors.

  ### Required Integration

  #### AWS IAM (Identity and Access Management)
  - [AWS IAM API Documentation](https://docs.aws.amazon.com/IAM/latest/APIReference/Welcome.html)
  - [Cortex XSOAR AWS IAM Integration](https://cortex.marketplace.pan.dev/marketplace/details/AWSIAM/)

  #### AWS EC2 (Elastic Compute Cloud)
  - [AWS EC2 API Documentation](https://docs.aws.amazon.com/AWSEC2/latest/APIReference/Welcome.html)
  - [Cortex XSOAR AWS EC2 Integration](https://cortex.marketplace.pan.dev/marketplace/details/AWSEC2/)

  #### AWS EKS (Elastic Kubernetes Service)
  - [AWS EKS API Documentation](https://docs.aws.amazon.com/eks/latest/APIReference/Welcome.html)
  - [Cortex XSOAR AWS EKS Integration](https://cortex.marketplace.pan.dev/marketplace/details/AWSEKS/)

  #### AWS Lambda
  - [AWS Lambda API Documentation](https://docs.aws.amazon.com/lambda/latest/dg/API_Reference.html)
  - [Cortex XSOAR AWS Lambda Integration](https://cortex.marketplace.pan.dev/marketplace/details/AWSLambda/).
id: Function Deployment - AWS
inputs:
- description: The name of the cluster.
  key: ClusterName
  playbookInputQuery: null
  required: false
  value: {}
- description: The region of the cluster.
  key: region
  playbookInputQuery: null
  required: false
  value: {}
- description: The name of the Lambda function.
  key: FunctionName
  playbookInputQuery: null
  required: false
  value: {}
- description: Entry ID of the uploaded base64-encoded contents of the deployment
    package. Amazon Web Services SDK and CLI clients handle the encoding for you.
  key: FunctionCode
  playbookInputQuery: null
  required: false
  value: {}
- description: "The runtime environment for the function.\t"
  key: FunctionRuntime
  playbookInputQuery: null
  required: false
  value: {}
- description: "The name of the method within your code that Lambda calls to execute
    your function.\t"
  key: FunctionHandler
  playbookInputQuery: null
  required: false
  value: {}
- description: The name to assign to the new Lambda layer.
  key: LayerName
  playbookInputQuery: null
  required: false
  value: {}
- description: "The name of the method within your code that Lambda calls to execute
    your function.\t"
  key: LayerRuntime
  playbookInputQuery: null
  required: false
  value: {}
- description: "A list of compatible architectures.\t"
  key: LayerArchitecture
  playbookInputQuery: null
  required: false
  value: {}
- description: "The Python library to download and attach to the Lambda Function.
    \ne.g.\nTo be able to use the kubernetes library, use 'kubernetes' and the script
    will download and pack its files."
  key: LibraryName
  playbookInputQuery: null
  required: false
  value: {}
- description: The lambda role name to create.
  key: LambdaRoleName
  playbookInputQuery: null
  required: false
  value: {}
- description: The lambda policy name to create.
  key: LambdaPolicyName
  playbookInputQuery: null
  required: false
  value: {}
- description: The security group name to create.
  key: SecurityGroupName
  playbookInputQuery: null
  required: false
  value: {}
name: Function Deployment - AWS
outputs:
- contextPath: AWS.EKS.DescribeCluster.name
  description: The name of your cluster.
- contextPath: AWS.EKS.DescribeCluster.arn
  description: The Amazon Resource Name (ARN) of the cluster.
- contextPath: AWS.EKS.DescribeCluster.createdAt
  description: The creation date of the object.
- contextPath: AWS.EKS.DescribeCluster.version
  description: The Kubernetes server version for the cluster.
- contextPath: AWS.EKS.DescribeCluster.endpoint
  description: The endpoint for your Kubernetes API server.
- contextPath: AWS.EKS.DescribeCluster.roleArn
  description: The Amazon Resource Name (ARN) of the IAM role that provides permissions
    for the Kubernetes control plane to make calls to Amazon Web Services API operations
    on your behalf.
- contextPath: AWS.EKS.DescribeCluster.identity
  description: The identity provider information for the cluster.
- contextPath: AWS.EKS.DescribeCluster.status
  description: The current status of the cluster.
- contextPath: AWS.EKS.DescribeCluster.clientRequestToken
  description: A unique, case-sensitive identifier that you provide to ensure the
    idempotency of the request.
- contextPath: AWS.EKS.DescribeCluster.platformVersion
  description: The platform version of your Amazon EKS cluster.
- contextPath: AWS.EKS.DescribeCluster.tags
  description: A dictionary containing metadata for categorization and organization.
- contextPath: AWS.EKS.DescribeCluster.id
  description: The ID of your local Amazon EKS cluster on an Amazon Web Services Outpost.
- contextPath: AWS.EKS.DescribeCluster.resourcesVpcConfig.subnetIds
  description: The subnets associated with your cluster.
- contextPath: AWS.EKS.DescribeCluster.resourcesVpcConfig.securityGroupIds
  description: The security groups associated with the cross-account elastic network
    interfaces that are used to allow communication between your nodes and the Kubernetes
    control plane.
- contextPath: AWS.EKS.DescribeCluster.resourcesVpcConfig.clusterSecurityGroupId
  description: The cluster security group that was created by Amazon EKS for the cluster.
    Managed node groups use this security group for control-plane-to-data-plane communication.
- contextPath: AWS.EKS.DescribeCluster.resourcesVpcConfig.vpcId
  description: The VPC associated with your cluster.
- contextPath: AWS.EKS.DescribeCluster.resourcesVpcConfig.endpointPublicAccess
  description: Whether the public API server endpoint is enabled.
- contextPath: AWS.EKS.DescribeCluster.resourcesVpcConfig.endpointPrivateAccess
  description: This parameter indicates whether the Amazon EKS private API server
    endpoint is enabled.
- contextPath: AWS.EKS.DescribeCluster.resourcesVpcConfig.publicAccessCidrs
  description: The CIDR blocks that are allowed access to your clusterâ€™s public Kubernetes
    API server endpoint.
- contextPath: AWS.EKS.DescribeCluster.kubernetesNetworkConfig.serviceIpv4Cidr
  description: The CIDR block that Kubernetes Pod and Service object IP addresses
    are assigned from.
- contextPath: AWS.EKS.DescribeCluster.kubernetesNetworkConfig.serviceIpv6Cidr
  description: The CIDR block that Kubernetes Pod and Service IP addresses are assigned
    from if you created a 1.21 or later cluster with version 1.10.1 or later of the
    Amazon VPC CNI add-on and specified ipv6 for ipFamily when you created the cluster.
- contextPath: AWS.EKS.DescribeCluster.kubernetesNetworkConfig.ipFamily
  description: The IP family used to assign Kubernetes Pod and Service objects IP
    addresses.
- contextPath: AWS.EKS.DescribeCluster.logging.clusterLogging
  description: The cluster control plane logging configuration for your cluster.
- contextPath: AWS.EKS.DescribeCluster.certificateAuthority.data
  description: The Base64-encoded certificate data required to communicate with your
    cluster.
- contextPath: AWS.EKS.DescribeCluster.encryptionConfig.resources
  description: Specifies the resources to be encrypted. The only supported value is
    secrets.
- contextPath: AWS.EKS.DescribeCluster.encryptionConfig.provider
  description: Key Management Service (KMS) key.
- contextPath: AWS.EKS.DescribeCluster.connectorConfig.activationId
  description: A unique ID associated with the cluster for registration purposes.
- contextPath: AWS.EKS.DescribeCluster.connectorConfig.activationCode
  description: A unique code associated with the cluster for registration purposes.
- contextPath: AWS.EKS.DescribeCluster.connectorConfig.activationExpiry
  description: The expiration time of the connected cluster.
- contextPath: AWS.EKS.DescribeCluster.connectorConfig.provider
  description: The clusterâ€™s cloud service provider.
- contextPath: AWS.EKS.DescribeCluster.connectorConfig.roleArn
  description: The Amazon Resource Name (ARN) of the role to communicate with services
    from the connected Kubernetes cluster.
- contextPath: AWS.EKS.DescribeCluster.health.issues
  description: An object representing the health issues of your local Amazon EKS cluster
    on an Amazon Web Services Outpost.
- contextPath: AWS.EKS.DescribeCluster.outpostConfig.outpostArns
  description: An object representing the configuration of your local Amazon EKS cluster
    on an Amazon Web Services Outpost.
- contextPath: AWS.EKS.DescribeCluster.outpostConfig.controlPlaneInstanceType
  description: The Amazon EC2 instance type used for the control plane.
- contextPath: AWS.EKS.DescribeCluster.outpostConfig.controlPlanePlacement
  description: An object representing the placement configuration for all the control
    plane instances of your local Amazon EKS cluster on an Amazon Web Services Outpost.
- contextPath: AWS.EKS.DescribeCluster.accessConfig.bootstrapClusterCreatorAdminPermissions
  description: Specifies whether or not the cluster creator IAM principal was set
    as a cluster admin access entry during cluster creation time.
- contextPath: AWS.EKS.DescribeCluster.accessConfig.authenticationMode
  description: The current authentication mode of the cluster.
- contextPath: AWS.IAM.Roles.RoleName
  description: The friendly name that identifies the role.
- contextPath: AWS.IAM.Roles.RoleId
  description: The stable and unique string identifying the role.
- contextPath: AWS.IAM.Roles.Arn
  description: The Amazon Resource Name (ARN) specifying the role.
- contextPath: AWS.IAM.Roles.CreateDate
  description: The date and time, when the role was created.
- contextPath: AWS.IAM.Roles.Path
  description: The path to the role.
- contextPath: AWS.IAM.Roles.AssumeRolePolicyDocument
  description: he policy that grants an entity permission to assume the role.
- contextPath: AWS.IAM.Roles.Description
  description: A description of the role that you provide.
- contextPath: AWS.IAM.Roles.MaxSessionDuration
  description: The maximum session duration (in seconds) for the specified role.
- contextPath: AWS.IAM.Policies.PolicyName
  description: The friendly name (not ARN) identifying the policy.
- contextPath: AWS.IAM.Policies.PolicyId
  description: The stable and unique string identifying the policy.
- contextPath: AWS.IAM.Policies.Arn
  description: The Amazon Resource Name (ARN). ARNs are unique identifiers for AWS
    resources.
- contextPath: AWS.IAM.Policies.Path
  description: The path to the policy.
- contextPath: AWS.IAM.Policies.DefaultVersionId
  description: The identifier for the version of the policy that is set as the default
    version.
- contextPath: AWS.IAM.Policies.Description
  description: A friendly description of the policy.
- contextPath: AWS.IAM.Policies.CreateDate
  description: The date and time, in ISO 8601 date-time format , when the policy was
    created.
- contextPath: AWS.IAM.Policies.UpdateDate
  description: The date and time, in ISO 8601 date-time format , when the policy was
    last updated.
- contextPath: AWS.EKS.CreateAccessEntry.clusterName
  description: The name of the cluster.
- contextPath: AWS.EKS.CreateAccessEntry.principalArn
  description: The ARN of the IAM principal for the access entry.
- contextPath: AWS.EKS.CreateAccessEntry.kubernetesGroups
  description: A list of names that youâ€™ve specified in a Kubernetes RoleBinding or
    ClusterRoleBinding object so that Kubernetes authorizes the principalARN access
    to cluster objects.
- contextPath: AWS.EKS.CreateAccessEntry.accessEntryArn
  description: The ARN of the access entry.
- contextPath: AWS.EKS.CreateAccessEntry.createdAt
  description: The creation date of the object.
- contextPath: AWS.EKS.CreateAccessEntry.modifiedAt
  description: The date and time for the last modification to the object.
- contextPath: AWS.EKS.CreateAccessEntry.tags
  description: A dictionary containing metadata for categorization and organization.
- contextPath: AWS.EKS.CreateAccessEntry.username
  description: The name of a user that can authenticate to the cluster.
- contextPath: AWS.EKS.CreateAccessEntry.type
  description: The type of the access entry.
- contextPath: AWS.EKS.AssociatedAccessPolicy.clusterName
  description: The name of your cluster.
- contextPath: AWS.EKS.AssociatedAccessPolicy.principalArn
  description: The ARN of the IAM principal for the AccessEntry.
- contextPath: AWS.EKS.AssociatedAccessPolicy.policyArn
  description: The ARN of the AccessPolicy.
- contextPath: AWS.EKS.AssociatedAccessPolicy.associatedAt
  description: The date and time the AccessPolicy was associated with an AccessEntry.
- contextPath: AWS.EKS.AssociatedAccessPolicy.modifiedAt
  description: The date and time for the last modification to the object.
- contextPath: AWS.EKS.AssociatedAccessPolicy.accessScope.type
  description: The scope type of an access policy.
- contextPath: AWS.EKS.AssociatedAccessPolicy.accessScope.namespaces
  description: A Kubernetes namespace that an access policy is scoped to.
- contextPath: AWS.EKS.UpdateAccessEntry.clusterName
  description: The name of your cluster.
- contextPath: AWS.EKS.UpdateAccessEntry.principalArn
  description: The ARN of the IAM principal for the access entry.
- contextPath: AWS.EKS.UpdateAccessEntry.kubernetesGroups
  description: A list of names that youâ€™ve specified in a Kubernetes RoleBinding or
    ClusterRoleBinding object so that Kubernetes authorizes the principalARN access
    to cluster objects.
- contextPath: AWS.EKS.UpdateAccessEntry.accessEntryArn
  description: The ARN of the access entry.
- contextPath: AWS.EKS.UpdateAccessEntry.createdAt
  description: The creation date of the object.
- contextPath: AWS.EKS.UpdateAccessEntry.modifiedAt
  description: The date and time for the last modification to the object.
- contextPath: AWS.EKS.UpdateAccessEntry.tags
  description: Metadata that assists with categorization and organization. Each tag
    consists of a key and an optional value.
- contextPath: AWS.EKS.UpdateAccessEntry.username
  description: The name of a user that can authenticate to your cluster.
- contextPath: AWS.EKS.UpdateAccessEntry.type
  description: The type of the access entry.
- contextPath: AWS.Lambda.Layers.LayerVersionArn
  description: The ARN of the layer version.
- contextPath: AWS.Lambda.Layers.LayerArn
  description: The ARN of the layer.
- contextPath: AWS.Lambda.Layers.Description
  description: The description of the version.
- contextPath: AWS.Lambda.Layers.CreatedDate
  description: The date that the layer version was created, in ISO-8601 format (YYYY-MM-DDThh:mm:ss.sTZD).
- contextPath: AWS.Lambda.Layers.Version
  description: The version number.
- contextPath: AWS.Lambda.Layers.CompatibleRuntimes
  description: The layerâ€™s compatible runtimes.
- contextPath: AWS.Lambda.Layers.CompatibleArchitectures
  description: The layerâ€™s compatible architectures.
  type: unknown
- contextPath: AWS.Lambda.Functions.FunctionName
  description: The name of the function.
- contextPath: AWS.Lambda.Functions.FunctionArn
  description: The functionâ€™s Amazon Resource Name (ARN).
- contextPath: AWS.Lambda.Functions.Runtime
  description: The identifier of the functionâ€™s runtime. Runtime is required if the
    deployment package is a .zip file archive.
- contextPath: AWS.Lambda.Functions.Role
  description: The functionâ€™s execution role.
- contextPath: AWS.Lambda.Functions.Handler
  description: The function that Lambda calls to begin running your function.
- contextPath: AWS.Lambda.Functions.Description
  description: The functionâ€™s description.
- contextPath: AWS.Lambda.Functions.PackageType
  description: The type of deployment package. Set to Image for container image and
    set Zip for .zip file archive.
- contextPath: AWS.Lambda.Functions.LastModified
  description: The date and time that the function was last updated, in ISO-8601 format
    (YYYY-MM-DDThh:mm:ss.sTZD).
- contextPath: AWS.Lambda.Functions.Timeout
  description: The amount of time in seconds that Lambda allows a function to run
    before stopping it.
- contextPath: AWS.Lambda.Functions.VpcConfig.SubnetIds
  description: A list of VPC subnet IDs.
- contextPath: AWS.Lambda.Functions.VpcConfig.SecurityGroupIds
  description: A list of VPC security group IDs.
- contextPath: AWS.Lambda.Functions.VpcConfig.VpcId
  description: The ID of the VPC.
- contextPath: AWS.Lambda.Functions.VpcConfig.Ipv6AllowedForDualStack
  description: Allows outbound IPv6 traffic on VPC functions that are connected to
    dual-stack subnets.
- contextPath: AWS.EKS.UpdateCluster.clusterName
  description: The name of the cluster.
- contextPath: AWS.EKS.UpdateCluster.id
  description: The ID of the update.
- contextPath: AWS.EKS.UpdateCluster.status
  description: The status of the update.
- contextPath: AWS.EKS.UpdateCluster.type
  description: The type of the update.
- contextPath: AWS.EKS.UpdateCluster.params
  description: The parameters of the update.
- contextPath: AWS.EKS.UpdateCluster.createdAt
  description: The creation date of the object.
- contextPath: File.Name
  description: The name of the file.
  type: String
- contextPath: File.EntryID
  description: The entry ID of the file.
  type: String
- contextPath: File.Type
  description: The file type.
  type: String
- contextPath: File.Extension
  description: The file extension.
  type: String
- contextPath: File.SHA256
  description: The SHA256 hash of the file.
  type: String
- contextPath: ZipFile.ZippedFile
  description: The zipped file.
  type: string
- contextPath: AWS.EC2.Vpcs.VpcEndpoint.VpcEndpointId
  description: The ID of the endpoint.
- contextPath: AWS.EC2.Vpcs.VpcEndpoint.State
  description: The state of the VPC endpoint.
- contextPath: AWS.EC2.Vpcs.VpcEndpoint.ServiceName
  description: The service name of the VPC endpoint.
- contextPath: AWS.EC2.Vpcs.VpcEndpoint.VpcId
  description: The ID of the VPC to which the endpoint is associated.
- contextPath: AWS.EC2.Vpcs.VpcEndpoint.EndpointType
  description: The type of the VPC endpoint.
- contextPath: AWS.EC2.Vpcs.VpcId
  description: The ID of the VPC.
- contextPath: AWS.EC2.Vpcs.AccountId
  description: The ID of the AWS account with which the EC2 instance is associated.
    This key is only present when the parameter "AWS organization accounts" is provided.
- contextPath: AWS.EC2.Vpcs.State
  description: The current state of the VPC.
- contextPath: AWS.EC2.Vpcs.CidrBlock
  description: The primary IPv4 CIDR block for the VPC.
- contextPath: AWS.EC2.Vpcs.Tags.Key
  description: The key of the tag.
- contextPath: AWS.EC2.Vpcs.Tags.Value
  description: The value of the tag.
- contextPath: AWS.EC2.Vpcs.Tags.Ipv6CidrBlockAssociationSet.AssociationId
  description: The association ID for the IPv6 CIDR block.
- contextPath: AWS.EC2.Vpcs.Tags.Ipv6CidrBlockAssociationSet.Ipv6CidrBlock
  description: The IPv6 CIDR block.
- contextPath: AWS.EC2.Vpcs.Tags.Ipv6CidrBlockAssociationSet.Ipv6CidrBlockState.State
  description: The state of the CIDR block.
- contextPath: AWS.EC2.Vpcs.Tags.Ipv6CidrBlockAssociationSet.Ipv6CidrBlockState.StatusMessage
  description: A message about the status of the CIDR block, if applicable.
- contextPath: AWS.EC2.Vpcs.Tags.CidrBlockAssociationSet.AssociationId
  description: The association ID for the IPv4 CIDR block.
- contextPath: AWS.EC2.Vpcs.Tags.CidrBlockAssociationSet.CidrBlock
  description: The IPv4 CIDR block.
- contextPath: AWS.EC2.Vpcs.Tags.CidrBlockAssociationSet.CidrBlockState.State
  description: The state of the CIDR block.
- contextPath: AWS.EC2.Vpcs.Tags.CidrBlockAssociationSet.CidrBlockState.StatusMessage
  description: A message about the status of the CIDR block, if applicable.
- contextPath: AWS.EC2.SecurityGroups.GroupName
  description: The name of the security group.
- contextPath: AWS.EC2.SecurityGroups.Description
  description: A description for the security group.
- contextPath: AWS.EC2.SecurityGroups.VpcId
  description: The ID of the VPC.
- contextPath: AWS.EC2.SecurityGroups.GroupId
  description: The ID of the security group.
- contextPath: AWS.EC2.SecurityGroups.AccountId
  description: The ID of the AWS account with which the EC2 instance is associated.
    This key is only present when the parameter "AWS organization accounts" is provided.
- contextPath: ErrorEntries
  description: Contents of the errors associated with the entry/entries.
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 54dd5378-1342-4d82-84fa-99649b7926f7
      iscommand: false
      name: ""
      version: -1
    taskid: 54dd5378-1342-4d82-84fa-99649b7926f7
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 450,
          "y": 40
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    scriptarguments:
      cluster_name:
        simple: ${inputs.ClusterName}
      region:
        simple: ${inputs.region}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Describes an Amazon EKS cluster.
      id: 2fa1b9d8-7711-49e3-80cd-e572b487aebf
      iscommand: true
      name: EKS - Describe Cluster
      script: '|||aws-eks-describe-cluster'
      type: regular
      version: -1
    taskid: 2fa1b9d8-7711-49e3-80cd-e572b487aebf
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 170
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      assumeRolePolicyDocument:
        simple: |-
          {
            "Version": "2012-10-17",
            "Statement": {
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              },
              "Action": "sts:AssumeRole"
            }
          }
      roleName:
        simple: ${inputs.LambdaRoleName}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a new role for your AWS account.
      id: 935b9483-60e9-44e2-8571-358a764a0fb3
      iscommand: true
      name: Create a role for the Lambda function
      script: '|||aws-iam-create-role'
      type: regular
      version: -1
    taskid: 935b9483-60e9-44e2-8571-358a764a0fb3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 340
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      policyDocument:
        simple: |-
          {
              "Version": "2012-10-17",
              "Statement": [
                  {
                      "Effect": "Allow",
                      "Action": "eks:*",
                      "Resource": "*"
                  },
                  {
                      "Effect": "Allow",
                      "Action": [
                          "ec2:DescribeNetworkInterfaces",
                          "ec2:CreateNetworkInterface",
                          "ec2:DeleteNetworkInterface",
                          "ec2:DescribeInstances",
                          "ec2:AttachNetworkInterface"
                      ],
                      "Resource": "*"
                  }
              ]
          }
      policyName:
        simple: ${inputs.LambdaPolicyName}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a new managed policy for your AWS account.  This operation
        creates a policy version with a version identifier of v1 and sets v1 as the
        policy's default version.
      id: b647b62d-4c70-47d1-8fe5-6551ccf7b334
      iscommand: true
      name: Create policy
      script: '|||aws-iam-create-policy'
      type: regular
      version: -1
    taskid: b647b62d-4c70-47d1-8fe5-6551ccf7b334
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 500
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    scriptarguments:
      entityName:
        simple: ${AWS.IAM.Roles.RoleName}
      policyArn:
        simple: ${AWS.IAM.Policies.Arn}
      type:
        simple: Role
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Attaches the specified managed policy to the specified IAM Entity.
      id: 2cef0fd3-6d20-4f8a-8e7d-3fa27d1638ae
      iscommand: true
      name: Attach the policy to the Lambda role
      script: '|||aws-iam-attach-policy'
      type: regular
      version: -1
    taskid: 2cef0fd3-6d20-4f8a-8e7d-3fa27d1638ae
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 660
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      cluster_name:
        simple: ${inputs.ClusterName}
      principal_arn:
        simple: ${AWS.IAM.Roles.Arn}
      region:
        simple: ${inputs.region}
      retry-count:
        simple: "1"
      retry-interval:
        simple: "5"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates an access entry.
      id: a59535eb-3371-4fa5-8777-14a41c7bf807
      iscommand: true
      name: EKS - Create access entry
      script: '|||aws-eks-create-access-entry'
      type: regular
      version: -1
    taskid: a59535eb-3371-4fa5-8777-14a41c7bf807
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1160
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    scriptarguments:
      cluster_name:
        simple: ${inputs.ClusterName}
      policy_arn:
        simple: arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy
      principal_arn:
        simple: ${AWS.IAM.Roles.Arn}
      region:
        simple: ${inputs.region}
      type:
        simple: cluster
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Describes an Amazon EKS cluster.
      id: 5e11c0d3-f12f-43f6-884b-1b07e5b580ae
      iscommand: true
      name: EKS - Associate access policy
      script: '|||aws-eks-associate-access-policy'
      type: regular
      version: -1
    taskid: 5e11c0d3-f12f-43f6-884b-1b07e5b580ae
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1320
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "18"
    note: false
    quietmode: 0
    scriptarguments:
      cluster_name:
        simple: ${inputs.ClusterName}
      kubernetes_groups:
        simple: cluster-admin
      principal_arn:
        simple: ${AWS.IAM.Roles.Arn}
      region:
        simple: ${inputs.region}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Updates an access entry.
      id: 61b4a2bb-6609-4701-8dd3-ba257660ab25
      iscommand: true
      name: EKS - Update access entry
      script: '|||aws-eks-update-access-entry'
      type: regular
      version: -1
    taskid: 61b4a2bb-6609-4701-8dd3-ba257660ab25
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1480
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    scriptarguments:
      compatible-architectures:
        simple: ${inputs.LayerArchitecture}
      compatible-runtimes:
        simple: ${inputs.LayerRuntime}
      layer-name:
        simple: ${inputs.LayerName}
      region:
        simple: ${inputs.region}
      zip-file:
        complex:
          accessor: EntryID
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: File.Name
              operator: containsString
              right:
                iscontext: true
                value:
                  simple: inputs.LibraryName
          root: File
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates an Lambda layer from a ZIP archive.
      id: 45528df7-bb7f-42c5-8bd0-761a893853fb
      iscommand: true
      name: AWS Lambda - Publish layer version
      script: '|||aws-lambda-publish-layer-version'
      type: regular
      version: -1
    taskid: 45528df7-bb7f-42c5-8bd0-761a893853fb
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2900
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a13603f8-4bba-4f72-8d38-d02255a1e429
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: a13603f8-4bba-4f72-8d38-d02255a1e429
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3710
        }
      }
  "11":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: AWS.EKS.DescribeCluster.accessConfig.authenticationMode
          operator: containsGeneral
          right:
            value:
              simple: API
      label: "yes"
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "12"
      "yes":
      - "5"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if the cluster allows authentication via API.
      id: 634c042a-b835-496e-83a9-37cde721742a
      iscommand: false
      name: Check if the authentication mode allows API
      type: condition
      version: -1
    taskid: 634c042a-b835-496e-83a9-37cde721742a
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": 820
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      authentication_mode:
        simple: API_AND_CONFIG_MAP
      cluster_name:
        simple: ${inputs.ClusterName}
      region:
        simple: ${inputs.region}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: 'Updates an Amazon EKS cluster configuration. Only one type of
        update can be allowed. Potentially harmful: once the authentication mode was
        updated to ''API'' it is irreversible.'
      id: 7fb729bd-cda7-4087-8e76-f68a2ec88100
      iscommand: true
      name: Update cluster authentication mode
      script: '|||aws-eks-update-cluster-config'
      type: regular
      version: -1
    taskid: 7fb729bd-cda7-4087-8e76-f68a2ec88100
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 70,
          "y": 990
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      library_name:
        simple: ${inputs.LibraryName}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: The script installs a Python library using pip and archive it.
      id: fb201ae1-4187-4978-8190-6aee638abd62
      iscommand: false
      name: Download Kubernetes library
      script: DownloadAndArchivePythonLibrary
      type: regular
      version: -1
    taskid: fb201ae1-4187-4978-8190-6aee638abd62
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2740
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "15"
    note: false
    quietmode: 0
    scriptarguments:
      data:
        simple: ${inputs.FunctionCode}
      filename:
        simple: lambda_function.py
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Creates a file (using the given data input or entry ID) and uploads it to the current investigation War Room.
      id: 2c183d15-aaf8-499f-8922-9df6eab414ca
      iscommand: false
      name: Create the Lambda code
      script: FileCreateAndUploadV2
      type: regular
      version: -1
    taskid: 2c183d15-aaf8-499f-8922-9df6eab414ca
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3190
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "23"
    note: false
    quietmode: 0
    scriptarguments:
      entryID:
        complex:
          accessor: EntryID
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: File.Name
              operator: isEqualString
              right:
                value:
                  simple: lambda_function.py
          root: File
      zipName:
        simple: code
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Zip a file and upload to war room
      id: 0399941e-47ee-459e-8aa7-60c150b1a1c6
      iscommand: false
      name: Zip Lambda code
      script: ZipFile
      type: regular
      version: -1
    taskid: 0399941e-47ee-459e-8aa7-60c150b1a1c6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3360
        }
      }
  "16":
    continueonerror: true
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "34"
    note: false
    quietmode: 0
    scriptarguments:
      region:
        simple: ${inputs.region}
      securityGroupIds:
        simple: ${AWS.EKS.DescribeCluster.resourcesVpcConfig.securityGroupIds}
      serviceName:
        simple: com.amazonaws.${inputs.region}.eks-auth
      subnetIds:
        simple: ${AWS.EKS.DescribeCluster.resourcesVpcConfig.subnetIds}
      vpcEndpointType:
        simple: Interface
      vpcId:
        simple: ${AWS.EC2.Vpcs.VpcId}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a VPC endpoint.
      id: fedbbd4d-58b3-4e54-84f1-29b233743f5a
      iscommand: true
      name: Create VPC endpoint for eks-auth
      script: '|||aws-ec2-create-vpc-endpoint'
      type: regular
      version: -1
    taskid: fedbbd4d-58b3-4e54-84f1-29b233743f5a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 200,
          "y": 2180
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    scriptarguments:
      region:
        simple: ${inputs.region}
      vpcIds:
        simple: ${AWS.EKS.DescribeCluster.resourcesVpcConfig.vpcId}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Describes one or more of your VPCs.
      id: 2d82ee8b-6bcd-4d34-88c0-f8b1d9ceb10b
      iscommand: true
      name: Describe VPCs
      script: '|||aws-ec2-describe-vpcs'
      type: regular
      version: -1
    taskid: 2d82ee8b-6bcd-4d34-88c0-f8b1d9ceb10b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1645
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    scriptarguments:
      description:
        simple: This security group allow the response function to communicate with
          the cluster
      groupName:
        simple: ${inputs.SecurityGroupName}
      region:
        simple: ${inputs.region}
      vpcId:
        simple: ${AWS.EC2.Vpcs.VpcId}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a security group.
      id: 19380d04-9017-4578-85d1-6539b235c361
      iscommand: true
      name: Create security group
      script: '|||aws-ec2-create-security-group'
      type: regular
      version: -1
    taskid: 19380d04-9017-4578-85d1-6539b235c361
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1810
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      cidrIp:
        simple: ${AWS.EC2.Vpcs.CidrBlock}
      fromPort:
        simple: "443"
      groupId:
        simple: ${AWS.EC2.SecurityGroups.GroupId}
      ipProtocol:
        simple: tcp
      region:
        simple: ${inputs.region}
      toPort:
        simple: "443"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Adds ingress rule to a security group.
      id: b3871919-30b5-4e02-8fcd-fecaeaead4e8
      iscommand: true
      name: Create an ingress rule for the security group
      script: '|||aws-ec2-authorize-security-group-ingress-rule'
      type: regular
      version: -1
    taskid: b3871919-30b5-4e02-8fcd-fecaeaead4e8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1980
        }
      }
  "22":
    continueonerror: true
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "31"
    note: false
    quietmode: 0
    scriptarguments:
      region:
        simple: ${inputs.region}
      securityGroupIds:
        simple: ${AWS.EKS.DescribeCluster.resourcesVpcConfig.securityGroupIds}
      serviceName:
        simple: com.amazonaws.${inputs.region}.eks
      subnetIds:
        simple: ${AWS.EKS.DescribeCluster.resourcesVpcConfig.subnetIds}
      vpcEndpointType:
        simple: Interface
      vpcId:
        simple: ${AWS.EC2.Vpcs.VpcId}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a VPC endpoint.
      id: 7a865610-19c6-415a-89d1-ae1d9f558f10
      iscommand: true
      name: Create VPC endpoint for eks-auth
      script: '|||aws-ec2-create-vpc-endpoint'
      type: regular
      version: -1
    taskid: 7a865610-19c6-415a-89d1-ae1d9f558f10
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 700,
          "y": 2180
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      code:
        complex:
          accessor: EntryID
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: File.Name
              operator: isEqualString
              right:
                value:
                  simple: code.zip
          root: File
      functionName:
        simple: ${inputs.FunctionName}
      handler:
        simple: ${inputs.FunctionHandler}
      layers:
        simple: ${AWS.Lambda.Layers.LayerVersionArn}
      packageType:
        simple: Zip
      region:
        simple: ${inputs.region}
      role:
        simple: ${AWS.IAM.Roles.Arn}
      runtime:
        simple: ${inputs.FunctionRuntime}
      vpcConfig:
        complex:
          accessor: resourcesVpcConfig
          root: AWS.EKS.DescribeCluster
          transformers:
          - args:
              fields:
                value:
                  simple: clusterSecurityGroupId,endpointPrivateAccess,endpointPublicAccess,publicAccessCidrs,vpcId
              json_object: {}
            operator: IgnoreFieldsFromJson
          - operator: Stringify
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: SecurityGroupIds
              toReplace:
                value:
                  simple: securityGroupIds
            operator: replace
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: SubnetIds
              toReplace:
                value:
                  simple: subnetIds
            operator: replace
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a Lambda function. To create a function, you need a deployment
        package and an execution role.
      id: 25d80d46-e3c7-4fdc-8ad4-67d04e22dfd5
      iscommand: true
      name: AWS Lambda - Create function
      script: '|||aws-lambda-create-function'
      type: regular
      version: -1
    taskid: 25d80d46-e3c7-4fdc-8ad4-67d04e22dfd5
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3530
        }
      }
  "24":
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0d583674-cc5b-4a9d-8398-e5649245ac0e
      iscommand: false
      name: Create Function
      type: title
      version: -1
    taskid: 0d583674-cc5b-4a9d-8398-e5649245ac0e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3060
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "32"
    note: false
    quietmode: 0
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
      extend-context:
        simple: ErrorEntries.eksAuth=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get the error(s) associated with a given entry/entries. Use ${lastCompletedTaskEntries}
        to check the previous task entries. The automation will return an array of
        the error contents from those entries.
      id: f00e38d5-c3f5-4d1d-8642-34550bad0aab
      iscommand: false
      name: Check the error returned for eks-auth VPC endpoint creation
      script: GetErrorsFromEntry
      type: regular
      version: -1
    taskid: f00e38d5-c3f5-4d1d-8642-34550bad0aab
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 700,
          "y": 2350
        }
      }
  "32":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ErrorEntries.eksAuth
          operator: containsString
          right:
            value:
              simple: conflicting
      label: "yes"
    continueonerrortype: ""
    id: "32"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if a VPC endpoint for eks-auth already exists.
      id: 55fce217-fa07-432c-8bf7-8e327e33f763
      iscommand: false
      name: Check if the VPC endpoint already exists
      type: condition
      version: -1
    taskid: 55fce217-fa07-432c-8bf7-8e327e33f763
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 700,
          "y": 2520
        }
      }
  "33":
    continueonerror: true
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Error Message
      output:
        simple: VPC Endpoint Creation Failed
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      message:
        simple: |-
          Unable to create a VPC endpoint for eks-auth due to the following error:

          ${ErrorEntries.eksAuth}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Prints an error entry with a given message.
      id: ee2a8892-22db-46c2-8fdd-4dd5271a8529
      iscommand: false
      name: VPC endpoint for eks-auth creation error
      script: PrintErrorEntry
      type: regular
      version: -1
    taskid: ee2a8892-22db-46c2-8fdd-4dd5271a8529
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 2740
        }
      }
  "34":
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
      extend-context:
        simple: ErrorEntries.eks=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get the error(s) associated with a given entry/entries. Use ${lastCompletedTaskEntries}
        to check the previous task entries. The automation will return an array of
        the error contents from those entries.
      id: b4b59d4a-77f1-49cc-8852-0c8fbe92178d
      iscommand: false
      name: Check the error returned for eks VPC endpoint creation
      script: GetErrorsFromEntry
      type: regular
      version: -1
    taskid: b4b59d4a-77f1-49cc-8852-0c8fbe92178d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 200,
          "y": 2350
        }
      }
  "35":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ErrorEntries.eks
          operator: containsString
          right:
            value:
              simple: conflicting
      label: "yes"
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if a VPC endpoint for eks already exists.
      id: 81bbd239-7d66-4dba-8916-574494b0fdb0
      iscommand: false
      name: Check if the VPC endpoint already exists
      type: condition
      version: -1
    taskid: 81bbd239-7d66-4dba-8916-574494b0fdb0
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 200,
          "y": 2520
        }
      }
  "36":
    continueonerror: true
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Error Message
      output:
        simple: VPC Endpoint Creation Failed
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      message:
        simple: |-
          Unable to create a VPC endpoint for eks due to the following error:

          ${ErrorEntries.eks}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Prints an error entry with a given message.
      id: d1ccb111-1357-494a-8c5b-314bb9a13c19
      iscommand: false
      name: VPC endpoint for eks creation error
      script: PrintErrorEntry
      type: regular
      version: -1
    taskid: d1ccb111-1357-494a-8c5b-314bb9a13c19
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -180,
          "y": 2740
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "11_5_yes": 0.17,
      "32_13_yes": 0.38,
      "35_13_yes": 0.43
    },
    "paper": {
      "dimensions": {
        "height": 3735,
        "width": 1630,
        "x": -180,
        "y": 40
      }
    }
  }
