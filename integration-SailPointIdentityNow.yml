category: Data Enrichment & Threat Intelligence
commonfields:
  id: SailPointIdentityNow
  version: -1
configuration:
- additionalinfo: The FQDN/IP of the IdentityNow server to connect
  display: IdentityNow Server URL (e.g. https://org.api.identitynow.com)
  name: identitynow_url
  required: true
  type: 12
- additionalinfo: Client Id for OAuth 2.0
  display: Client Id (for OAuth 2.0)
  name: client_id
  required: true
  type: 0
- additionalinfo: Client Secret for OAuth 2.0
  display: Client Secret (for OAuth 2.0)
  name: client_secret
  required: true
  type: 4
- display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- display: Use system proxy settings
  name: proxy
  required: false
  type: 8
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.0.0
    itemVersion: 1.0.6
    packID: SailPointIdentityNow
    packName: SailPoint IdentityNow
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
defaultmapperin: SailPoint IdentityNow Trigger Mapper
description: The SailPoint Identity Security platform can be configured either on-prem/single
  tenant SaaS, or multi-tenant. This package is intended to be used with the SaaS,
  multi-tenant solution, IdentityNow.
detaileddescription: |-
  ### Partner Contributed Integration
  #### Integration Author: SailPoint
  Support and maintenance for this integration are provided by the author. Please use the following contact details:
  - **Email**: [support.idplusa@sailpoint.com](mailto:support.idplusa@sailpoint.com)
  - **URL**: [https://support.sailpoint.com/hc/en-us/requests/new](https://support.sailpoint.com/hc/en-us/requests/new)
  ***
  ## SailPoint IdentityNow
  - Following link describes the process of how one can obtain a Personal Access Token in IdentityNow.
  https://community.sailpoint.com/t5/Admin-Help/Generating-Personal-Access-Tokens/ta-p/172152


  ---
  [View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/sail-point-identity-now)
display: SailPoint IdentityNow (Partner Contribution)
image: data:image/png;base64,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
name: SailPointIdentityNow
script:
  commands:
  - arguments:
    - description: Elastic search query for retrieving identities.
      name: query
      required: true
    - description: Offset into the full result set. Usually specified with limit to
        paginate through the results.
      name: offset
    - description: Max number of results to return. Maximum of 250.
      name: limit
    description: Search for identity(identities) using elastic search query used by
      IdentityNow Search Engine.
    name: identitynow-search-identities
    outputs:
    - contextPath: SailPointIdentityNow.Identity.id
      description: The IdentityNow internal Id (uuid).
      type: String
    - contextPath: SailPointIdentityNow.Identity.name
      description: Name of the identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.displayName
      description: The display name of the identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.firstName
      description: The first name of the identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.lastName
      description: The last name of the identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.email
      description: Email address of the Identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.created
      description: Timestamp when the identity was created.
      type: Date
    - contextPath: SailPointIdentityNow.Identity.modified
      description: Timestamp when the identity was last modified.
      type: Date
    - contextPath: SailPointIdentityNow.Identity.inactive
      description: Indicates whether the identity is active.
      type: Boolean
    - contextPath: SailPointIdentityNow.Identity.protected
      description: Indicates whether this identity is protected.
      type: Boolean
    - contextPath: SailPointIdentityNow.Identity.status
      description: Status of this Identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.isManager
      description: Indicates whether this identity is a manager.
      type: Boolean
    - contextPath: SailPointIdentityNow.Identity.identityProfile
      description: Identity profile that maps this identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.source
      description: Source that maps this identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.attributes
      description: Map of variable number of attributes unique to this identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.accounts
      description: Array of objects representing the accounts belonging to this identity.
      type: String
    - contextPath: SailPointIdentityNow.Identity.accountCount
      description: Number of accounts belonging to this identity.
      type: Number
    - contextPath: SailPointIdentityNow.Identity.appCount
      description: Number of applications belonging to this identity.
      type: Number
    - contextPath: SailPointIdentityNow.Identity.accessCount
      description: Number of access objects belonging to this identity.
      type: Number
    - contextPath: SailPointIdentityNow.Identity.entitlementCount
      description: Number of entitlements assigned to this identity.
      type: Number
    - contextPath: SailPointIdentityNow.Identity.roleCount
      description: Number of roles assigned to this identity.
      type: Number
    - contextPath: SailPointIdentityNow.Identity.accessProfileCount
      description: Number of access profiles assigned to this identity.
      type: Number
    - contextPath: SailPointIdentityNow.Identity.pod
      description: Pod on which the organization that this identity belongs to resides
        on.
      type: String
    - contextPath: SailPointIdentityNow.Identity.org
      description: The organization that this identity belongs to.
      type: String
    - contextPath: SailPointIdentityNow.Identity.type
      description: Type of object, will be "identity".
      type: String
  - arguments:
    - description: Account Id of the user/identity(uuid).
      name: id
    - description: Name of the user/identity on the account.
      name: name
    - description: Native identity for the user account.
      name: native_identity
    - description: Offset into the full result set. Usually specified with limit to
        paginate through the results.
      name: offset
    - description: Max number of results to return. Maximum of 250.
      name: limit
    description: Get accounts by search/filter parameters (id, name, native_identity).
    name: identitynow-get-accounts
    outputs:
    - contextPath: SailPointIdentityNow.Account.id
      description: The IdentityNow internal id (uuid).
      type: String
    - contextPath: SailPointIdentityNow.Account.name
      description: Name of the identity on this account.
      type: String
    - contextPath: SailPointIdentityNow.Account.identityId
      description: The IdentityNow internal identity id.
      type: String
    - contextPath: SailPointIdentityNow.Account.nativeIdentity
      description: The IdentityNow internal native identity id.
      type: String
    - contextPath: SailPointIdentityNow.Account.sourceId
      description: Source id that maps this account.
      type: String
    - contextPath: SailPointIdentityNow.Account.created
      description: Timestamp when the account was created.
      type: Date
    - contextPath: SailPointIdentityNow.Account.modified
      description: Timestamp when the account was last modified.
      type: Date
    - contextPath: SailPointIdentityNow.Account.attributes
      description: Map of variable number of attributes unique to this account.
      type: String
    - contextPath: SailPointIdentityNow.Account.authoritative
      description: Indicates whether the account is the true source for this identity.
      type: Boolean
    - contextPath: SailPointIdentityNow.Account.disabled
      description: Indicates whether the account is disabled.
      type: Boolean
    - contextPath: SailPointIdentityNow.Account.locked
      description: Indicates whether the account is locked.
      type: Boolean
    - contextPath: SailPointIdentityNow.Account.systemAccount
      description: Indicates whether the account is a system account.
      type: Boolean
    - contextPath: SailPointIdentityNow.Account.uncorrelated
      description: Indicates whether the account is uncorrelated.
      type: Boolean
    - contextPath: SailPointIdentityNow.Account.manuallyCorrelated
      description: Indicates whether the account was manually correlated.
      type: Boolean
    - contextPath: SailPointIdentityNow.Account.hasEntitlements
      description: Indicates whether the account has entitlement.
      type: Boolean
  - arguments:
    - description: Account activity Id (uuid).
      name: id
    - description: The identity (uuid) that the activity was requested for (me indicates
        current user).
      name: requested_for
    - description: The identity (uuid) that requested the activity (me indicates current
        user).
      name: requested_by
    - description: The specified identity (uuid) will be either requester or target
        of account activity (me indicates current user).
      name: regarding_identity
    - description: Type of account activity.
      name: type
    - description: Offset into the full result set. Usually specified with limit to
        paginate through the results.
      name: offset
    - description: Max number of results to return. Maximum of 250.
      name: limit
    description: Get account activities by search/filter parameters (requested_for,
      requested_by, regarding_identity, type).
    name: identitynow-get-accountactivities
    outputs:
    - contextPath: SailPointIdentityNow.AccountActivity.id
      description: The IdentityNow internal id (uuid).
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.name
      description: Name of the account activity.
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.created
      description: Timestamp when the account activity was created.
      type: Date
    - contextPath: SailPointIdentityNow.AccountActivity.modified
      description: Timestamp when the account activity was last modified.
      type: Date
    - contextPath: SailPointIdentityNow.AccountActivity.completed
      description: Timestamp when the account activity was completed.
      type: Date
    - contextPath: SailPointIdentityNow.AccountActivity.completionStatus
      description: Completion status of the activity.
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.type
      description: Type of account activity.
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.requesterIdentitySummary
      description: Information of the requester identity.
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.targetIdentitySummary
      description: Information of the target identity.
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.items
      description: List of items that were requested as part of the account activity.
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.executionStatus
      description: Execution status of the account activity.
      type: String
    - contextPath: SailPointIdentityNow.AccountActivity.cancelable
      description: Indicates whether the account activity is cancelable.
      type: Boolean
    - contextPath: SailPointIdentityNow.AccountActivity.cancelComment
      description: Comments added while canceling the account activity.
      type: String
  - arguments:
    - description: Elastic search query for retrieving identities.
      name: query
      required: true
    - description: Offset into the full result set. Usually specified with limit to
        paginate through the results.
      name: offset
    - description: Max number of results to return. Maximum of 250.
      name: limit
    description: Search for access profile(s) using elastic search query used by IdentityNow
      Search Engine.
    name: identitynow-search-accessprofiles
    outputs:
    - contextPath: SailPointIdentityNow.AccessProfile.id
      description: The IdentityNow internal id of the access profile object.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.name
      description: Name of the access profile object.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.description
      description: User friendly description of the access profile.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.source
      description: Source of the access profile.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.entitlements
      description: Entitlements included in the access profile.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.entitlementCount
      description: Number of entitlements included in the access profile.
      type: Number
    - contextPath: SailPointIdentityNow.AccessProfile.created
      description: Date when the access profile was created.
      type: Date
    - contextPath: SailPointIdentityNow.AccessProfile.modified
      description: Date when the access profile was last modified.
      type: Date
    - contextPath: SailPointIdentityNow.AccessProfile.synced
      description: Date when the access profile was last synced.
      type: Date
    - contextPath: SailPointIdentityNow.AccessProfile.enabled
      description: Indicates whether the access profile is active (true/false).
      type: Boolean
    - contextPath: SailPointIdentityNow.AccessProfile.requestable
      description: Indicates whether the access profile is requestable in IdentityNow.
      type: Boolean
    - contextPath: SailPointIdentityNow.AccessProfile.requestCommentsRequired
      description: Indicates whether any request for this profile must contain comments.
      type: Boolean
    - contextPath: SailPointIdentityNow.AccessProfile.owner
      description: Owner of the access profile.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.pod
      description: Pod that the organization containing the access profile belongs
        to.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.org
      description: Name of the org on which the access profile exists.
      type: String
    - contextPath: SailPointIdentityNow.AccessProfile.type
      description: Type of access profile, will be "accessprofile".
      type: String
  - arguments:
    - description: Elastic search query for retrieving roles.
      name: query
      required: true
    - description: Offset into the full result set. Usually specified with limit to
        paginate through the results.
      name: offset
    - description: Max number of results to return. Maximum of 250.
      name: limit
    description: Search for role(s) using elastic search query used by IdentityNow
      Search Engine.
    name: identitynow-search-roles
    outputs:
    - contextPath: SailPointIdentityNow.Role.id
      description: The IdentityNow internal id of the role object.
      type: String
    - contextPath: SailPointIdentityNow.Role.name
      description: Name of the role.
      type: String
    - contextPath: SailPointIdentityNow.Role.description
      description: Description of this role.
      type: String
    - contextPath: SailPointIdentityNow.Role.accessProfiles
      description: Array of objects representing the access profiles that belong to
        this role.
      type: Unknown
    - contextPath: SailPointIdentityNow.Role.accessProfileCount
      description: Number indicated how many access profiles are attached to this
        role.
      type: Number
    - contextPath: SailPointIdentityNow.Role.created
      description: Timestamp when this role was created.
      type: Date
    - contextPath: SailPointIdentityNow.Role.modified
      description: Timestamp when this role was last modified.
      type: Date
    - contextPath: SailPointIdentityNow.Role.synced
      description: Timestamp when this role was last synced.
      type: Date
    - contextPath: SailPointIdentityNow.Role.enabled
      description: Indicates whether this role is enabled.
      type: Boolean
    - contextPath: SailPointIdentityNow.Role.requestable
      description: Indicates whether this role is requestable.
      type: Boolean
    - contextPath: SailPointIdentityNow.Role.requestCommentsRequired
      description: Indicates whether comments are required when requesting this role.
      type: Boolean
    - contextPath: SailPointIdentityNow.Role.owner
      description: Owner of the role.
      type: String
    - contextPath: SailPointIdentityNow.Role.pod
      description: Pod on which the organization responsible for this role belongs.
      type: String
    - contextPath: SailPointIdentityNow.Role.org
      description: Organization on which this role exists.
      type: String
    - contextPath: SailPointIdentityNow.Role.type
      description: Type of object, will be "role".
      type: String
  - arguments:
    - description: Elastic search query for retrieving entitlements.
      name: query
      required: true
    - description: Offset into the full result set. Usually specified with limit to
        paginate through the results.
      name: offset
    - description: Max number of results to return. Maximum of 250.
      name: limit
    description: Search for entitlement(s) using elastic search query used by IdentityNow
      Search Engine.
    name: identitynow-search-entitlements
    outputs:
    - contextPath: SailPointIdentityNow.Entitlement.id
      description: The IdentityNow internal id of the entitlement object.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.name
      description: Name of the entitlement object.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.displayName
      description: Displayname of the entitlement object.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.description
      description: Description of the entitlement.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.modified
      description: Timestamp when the entitlement was last modified.
      type: Date
    - contextPath: SailPointIdentityNow.Entitlement.synced
      description: Timestamp when the entitlement was last synced.
      type: Date
    - contextPath: SailPointIdentityNow.Entitlement.source
      description: Source from which this entitlement was aggregated.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.privileged
      description: Indicates this is a privileged entitlement.
      type: Boolean
    - contextPath: SailPointIdentityNow.Entitlement.identityCount
      description: Indicates how many identities have this entitlement.
      type: Number
    - contextPath: SailPointIdentityNow.Entitlement.attribute
      description: Name of the attribute type on the source.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.value
      description: Value of the entitlement (its native identifier).
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.schema
      description: The source schema that this entitlement utilizes.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.pod
      description: Pod on which the organization this entitlement belongs to is located.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.org
      description: Organization on which the source of this entitlement resides.
      type: String
    - contextPath: SailPointIdentityNow.Entitlement.type
      description: Type of object, will be "entitlement".
      type: String
  - arguments:
    - description: Elastic search query for retrieving events.
      name: query
      required: true
    - description: Offset into the full result set. Usually specified with limit to
        paginate through the results.
      name: offset
    - description: Max number of results to return. Maximum of 250.
      name: limit
    description: Search for event(s) using elastic search query used by IdentityNow
      Search Engine.
    name: identitynow-search-events
    outputs:
    - contextPath: SailPointIdentityNow.Event.id
      description: The IdentityNow internal id of the event object.
      type: String
    - contextPath: SailPointIdentityNow.Event.name
      description: Name of the event.
      type: String
    - contextPath: SailPointIdentityNow.Event.stack
      description: Component that triggered the event.
      type: String
    - contextPath: SailPointIdentityNow.Event.created
      description: Timestamp when the event was created.
      type: Date
    - contextPath: SailPointIdentityNow.Event.synced
      description: Timestamp when the event was last synced.
      type: String
    - contextPath: SailPointIdentityNow.Event.objects
      description: Array of object types that were the target of this event.
      type: Unknown
    - contextPath: SailPointIdentityNow.Event.ipAddress
      description: IP address that triggered this event.
      type: String
    - contextPath: SailPointIdentityNow.Event.technicalName
      description: System name for the event.
      type: String
    - contextPath: SailPointIdentityNow.Event.target
      description: Target of this event action.
      type: String
    - contextPath: SailPointIdentityNow.Event.actor
      description: Entity that initiated the action that caused this event.
      type: String
    - contextPath: SailPointIdentityNow.Event.action
      description: Action type of the event.
      type: String
    - contextPath: SailPointIdentityNow.Event.attributes
      description: Attributes of other interesting information about this event, contextual
        to the type.
      type: String
    - contextPath: SailPointIdentityNow.Event.operation
      description: Operation performed that triggered event.
      type: String
    - contextPath: SailPointIdentityNow.Event.status
      description: Status of the event.
      type: String
    - contextPath: SailPointIdentityNow.Event.pod
      description: Pod on which the organization that the event exists.
      type: String
    - contextPath: SailPointIdentityNow.Event.org
      description: Organization that initiated the event.
      type: String
    - contextPath: SailPointIdentityNow.Event.type
      description: Type of event.
      type: String
  - arguments:
    - description: Identity Id (uuid) for whom the access request is being made.
      name: requested_for
      required: true
    - description: Id (uuid) of the object (access profile or role).
      name: requested_item
      required: true
    - auto: PREDEFINED
      description: Type of object (ACCESS_PROFILE or ROLE).
      name: requested_item_type
      predefined:
      - ACCESS_PROFILE
      - ROLE
      required: true
    - description: Comments to attach to the item request.
      name: comment
    description: Grant access request for a single object(access profile or role)
      for a single user.
    name: identitynow-request-grant
  - arguments:
    - description: Identity Id (uuid) for whom the access request is being made.
      name: requested_for
      required: true
    - description: Id (uuid) of the object(access profile or role).
      name: requested_item
      required: true
    - auto: PREDEFINED
      description: Type of object (ACCESS_PROFILE or ROLE).
      name: requested_item_type
      predefined:
      - ACCESS_PROFILE
      - ROLE
      required: true
    - description: Comments to attach to the item request.
      name: comment
    description: Revoke access request for a single object(access profile or role)
      for a single user.
    name: identitynow-request-revoke
  dockerimage: demisto/python3:3.10.12.63474
  runonce: false
  script: |
    register_module_line('SailPointIdentityNow', 'start', __line__())
    ### pack version: 1.0.6


    ''' IMPORTS '''

    import traceback

    import requests
    import urllib3

    # Disable insecure warnings
    urllib3.disable_warnings()

    ''' CONSTANTS '''

    # IdentityNow OAuth token endpoint
    IDN_OAUTH_EXT = '/oauth/token'
    IDN_SEARCH_PREFIX = '/beta/search'

    # Resource endpoints
    IDN_SEARCH_IDENTITIES_EXT = f'{IDN_SEARCH_PREFIX}/identities'
    IDN_BETA_ACCOUNTS_EXT = '/beta/accounts'
    IDN_SEARCH_ACCESS_PROFILES_EXT = f'{IDN_SEARCH_PREFIX}/accessprofiles'
    IDN_SEARCH_ROLES_EXT = f'{IDN_SEARCH_PREFIX}/roles'
    IDN_SEARCH_ENTITLEMENTS_EXT = f'{IDN_SEARCH_PREFIX}/entitlements'
    IDN_SEARCH_EVENTS_EXT = f'{IDN_SEARCH_PREFIX}/events'
    IDN_BETA_ACCOUNT_ACTIVITIES_EXT = '/beta/account-activities'
    IDN_BETA_ACCESS_REQUEST_EXT = '/beta/access-requests'

    # Other constants
    # Using beta account API for accounts
    SEARCHABLE_TYPE_LIST = ['identities', 'accessprofiles', 'roles', 'entitlements', 'events']
    MAX_INCIDENTS_TO_FETCH = 250
    MAX_LIMIT = 250
    OFFSET_DEFAULT = '0'
    LIMIT_DEFAULT = '250'
    DATE_FORMAT = '%Y-%m-%dT%H:%M:%S'

    ''' CLIENT CLASS '''


    class Client(BaseClient):
        """
        Client class to interact with API request.
        """

        def __init__(self, base_url: str, verify: bool, proxy: bool, headers: dict, max_results: int, request_timeout: int):
            super().__init__(base_url=base_url, verify=verify, proxy=proxy, headers=headers)
            self.max_results = max_results
            self.request_timeout = request_timeout

        def send_request(self, url_suffix: str, method: str, params=None, json_data=None):
            """
            Perform a HTTP request to IdentityNow API.

            :type url_suffix: ``str``
            :param url_suffix: IdentityNow API endpoint ext suffix.

            :type method: ``str``
            :param method: HTTP method, e.g. 'GET', 'POST', 'PUT', 'DELETE'.

            :type params: ``JSON``
            :param params: URL parameters to specify the query.

            :type json_data: ``JSON``
            :param json_data: Data to be sent as part of 'POST' or 'PUT' request.

            :return: Response after fulfilling the request successfully, else None.
            """
            if url_suffix is None or method is None:
                return None

            return self._http_request(url_suffix=url_suffix, method=method, json_data=json_data, params=params,
                                      timeout=self.request_timeout, resp_type='response')


    ''' HELPER/UTILITY FUNCTIONS '''


    def get_headers(base_url: str, client_id: str, client_secret: str, grant_type: str):
        """
        Create header with OAuth 2.0 authentication information.

        :type base_url: ``str``
        :param base_url: Base URL of the IdentityNow tenant.

        :type client_id: ``str``
        :param client_id: Client Id for OAuth 2.0.

        :type client_secret: ``str``
        :param client_secret: Client Secret for OAuth 2.0.

        :type grant_type: ``str``
        :param grant_type: Grant Type for OAuth 2.0. Defaulted to 'client_credentials' if not provided.

        :return: Header with OAuth 2.0 information if client_id & client_secret are provided, else ConnectionError(message).
        This will return ConnectionError(message) if the client_id & client_secret were not valid (authorized).
        """
        if base_url is None or client_id is None or client_secret is None:
            return None

        if grant_type is None:
            grant_type = 'client_credentials'

        params = {
            'grant_type': grant_type,
            'client_id': client_id,
            'client_secret': client_secret
        }
        oauth_response = requests.request("POST", url=f'{base_url}{IDN_OAUTH_EXT}', params=params)
        if oauth_response is not None and 200 <= oauth_response.status_code < 300:
            return {
                'Authorization': 'Bearer %s' % oauth_response.json().get('access_token', None),
                'Content-Type': 'application/json'
            }
        elif oauth_response.json().get('error_description') is not None:
            raise ConnectionError(oauth_response.json().get('error_description'))
        else:
            raise ConnectionError('Unable to fetch headers from IdentityNow!')


    def build_query_object(object_type: str, query: str):
        """
        Build query object for IdentityNow Search Engine.

        :type object_type: ``str``
        :param object_type: Type of object (Identity, AccessProfile, Account, Role, Entitlement, Event)

        :type query: ``str``
        :param query: Elastic search query for the IdentityNow Search Engine.

        :return: JSON object that contains the elastic search query.
        """
        if object_type is None or object_type not in SEARCHABLE_TYPE_LIST:
            return None

        if query is None:
            return None

        return {
            "indices": [object_type],
            "query": {
                "query": query
            }
        }


    def get_markdown(object_type: str, objects=None):
        """
        Getting markdown for object type to display the results in human readable format.

        :type object_type: ``str``
        :param object_type: Type of IdentityNow object.

        :type objects: ``dict`` or ``list``
        :param objects: Single or list of Identity resources object/s.

        :return: Markdown for each object type.
        """
        markdown = ''
        if object_type == 'IdentityNow.Identity':
            headers = ['id', 'name', 'displayName', 'firstName', 'lastName', 'email', 'created', 'modified', 'inactive',
                       'protected', 'status', 'isManager', 'identityProfile', 'source', 'attributes', 'accounts',
                       'accountCount', 'appCount', 'accessCount', 'entitlementCount', 'roleCount', 'accessProfileCount',
                       'pod', 'org', 'type']
            markdown = tableToMarkdown('Identity(Identities)', objects, headers=headers, removeNull=True)
        elif object_type == 'IdentityNow.Account':
            headers = ['id', 'name', 'identityId', 'nativeIdentity', 'sourceId', 'created', 'modified',
                       'attributes', 'authoritative', 'disabled', 'locked', 'systemAccount', 'uncorrelated',
                       'manuallyCorrelated', 'hasEntitlements']
            markdown = tableToMarkdown('Account(s)', objects, headers=headers, removeNull=True)
        elif object_type == 'IdentityNow.AccountActivity':
            headers = ['id', 'name', 'created', 'modified', 'completed', 'completionStatus', 'type',
                       'requesterIdentitySummary', 'targetIdentitySummary', 'items', 'executionStatus', 'cancelable',
                       'cancelComment']
            markdown = tableToMarkdown('Account Activity(Account Activities)', objects, headers=headers, removeNull=True)
        elif object_type == 'IdentityNow.AccessProfile':
            headers = ['id', 'name', 'description', 'source', 'entitlements', 'entitlementCount', 'created', 'modified',
                       'synced', 'enabled', 'requestable', 'requestCommentsRequired', 'owner', 'pod', 'org', 'type']
            markdown = tableToMarkdown('Access Profile(s)', objects, headers=headers, removeNull=True)
        elif object_type == 'IdentityNow.Role':
            headers = ['id', 'name', 'description', 'accessProfiles', 'accessProfileCount', 'created', 'modified', 'synced',
                       'enabled', 'requestable', 'requestCommentsRequired', 'owner', 'pod', 'org', 'type']
            markdown = tableToMarkdown('Role(s)', objects, headers=headers, removeNull=True)
        elif object_type == 'IdentityNow.Entitlement':
            headers = ['id', 'name', 'displayName', 'description', 'modified', 'synced', 'source', 'privileged',
                       'identityCount', 'attribute', 'value', 'schema', 'pod', 'org', 'type']
            markdown = tableToMarkdown('Entitlement(s)', objects, headers=headers, removeNull=True)
        elif object_type == 'IdentityNow.Event':
            headers = ['id', 'name', 'stack', 'created', 'synced', 'objects', 'ipAddress', 'technicalName', 'target',
                       'actor', 'action', 'attributes', 'operation', 'status', 'pod', 'org', 'type']
            markdown = tableToMarkdown('Event(s)', objects, headers=headers, removeNull=True)
        return markdown


    def build_results(prefix: str, key_field: str, response=None):
        """
        Build results.

        :type prefix: ``str``
        :param prefix: Prefix for CommandResults as part of the results.

        :type key_field: ``str``
        :param key_field: Key field for CommandResults as part of the results.

        :type response: ``response``
        :param response: Response object from IdentityNow API call.

        :return: CommandResults in case of a successful response else message describing the error status.
        """
        if response is not None and 200 <= response.status_code < 300:
            if isinstance(response.json(), list):
                markdown = '### Results:\nTotal: ' + str(len(response.json())) + '\n'
            else:
                markdown = '### Results:\n'
            markdown += get_markdown(prefix, response.json())
            return CommandResults(
                readable_output=markdown,
                outputs_prefix=prefix,
                outputs_key_field=key_field,
                outputs=response.json()
            )
        else:
            return None


    ''' COMMAND FUNCTIONS '''


    def test_connection(base_url: str, client_id: str, client_secret: str, grant_type: str):
        """
        Test connectivity to IdentityNow

        :type base_url: ``str``
        :param base_url: Base URL of the IdentityNow tenant.

        :type client_id: ``str``
        :param client_id: Client Id for OAuth 2.0.

        :type client_secret: ``str``
        :param client_secret: Client Secret for OAuth 2.0.

        :type grant_type: ``str``
        :param grant_type: Grant Type for OAuth 2.0. Defaulted to 'client_credentials' if not provided.

        :return: HTTP connectivity status for test connection.
        """
        try:
            get_headers(base_url, client_id, client_secret, grant_type)
            return 'ok'
        except ConnectionError as error:
            return f'Error Connecting : {error}'


    def search(client: Client, object_type: str, query: str, offset: int, limit: int):
        """
        Search object type using elastic search query for IdentityNow Search Engine.
        Command(s): identitynow-search-identities, identitynow-search-accessprofiles, identitynow-search-roles,
        identitynow-search-entitlements, identitynow-search-events

        :type client: ``Client``
        :param client: SailPoint client

        :type object_type: ``str``
        :param object_type: Type of object(Identity, AccessProfile, Role, Entitlement, Event)

        :type query: ``str``
        :param query: The query using the Elasticsearch Query (String Query) syntax from the Query DSL extended by SailPoint
        to support Nested queries.

        :type offset: ``int``
        :param offset: Offset into the full result set. Usually specified with limit to paginate through the results.

        :type limit: ``int``
        :param limit: Max number of results to return. Maximum of 250.

        :return: IdentityNow object (JSON) corresponding to the elastic search query. Empty JSON if the event was not found
        in IdentityNow.
        """
        if object_type is None or object_type not in SEARCHABLE_TYPE_LIST:
            return None

        if query is None:
            return None

        if not offset or offset < 0:
            offset = 0

        if not limit or limit > MAX_LIMIT:
            limit = MAX_LIMIT

        params = {'offset': offset, 'limit': limit}
        url = IDN_SEARCH_PREFIX
        if object_type == 'IdentityNow.Identity':
            url = IDN_SEARCH_IDENTITIES_EXT
        elif object_type == 'IdentityNow.AccessProfile':
            url = IDN_SEARCH_ACCESS_PROFILES_EXT
        elif object_type == 'IdentityNow.Role':
            url = IDN_SEARCH_ROLES_EXT
        elif object_type == 'IdentityNow.Entitlement':
            url = IDN_SEARCH_ENTITLEMENTS_EXT
        elif object_type == 'IdentityNow.Event':
            url = IDN_SEARCH_EVENTS_EXT
        return client.send_request(url, "POST", params, build_query_object(object_type, query))


    def get_accounts(client: Client, id: str, name: str, native_identity: int, offset: int, limit: int):
        """
        Get accounts by search/filter parameters (id, name, native_identity).
        Command(s): identitynow-get-accounts

        :type client: ``Client``
        :param client: SailPoint client

        :type id: ``str``
        :param id: Account Id of the user/identity.

        :type name: ``str``
        :param name: Name of the user/identity on the account.

        :type native_identity: ``str``
        :param native_identity: Native identity for the user account.

        :type offset: ``int``
        :param offset: Offset into the full result set. Usually specified with limit to paginate through the results.

        :type limit: ``int``
        :param limit: Max number of results to return. Maximum of 250.

        :return: Account object (JSON) corresponding to the filter parameters. Empty JSON if the event was not found in
        IdentityNow.
        """
        if not offset or offset < 0:
            offset = 0

        if not limit or limit > MAX_LIMIT:
            limit = MAX_LIMIT

        params = {'offset': offset, 'limit': limit}
        if id is not None:
            url = ''.join((IDN_BETA_ACCOUNTS_EXT, '/', id))
        else:
            url = IDN_BETA_ACCOUNTS_EXT
            filter_list = []
            if name is not None:
                filter_list.append(''.join(('name eq "', name, '"')))
            if native_identity is not None:
                filter_list.append(''.join(('nativeIdentity eq "', native_identity, '"')))
            # Combine the filters
            if filter_list is not None and len(filter_list) > 0:
                filter_string = ' and '.join(filter_list)
                params.update({'filters': filter_string})
        return client.send_request(url, "GET", params, None)


    def get_account_activities(client: Client, id: str, requested_for: str, requested_by: str, regarding_identity: str,
                               type: str, offset: int, limit: int):
        """
        Get account activities by search/filter parameters (requested_for, requested_by, regarding_identity, type).
        Command(s): identitynow-get-accountactivities

        :type client: ``Client``
        :param client: SailPoint client

        :type id: ``str``
        :param id: Account activity Id.

        :type requested_for: ``str``
        :param requested_for: The identity that the activity was requested for (me indicates current user).

        :type requested_by: ``str``
        :param requested_by: The identity that requested the activity (me indicates current user).

        :type regarding_identity: ``str``
        :param regarding_identity: The specified identity will be either requester or target of account activity (me
        indicates current user).

        :type type: ``str``
        :param type: Type of account activity.

        :type offset: ``int``
        :param offset: Offset into the full result set. Usually specified with limit to paginate through the results.

        :type limit: ``int``
        :param limit: Max number of results to return. Maximum of 250.

        :return: Account object (JSON) corresponding to the filter parameters. Empty JSON if the event was not found in
        IdentityNow.
        """
        if not offset or offset < 0:
            offset = 0

        if not limit or limit > MAX_LIMIT:
            limit = MAX_LIMIT

        params = {'offset': offset, 'limit': limit}
        if id is not None:
            url = ''.join((IDN_BETA_ACCOUNT_ACTIVITIES_EXT, '/', id))
        else:
            url = IDN_BETA_ACCOUNT_ACTIVITIES_EXT
            if requested_for is not None:
                params.update({'requested-for': requested_for})
            if requested_by is not None:
                params.update({'requested-by': requested_by})
            if regarding_identity is not None:
                params.update({'regarding-identity': regarding_identity})
            if type is not None:
                params.update({'filters': ''.join(('type eq "', type, '"'))})
        return client.send_request(url, "GET", params, None)


    def access_request_bulk(client: Client, request_type: str, requested_for=None, requested_items=None):
        """
        Grant or revoke access request for a list of objects(access profiles or roles) for a list of users.
        Command(s): identitynow-request-grant, identitynow-request-revoke

        :type client: ``Client``
        :param client: SailPoint client

        :type request_type: ``str``
        :param request_type: Type of access request(GRANT_ACCESS or REVOKE_ACCESS).

        :type requested_for: ``list``
        :param requested_for: List of Identity Id's.

        :type requested_items: ``list``
        :param requested_items: List of objects(access profiles or roles).

        :return: Success or failure status.
        """
        if request_type is None or requested_for is None or requested_items is None:
            return None

        json_data = {
            "requestedFor": requested_for,
            "requestType": request_type,
            "requestedItems": requested_items,
            "clientMetadata": {}
        }
        response = client.send_request(IDN_BETA_ACCESS_REQUEST_EXT, "POST", None, json_data)
        if response is not None and 200 <= response.status_code < 300:
            return 'Access request was successful!'
        elif 'detailCode' in response.json():
            return response.json()
        return None


    def access_request(client: Client, request_type: str, requested_for: str, requested_item: str, requested_item_type: str,
                       comment: str):
        """
        Grant or revoke access request for a single object(access profile or role) for a single user.
        Command(s): identitynow-request-grant, identitynow-request-revoke

        :type client: ``Client``
        :param client: SailPoint client

        :type request_type: ``str``
        :param request_type: Type of access request(GRANT_ACCESS or REVOKE_ACCESS).

        :type requested_for: ``str``
        :param requested_for: Identity Id for whom the access request is being made.

        :type requested_item: ``str``
        :param requested_item: Id of the object(access profile or role).

        :type requested_item_type: ``str``
        :param requested_item_type: Type of object(ACCESS_PROFILE or ROLE).

        :type comment: ``str``
        :param comment: Comments to attach to the item request.

        :return: Success or failure status.
        """
        if request_type is None or requested_for is None or requested_item is None or requested_item_type is None:
            return None

        json_data = {
            "requestedFor": [requested_for],
            "requestType": request_type,
            "requestedItems": [
                {
                    "type": requested_item_type,
                    "id": requested_item,
                    "comment": comment
                }
            ],
            "clientMetadata": {}
        }
        response = client.send_request(IDN_BETA_ACCESS_REQUEST_EXT, "POST", None, json_data)
        if response is not None and 200 <= response.status_code < 300:
            return 'Access request was successful!'
        elif 'detailCode' in response.json():
            return response.json()
        return None


    ''' MAIN FUNCTION '''


    def main():
        """
        Intercept and execute commands.
        """

        params = demisto.params()
        # IdentityNow API Base URL (https://org.api.identitynow.com)
        base_url = params.get('identitynow_url')

        # OAuth 2.0 Credentials
        client_id = params.get('client_id')
        client_secret = params.get('client_secret')
        grant_type = 'client_credentials'

        # Other configs
        verify_certificate = not params.get('insecure', False)
        proxy = params.get('proxy', False)
        request_timeout = 10

        headers = {}
        try:
            headers = get_headers(base_url, client_id, client_secret, grant_type)
        except ConnectionError as error:
            demisto.error(f'Error getting header : {error}')
            return_error(f'Error getting header : {error}')

        client = Client(
            base_url=base_url,
            verify=verify_certificate,
            proxy=proxy,
            headers=headers,
            max_results=MAX_INCIDENTS_TO_FETCH,
            request_timeout=request_timeout)

        command = demisto.command()
        demisto.debug(f'Command being called is {command}')
        try:
            args = demisto.args()
            results = None
            if command == 'test-module':
                # This is the call made when pressing the integration Test button.
                results = test_connection(base_url, client_id, client_secret, grant_type)

            elif command == 'identitynow-search-identities':
                query = args.get('query', None)
                offset = int(args.get('offset', OFFSET_DEFAULT))
                limit = int(args.get('limit', LIMIT_DEFAULT))
                response = search(client, 'identities', query, offset, limit)
                results = build_results('IdentityNow.Identity', 'id', response)

            elif command == 'identitynow-get-accounts':
                id = args.get('id', None)
                name = args.get('name', None)
                native_identity = args.get('native_identity', None)
                offset = int(args.get('offset', OFFSET_DEFAULT))
                limit = int(args.get('limit', LIMIT_DEFAULT))
                response = get_accounts(client, id, name, native_identity, offset, limit)
                results = build_results('IdentityNow.Account', 'id', response)

            elif command == 'identitynow-get-accountactivities':
                id = args.get('id', None)
                requested_for = args.get('requested_for', None)
                requested_by = args.get('requested_by', None)
                regarding_identity = args.get('regarding_identity', None)
                type = args.get('type', None)
                offset = int(args.get('offset', OFFSET_DEFAULT))
                limit = int(args.get('limit', LIMIT_DEFAULT))
                response = get_account_activities(client, id, requested_for, requested_by, regarding_identity, type, offset,
                                                  limit)
                results = build_results('IdentityNow.AccountActivity', 'id', response)

            elif command == 'identitynow-search-accessprofiles':
                query = args.get('query', None)
                offset = int(args.get('offset', OFFSET_DEFAULT))
                limit = int(args.get('limit', LIMIT_DEFAULT))
                response = search(client, 'accessprofiles', query, offset, limit)
                results = build_results('IdentityNow.AccessProfile', 'id', response)

            elif command == 'identitynow-search-roles':
                query = args.get('query', None)
                offset = int(args.get('offset', OFFSET_DEFAULT))
                limit = int(args.get('limit', LIMIT_DEFAULT))
                response = search(client, 'roles', query, offset, limit)
                results = build_results('IdentityNow.Role', 'id', response)

            elif command == 'identitynow-search-entitlements':
                query = args.get('query', None)
                offset = int(args.get('offset', OFFSET_DEFAULT))
                limit = int(args.get('limit', LIMIT_DEFAULT))
                response = search(client, 'entitlements', query, offset, limit)
                results = build_results('IdentityNow.Entitlement', 'id', response)

            elif command == 'identitynow-search-events':
                query = args.get('query', None)
                offset = int(args.get('offset', OFFSET_DEFAULT))
                limit = int(args.get('limit', LIMIT_DEFAULT))
                response = search(client, 'events', query, offset, limit)
                results = build_results('IdentityNow.Event', 'id', response)

            elif command == 'identitynow-request-grant':
                requested_for = args.get('requested_for', None)
                requested_item = args.get('requested_item', None)
                requested_item_type = args.get('requested_item_type', None)
                comment = args.get('comment', None)
                results = access_request(client, "GRANT_ACCESS", requested_for, requested_item, requested_item_type,
                                         comment)

            elif command == 'identitynow-request-revoke':
                requested_for = args.get('requested_for', None)
                requested_item = args.get('requested_item', None)
                requested_item_type = args.get('requested_item_type', None)
                comment = args.get('comment', None)
                results = access_request(client, "REVOKE_ACCESS", requested_for, requested_item, requested_item_type,
                                         comment)

            return_results(results)

        # Log exceptions and return errors
        except Exception as e:
            demisto.error(traceback.format_exc())
            return_error(f'Failed to execute {command} command.\nError:\n{str(e)}')


    ''' ENTRY POINT '''

    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()

    register_module_line('SailPointIdentityNow', 'end', __line__())
  subtype: python3
  type: python
system: true
