contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: |-
  Use this playbook to investigate and remediate a potential phishing incident. The playbook simultaneously engages with the user that triggered the incident, while investigating the incident itself.

  The final remediation tasks are always decided by a human analyst.
hidden: true
id: 3d047986-7cf1-431b-8778-899fae918aa7
inputs:
- description: The default role to assign the incident to.
  key: Role
  playbookInputQuery: null
  required: true
  value:
    simple: Administrator
- description: |-
    Enable the "Search and Delete" capability (can be either "True" or "False").
    In case of a malicious email, the "Search and Delete" sub-playbook will look for other instances of the email and delete them pending analyst approval.
  key: SearchAndDelete
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: |-
    Enable the "Block Indicators" capability (can be either "True" or "False").
    In case of a malicious email, the "Block Indicators" sub-playbook will block all malicious indicators in the relevant integrations.
  key: BlockIndicators
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: Whether the authenticity of the email should be verified, using SPF,
    DKIM and DMARC.
  key: AuthenticateEmail
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
name: TCS-Phishing Investigation-Generic v2
outputs: []
sourceplaybookid: Phishing Investigation - Generic v2
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "39"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: df795f95-2c0c-4f2a-89bc-dd2cff758526
      iscommand: false
      name: ""
      version: -1
    taskid: df795f95-2c0c-4f2a-89bc-dd2cff758526
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": -90
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "15"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      assignBy:
        simple: machine-learning
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Assign the incident to an analyst based on the analyst's organizational
        role.
      id: 00b60677-045f-40a9-8589-839cc589c7f9
      iscommand: false
      name: Assign to analyst
      script: AssignAnalystToIncident
      type: regular
      version: -1
    taskid: 00b60677-045f-40a9-8589-839cc589c7f9
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 642.5,
          "y": 2810
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "33"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Review the incident to determine if the email that the user reported
        is malicious.
      id: 1330fd67-6f08-4172-88ce-cdf13cc43d7a
      iscommand: false
      name: Manually review the incident
      type: regular
      version: -1
    taskid: 1330fd67-6f08-4172-88ce-cdf13cc43d7a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3305
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    reputationcalc: 1
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Close the investigation.
      id: 5f5d3128-2704-4b42-8d0c-f12dcc3f7f8e
      iscommand: true
      name: Close investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 5f5d3128-2704-4b42-8d0c-f12dcc3f7f8e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 710,
          "y": 5050
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "85"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a35b32df-14c3-4faf-8544-2ecf9e69e4a1
      iscommand: false
      name: Triage
      type: title
      version: -1
    taskid: a35b32df-14c3-4faf-8544-2ecf9e69e4a1
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 7.5,
          "y": 195
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "53"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Account.Email.Address
      value:
        complex:
          accessor: labels.Email/from
          root: incident
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Store the email address of the user that reported the incident.
      id: 3006f70e-c1e7-423b-8399-feff6e2552ed
      iscommand: false
      name: Store the email address of the reporting user
      script: Set
      type: regular
      version: -1
    taskid: 3006f70e-c1e7-423b-8399-feff6e2552ed
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1182.5,
          "y": 345
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      body:
        simple: "Hi ${.=val.Account.DisplayName && val.Email.Address === val.incident.labels['Email/from']
          ? val.Account.DisplayName : val.incident.labels['Email/from']},\nWe've received
          your email and are investigating.\nPlease do not touch the email until further
          notice.\n\nCordially, \n  Your friendly neighborhood security team"
      subject:
        simple: 'Re: Phishing Investigation - ${incident.name}'
      to:
        complex:
          accessor: labels.Email/from
          root: incident
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Send an auto-response to user that reported the incident, informing them the incident was received and being handled.
      id: 43aad5df-fe85-4601-850b-41afb26233e3
      iscommand: true
      name: Acknowledge incident was received
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 43aad5df-fe85-4601-850b-41afb26233e3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1182.5,
          "y": 695
        }
      }
  "15":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: incident.severity
          operator: greaterThanOrEqual
          right:
            value:
              simple: "2"
      label: 'Malicious '
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "31"
      'Malicious ':
      - "30"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if the email is malicious based on the calculated severity.
      id: ff34651f-076a-4e9b-8b60-6b8f2dc7a235
      iscommand: false
      name: Is the email malicious?
      type: condition
      version: -1
    taskid: ff34651f-076a-4e9b-8b60-6b8f2dc7a235
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 642.5,
          "y": 2985
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      body:
        simple: |-
          Hi ${.=val.Account.DisplayName && val.Email.Address === val.incident.labels['Email/from'] ? val.Account.DisplayName : val.incident.labels['Email/from']},
          We've concluded that the email you forwarded to us is safe.
          Thank you for your alertness and your participation in keeping our organization secure.

          Cordially,
            Your security team
      subject:
        simple: 'Re: Phishing Investigation - ${incident.name}'
      to:
        simple: ${incident.labels.Email/from}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email to the user explaining that the email they reported
        is safe.
      id: 35082323-10eb-4ba7-89f4-89be66c59535
      iscommand: false
      name: Update  the user that the reported email is safe
      script: SendEmail
      type: regular
      version: -1
    taskid: 35082323-10eb-4ba7-89f4-89be66c59535
    timertriggers:
    - action: stop
      fieldname: detectionsla
    type: regular
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3930
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    scriptarguments:
      body:
        simple: |-
          Hi ${.=val.Account.DisplayName && val.Email.Address === val.incident.labels['Email/from'] ? val.Account.DisplayName : val.incident.labels['Email/from']},
          We've concluded that the email you forwarded to us is malicious. No further action is required on your part. Good job on detecting and forwarding it to us!

          All the best,
            Your security team
      subject:
        simple: 'Re: Phishing Investigation - ${incident.name}'
      to:
        simple: ${incident.labels.Email/from}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email to the user explaining that the email they reported
        is malicious.
      id: c5f7de77-5db5-4c87-8789-dbd2fec03bb2
      iscommand: true
      name: Update  the user that the reported email is malicious
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: c5f7de77-5db5-4c87-8789-dbd2fec03bb2
    timertriggers:
    - action: stop
      fieldname: detectionsla
    type: regular
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 3940
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 79c4091f-3e64-4b50-8de6-4cc19b74c5b2
      iscommand: false
      name: Engage with User
      type: title
      version: -1
    taskid: 79c4091f-3e64-4b50-8de6-4cc19b74c5b2
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1182.5,
          "y": 195
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "56"
    note: false
    quietmode: 0
    scriptarguments:
      EntryID:
        complex:
          accessor: EntryID
          root: File
      File:
        complex:
          root: File
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Detonate file through active integrations that support file detonation
      id: 18a25b85-d890-4f0a-8308-cd29b847a697
      iscommand: false
      name: Detonate File - Generic
      playbookId: Detonate File - Generic
      type: playbook
      version: -1
    taskid: 18a25b85-d890-4f0a-8308-cd29b847a697
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 272.5,
          "y": 530
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "37"
      - "36"
      - "34"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a17aec00-34c9-4810-8c3c-2c699b8fbea3
      iscommand: false
      name: Remediation
      type: title
      version: -1
    taskid: a17aec00-34c9-4810-8c3c-2c699b8fbea3
    timertriggers:
    - action: start
      fieldname: remediationsla
    type: title
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 4140
        }
      }
  "28":
    continueonerrortype: ""
    id: "28"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 763334bd-22b1-4f97-8082-f17e53294061
      iscommand: false
      name: Search And Delete Emails - Generic
      playbookId: search_and_delete_emails_-_generic
      type: playbook
      version: -1
    taskid: 763334bd-22b1-4f97-8082-f17e53294061
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1062.5,
          "y": 4700
        }
      }
  "29":
    continueonerrortype: ""
    id: "29"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b77dc122-4e54-4c61-8df3-701ad61c2860
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: b77dc122-4e54-4c61-8df3-701ad61c2860
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 715,
          "y": 5215
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: c9431052-b930-48a0-88a9-b9018c6368f3
      iscommand: false
      name: Email Is Malicious
      type: title
      version: -1
    taskid: c9431052-b930-48a0-88a9-b9018c6368f3
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1062.5,
          "y": 3160
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: aaea8fea-86bd-4237-8170-32529ff2c3ce
      iscommand: false
      name: Undetermined
      type: title
      version: -1
    taskid: aaea8fea-86bd-4237-8170-32529ff2c3ce
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3160
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      "No":
      - "16"
      "Yes":
      - "17"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Is the email that the user reported malicious?
      id: 5e765062-0496-4d1e-8d9a-df336fd0ed32
      iscommand: false
      name: Is the email malicious?
      type: condition
      version: -1
    taskid: 5e765062-0496-4d1e-8d9a-df336fd0ed32
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3470
        }
      }
  "34":
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Consider the following:\n1. Search for and delete similar emails\n2.
        Inform the organization about the threat\n3. Hunt the relevant IOCs\n4. Update
        proxies and firewalls as necessary\n5. Block the malicious sender/ domain
        in the mail-gateway "
      id: fc672f19-e914-49e1-89fe-cb1f65cee036
      iscommand: false
      name: Manually remediate  the incident
      type: regular
      version: -1
    taskid: fc672f19-e914-49e1-89fe-cb1f65cee036
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 620,
          "y": 4310
        }
      }
  "36":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: inputs.SearchAndDelete
                    operator: isEqualString
                    right:
                      value:
                        simple: "True"
                root: inputs.SearchAndDelete
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "88"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Verify that the "Search and Delete" parameter is set to "True"?
      id: 9a4743b7-f4df-4c48-81f9-5da09c9295d4
      iscommand: false
      name: Execute the "Search and Delete" sub-playbook?
      type: condition
      version: -1
    taskid: 9a4743b7-f4df-4c48-81f9-5da09c9295d4
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 4310
        }
      }
  "37":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: inputs.BlockIndicators
                    operator: isEqualString
                    right:
                      value:
                        simple: "True"
                root: inputs.BlockIndicators
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "89"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Verify that the "Block indicators" parameter is set to "True"?
      id: e88508b3-7662-42da-84f2-e2f64811ab3a
      iscommand: false
      name: Execute the "Block Indicators" sub-playbook?
      type: condition
      version: -1
    taskid: e88508b3-7662-42da-84f2-e2f64811ab3a
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1510,
          "y": 4310
        }
      }
  "38":
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 9b294901-88ae-48c5-86c0-e91e5a1764e4
      iscommand: false
      name: Block Indicators - Generic
      playbookId: block_indicators_-_generic
      type: playbook
      version: -1
    taskid: 9b294901-88ae-48c5-86c0-e91e5a1764e4
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 4670
        }
      }
  "39":
    continueonerrortype: ""
    id: "39"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b0b9e16f-8b0b-4864-83e8-ec124f451233
      iscommand: false
      name: Start Detection Timer
      type: title
      version: -1
    taskid: b0b9e16f-8b0b-4864-83e8-ec124f451233
    timertriggers:
    - action: start
      fieldname: detectionsla
    type: title
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 40
        }
      }
  "43":
    continueonerrortype: ""
    id: "43"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ab920cea-156f-4202-88da-f556c93d490d
      iscommand: false
      name: Stop Remediation Timer
      type: title
      version: -1
    taskid: ab920cea-156f-4202-88da-f556c93d490d
    timertriggers:
    - action: stop
      fieldname: remediationsla
    type: title
    view: |-
      {
        "position": {
          "x": 710,
          "y": 4910
        }
      }
  "47":
    continueonerrortype: ""
    id: "47"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "56"
    note: false
    quietmode: 0
    scriptarguments:
      MD5:
        complex:
          accessor: MD5
          root: File
          transformers:
          - operator: uniq
      SHA1:
        complex:
          accessor: SHA1
          root: File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          accessor: SHA256
          root: File
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 8091d723-a2ac-4bca-84ac-969b53bb78b4
      iscommand: false
      name: File Enrichment - Generic v2
      playbookId: File Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: 8091d723-a2ac-4bca-84ac-969b53bb78b4
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -490,
          "y": 860
        }
      }
  "48":
    continueonerrortype: ""
    id: "48"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "56"
    note: false
    quietmode: 0
    scriptarguments:
      IP:
        complex:
          accessor: Address
          root: IP
          transformers:
          - operator: uniq
      ResolveIP:
        simple: "False"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 16524d5e-ebc5-4f7c-899d-21c23a1825ff
      iscommand: false
      name: IP Enrichment - External - Generic v2
      playbookId: IP Enrichment - External - Generic v2
      type: playbook
      version: -1
    taskid: 16524d5e-ebc5-4f7c-899d-21c23a1825ff
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -52.5,
          "y": 860
        }
      }
  "49":
    continueonerrortype: ""
    id: "49"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "56"
    note: false
    quietmode: 0
    scriptarguments:
      Domain:
        complex:
          accessor: Name
          root: Domain
          transformers:
          - operator: uniq
      Email:
        complex:
          accessor: Email.Address
          root: Account
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: a128258c-c0f7-47d6-8871-0e168fc10dd4
      iscommand: false
      name: Email Address Enrichment - Generic v2.1
      playbookId: Email Address Enrichment - Generic v2.1
      type: playbook
      version: -1
    taskid: a128258c-c0f7-47d6-8871-0e168fc10dd4
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -490,
          "y": 1020
        }
      }
  "50":
    continueonerrortype: ""
    id: "50"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "56"
    note: false
    quietmode: 0
    scriptarguments:
      Rasterize:
        simple: "True"
      URL:
        complex:
          accessor: Data
          root: URL
          transformers:
          - operator: uniq
      VerifyURL:
        simple: "False"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: a76d1e81-929c-457c-8e68-528a3a995263
      iscommand: false
      name: URL Enrichment - Generic v2
      playbookId: URL Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: a76d1e81-929c-457c-8e68-528a3a995263
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -52.5,
          "y": 1020
        }
      }
  "51":
    continueonerrortype: ""
    id: "51"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "56"
    note: false
    quietmode: 0
    scriptarguments:
      Domain:
        complex:
          accessor: Name
          root: Domain
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 9fae462b-1bea-44e4-8d5f-c3343dbbb36d
      iscommand: false
      name: Domain Enrichment - Generic v2
      playbookId: Domain Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: 9fae462b-1bea-44e4-8d5f-c3343dbbb36d
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -52.5,
          "y": 1180
        }
      }
  "52":
    continueonerrortype: ""
    id: "52"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "48"
      - "47"
      - "50"
      - "49"
      - "51"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ad18962d-c30a-4b9c-8474-eff5ea91972a
      iscommand: false
      name: Indicator Enrichment
      type: title
      version: -1
    taskid: ad18962d-c30a-4b9c-8474-eff5ea91972a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -272.5,
          "y": 710
        }
      }
  "53":
    continueonerrortype: ""
    id: "53"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    scriptarguments:
      Domain:
        complex:
          root: Domain
          transformers:
          - operator: uniq
      Email:
        complex:
          accessor: Email.Address
          root: Account
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Enrich email addresses.
        - Get information from Active Directory for internal addresses
        - Get the domain-squatting reputation for external addresses
      id: 1f6208a9-4eb5-464e-818e-c92cd727e933
      iscommand: false
      name: Email Address Enrichment - Generic v2.1
      playbookId: Email Address Enrichment - Generic v2.1
      type: playbook
      version: -1
    taskid: 1f6208a9-4eb5-464e-818e-c92cd727e933
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1182.5,
          "y": 530
        }
      }
  "56":
    continueonerrortype: ""
    id: "56"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "79"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: eb2eb6f9-ec6d-437d-8447-9b17eb4426e6
      iscommand: false
      name: Investigation
      type: title
      version: -1
    taskid: eb2eb6f9-ec6d-437d-8447-9b17eb4426e6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -260,
          "y": 1510
        }
      }
  "79":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.AuthenticateEmail
          operator: isEqualString
          right:
            value:
              simple: "True"
      - - left:
            iscontext: true
            value:
              complex:
                accessor: HeadersMap
                root: Email
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "79"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "84"
      "yes":
      - "80"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Whether the email should be authenticated using DKIM, SPF and DMARC.
        This checks whether "AuthenticateEmail" output is set to "True" and whether
        there are headers from an email to authenticate.
      id: 00a256b8-8c7a-417d-86fb-559cd40c50a9
      iscommand: false
      name: Should the email be authenticated?
      type: condition
      version: -1
    taskid: 00a256b8-8c7a-417d-86fb-559cd40c50a9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -260,
          "y": 1680
        }
      }
  "80":
    continueonerrortype: ""
    id: "80"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "82"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 63953cd0-b9f7-4148-836e-b7bf620ee8bc
      iscommand: false
      name: Email Authenticity Check
      type: title
      version: -1
    taskid: 63953cd0-b9f7-4148-836e-b7bf620ee8bc
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -260,
          "y": 1910
        }
      }
  "82":
    continueonerrortype: ""
    id: "82"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "83"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      headers:
        complex:
          accessor: HeadersMap
          root: Email
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks the authenticity of an email based on the email's SPF, DMARC,
        and DKIM.
      id: e9f0eb68-6f93-49ce-811b-f0f9b6bd3449
      iscommand: false
      name: Authenticate email
      script: CheckEmailAuthenticity
      type: regular
      version: -1
    taskid: e9f0eb68-6f93-49ce-811b-f0f9b6bd3449
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -260,
          "y": 2080
        }
      }
  "83":
    continueonerrortype: ""
    id: "83"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "84"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      emailauthenticitycheck:
        complex:
          accessor: AuthenticityCheck
          root: Email
          transformers:
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: Undetermined
              toReplace:
                value:
                  simple: undetermined
            operator: replace
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: Pass
              toReplace:
                value:
                  simple: pass
            operator: replace
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: Fail
              toReplace:
                value:
                  simple: fail
            operator: replace
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: Suspicious
              toReplace:
                value:
                  simple: suspicious
            operator: replace
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Save the verdict, regarding the authenticity of the email, in an
        incident field.
      id: 78e78c85-2a84-4c26-83de-a44eb05bebcf
      iscommand: true
      name: Save authenticity check result to incident field
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 78e78c85-2a84-4c26-83de-a44eb05bebcf
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -260,
          "y": 2255
        }
      }
  "84":
    continueonerrortype: ""
    id: "84"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 721f465a-b35d-4481-8213-587538dd852f
      iscommand: false
      name: Calculate Severity - Generic v2
      playbookId: Calculate Severity - Generic v2
      type: playbook
      version: -1
    taskid: 721f465a-b35d-4481-8213-587538dd852f
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 212.5,
          "y": 2560
        }
      }
  "85":
    continueonerrortype: ""
    id: "85"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
      - "86"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 63a370f8-9c18-415f-874e-733cbfcfbcc4
      iscommand: false
      name: TCS - Process Email - Generic
      playbookId: 3d54551f-efc4-420a-8b21-ac3ae034714d
      type: playbook
      version: -1
    taskid: 63a370f8-9c18-415f-874e-733cbfcfbcc4
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -10,
          "y": 360
        }
      }
  "86":
    continueonerrortype: ""
    id: "86"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "52"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 24bb0a8e-686f-4cab-89ca-e41db7209702
      iscommand: false
      name: 'TCS - Extract Indicators From File - Generic v2 '
      playbookId: 6c6bd3d2-aea9-4b59-843f-d125dc42d25c
      type: playbook
      version: -1
    taskid: 24bb0a8e-686f-4cab-89ca-e41db7209702
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -220,
          "y": 520
        }
      }
  "88":
    continueonerrortype: ""
    id: "88"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "28"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 21425703-3182-4384-8fbe-e65ecd73130c
      iscommand: false
      name: Manually Review the case before deleting email
      type: regular
      version: -1
    taskid: 21425703-3182-4384-8fbe-e65ecd73130c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1062.5,
          "y": 4540
        }
      }
  "89":
    continueonerrortype: ""
    id: "89"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "38"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cf6f9f75-8719-4409-8d49-a43aae870a58
      iscommand: false
      name: Manually Review the case before block it
      type: regular
      version: -1
    taskid: cf6f9f75-8719-4409-8d49-a43aae870a58
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 4520
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "15_30_Malicious ": 0.48,
      "15_31_#default#": 0.44,
      "33_16_No": 0.64,
      "33_17_Yes": 0.19,
      "36_43_#default#": 0.14,
      "37_43_#default#": 0.23,
      "79_80_yes": 0.49,
      "79_84_#default#": 0.34
    },
    "paper": {
      "dimensions": {
        "height": 5370,
        "width": 2410,
        "x": -490,
        "y": -90
      }
    }
  }
