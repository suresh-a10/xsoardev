contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.0.0
    itemVersion: 6.1.65
    packID: CortexXDR
    packName: Cortex XDR by Palo Alto Networks
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: "The playbook investigates Cortex XDR incidents involving port scan alerts.
  The playbook is designed to run as a sub-playbook of ‘Cortex XDR Alerts Handling’.
  \n\nThe playbook consists of the following procedures:\n- Enrichment and investigation
  of the scanner and scanned hostname and IP address.\n- Enrichment and investigation
  of the initiator user, process, file, or command if it exists.\n- Detection of related
  indicators and analysis of the relationship between the detected indicators.\n-
  Utilize the detected indicators to conduct threat hunting.\n- Blocks detected malicious
  indicators.\n- Endpoint isolation.\n\nThis playbook supports the following Cortex
  XDR alert names:\n- Suspicious port scan\n- Port scan by suspicious process\n- Highly
  suspicious port scan\n- Port scan."
id: Cortex XDR - Port Scan - Adjusted
inputs:
- description: 'A list of IP ranges to check the IP against. The comma-separated list
    should be provided in CIDR notation. For example, a list of ranges would be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16"
    (without quotes).'
  key: InternalIPRanges
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: PrivateIPs
      root: lists
      transformers:
      - args:
          error_if_no_match: {}
          ignore_case: {}
          multi_line: {}
          period_matches_newline: {}
          regex:
            value:
              simple: (\b(?:\d{1,3}\.){3}\d{1,3}\b/\d{1,2})
          unpack_matches: {}
        operator: RegexExtractAll
      - args:
          separator:
            value:
              simple: ','
        operator: join
- description: The user name used for port scanning.
  key: Username
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: user_name
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - operator: uniq
- description: The source IP address from which the port scanning was initiated.
  key: SrcIPAddress
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: action_local_ip
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - operator: uniq
- description: Scanned destination IP address.
  key: DstIPAddress
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: action_remote_ip
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - operator: uniq
- description: Scanned port numbers.
  key: DstPort
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: action_remote_port
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - operator: uniq
- description: |-
    Whether early containment should be allowed when the IP address is known to be malicious.
    Possible values:True/False. Default:True.
  key: EarlyContainment
  playbookInputQuery: null
  required: true
  value:
    simple: "True"
- description: Source host name from which port scanning was initiated.
  key: SrcHostname
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: host_name
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - args:
          item:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.action_external_hostname
        operator: append
      - operator: uniq
- description: Source endpoint ID from which port scanning was initiated.
  key: EndpointID
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: endpoint_id
      filters:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.name
          operator: containsGeneral
          right:
            value:
              simple: port scan
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - operator: uniq
- description: The command used to initiate port scan activity.
  key: Initiator_CMD
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: action_process_image_command_line
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - args:
          item:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.causality_actor_process_command_line
        operator: append
      - operator: uniq
- description: Process SHA256 file hash initiated port scanning.
  key: Initiator_Process_SHA256
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: action_process_image_sha256
      root: PaloAltoNetworksXDR.Incident.alerts
      transformers:
      - args:
          item:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.causality_actor_process_image_sha256
        operator: append
      - operator: uniq
- description: Whether to automatically isolate endpoints.
  key: AutoIsolateEndpoint
  playbookInputQuery: null
  required: true
  value:
    simple: "False"
- description: |-
    Possible values: True/False.  Default: True.
    Should the given indicators be automatically blocked, or should the user be given the option to choose?

    If set to False - no prompt will appear, and all provided indicators will be blocked automatically.
    If set to True - the user will be prompted to select which indicators to block.
  key: AutoBlockIndicators
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
name: Cortex XDR - Port Scan - Adjusted
outputs:
- contextPath: PortScan.BlockPorts
  description: Indicates whether there's a need to block the ports used for exploitation
    on the scanned host.
  type: unknown
- contextPath: PortScan.AttackerIPs
  description: Attacker IPs from the port scan alert.
  type: unknown
- contextPath: PortScan.AttackerHostnames
  description: Attacker hostnames from the port scan alert.
  type: unknown
- contextPath: PortScan.AttackerUsername
  description: Attacker username from the port scan alert.
  type: unknown
- contextPath: PortScan.FileArtifacts
  description: File artifacts from the port scan alert.
  type: unknown
- contextPath: PortScan.LateralMovementFirstDatetime
  description: Lateral Movement First Date time from the port scan alert.
  type: unknown
- contextPath: PortScan.PortScanFirstDatetime
  description: Port Scan First Date time.
  type: unknown
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "101"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7c46d5ad-2e77-4213-8d84-4de23934ce23
      iscommand: false
      name: ""
      version: -1
    taskid: 7c46d5ad-2e77-4213-8d84-4de23934ce23
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 1770,
          "y": -960
        }
      }
  "101":
    continueonerrortype: ""
    id: "101"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "103"
      - "149"
      - "121"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 56c0dce3-6475-432f-8222-3eb612f97f4d
      iscommand: false
      name: Analysis
      type: title
      version: -1
    taskid: 56c0dce3-6475-432f-8222-3eb612f97f4d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1770,
          "y": -830
        }
      }
  "102":
    continueonerrortype: ""
    id: "102"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "109"
    note: false
    quietmode: 0
    scriptarguments:
      Username:
        complex:
          root: inputs.Username
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |-
        Enrich accounts using one or more integrations.
        Supported integrations:
        - Active Directory
        - SailPoint IdentityNow
        - SailPoint IdentityIQ
        - PingOne
        - Okta
        - AWS IAM
        - Cortex XDR (account enrichment and reputation)

        Also, the playbook supports the generic command 'iam-get-user' (implemented in IAM integrations. For more information, visit https://xsoar.pan.dev/docs/integrations/iam-integrations.
      id: 6756bd3a-2ff7-4140-8816-badf1aa7b1f9
      iscommand: false
      name: Account Enrichment - Generic v2.1
      playbookId: Account Enrichment - Generic v2.1
      type: playbook
      version: -1
    taskid: 6756bd3a-2ff7-4140-8816-badf1aa7b1f9
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1380,
          "y": -390
        }
      }
  "103":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.Username
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "103"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "122"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether a specific username initiated the port scanning
        activity.
      id: 0c0ea9a0-dce5-4da7-87a5-bba2b35549e8
      iscommand: false
      name: Was port scanning initiated by a username?
      type: condition
      version: -1
    taskid: 0c0ea9a0-dce5-4da7-87a5-bba2b35549e8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1550,
          "y": -690
        }
      }
  "109":
    continueonerrortype: ""
    id: "109"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "147"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7aa518ff-d72e-4a43-83c7-e0627584fc29
      iscommand: false
      name: Containment
      type: title
      version: -1
    taskid: 7aa518ff-d72e-4a43-83c7-e0627584fc29
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 730
        }
      }
  "112":
    continueonerrortype: ""
    id: "112"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "134"
      - "145"
      - "176"
      - "192"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 75118ba5-ef70-43e8-8fd0-345f4734c797
      iscommand: false
      name: Investigation
      type: title
      version: -1
    taskid: 75118ba5-ef70-43e8-8fd0-345f4734c797
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 1510
        }
      }
  "113":
    continueonerrortype: ""
    id: "113"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "133"
    note: false
    quietmode: 0
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      FilesToBlock:
        complex:
          accessor: Indicator
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      IP:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: ip
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      InputEnrichment:
        simple: "True"
      RuleDirection:
        simple: inbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      SHA256:
        complex:
          accessor: Indicator
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
            - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: hash
          root: DBotScore
          transformers:
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |+
        This playbook blocks malicious indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic v2
        - Block Account - Generic v2
        - Block IP - Generic v3
        - Block File - Generic v2
        - Block Email - Generic v2
        - Block Domain - Generic v2

      id: ed746e97-2f73-4656-8ef7-a5305babd03d
      iscommand: false
      name: Block Indicators - Generic v3
      playbookId: Block Indicators - Generic v3
      type: playbook
      version: -1
    taskid: ed746e97-2f73-4656-8ef7-a5305babd03d
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 1210
        }
      }
  "121":
    continueonerrortype: ""
    id: "121"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "125"
      - "158"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 034add39-d2a2-46df-8207-58d2258ee440
      iscommand: false
      name: Network Enrichment
      type: title
      version: -1
    taskid: 034add39-d2a2-46df-8207-58d2258ee440
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2240,
          "y": -690
        }
      }
  "122":
    continueonerrortype: ""
    id: "122"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "102"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: cf8e5592-f3ce-4d72-8a08-0eeaba001c94
      iscommand: false
      name: Identity Enrichment
      type: title
      version: -1
    taskid: cf8e5592-f3ce-4d72-8a08-0eeaba001c94
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1380,
          "y": -520
        }
      }
  "123":
    continueonerrortype: ""
    id: "123"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "109"
    note: false
    quietmode: 0
    scriptarguments:
      IP:
        complex:
          root: inputs.DstIPAddress
          transformers:
          - operator: uniq
      InternalRange:
        complex:
          root: inputs.InternalIPRanges
          transformers:
          - operator: uniq
      ResolveIP:
        simple: "True"
      UseReputationCommand:
        simple: "True"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Enrich IP addresses using one or more integrations.

        - Resolve IP addresses to hostnames (DNS)
        - Provide threat information
        - Separate internal and external IP addresses
        - For internal IP addresses, get host information
      id: 1ea5d847-1818-4420-8804-575b6e0a6f2c
      iscommand: false
      name: IP Enrichment - Generic v2
      playbookId: IP Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: 1ea5d847-1818-4420-8804-575b6e0a6f2c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 2007.5,
          "y": -420
        }
      }
  "125":
    continueonerrortype: ""
    id: "125"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "123"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ea0ea81e-59af-4b7a-8689-8faf389fe8d5
      iscommand: false
      name: Destination IP & Host Enrichment
      type: title
      version: -1
    taskid: ea0ea81e-59af-4b7a-8689-8faf389fe8d5
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2010,
          "y": -550
        }
      }
  "128":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Score
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: IP
                root: DBotScore
          operator: greaterThanOrEqual
          right:
            value:
              simple: "3"
        - left:
            iscontext: true
            value:
              complex:
                accessor: Score
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: File
                  - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: Hash
                root: DBotScore
          operator: greaterThanOrEqual
          right:
            value:
              simple: "3"
      label: "yes"
    continueonerrortype: ""
    id: "128"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "112"
      "yes":
      - "113"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether any malicious artifacts should be blocked.
      id: 982f8452-1b8f-4781-8927-3f7f94a1319d
      iscommand: false
      name: Any artifacts found as malicious?
      type: condition
      version: -1
    taskid: 982f8452-1b8f-4781-8927-3f7f94a1319d
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 1040
        }
      }
  "133":
    continueonerrortype: ""
    id: "133"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "112"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f6e9fc1b-acee-424c-872c-b42f8f4f1ea6
      iscommand: false
      name: Containment Complete
      type: title
      version: -1
    taskid: f6e9fc1b-acee-424c-872c-b42f8f4f1ea6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 1370
        }
      }
  "134":
    continueonerrortype: ""
    id: "134"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "194"
    note: false
    quietmode: 0
    scriptarguments:
      Indicator:
        complex:
          accessor: Indicator
          root: DBotScore
      LimitResults:
        simple: "200"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        This playbook is designed to assist with a security investigation by providing an analysis of indicator relationships. The following information is included:
        - Indicators of compromise (IOCs) related to the investigation.
        - Attack patterns related to the investigation.
        - Campaigns related to the investigation.
        - IOCs associated with the identified campaigns.
        - Reports containing details on the identified campaigns.
      id: 676497a0-9c1e-4fea-8a6b-f60219387e9e
      iscommand: false
      name: TIM - Indicator Relationships Analysis
      playbookId: TIM - Indicator Relationships Analysis
      type: playbook
      version: -1
    taskid: 676497a0-9c1e-4fea-8a6b-f60219387e9e
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1990,
          "y": 1660
        }
      }
  "135":
    continueonerrortype: ""
    id: "135"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "194"
    note: false
    quietmode: 0
    scriptarguments:
      AzureSearchTime:
        simple: ago(3d)
      OktaSearch:
        simple: "True"
      QRadarSearchTime:
        simple: Last 3 days
      SIEMFailedLogonSearch:
        simple: "True"
      SplunkEarliestTime:
        simple: -1d
      SplunkIndex:
        simple: '*'
      SplunkLatestTime:
        simple: now
      ThreatLogSearch:
        simple: "True"
      UserEmail:
        complex:
          accessor: Email
          root: Account
          transformers:
          - operator: uniq
      Username:
        complex:
          root: inputs.Username
          transformers:
          - operator: uniq
      XDRAlertSearch:
        simple: "True"
      XDRUsernameField:
        simple: actor_effective_username
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |-
        This playbook performs an investigation on a specific user, using queries and logs from SIEM, Identity management systems, XDR, and firewalls.

        Supported Integrations:
        -Okta
        -Splunk
        -QRadar
        -Azure Log Analytics
        -PAN-OS
        -XDR By Palo Alto Networks
      id: 2b4b78da-dfae-4cb4-8a6e-1858b2068389
      iscommand: false
      name: User Investigation - Generic
      playbookId: User Investigation - Generic
      type: playbook
      version: -1
    taskid: 2b4b78da-dfae-4cb4-8a6e-1858b2068389
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1580,
          "y": 1820
        }
      }
  "140":
    continueonerrortype: ""
    id: "140"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "141"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: dcf85ced-cb7b-4ea7-8c5b-e9fa15f92b87
      iscommand: false
      name: Investigation - Related Indicators Hunt
      type: title
      version: -1
    taskid: dcf85ced-cb7b-4ea7-8c5b-e9fa15f92b87
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 2515
        }
      }
  "141":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: RelatedFiles
          operator: isNotEmpty
          right:
            value: {}
        - left:
            iscontext: true
            value:
              complex:
                root: RelatedDomains
          operator: isNotEmpty
        - left:
            iscontext: true
            value:
              complex:
                root: RelatedIPs
          operator: isNotEmpty
        - left:
            iscontext: true
            value:
              complex:
                root: RelatedURLs
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "141"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "152"
      "yes":
      - "142"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether there are any indicators to hunt for.
      id: 89d1e208-6669-43af-8c41-50fb577f4c51
      iscommand: false
      name: Found related Indicators to hunt?
      type: condition
      version: -1
    taskid: 89d1e208-6669-43af-8c41-50fb577f4c51
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 2650
        }
      }
  "142":
    continueonerrortype: ""
    id: "142"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "143"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: IP
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: RelatedIPs
            operator: append
          - operator: uniq
      InternalRange:
        complex:
          root: inputs.InternalIPRanges
      MD5:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
            - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: hash
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      QRadarTimeFrame:
        simple: LAST 7 DAYS
      SHA1:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
            - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: hash
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: stringHasLength
              right:
                value:
                  simple: "40"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      SHA256:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
            - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: hash
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: RelatedFiles
            operator: append
          - operator: uniq
      SplunkEarliestTime:
        simple: -7d@d
      SplunkLatestTime:
        simple: now
      URLDomain:
        complex:
          root: RelatedURLs
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: RelatedDomains
            operator: append
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: "This playbook enables threat hunting for IOCs in your enterprise.
        It currently supports the following integrations: \n- Splunk\n- Qradar\n-
        Pan-os \n- Cortex data lake \n- Autofocus\n- Microsoft 365 Defender"
      id: f6b64a54-4e85-4350-8a5c-375d7090a5b5
      iscommand: false
      name: Threat Hunting - Generic
      playbookId: Threat Hunting - Generic
      type: playbook
      version: -1
    taskid: f6b64a54-4e85-4350-8a5c-375d7090a5b5
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 2820
        }
      }
  "143":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: Splunk
          operator: isNotEmpty
          right:
            value: {}
        - left:
            iscontext: true
            value:
              complex:
                root: PANWHunting
          operator: isNotEmpty
        - left:
            iscontext: true
            value:
              complex:
                root: QRadar
          operator: isNotEmpty
        - left:
            iscontext: true
            value:
              complex:
                root: Microsoft365Defender
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "143"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "152"
      "yes":
      - "144"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Verifies whether there are any threat hunting results.
      id: 7df2f070-6394-4152-80ca-a485b961aaae
      iscommand: false
      name: Has hunt results?
      type: condition
      version: -1
    taskid: 7df2f070-6394-4152-80ca-a485b961aaae
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 2980
        }
      }
  "144":
    continueonerrortype: ""
    id: "144"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "152"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: HasHuntResults
      value:
        simple: "true"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 67482103-02eb-43b0-8be6-1636642362ce
      iscommand: false
      name: Set hunt results true
      script: Set
      type: regular
      version: -1
    taskid: 67482103-02eb-43b0-8be6-1636642362ce
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 3140
        }
      }
  "145":
    continueonerrortype: ""
    id: "145"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "194"
    note: false
    quietmode: 0
    scriptarguments:
      FileSHA256:
        complex:
          root: inputs.Initiator_Process_SHA256
          transformers:
          - operator: uniq
      HuntAttacker:
        simple: "True"
      HuntByFile:
        simple: "True"
      HuntByHost:
        simple: "True"
      HuntCnCTechniques:
        simple: "True"
      HuntCollectionTechniques:
        simple: "True"
      HuntDefenseEvasionTechniques:
        simple: Fale
      HuntDiscoveryTechniques:
        simple: "True"
      HuntExecutionTechniques:
        simple: "True"
      HuntImpactTechniques:
        simple: "False"
      HuntInitialAccessTechniques:
        simple: Fale
      HuntLateralMovementTechniques:
        simple: "True"
      HuntPersistenceTechniques:
        simple: "False"
      HuntPrivilegeEscalationTechniques:
        simple: "True"
      HuntReconnaissanceTechniques:
        simple: "True"
      RunAll:
        simple: Fale
      agentID:
        complex:
          root: inputs.EndpointID
      attackerExternalHost:
        complex:
          root: inputs.SrcHostname
          transformers:
          - operator: uniq
      attackerRemoteIP:
        complex:
          root: inputs.SrcIPAddress
          transformers:
          - operator: uniq
      timeRange:
        simple: 6 hours ago
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: "This playbook is part of the 'Malware Investigation And Response'
        pack. For more information, refer to https://xsoar.pan.dev/docs/reference/packs/malware-investigation-and-response.
        This playbook handles all the endpoint investigation actions available with
        Cortex XSOAR, including the following tasks:\n * Pre-defined MITRE Tactics\n
        * Host fields (Host ID)\n * Attacker fields (Attacker IP, External host)\n
        * MITRE techniques\n * File hash (currently, the playbook supports only SHA256)
        \ \n\n Note: The playbook inputs enable manipulating the execution flow; read
        the input descriptions for details."
      id: 1f1f6c4f-2c50-4d41-8668-5dc0e95b2e21
      iscommand: false
      name: Cortex XDR - Endpoint Investigation
      playbookId: Cortex XDR - Endpoint Investigation
      type: playbook
      version: -1
    taskid: 1f1f6c4f-2c50-4d41-8668-5dc0e95b2e21
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 2390,
          "y": 1660
        }
      }
  "147":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.EarlyContainment
          operator: isEqualString
          right:
            value:
              simple: "true"
      label: "yes"
    continueonerrortype: ""
    id: "147"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "112"
      "yes":
      - "128"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether early containment is enabled for this playbook before
        executing containment.
      id: 47ee517a-0c40-412c-8994-ee0c69ccc564
      iscommand: false
      name: Early containment enabled?
      type: condition
      version: -1
    taskid: 47ee517a-0c40-412c-8994-ee0c69ccc564
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 860
        }
      }
  "149":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.Initiator_Process_SHA256
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "149"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "151"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether a process initiated the port scanning activity.
      id: 57d07af1-54fd-433d-884d-eded8e8f2453
      iscommand: false
      name: Was port scanning initiated by a process?
      type: condition
      version: -1
    taskid: 57d07af1-54fd-433d-884d-eded8e8f2453
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 960,
          "y": -690
        }
      }
  "150":
    continueonerrortype: ""
    id: "150"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      forEach: true
      iscommand: false
      max: 100
      wait: 10
    nexttasks:
      '#none#':
      - "109"
    note: false
    quietmode: 0
    scriptarguments:
      SHA256:
        complex:
          root: inputs.Initiator_Process_SHA256
      UseReputationCommand:
        simple: "True"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Enrich a file using one or more integrations.

        - Provide threat information
      id: a53126c1-bd98-4d1f-86c1-c75c8191f164
      iscommand: false
      name: File Enrichment - Generic v2
      playbookId: File Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: a53126c1-bd98-4d1f-86c1-c75c8191f164
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 790,
          "y": -390
        }
      }
  "151":
    continueonerrortype: ""
    id: "151"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "150"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5294a392-a72d-458e-8f90-41b73cc394b7
      iscommand: false
      name: File Enrichment
      type: title
      version: -1
    taskid: 5294a392-a72d-458e-8f90-41b73cc394b7
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 790,
          "y": -520
        }
      }
  "152":
    continueonerrortype: ""
    id: "152"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "179"
      - "177"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 78a08737-3646-48d0-8857-8fd5688dbd67
      iscommand: false
      name: Remediation
      type: title
      version: -1
    taskid: 78a08737-3646-48d0-8857-8fd5688dbd67
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 3315
        }
      }
  "157":
    continueonerrortype: ""
    fieldMapping:
    - incidentfield: Scan Source Type
      output:
        complex:
          accessor: InRange
          root: IP
          transformers:
          - args:
              condition:
                value:
                  simple: lhs==rhs
              conditionB: {}
              conditionInBetween: {}
              else:
                value:
                  simple: External
              equals: {}
              lhs:
                iscontext: true
                value:
                  simple: IP.InRange
              lhsB: {}
              options: {}
              optionsB: {}
              rhs:
                value:
                  simple: "yes"
              rhsB: {}
              then:
                value:
                  simple: Internal
            operator: If-Then-Else
    id: "157"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "162"
    note: false
    quietmode: 0
    scriptarguments:
      ip:
        complex:
          root: inputs.SrcIPAddress
          transformers:
          - operator: uniq
      ipRanges:
        complex:
          root: inputs.InternalIPRanges
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Returns yes if the IP is in one of the ranges provided, returns
        no otherwise.
      id: 5ad713e5-65eb-41d6-8c32-5689246a9154
      iscommand: false
      name: Check if attacker IP is within Internal Range
      script: IsIPInRanges
      type: regular
      version: -1
    taskid: 5ad713e5-65eb-41d6-8c32-5689246a9154
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2460,
          "y": -90
        }
      }
  "158":
    continueonerrortype: ""
    id: "158"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "193"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 3c0af0f3-57e5-4652-8049-80bf8b1c26fb
      iscommand: false
      name: Source IP & Host Enrichment
      type: title
      version: -1
    taskid: 3c0af0f3-57e5-4652-8049-80bf8b1c26fb
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2460,
          "y": -550
        }
      }
  "162":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: InRange
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: IP.Address
                    operator: isEqualString
                    right:
                      iscontext: true
                      value:
                        simple: inputs.SrcIPAddress
                root: IP
          operator: isEqualString
          right:
            value:
              simple: "yes"
      label: Internal
    continueonerrortype: ""
    id: "162"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "109"
      Internal:
      - "163"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether the attacker IP address is internal or external.
      id: 46359a0e-6f65-43b8-8918-ebda6309a008
      iscommand: false
      name: Attacker IP is Internal or External?
      type: condition
      version: -1
    taskid: 46359a0e-6f65-43b8-8918-ebda6309a008
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 2460,
          "y": 70
        }
      }
  "163":
    continueonerrortype: ""
    id: "163"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "168"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9cc404c8-b73f-4203-845f-1046fe3bca07
      iscommand: false
      name: Internal Source IP
      type: title
      version: -1
    taskid: 9cc404c8-b73f-4203-845f-1046fe3bca07
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2670,
          "y": 240
        }
      }
  "168":
    continueonerrortype: ""
    id: "168"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "169"
    note: false
    quietmode: 0
    scriptarguments:
      contextKey:
        simple: Time
      dateFormat:
        simple: UTC
      daysAgo:
        simple: "3"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Retrieves the current date and time.
      id: 77cf6729-2a97-4ada-888a-9b9c4072fb74
      iscommand: false
      name: Get time
      script: GetTime
      type: regular
      version: -1
    taskid: 77cf6729-2a97-4ada-888a-9b9c4072fb74
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2670,
          "y": 375
        }
      }
  "169":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: first_seen
                root: PaloAltoNetworksXDR.Endpoint
          operator: isAfter
          right:
            iscontext: true
            value:
              complex:
                root: Time
      label: "yes"
    continueonerrortype: ""
    id: "169"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "170"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Checks whether the source endpoint is new on the network\nNew
        endpoints that use multiple ports can cause a false positive port scan alerts. "
      id: ab3b62a3-b0c8-430b-8cec-426a60f660d5
      iscommand: false
      name: Source endpoint is new?
      type: condition
      version: -1
    taskid: ab3b62a3-b0c8-430b-8cec-426a60f660d5
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 2670,
          "y": 540
        }
      }
  "170":
    continueonerrortype: ""
    id: "170"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "180"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 92e84ec7-6773-4e5d-8eac-f2775eca8cdc
      iscommand: false
      name: False Positive
      type: title
      version: -1
    taskid: 92e84ec7-6773-4e5d-8eac-f2775eca8cdc
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2670,
          "y": 720
        }
      }
  "176":
    continueonerrortype: ""
    id: "176"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "194"
    note: false
    quietmode: 0
    scriptarguments:
      Commandline:
        complex:
          root: inputs.Initiator_CMD
          transformers:
          - operator: uniq
      StringSimilarityThreshold:
        simple: "0.5"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: "This playbook takes a command line from the alert and performs
        the following actions:\n- Checks for base64 string and decodes if exists\n-
        Extracts and enriches indicators from the command line\n- Checks specific
        arguments for malicious usage \n\nAt the end of the playbook, it sets a possible
        verdict for the command line, based on the finding:\n1. Indicators found in
        the command line\n2. Found AMSI techniques\n3. Found suspicious parameters\n4.
        Usage of malicious tools\n5. Indication of network activity\n6. Indication
        of suspicious LOLBIN execution\n\nNote: In case you are wishing to run this
        playbook with a list of command lines, set this playbook to be running in
        a loop. To do so, navigate to the 'Loop'  and check \"For Each Input\"."
      id: d9581aa7-edf0-4159-8913-dbe1b9578028
      iscommand: false
      name: Command-Line Analysis
      playbookId: Command-Line Analysis
      type: playbook
      version: -1
    taskid: d9581aa7-edf0-4159-8913-dbe1b9578028
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1180,
          "y": 1660
        }
      }
  "177":
    continueonerrortype: ""
    id: "177"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "180"
    note: false
    quietmode: 0
    scriptarguments:
      AutoBlockIndicators:
        complex:
          root: inputs.AutoBlockIndicators
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      DomainToBlock:
        complex:
          accessor: Indicator
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: domain
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      EmailToBlock:
        complex:
          accessor: Indicator
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: email
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      FilesToBlock:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: notIn
              right:
                iscontext: true
                value:
                  simple: IndicatorsToBlock
          root: DBotScore.Indicator
          transformers:
          - operator: uniq
      IP:
        complex:
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: ip
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: notIn
              right:
                iscontext: true
                value:
                  simple: IndicatorsToBlock
          root: DBotScore.Indicator
          transformers:
          - operator: uniq
      InputEnrichment:
        simple: "True"
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
            - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: hash
          root: DBotScore.Indicator
          transformers:
          - operator: uniq
      RuleDirection:
        simple: inbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: file
            - left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: hash
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Indicator
              operator: notIn
              right:
                iscontext: true
                value:
                  simple: IndicatorsToBlock
          root: DBotScore.Indicator
          transformers:
          - operator: uniq
      URL:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: url
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |+
        This playbook blocks malicious indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic v2
        - Block Account - Generic v2
        - Block IP - Generic v3
        - Block File - Generic v2
        - Block Email - Generic v2
        - Block Domain - Generic v2

      id: b9ead119-ed52-4d06-86ac-2b8fdc058fbb
      iscommand: false
      name: Block Indicators - Generic v3
      playbookId: Block Indicators - Generic v3
      type: playbook
      version: -1
    taskid: b9ead119-ed52-4d06-86ac-2b8fdc058fbb
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 2007.5,
          "y": 3460
        }
      }
  "178":
    continueonerrortype: ""
    id: "178"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "180"
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_id:
        complex:
          root: inputs.EndpointID
          transformers:
          - operator: uniq
      hostname:
        complex:
          root: inputs.SrcHostname
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: This playbook accepts an XDR endpoint ID and isolates it using
        the 'Palo Alto Networks Cortex XDR - Investigation and Response' integration.
      id: 00f2a63f-7fff-4891-8571-7708001fd21c
      iscommand: false
      name: Cortex XDR - Isolate Endpoint
      playbookId: Cortex XDR - Isolate Endpoint
      type: playbook
      version: -1
    taskid: 00f2a63f-7fff-4891-8571-7708001fd21c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1600,
          "y": 3630
        }
      }
  "179":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.AutoIsolateEndpoint
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "179"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "180"
      "yes":
      - "178"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determine whether the endpoint should be isolated automatically.
      id: 63bce0cf-ac43-421c-8961-83597c546d03
      iscommand: false
      name: Endpoint auto-isolation enabled?
      type: condition
      version: -1
    taskid: 63bce0cf-ac43-421c-8961-83597c546d03
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1600,
          "y": 3460
        }
      }
  "180":
    continueonerrortype: ""
    id: "180"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b20f1501-ea86-4987-86a8-1884b8155fdd
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: b20f1501-ea86-4987-86a8-1884b8155fdd
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2670,
          "y": 3800
        }
      }
  "192":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.Username
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "192"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "194"
      "yes":
      - "135"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: 'Checks whether an initiator username is available for investigation. '
      id: a601b414-67f1-4d3e-8745-6ee65383bf27
      iscommand: false
      name: Has user to investigate?
      type: condition
      version: -1
    taskid: a601b414-67f1-4d3e-8745-6ee65383bf27
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1580,
          "y": 1660
        }
      }
  "193":
    continueonerrortype: ""
    id: "193"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "197"
    note: false
    quietmode: 0
    scriptarguments:
      IP:
        complex:
          root: inputs.SrcIPAddress
          transformers:
          - operator: uniq
      InternalRange:
        complex:
          root: inputs.InternalIPRanges
          transformers:
          - operator: uniq
      ResolveIP:
        simple: "True"
      UseReputationCommand:
        simple: "True"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Enrich IP addresses using one or more integrations.

        - Resolve IP addresses to hostnames (DNS)
        - Provide threat information
        - Separate internal and external IP addresses
        - For internal IP addresses, get host information
      id: 721621fc-6135-4483-85e5-4657c8dfab13
      iscommand: false
      name: IP Enrichment - Generic v2
      playbookId: IP Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: 721621fc-6135-4483-85e5-4657c8dfab13
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 2460,
          "y": -420
        }
      }
  "194":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Alert
                root: PaloAltoNetworksXDR
          operator: isNotEmpty
          right:
            value: {}
        - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: RelatedAttackPatterns
                transformers:
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: RelatedCampaign
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: RelatedReport
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: RelatedFiles
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: RelatedDomains
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: RelatedIPs
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: RelatedURLs
                  operator: append
          operator: isNotEmpty
        - left:
            iscontext: true
            value:
              complex:
                root: NumOfSiemFailedLogon
                transformers:
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: NumOfThreatLogs
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: ArraySize
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: NumOfOktaSuspiciousActivities
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: NumOfOktaSuspiciousUserAgent
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: NumOfOktaFailedLogon
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: AzureFailedLogonLogs
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: PaloAltoNetworksXDR.Alert
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: QRadar.Search.Result
                  operator: append
                - args:
                    item:
                      iscontext: true
                      value:
                        simple: Splunk.Result
                  operator: append
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "194"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "180"
      "yes":
      - "195"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether any results have been obtained from the investigation
        stage.
      id: fcb2421a-017b-4034-8ce4-a9ec5f97394e
      iscommand: false
      name: Found investigation results?
      type: condition
      version: -1
    taskid: fcb2421a-017b-4034-8ce4-a9ec5f97394e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 1990
        }
      }
  "195":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: action_local_port
                root: PaloAltoNetworksXDR.Alert
                transformers:
                - operator: uniq
          operator: in
          right:
            iscontext: true
            value:
              complex:
                root: inputs.DstPort
      label: "yes"
    continueonerrortype: ""
    id: "195"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "140"
      "yes":
      - "196"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Verifies whether the scanned ports are involved in any XDR alerts
        obtained from the investigation stage.
      id: 0c4c888e-8700-4ac8-8d47-e228bcda763b
      iscommand: false
      name: Found XDR alerts that involve the scanned ports?
      type: condition
      version: -1
    taskid: 0c4c888e-8700-4ac8-8d47-e228bcda763b
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1790,
          "y": 2170
        }
      }
  "196":
    continueonerrortype: ""
    id: "196"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "140"
    note: false
    quietmode: 0
    scriptarguments:
      severity:
        simple: "3"
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 9569d6ed-4218-47d0-8bb0-965981759edf
      iscommand: true
      name: Raise incident severity
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 9569d6ed-4218-47d0-8bb0-965981759edf
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1410,
          "y": 2340
        }
      }
  "197":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.InternalIPRanges
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "197"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "157"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 19efd50e-a23c-466c-8e90-7facf5ffe2ab
      iscommand: false
      name: Is InternalIPRanges exist
      type: condition
      version: -1
    taskid: 19efd50e-a23c-466c-8e90-7facf5ffe2ab
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 2460,
          "y": -250
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "103_109_#default#": 0.11,
      "128_112_#default#": 0.14,
      "141_152_#default#": 0.53,
      "143_144_yes": 0.48,
      "143_152_#default#": 0.52,
      "149_109_#default#": 0.1,
      "162_109_#default#": 0.15,
      "162_163_Internal": 0.48,
      "169_109_#default#": 0.3,
      "169_170_yes": 0.57,
      "179_180_#default#": 0.25,
      "194_180_#default#": 0.36,
      "194_195_yes": 0.49,
      "195_140_#default#": 0.47
    },
    "paper": {
      "dimensions": {
        "height": 4825,
        "width": 2260,
        "x": 790,
        "y": -960
      }
    }
  }
