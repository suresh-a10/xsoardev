category: Data Enrichment & Threat Intelligence
commonfields:
  id: RecordedFuturePlaybookAlerts_custom
  version: -1
configuration:
- defaultvalue: https://api.recordedfuture.com/gw/xsoar/
  display: API URL (e.g., https://api.recordedfuture.com/gw/xsoar/)
  name: server_url
  required: true
  type: 0
- display: ""
  displaypassword: API Token
  hiddenusername: true
  name: token
  required: true
  type: 9
- display: Trust any certificate (not secure)
  name: unsecure
  required: false
  type: 8
- display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- additionalinfo: 'Limit incidents to include in the first fetch by time range. Input
    format: "NN hours" or "NN days". E.g., input "5 days" to fetch all incidents created
    in the last 5 days.'
  defaultvalue: 24 hours
  display: 'First Incidient Fetch: Time Range'
  name: first_fetch
  required: false
  type: 0
- additionalinfo: Some listed Playbook alert Categories might be unavailable due to
    limitations in the current Recorded Future subscription
  defaultvalue: All Available
  display: 'Playbook Alerts: Fetched Categories'
  name: pa_categories
  options:
  - All Available
  - Domain Abuse
  - Vulnerability
  - Code Repo Leakage
  required: false
  type: 16
- defaultvalue: "50"
  display: Maximum number of incidents per fetch
  name: max_fetch
  required: false
  type: 0
- defaultvalue: New
  display: 'Playbook Alerts: Fetched Statuses'
  name: pa_statuses
  options:
  - New
  - In Progress
  - Dismissed
  - Resolved
  required: false
  type: 16
- additionalinfo: Returns alerts with this selected priority or higher. High > Moderate
    > Informational
  defaultvalue: Moderate
  display: 'Playbook Alerts: Fetched Priorities Threshold'
  name: pa_priorities
  options:
  - High
  - Moderate
  - Informational
  required: false
  type: 15
- defaultvalue: Recorded Future Playbook Alert
  display: Incident type
  name: incidentType
  required: false
  type: 13
- defaultvalue: "1"
  display: Incidents Fetch Interval
  name: incidentFetchInterval
  required: false
  type: 19
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: Fetch & triage Recorded Future Playbook Alerts
detaileddescription: "### Partner Contributed Integration\n#### Integration Author:
  Recorded Future\nSupport and maintenance for this integration are provided by the
  author. Please use the following contact details:\n- **Email**: [support@recordedfuture.com](mailto:support@recordedfuture.com)\n-
  **URL**: [https://www.recordedfuture.com/support/demisto-integration/](https://www.recordedfuture.com/support/demisto-integration/)\n***\n##
  Information  \nA valid API Token for XSOAR from Recorded Future needed to fetch
  information.\n[Get help with Recorded Future for Cortex XSOAR](https://www.recordedfuture.com/support/demisto-integration/).
  \ \n\n**Version:** 1.0.0\n\n---\n\n## Configuration\n| Parameter                                      |
  Description                                                                                                                                                                                                                                 |\n|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|
  Server URL                                     | The URL to the Recorded Future
  ConnectAPI.                                                                                                                                                                                                  |\n|
  API Token                                      | Valid API Token from Recorded Future.
  \                                                                                                                                                                                                      |\n|
  Classifier                                     | Select \"Recorded Future Playbook
  Alert Classifier\".                                                                                                                                                                                                      |\n|
  Mapper (Incoming)                              | Select \"Recorded Future Playbook
  Alert Mapper\".                                                                                                                                                                                                  
  \                                                                                                           |\n|
  Trust any certificate (not secure)             | -                                                                                                                                                  \n|
  Use system proxy settings                      | -                                                                                                                                                                                                                                           |\n|
  First incident fetch: Time range | Limit incidents to include in the first fetch
  by time range. Input format: \"NN hours\" or \"NN days\". E.g., input \"5 days\"
  to fetch all incidents created in the last 5 days.                                                                                         |\n|
  Playbook Alerts: Fetched Categories                               | Some listed
  Alert Categories may be unavailable due to limitations in the current Recorded Future
  subscription. The \"All Available\" option will fetch Playbook Alerts of all types
  that are available to the specific token                                   |\n|
  Playbook Alerts: Fetched Statuses       | Choose what statuses that is included
  in the fetch (New, In Progress, Dismissed. Resolved) |\n| Playbook Alerts: Fetched
  Priorites Threshold                   | Choose the threshold of which priorites
  are fetched (Informational < Moderate < High)                                                                                                                                                                                                                                           |\n|
  Maximum number of incidents per fetch          | Limits the number of returned incidents
  per fetch                                                                                                                                                                                                                                          |\n|
  Incidents Fetch Interval                       | Choose the interval of polling
  for updated alerts                                                                                                                                                                                                                                           |\n---\n\n##
  Available Actions\n* Search action\n  * Search and filter Playbook alerts from Recorded
  Future to find what is available\n  * Searches for the last 24 hours by default\n*
  Details action\n  * Provide a Playbook alert id and retrieve the details of that
  alert\n* Update action\n  * Update the status of Playbook alerts in Recorded Future\n\nCopyright
  2020-2023 Recorded Future, Inc.\n\n\n---\n[View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/recorded-future-playbook-alerts)"
display: RecordedFuturePlaybookAlerts_custom
image: data:image/png;base64,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
name: RecordedFuturePlaybookAlerts_custom
script:
  commands:
  - arguments:
    - description: Ids of the playbook alert that should be fetched
      name: alert_ids
      required: true
    - auto: PREDEFINED
      description: What evidence sections to include in the fetch, fetches all available
        if not specified
      name: detail_sections
      predefined:
      - status
      - action
      - summary
      - log
      - whois
      - dns
    description: Get Playbook alert details by id.
    name: recordedfuture-playbook-alerts-details
    outputs:
    - contextPath: RecordedFuture.PlaybookAlerts.playbook_alert_id
      description: Unique id of the playbook alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.category
      description: Playbook alert category
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.priority
      description: Recommended Priority of the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.status
      description: Current alert status in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.title
      description: Title of the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.updated
      description: Date of last update
      type: date
    - contextPath: RecordedFuture.PlaybookAlerts.created
      description: Date of creation
      type: date
    - contextPath: RecordedFuture.PlaybookAlerts.organization_id
      description: Organization uhash
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.organization_name
      description: Plaintext Organization name
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.assignee_id
      description: uhash of the assigned user
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.assignee_name
      description: name of the assigned user
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.owner_id
      description: uhash of the enterprise that owns the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.owner_name
      description: Name of the enterprise that owns the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.playbook_alert_id
      description: Unique id of the playbook alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.category
      description: Playbook alert category
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.priority
      description: Recommended Priority of the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.status
      description: Current alert status in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.title
      description: Title of the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.updated
      description: Date of last update
      type: date
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.created
      description: Date of creation
      type: date
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.organization_id
      description: Organization uhash
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.organization_name
      description: Plaintext Organization name
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.assignee_id
      description: uhash of the assigned user
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.assignee_name
      description: name of the assigned user
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.owner_id
      description: uhash of the enterprise that owns the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.owner_name
      description: Name of the enterprise that owns the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.case_rule_id
      description: Id of the playbook alert category
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.case_rule_label
      description: Name of the playbook alert category
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.context_list.context
      description: Context of entity connected to the Playbook alert.
      type: Array
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.created
      description: Date marking the creation of the Playbook alert in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.entity_criticality
      description: Criticality of the Playbook alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.entity_id
      description: Id of the entity in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.entity_name
      description: Name of the entity
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.risk_score
      description: Risk score of the entity in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.targets
      description: List of targets of the Playbook alert
      type: Array
    - contextPath: RecordedFuture.PlaybookAlerts.panel_status.lifecycle_stage
      description: Indicates what lifecycle the vulerability is in
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.explanation
      description: Entails the explanation to the triggering of the Playbook alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.resolved_record_list.context_list.context
      description: Context of entity connected to the Playbook alert.
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.resolved_record_list.criticality
      description: Level of criticality
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.resolved_record_list.entity
      description: ID of the entitiy in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.resolved_record_list.record_type
      description: Type of record A, CNAME or MX
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.resolved_record_list.risk_score
      description: Risk score of the entity in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.screenshots.description
      description: Description of the image
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.screenshots.image_id
      description: ID of the screenshot in recorded future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.screenshots.tag
      description: Image Analisys tag
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.screenshots.created
      description: When the image was created
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.screenshots.base64
      description: The image binary encoded as a base64 string
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.summary.targets.name
      description: Target affected by the vulnerability
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.summary.lifecycle_stage
      description: The current lifecycle stage of the Playbook Alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.summary.riskrules.rule
      description: Name of the rule that triggered
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.summary.riskrules.description
      description: Short description of the trigger (E.g 13 sightings on 1 source..)
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.affected_products.name
      description: Name of of affected product
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.insikt_notes.id
      description: The id of the Insikt note
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.insikt_notes.title
      description: The title of the Insikt note
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.insikt_notes.topic
      description: The topic of the Insikt note
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.insikt_notes.published
      description: The time at which the Insikt note was published
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_summary.insikt_notes.fragment
      description: A fragment of the Insikt note text
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.id
      description: Log id in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.actor_id
      description: Id of the actor
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.created
      description: When was the log created
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.modified
      description: When was the log last modified
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.action_priority
      description: The priority of the Playbook alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.message
      description: Log message
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.assigne_change.old
      description: Previous assignee
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.assigne_change.new
      description: New assignee
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.assigne_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.status_change.old
      description: Previous status
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.status_change.new
      description: New status
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.status_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.title_change.old
      description: Previous title
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.title_change.new
      description: New title
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.title_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.priority_change.old
      description: Previous priority
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.priority_change.new
      description: New priority
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.priority_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.reopen_strategy_change.old
      description: Previous reopen strategy
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.reopen_strategy_change.new
      description: New reopen strategy
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.reopen_strategy_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.entities_change.removed
      description: Removed entity
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.entities_change.added
      description: Added entity
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.entities_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.related_entities_change.removed
      description: Removed related entity
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.related_entities_change.added
      description: Added related entity
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.related_entities_changetype
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.description_change.old
      description: Previous description
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.description_change.new
      description: New description
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.description_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.external_id_change.old
      description: Previous external ID
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.external_id_change.new
      description: New external ID
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_log.changes.external_id_change.type
      description: Type of change
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_action.action
      description: The name of the action
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_action.updated
      description: When was the action last updated
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_action.assignee_name
      description: Full name of the assignee
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_action.assignee_id
      description: ID of the assignee
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_action.status
      description: The status of the action
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_action.description
      description: A short description of the action
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_action.link
      description: A link associated with the action
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ip_list.record
      description: The DNS record
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ip_list.risk_score
      description: Risk score associated with the record
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ip_list.criticality
      description: The level of criticality
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ip_list.record_type
      description: Type of record A, CNAME or MX
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ip_list.context_list.context
      description: Labels of malicious behavior types that can be associated with
        an entity.
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.mx_list.record
      description: The DNS record
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.mx_list.risk_score
      description: Risk score associated with the record
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.mx_list.criticality
      description: The level of criticality
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.mx_list.record_type
      description: Type of record A, CNAME or MX
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.mx_list.context_list.context
      description: Labels of malicious behavior types that can be associated with
        an entity.
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ns_list.record
      description: The DNS record
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ns_list.risk_score
      description: Risk score associated with the record
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ns_list.criticality
      description: The level of criticality
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ns_list.record_type
      description: Type of record A, CNAME or MX
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_dns.ns_list.context_list.context
      description: Labels of malicious behavior types that can be associated with
        an entity.
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.added
      description: When the whois information was added
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.attribute
      description: Attribute, either whois or whoisContancts
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.entity
      description: Id of whois entity
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.provider
      description: Name of provider
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.createdDate
      description: When was it created
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.nameServers
      description: List of name server IDs
      type: Array
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.privateRegistration
      description: Boolean indicating private registration
      type: Bool
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.registrarName
      description: Name of the registrar
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.status
      description: Status of registrar
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.city
      description: Contact located in this city
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.country
      description: Contact located in this city
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.name
      description: Name of contact
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.organization
      description: Name of contact organization
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.postalCode
      description: Postal code of contact organization
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.state
      description: Contact located in state
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.street1
      description: Street name of contact
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.telephone
      description: Phone number of contact
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.panel_whois.body.value.type
      description: Type of contact
      type: String
  - arguments:
    - description: Ids of the playbook alerts that will be updated
      name: alert_ids
      required: true
    - auto: PREDEFINED
      description: New status to set for all alerts in alert_ids
      name: new_status
      predefined:
      - new
      - in-progress
      - dismissed
      - resolved
      required: true
    description: Update the status of one or multiple Playbook alerts
    name: recordedfuture-playbook-alerts-update
    outputs:
    - contextPath: RecordedFuture.PlaybookAlerts.playbook_alert_id
      description: Unique id of the playbook alert in Recorded Future
      type: string
    - contextPath: RecordedFuture.PlaybookAlerts.current_status
      description: Current status of playbook alert in Recorded Future
      type: string
    - contextPath: RecordedFuture.PlaybookAlerts.title
      description: Title of the playbook alert in Recorded Future
      type: string
    - contextPath: RecordedFuture.PlaybookAlerts.status_message
      description: Message describing the outcome of the update
      type: string
  - arguments:
    - auto: PREDEFINED
      description: filter what playbook alert categories that is wanted. (default
        = all available)
      name: category
      predefined:
      - all_available
      - domain_abuse
      - vulnerability
      - code_repo_leakage
    - description: Limits the number of alerts to fetch.
      name: limit
    - description: Time between now and e.g. "2 hours" or "7 days" ago
      name: time_since_update
    - auto: PREDEFINED
      description: Filter what statuses are fetched, defaults to only new status if
        not specified.
      name: playbook_alert_status
      predefined:
      - new
      - in-progress
      - dismissed
      - resolved
    - auto: PREDEFINED
      description: Actions pritority assigned in Recorded Future
      name: priority
      predefined:
      - high
      - moderate
      - informational
    - auto: PREDEFINED
      description: Actions pritority assigned in Recorded Future
      name: order_search_by
      predefined:
      - updated
      - created
    description: Search playbook alerts based on filters
    name: recordedfuture-playbook-alerts-search
    outputs:
    - contextPath: RecordedFuture.PlaybookAlerts.playbook_alert_id
      description: Unique id of the playbook alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.category
      description: Playbook alert category
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.priority
      description: Recommended Priority of the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.status
      description: Current alert status in Recorded Future
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.title
      description: Title of the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.updated
      description: Date of last update
      type: date
    - contextPath: RecordedFuture.PlaybookAlerts.created
      description: Date of creation
      type: date
    - contextPath: RecordedFuture.PlaybookAlerts.organization_id
      description: Organization uhash
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.organization_name
      description: Plaintext Organization name
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.assignee_id
      description: uhash of the assigned user
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.assignee_name
      description: name of the assigned user
    - contextPath: RecordedFuture.PlaybookAlerts.owner_id
      description: uhash of the enterprise that owns the alert
      type: String
    - contextPath: RecordedFuture.PlaybookAlerts.owner_name
      description: Name of the enterprise that owns the alert
      type: String
  dockerimage: demisto/python3:3.10.12.63474
  isfetch: true
  runonce: false
  script: |
    register_module_line('RecordedFuturePlaybookAlerts', 'start', __line__())
    ### pack version: 1.6.2
    """Recorded Future Playbook alerts Integration for Demisto."""

    import platform
    import json
    import base64

    # flake8: noqa: F402,F405 lgtm



    STATUS_TO_RETRY = [500, 501, 502, 503, 504]

    # disable insecure warnings
    requests.packages.urllib3.disable_warnings()  # type: ignore

    __version__ = '1.0.1'


    # === === === === === === === === === === === === === === ===
    # === === === === Recorded Future API Client === === === ====
    # === === === === === === === === === === === === === === ===


    class Client(BaseClient):
        def whoami(self) -> Dict[str, Any]:

            return self._http_request(
                method='get',
                url_suffix='info/whoami',
                timeout=60,
            )

        def _call(self, url_suffix, **kwargs):

            json_data = {
                'demisto_command': demisto.command(),
                'demisto_args': demisto.args(),
            }
            if 'demisto_args' in kwargs.keys():
                if args := kwargs.get('demisto_args'):
                    json_data.update({'demisto_args': args})
                kwargs.pop('demisto_args')

            method = kwargs.get('method', 'post')

            request_kwargs = {
                'method': method,
                'url_suffix': url_suffix,
                'json_data': json_data,
                'timeout': 90,
                'retries': 3,
                'status_list_to_retry': STATUS_TO_RETRY,
            }

            request_kwargs.update(kwargs)

            try:
                response = self._http_request(**request_kwargs)

                if isinstance(response, dict) and response.get('return_error'):
                    # This will raise the Exception or call "demisto.results()" for the error and sys.exit(0).
                    return_error(**response['return_error'])

            except DemistoException as err:
                if '404' in str(err):
                    return CommandResults(
                        outputs_prefix='',
                        outputs=dict(),
                        raw_response=dict(),
                        readable_output='No results found.',
                        outputs_key_field='',
                    )
                else:
                    raise err

            return response

        def fetch_incidents(self) -> Dict[str, Any]:
            """Fetch incidents."""
            return self._call(
                url_suffix=f'/v2/playbook_alert/fetch',
                json_data={
                    'demisto_command': demisto.command(),
                    'demisto_args': demisto.args(),
                    'demisto_params': demisto.params(),
                    'demisto_last_run': demisto.getLastRun(),
                },
                timeout=120,
            )

        #######################################################
        ################## Playbook alerts ####################
        #######################################################

        def details_playbook_alerts(self) -> Dict[str, Any]:
            parsed_args = demisto.args()
            if alert_ids := parsed_args.get('alert_ids'):
                parsed_args['alert_ids'] = alert_ids.split(",")
            if sections := parsed_args.get('detail_sections'):
                parsed_args["detail_sections"] = sections.split(",")
            """Get details of a playbook alert"""
            return self._call(
                url_suffix='/v2/playbook_alert/lookup', demisto_args=parsed_args
            )

        def update_playbook_alerts(self) -> Dict[str, Any]:
            parsed_args = demisto.args()
            if ids := parsed_args.get('alert_ids'):
                parsed_args["alert_ids"] = ids.split(",")
            return self._call(
                url_suffix='/v2/playbook_alert/update', demisto_args=parsed_args
            )

        def search_playbook_alerts(self) -> Dict[str, Any]:
            parsed_args = demisto.args()
            if categories := parsed_args.get('category'):
                parsed_args["category"] = categories.split(",")
            if statuses := parsed_args.get('playbook_alert_status'):
                parsed_args["playbook_alert_status"] = statuses.split(",")
            return self._call(
                url_suffix='/v2/playbook_alert/search', demisto_args=parsed_args
            )


    # === === === === === === === === === === === === === === ===
    # === === === === === === ACTIONS === === === === === === ===
    # === === === === === === === === === === === === === === ===


    class Actions:
        def __init__(self, rf_client: Client):
            self.client = rf_client

        def _process_result_actions(
            self, response: Union[dict, CommandResults]
        ) -> List[CommandResults]:

            if isinstance(response, CommandResults):
                # Case when we got 404 on response, and it was processed in self.client._call() method.
                return [response]
            elif not isinstance(response, dict):
                # In case API returned a str - we don't want to call "response.get()" on a str object.
                return None  # type: ignore

            result_actions: Union[List[dict], None] = response.get('result_actions')

            if not result_actions:
                return None  # type: ignore

            command_results: List[CommandResults] = list()
            for action in result_actions:
                if 'CommandResults' in action:
                    command_results.append(CommandResults(**action['CommandResults']))

            return command_results

        def fetch_incidents(self) -> None:

            response = self.client.fetch_incidents()

            if isinstance(response, CommandResults):
                # 404 case.
                return

            for _key, _val in response.items():
                if _key == 'demisto_last_run':
                    demisto.setLastRun(_val)
                if _key == 'incidents':
                    for incident in _val:
                        attachments = list()
                        incident_json = json.loads(incident.get("rawJSON", "{}"))
                        if incident_json.get("panel_evidence_summary", {}).get(
                            "screenshots"
                        ):
                            for screenshot_data in incident_json["panel_evidence_summary"][
                                "screenshots"
                            ]:
                                file_name = f'{screenshot_data.get("image_id", "").replace("img:","")}.png'
                                file_data = screenshot_data.get("base64", "")
                                file = fileResult(file_name, base64.b64decode(file_data))
                                attachment = {
                                    "description": screenshot_data.get('description'),
                                    "name": file.get("File"),
                                    "path": file.get("FileID"),
                                    "showMediaFile": True,
                                }
                                attachments.append(attachment)
                            incident['attachment'] = attachments

                    demisto.incidents(_val)

            #######################################################
            ################## Playbook alerts ####################
            #######################################################

        def playbook_alert_details_command(self) -> List[CommandResults]:
            response = self.client.details_playbook_alerts()
            return self._process_result_actions(response=response)

        def playbook_alert_update_command(self) -> List[CommandResults]:
            response = self.client.update_playbook_alerts()
            return self._process_result_actions(response=response)

        def playbook_alert_search_command(self) -> List[CommandResults]:
            response = self.client.search_playbook_alerts()
            return self._process_result_actions(response=response)


    # === === === === === === === === === === === === === === ===
    # === === === === === === === MAIN === === === === === === ==
    # === === === === === === === === === === === === === === ===


    def main() -> None:
        """Main method used to run actions."""
        try:
            demisto_params = demisto.params()
            base_url = demisto_params.get('server_url', '').rstrip('/')
            verify_ssl = not demisto_params.get('unsecure', False)
            proxy = demisto_params.get('proxy', False)

            headers = {
                'X-RFToken': demisto_params['token'].get('password'),
                'X-RF-User-Agent': (
                    f'RecordedFuturePlaybookAlerts.py/{__version__} ({platform.platform()}) '
                    f'XSOAR/{__version__} '
                    f'RFClient/{__version__} (Cortex_XSOAR_{demisto.demistoVersion()["version"]})'
                ),
            }
            client = Client(
                base_url=base_url, verify=verify_ssl, headers=headers, proxy=proxy
            )
            command = demisto.command()
            actions = Actions(client)

            if command == 'test-module':
                # This is the call made when pressing the integration Test button.
                # Returning 'ok' indicates that the integration works like it suppose to and
                # connection to the service is successful.
                # Returning 'ok' will make the test result be green.
                # Any other response will make the test result be red.

                try:
                    client.whoami()
                    return_results('ok')
                except Exception as err:
                    message = str(err)
                    try:
                        error = json.loads(str(err).split('\n')[1])
                        if 'fail' in error.get('result', dict()).get('status', ''):
                            message = error.get('result', dict())['message']
                    except Exception:
                        message = (
                            'Unknown error. Please verify that the API'
                            f' URL and Token are correctly configured. RAW Error: {err}'
                        )
                    raise DemistoException(f'Failed due to - {message}')

            elif command == 'fetch-incidents':
                actions.fetch_incidents()

            #######################################################
            ################## Playbook alerts ####################
            #######################################################

            elif command == 'recordedfuture-playbook-alerts-details':
                return_results(actions.playbook_alert_details_command())

            elif command == 'recordedfuture-playbook-alerts-update':
                return_results(actions.playbook_alert_update_command())

            elif command == 'recordedfuture-playbook-alerts-search':
                return_results(actions.playbook_alert_search_command())

        except Exception as e:
            return_error(message=f'Failed to execute {demisto.command()} command: {str(e)}')


    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()

    register_module_line('RecordedFuturePlaybookAlerts', 'end', __line__())
  subtype: python3
  type: python
sourcemoduleid: RecordedFuturePlaybookAlerts
