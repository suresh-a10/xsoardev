args:
- auto: PREDEFINED
  description: The new value of the field that was changed.
  name: new
  predefined:
  - Low
  - Medium
  - High
  - Critical
comment: |-
  Changes the remediation SLA once a change in incident severity occurs.
  This is done automatically and the changes can be configured to your needs.
commonfields:
  id: 4833cabe-ef3f-467b-86a4-65dec43bcd96
  version: -1
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
enabled: true
engineinfo: {}
mainengineinfo: {}
name: updateResponseSLAOnSevChange
pswd: ""
runas: DBotRole
runonce: false
script: |+
  import datetime

  # ##### Response Configuration #####
  CRITICAL_SLA = 15  # In minutes
  High_SLA = 30 # In minutes
  Medium_SLA = 60 # In minutes
  Low_SLA = 120 # In minutes
  Informational_SLA = 2 # In days


  # ##### Logic #####
  args_sev =  int(demisto.args().get('new'))
  now = datetime.datetime.utcnow()

  if args_sev > 7 :
      demisto.log('Severity changed to Critical')
      demisto.executeCommand("setIncident",{'sla': CRITICAL_SLA, "slaField":"detectionsla"})
      ## demisto.executeCommand("setIncident",{'sla': CRITICAL_RSLA, "slaField":"remediationsla"}) ##


  if args_sev > 4 and args_sev <= 7:
      demisto.log('Severity changed to high')
      demisto.executeCommand("setIncident",{'sla': High_SLA, "slaField":"detectionsla"})
      ##demisto.executeCommand("setIncident",{'sla': High_RSLA, "slaField":"remediationsla"})##

  if args_sev >= 2 and args_sev <= 4:
      demisto.log('Severity changed to Medium')
      demisto.executeCommand("setIncident",{'sla': Medium_SLA, "slaField":"detectionsla"})
      ### demisto.executeCommand("setIncident",{'sla': Medium_RSLA, "slaField":"remediationsla"}) ###


  if args_sev > 0 and args_sev < 2:
      demisto.log('Severity changed to low')
      demisto.executeCommand("setIncident",{'sla': Low_SLA, "slaField":"detectionsla"})
      ### demisto.executeCommand("setIncident",{'sla': Low_RSLA, "slaField":"remediationsla"}) ###

  if args_sev == 0:
      demisto.log('Severity changed to Informational')
      newsla = now + datetime.timedelta(days=Informational_SLA)
      newsla = newsla.strftime('%Y-%m-%dT%H:%M:%S+00:00')
      demisto.executeCommand("setIncident",{'sla': newsla, "slaField":"detectionsla"})




scripttarget: 0
subtype: python2
tags:
- field-change-triggered
type: python
