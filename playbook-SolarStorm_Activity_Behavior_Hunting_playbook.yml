contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.5.0
    itemVersion: 1.6.38
    packID: MajorBreachesInvestigationandResponse
    packName: Rapid Breach Response
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: "This manual playbook should be used as a sub-playbook in the 'SolarStorm
  and SUNBURST Hunting and Response' playbook and it helps you hunt for suspicious
  behavior related to SolarStorm activity. \n\nSources:\n- https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html\n-
  https://unit42.paloaltonetworks.com/fireeye-solarstorm-sunburst/3/\n- https://www.splunk.com/en_us/blog/security/sunburst-backdoor-detections-in-splunk.html"
id: SolarStorm Activity Behavior Hunting playbook
inputs: []
name: SolarStorm Activity Behavior Hunting playbook
outputs: []
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "18"
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e12ceb8c-018b-4a48-806a-4443ee22b71e
      iscommand: false
      name: ""
      version: -1
    taskid: e12ceb8c-018b-4a48-806a-4443ee22b71e
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 910,
          "y": 600
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "15"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ba7bc759-073e-40eb-818f-86f1cfd84944
      iscommand: false
      name: SUNBURST Backdoor Hunting
      type: title
      version: -1
    taskid: ba7bc759-073e-40eb-818f-86f1cfd84944
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 640,
          "y": 750
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "28"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: The malicious DLL will be loaded by the legitimate SolarWinds.BusinessLayerHost.exe
        or SolarWinds.BusinessLayerHostx64.exe files (depending on system configuration)
        and the malware will attempt to resolve a subdomain of avsvmcloud[.]com. The
        DNS response will return a CNAME record that points to a Command and Control
        (C2) domain.
      id: 3092bd2a-d3b0-48e4-8d87-2a6b9166d94f
      iscommand: false
      name: Search SUNBURST DNS queries
      type: regular
      version: -1
    taskid: 3092bd2a-d3b0-48e4-8d87-2a6b9166d94f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 640,
          "y": 1070
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Search for the malicious DLL **SolarWinds.Orion.Core.BusinessLayer.dll**.
        The DLL is a SolarWinds digitally-signed component of the Orion software framework that contains a backdoor that communicates via HTTP to third party servers.
      id: 3cb0834d-20a2-4fab-81b2-a1ba262337cd
      iscommand: false
      name: Search the malicious DLL
      type: regular
      version: -1
    taskid: 3cb0834d-20a2-4fab-81b2-a1ba262337cd
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 640,
          "y": 895
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Look at alerts and incidents that have a SolarWinds binary attached
        to them or any alerts related to Cobalt Strike, as these attackers have been
        seen using the framework.
      id: 9b57152c-17f7-4c70-813f-dabd9cc66693
      iscommand: false
      name: Search for Cobalt Strike Alerts
      type: regular
      version: -1
    taskid: 9b57152c-17f7-4c70-813f-dabd9cc66693
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 895
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 406e7ccd-d893-473e-81d1-20d534f2064b
      iscommand: false
      name: Hunt Behavior SolarStorm Activity
      type: title
      version: -1
    taskid: 406e7ccd-d893-473e-81d1-20d534f2064b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 750
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Example XDR Query:
        lowercase(actor_process_image_name) = “solarwinds.businesslayerhost*.exe” and
        action_file_extension in (“dll”, “exe”, “sys”, “msi”, “scr”, “ocx”, “cmd”, “bat”,
        “ps1”, “vba”, “vbs”, “com”, “cpl”, “bin”, “vbe”)| fields
        causality_actor_process_image_path, actor_process_image_path, agent_hostname,
        action_file_path, action_file_name|dedup causality_actor_process_image_path,
        actor_process_image_path, agent_hostname, action_file_name
      id: c0048ab6-752a-4e17-8707-13900e51778a
      iscommand: false
      name: Search for files dropped from the infected SolarWinds process
      type: regular
      version: -1
    taskid: c0048ab6-752a-4e17-8707-13900e51778a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1070
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Example XDR command query:
        dataset = xdr_data|
        filter event_type = NETWORK  and
        lowercase(actor_process_image_name) = "solarwinds.businesslayerhost*.exe" and
        action_external_hostname not contains "solarwinds.com" and action_external_hostname
        != "*.local" | fields causality_actor_process_image_path, actor_process_image_path,
        agent_hostname, action_remote_ip, action_external_hostname|dedup
        causality_actor_process_image_path, actor_process_image_path, agent_hostname, action_remote_ip, action_external_hostname
      id: 28389aa4-3d1a-4cec-89fb-951ad02b906f
      iscommand: false
      name: SolarWinds process accessing non-SolarWinds domains
      type: regular
      version: -1
    taskid: 28389aa4-3d1a-4cec-89fb-951ad02b906f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1260
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "23"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        XDR example query:
        dataset = xdr_data|filter event_type = RPC_CALL and
        lowercase(actor_process_image_name) = "solarwinds.businesslayerhost*.exe" and
        action_rpc_interface_name = "IWbemServices"|fields agent_hostname,
        action_rpc_func_str_call_fields

        Splunk query example:
        index=* sourcetype=XmlWinEventLog:Microsoft-WindowsSysmon/Operational EventCode=1 Image=*wmic*
        CommandLine=*node* CommandLine="*process call create*"
      id: 14979ec8-1a90-451d-8f52-e27dc797363a
      iscommand: false
      name: Search the infected SolarWinds process running WMI queries
      type: regular
      version: -1
    taskid: 14979ec8-1a90-451d-8f52-e27dc797363a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1440
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Look for the infected SolarWinds process modifying or creating a service.
        XDR example query:
        dataset = xdr_data|filter event_type = REGISTRY and
        lowercase(actor_process_image_name) = "solarwinds.businesslayerhost*.exe" and
        action_registry_key_name = "HKEY_LOCAL_MACHINE\SYSTEM\*\Services\*" | fields
        causality_actor_process_image_path, actor_process_image_path, agent_hostname,
        action_registry_key_name, action_registry_value_name, action_registry_data |dedup
        causality_actor_process_image_path, actor_process_image_path, agent_hostname,
        action_registry_key_name, action_registry_value_name, action_registry_data
      id: 7be578db-8cfb-4e02-8738-c9a83171943a
      iscommand: false
      name: Search for modifying or creating a service by the process
      type: regular
      version: -1
    taskid: 7be578db-8cfb-4e02-8738-c9a83171943a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1610
        }
      }
  "24":
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "25"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Hunt for backdoor DLLs that initiated network connections and look for any suspicious connection that involves DGA domains.
         XDR example query:
         dataset = xdr_data
         | filter (event_type = NETWORK or event_type = STORY) and
         lowercase(actor_process_image_name) contains "solarwinds.businesslayerhost"
         | filter action_external_hostname not contains "solarwinds" and
         action_external_hostname not contains ".local"
         | fields agent_hostname, agent_id, actor_process_instance_id,
         actor_process_image_name, action_external_hostname, dst_action_external_hostname,
         dns_query_name
         | join (dataset = xdr_data
                | filter event_sub_type = LOAD_IMAGE_MODULE and
                                            action_module_sha256 in
         ("019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134",
         "32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77",
         "ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6")
                                            and lowercase(actor_process_image_name) contains
         "solarwinds.businesslayerhost"
                | fields agent_hostname, agent_id, actor_process_instance_id,
         actor_process_image_name, action_module_sha256, action_module_path) as modules
                modules.actor_process_instance_id = actor_process_instance_id and
         modules.agent_id = agent_id
                | fields agent_hostname, agent_id, actor_process_instance_id,
         actor_process_image_name, action_module_sha256, action_module_path,
         action_external_hostname, dst_action_external_hostname, dns_query_name
                | dedup agent_hostname, agent_id, actor_process_instance_id,
         actor_process_image_name, action_module_path, action_external_hostname,
         dst_action_external_hostname, dns_query_name
      id: 3e5b5cf7-32bb-4928-8a0e-3d8e902de79e
      iscommand: false
      name: 'Search backdoor DLLs which initiated network connections '
      type: regular
      version: -1
    taskid: 3e5b5cf7-32bb-4928-8a0e-3d8e902de79e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1790
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "28"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Hunt based on the known backdoor named pipe.\n - XDR example query:\ndataset
        = xdr_data\n| filter action_file_device_type = 1 and action_file_name != null
        and\nlowercase(actor_process_image_name) contains \"solarwinds.businesslayerhost\"\n|
        filter action_file_name = \"583da945-62af-10e8-4902-a8f205c72b2e\"\n| fields
        agent_hostname, actor_process_instance_id, actor_process_image_name,\naction_file_name\n|
        dedup actor_process_instance_id, actor_process_image_name, action_file_name\n\n-
        Sysmon with Splunk exmaple query:\nindex=windows sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\"
        \n(EventCode=17 OR EventCode=18) PipeName=583da945-62af-10e8-4902-a8f205c72b2e"
      id: 1244240b-1d33-4714-84b9-7f78c31266c6
      iscommand: false
      name: Search for known backdoor named pipe
      type: regular
      version: -1
    taskid: 1244240b-1d33-4714-84b9-7f78c31266c6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1950
        }
      }
  "28":
    continueonerrortype: ""
    id: "28"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: c8d75c55-e9f1-4808-8272-4c027f784e3b
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: c8d75c55-e9f1-4808-8272-4c027f784e3b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 640,
          "y": 2130
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1595,
        "width": 930,
        "x": 640,
        "y": 600
      }
    }
  }
