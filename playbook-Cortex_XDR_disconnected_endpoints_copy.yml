contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.5.0
    itemVersion: 4.8.7
    packID: ""
    packName: Palo Alto Networks Cortex XDR - Investigation and Response
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: |
  A Job to periodically query disconnected Cortex XDR endpoints with a provided last seen time range playbook input.
  The Collected data, if found will be generated to a CSV report, including a detailed list of the disconnected endpoints.
  The report will be sent to the recipient's provided email addresses in the playbook input.
  The playbook includes an incident type with a dedicated layout to visualize the collected data.
  To set the job correctly, you will need to.
  1. Create a new recurring job.
  2. Set the recurring schedule.
  3. Add a name.
  4. Set type to Cortex XDR disconnected endpoints.
  5. Set this playbook as the job playbook.

  https://xsoar.pan.dev/docs/incidents/incident-jobs

  The scheduled run time and the timestamp relative date should be identical,
  If the job is recurring every 7 days, the time range should be 7 days as well.
id: 75b96a6d-79b5-461f-8c05-f42774609361
inputs:
- description: 'Last seen start date, in relative timestamp - "1 Day" or  "7 days" '
  key: LastSeenStartDate
  playbookInputQuery: null
  required: false
  value: {}
- description: "Last seen end date, in relative timestamp - \"1 Day\" or  \"7 days\"
    \nFor the current day use \"0 days\""
  key: LastSeenEndDate
  playbookInputQuery: null
  required: false
  value: {}
- description: Email addresses to send the disconnected endpoints report.
  key: Email
  playbookInputQuery: null
  required: false
  value:
    simple: shapatil@paloaltonetworks.com
- description: 'Body for the report email message. '
  key: MessageBody
  playbookInputQuery: null
  required: false
  value:
    simple: |-
      This message contains an automatically generated report by Cortex XSOAR, including a list of  disconnected Cortex XDR endpoints.
      Please investigate and remediate according to the organization's policy.
name: Cortex XDR disconnected endpoints_copy
outputs: []
sourceplaybookid: Cortex XDR disconnected endpoints
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 94a7cfd0-ec4e-402a-8f15-ca0e8b84b011
      iscommand: false
      name: ""
      version: -1
    taskid: 94a7cfd0-ec4e-402a-8f15-ca0e8b84b011
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 50,
          "y": 50
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      last_seen_gte:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: inputs.LastSeenStartDate
              operator: isNotEmpty
          root: inputs.LastSeenStartDate
      last_seen_lte:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: inputs.LastSeenEndDate
              operator: isNotEmpty
          root: inputs.LastSeenEndDate
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Gets a list of endpoints, according to the passed filters. If there
        are no filters, all endpoints are returned. Filtering by multiple fields will
        be concatenated using the AND condition (OR is not supported). The maximum
        result set size is 100. Offset is the zero-based number of the endpoint from
        the start of the result set (start by counting from 0).
      id: 5abef912-2824-4f48-8971-39724c0c88d9
      iscommand: true
      name: 'Get XDR disconnected endpoints '
      script: '|||xdr-get-endpoints'
      type: regular
      version: -1
    taskid: 5abef912-2824-4f48-8971-39724c0c88d9
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 370
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      csvArray:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: LOST
            - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: DISCONNECTED
          root: PaloAltoNetworksXDR.Endpoint
      fileName:
        simple: Disconnected XDR endpoints - ${incident.created}.csv
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Export the given array to a CSV file.
      id: 457c6a32-3455-4d08-8d37-fa4926b647fc
      iscommand: false
      name: Generate a CSV report for disconnected XDR endpoints
      script: ExportToCSV
      tags:
      - Endpoint report
      type: regular
      version: -1
    taskid: 457c6a32-3455-4d08-8d37-fa4926b647fc
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 162.5,
          "y": 720
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      attachIDs:
        complex:
          accessor: EntryID
          root: File
      htmlBody:
        complex:
          root: inputs.MessageBody
      subject:
        simple: Cortex XDR Discconcted endpoints
      to:
        complex:
          root: inputs.Email
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sends an mail using Gmail/EWS.
      id: 661a680a-7159-4adb-8d3a-db78e926d4e3
      iscommand: true
      name: Mail disconnected endpoints report
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 661a680a-7159-4adb-8d3a-db78e926d4e3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1070
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0010aad2-f9ae-4d04-8913-2773e6d6f6d9
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 0010aad2-f9ae-4d04-8913-2773e6d6f6d9
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1945
        }
      }
  "5":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Endpoint
          operator: isNotEmpty
      - - left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
          operator: isEqualString
          right:
            value:
              simple: LOST
        - left:
            iscontext: true
            value:
              simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
          operator: isEqualString
          right:
            value:
              simple: DISCONNECTED
      label: "yes"
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: ''''''
      id: c366c541-07c6-4fcf-8e70-38ea67a02a73
      iscommand: false
      name: Disconnected endpoints found?
      type: condition
      version: -1
    taskid: c366c541-07c6-4fcf-8e70-38ea67a02a73
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 50,
          "y": 545
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      xdrhostcount:
        complex:
          accessor: host_name
          filters:
          - - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: LOST
            - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: DISCONNECTED
          root: PaloAltoNetworksXDR.Endpoint
          transformers:
          - operator: count
      xdrusercount:
        complex:
          accessor: users
          filters:
          - - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: LOST
            - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: DISCONNECTED
          root: PaloAltoNetworksXDR.Endpoint
          transformers:
          - operator: count
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Count the users and hosts involved in the incidents and insert
        the amount in the incident field,
      id: d8ca9b11-a0c5-4c96-8ca8-fa3c463a56d6
      iscommand: true
      name: Count involved users and hosts
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: d8ca9b11-a0c5-4c96-8ca8-fa3c463a56d6
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 162.5,
          "y": 1245
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      columns:
        simple: Endpoint Name,Endpoint Status,Endpoint OS,Endpoint ID,Endpoint Last
          Seen
      context_path:
        simple: XDR.DisconnectedEndpoints
      grid_id:
        simple: disconnectedendpoints
      keys:
        simple: endpoint_name,endpoint_status,endpoint_type,endpoint_id,last_seen
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Creates a grid table from items or key-value pairs.
      id: fe8c5471-bd6a-4286-8cd3-43cf241138ca
      iscommand: false
      name: Set endpoints grid
      script: SetGridField
      type: regular
      version: -1
    taskid: fe8c5471-bd6a-4286-8cd3-43cf241138ca
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 162.5,
          "y": 1595
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: XDR.DisconnectedEndpoints
      value:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: LOST
            - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_status
              operator: isEqualString
              right:
                value:
                  simple: DISCONNECTED
          root: PaloAltoNetworksXDR.Endpoint
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: b38fcb30-8a3c-433e-8386-fa4fa8d94322
      iscommand: false
      name: |2-

        Set disconnected endpoints
      script: Set
      type: regular
      version: -1
    taskid: b38fcb30-8a3c-433e-8386-fa4fa8d94322
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 162.5,
          "y": 1420
        }
      }
  "9":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.Email
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: ''''''
      id: a3d28bdd-c4bf-4440-8438-ac9fd5d622ee
      iscommand: false
      name: Email report?
      type: condition
      version: -1
    taskid: a3d28bdd-c4bf-4440-8438-ac9fd5d622ee
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 162.5,
          "y": 895
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: 800b8cc4-732a-4008-8d3e-cb4298bb3cee
      iscommand: true
      name: Close job
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 800b8cc4-732a-4008-8d3e-cb4298bb3cee
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1770
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      id: e2e2831d-9509-4a94-8f7c-0e391389aa0f
      iscommand: false
      name: delete context
      script: DeleteContext
      type: regular
      version: -1
    taskid: e2e2831d-9509-4a94-8f7c-0e391389aa0f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 195
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "5_10_#default#": 0.1,
      "9_6_#default#": 0.21
    },
    "paper": {
      "dimensions": {
        "height": 1960,
        "width": 492.5,
        "x": 50,
        "y": 50
      }
    }
  }
