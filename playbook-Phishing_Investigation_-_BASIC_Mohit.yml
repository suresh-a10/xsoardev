contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: |-
  Use this playbook to investigate and remediate a potential phishing incident. The playbook simultaneously engages with the user that triggered the incident, while investigating the incident itself.

  The final remediation tasks are always decided by a human analyst.
id: a3ffa66f-bbe6-4353-8c8b-d945b8057914
inputs:
- description: The default role to assign the incident to.
  key: Role
  playbookInputQuery: null
  required: true
  value:
    simple: Administrator
name: Phishing Investigation - BASIC_Mohit
outputs: []
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
      - "18"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: c4aebd89-7d2b-4e17-82f5-b68673b3ea00
      iscommand: false
      name: ""
      version: -1
    taskid: c4aebd89-7d2b-4e17-82f5-b68673b3ea00
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 265,
          "y": 65
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "15"
    note: false
    quietmode: 0
    scriptarguments:
      roles:
        complex:
          root: inputs.Role
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Assign the incident to an analyst based on the analyst's organizational
        role.
      id: 0e2fab97-3d10-4e6c-84e6-5df1719dcafc
      iscommand: false
      name: Assign to analyst
      script: AssignAnalystToIncident
      type: regular
      version: -1
    taskid: 0e2fab97-3d10-4e6c-84e6-5df1719dcafc
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 895
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Close the investigation.
      id: 606c8b86-3623-455a-8b5c-7624e2d57153
      iscommand: true
      name: Close investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 606c8b86-3623-455a-8b5c-7624e2d57153
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 1885
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "36"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 4c16ecc7-cc0b-4eec-8b4d-a0aa9b882e95
      iscommand: false
      name: Triage
      type: title
      version: -1
    taskid: 4c16ecc7-cc0b-4eec-8b4d-a0aa9b882e95
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 225
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    scriptarguments:
      body:
        simple: "Hi ${.=val.Account.DisplayName && val.Email.Address === val.incident.labels['Email/from']
          ? val.Account.DisplayName : val.incident.labels['Email/from']},\nWe've received
          your email and are investigating.\nPlease do not touch the email until further
          notice.\n\nCordially, \n  Your friendly neighborhood security team"
      subject:
        simple: 'Re: Phishing Investigation - ${incident.name}'
      to:
        complex:
          accessor: ghule@tcs.com
          root: v
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email
      id: 79497147-5329-470c-8e0c-995ea62586ba
      iscommand: true
      name: Acknowledge incident was received
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 79497147-5329-470c-8e0c-995ea62586ba
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 720
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "31"
      'Malicious ':
      - "30"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determine if the email is malicious based on the calculated severity.
      id: 34891efd-8ac8-4aa1-86c3-ddc72fe42ada
      iscommand: false
      name: Is the email malicious?
      type: condition
      version: -1
    taskid: 34891efd-8ac8-4aa1-86c3-ddc72fe42ada
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 265,
          "y": 1070
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      body:
        simple: |-
          Hi ${.=val.Account.DisplayName && val.Email.Address === val.incident.labels['Email/from'] ? val.Account.DisplayName : val.incident.labels['Email/from']},
          We've concluded that the email you forwarded to us is safe.
          Thank you for your alertness and your participation in keeping our organization secure.

          Cordially,
            Your security team
      subject:
        simple: 'Re: Phishing Investigation - ${incident.name}'
      to:
        simple: v.ghule@tcs.com
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email
      id: 80fcf893-1e6d-49c0-8f71-3fadf8293fb5
      iscommand: true
      name: Update  the user that the reported email is safe
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 80fcf893-1e6d-49c0-8f71-3fadf8293fb5
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1710
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    scriptarguments:
      body:
        simple: |-
          Hi ${.=val.Account.DisplayName && val.Email.Address === val.incident.labels['Email/from'] ? val.Account.DisplayName : val.incident.labels['Email/from']},
          We've concluded that the email you forwarded to us is malicious. We've taken steps to blacklist the sender and quarantine the email. Good job on detecting and forwarding it to us!

          All the best,
            Your security team
      subject:
        simple: 'Re: Phishing Investigation - ${incident.name}'
      to:
        simple: v.ghule@tcs.com
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email
      id: 7edf2714-2485-452e-864e-0aa8f34e2c45
      iscommand: true
      name: Update  the user that the reported email is malicious
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 7edf2714-2485-452e-864e-0aa8f34e2c45
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1390
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6f85df78-390e-4cd6-840c-e779e143c2ce
      iscommand: false
      name: Engage with User
      type: title
      version: -1
    taskid: 6f85df78-390e-4cd6-840c-e779e143c2ce
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 50,
          "y": 560
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "34"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a0fdd8b2-c6b4-4169-854b-3443dadeb592
      iscommand: false
      name: Remediate
      type: title
      version: -1
    taskid: a0fdd8b2-c6b4-4169-854b-3443dadeb592
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1565
        }
      }
  "29":
    continueonerrortype: ""
    id: "29"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fe8c47f8-8f13-4081-83cf-ceae7192879e
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: fe8c47f8-8f13-4081-83cf-ceae7192879e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 265,
          "y": 2060
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f9b8a319-5c4f-4976-8afd-263f57983f43
      iscommand: false
      name: Malicious
      type: title
      version: -1
    taskid: f9b8a319-5c4f-4976-8afd-263f57983f43
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1245
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 423fb526-3671-4ebb-89b0-58edbe8b495f
      iscommand: false
      name: Not Malicious
      type: title
      version: -1
    taskid: 423fb526-3671-4ebb-89b0-58edbe8b495f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1565
        }
      }
  "34":
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Consider the following:\n1. Search for and delete similar emails\n2.
        Inform the organization about the threat\n3. Hunt the relevant IOCs\n4. Update
        proxies and firewalls as necessary\n5. Block the malicious sender/ domain
        in the mail-gateway "
      id: cc0c6e0f-7c8f-4b28-8d35-9e539d638bea
      iscommand: false
      name: Manually remediate  the incident
      type: regular
      version: -1
    taskid: cc0c6e0f-7c8f-4b28-8d35-9e539d638bea
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1710
        }
      }
  "35":
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 525e27d0-f48a-4094-8c57-0f86416234fa
      iscommand: false
      name: Entity Enrichment - BASIC
      playbookId: c547a0b9-54ca-4d35-85ea-653848433ac2
      type: playbook
      version: -1
    taskid: 525e27d0-f48a-4094-8c57-0f86416234fa
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 480,
          "y": 720
        }
      }
  "36":
    continueonerrortype: ""
    id: "36"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "39"
    note: false
    quietmode: 0
    scriptarguments:
      Email:
        complex:
          accessor: labels.Email
          root: incident
      Email/cc:
        complex:
          accessor: labels.CC
          root: incident
      Email/format:
        complex:
          accessor: labels.Email/format
          root: incident
      Email/from:
        complex:
          accessor: labels.Email/from
          root: incident
      Email/headers:
        complex:
          accessor: labels.Email/headers
          root: incident
      Email/html:
        complex:
          accessor: labels.Email/html
          root: incident
      Email/subject:
        complex:
          accessor: labels.Email/subject
          root: incident
      Email/text:
        complex:
          accessor: labels.Email/text
          root: incident
      File:
        complex:
          root: File
      GetOriginalEmail:
        simple: "False"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Add email details to the relevant context entities and handle the
        case where original emails are attached.
      id: 30e44503-399c-486f-8cba-339d4452e7e4
      iscommand: false
      name: Process Email - Generic
      playbookId: process_email_-_generic
      type: playbook
      version: -1
    taskid: 30e44503-399c-486f-8cba-339d4452e7e4
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 480,
          "y": 370
        }
      }
  "37":
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: f0e6cdef-92a4-4a4f-8c11-d2832e2e264c
      iscommand: false
      name: Extract Indicators From File - Generic
      playbookId: extract_indicators_from_file_-_generic
      type: playbook
      version: -1
    taskid: f0e6cdef-92a4-4a4f-8c11-d2832e2e264c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 695,
          "y": 50
        }
      }
  "38":
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 06f6251f-d183-4f3a-8013-8c59ba414cd7
      iscommand: false
      name: Extract Indicators From File - Generic v2
      playbookId: Extract Indicators From File - Generic v2
      type: playbook
      version: -1
    taskid: 06f6251f-d183-4f3a-8013-8c59ba414cd7
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1125,
          "y": 50
        }
      }
  "39":
    continueonerrortype: ""
    id: "39"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    scriptarguments:
      file:
        simple: ${incident.filename}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This script will parse a CSV file and place the unique IPs, Domains
        and Hashes into the context.
      id: f20ada5c-50d4-4b1f-81ed-01564908c693
      iscommand: false
      name: Parse CSV
      script: ParseCSV
      type: regular
      version: -1
    taskid: f20ada5c-50d4-4b1f-81ed-01564908c693
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 545
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2075,
        "width": 1455,
        "x": 50,
        "y": 50
      }
    }
  }
