contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.5.0
    itemVersion: 1.6.38
    packID: MajorBreachesInvestigationandResponse
    packName: Rapid Breach Response
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: "On April 20th, a new Remote Code Execution vulnerability in Pulse Connect
  Secure was disclosed. \nThe reference number for the vulnerability is CVE-2021-22893
  with the CVSS Score of 10.0. \nThis playbook should be trigger manually and includes
  the following tasks: \n\n* Enrich related known CVEs and Malware Hashes used by
  the suspected APT actor.\n* Search for unpatched endpoints vulnerable to the exploits.\n*
  Search network facing system using Expanse for relevant issues.\n* Indicators and
  known webshells hunting using SIEM products.\n* Block indicators automatically or
  manually.\n* Provide different mitigations that has been publicly published such
  as:\n    * Patches\n    * Workarounds\n    * Yara and Snort Rules\n\nNote: This
  is a beta playbook, which lets you implement and test pre-release software. Since
  the playbook is beta, it might contain bugs. Updates to the pack during the beta
  phase might include non-backward compatible features. We appreciate your feedback
  on the quality and usability of the pack to help us identify issues, fix them, and
  continually improve.\n\nMore information:\n[Exploitation of Pulse Connect Secure
  Vulnerabilities](https://us-cert.cisa.gov/ncas/alerts/aa21-110a)\n"
id: CVE-2021-22893 - Pulse Connect Secure RCE
inputs:
- description: The known hashes of different malware families associated with the
    exploitation.
  key: Related_Hashes
  playbookInputQuery: null
  required: false
  value:
    simple: 06c56bd272b19bf7d7207443693cd1fc774408c4ca56744577b11fee550c23f7,64c87520565165ac95b74d6450b3ab8379544933dd3e2f2c4dc9b03a3ec570a7,1322340356018696d853e0ac6f7ce3a2,09956753b5000061524d204000000001,88170125598a4fb801102ad56494a773895059ac8550a983fdd2ef429653f079,9f6ac39707822d243445e30d27b8404466aa69c61119d5308785bf4a464a9ebd,325d6d60e24c7cfc3a782839d85ce08c8d3bb27c,1ab50b77dd9515f6cd9ed07d1d3176ba4627a292dc4a21b16ac9d211353818bd,1741dc0a491fcc8d078220ac9628152668d3370b92a8eae258e34ba28c6473b9,cd09ec795a8f4b6ced003500a44d810f49943514e2f92c81ab96c33e1c0fbd68,d72daafedf41d484f7f9816f7f076a9249a6808f1899649b7daa22c0447bb37b,c9b323b9747659eac25cec078895d75f016e26a8b5858567c7fb945b7321722c,2610d0372e0e107053bc001d278ef71f08562e5610691f18b978123c499a74d8,c774eca633136de35c9d2cd339a3b5d29f00f761657ea2aa438de4f33e4bbba4,224b7c45cf6fe4547d3ea66a12c30f3cb4c601b0a80744154697094e73dbd450,78d7c7c9f800f6824f63a99d935a4ad0112f97953d8c100deb29dae24d7da282,1d3ab04e21cfd40aa8d4300a359a09e3b520d39b1496be1e4bc91ae1f6730ecc,133631957d41eed9496ac2774793283ce26f8772de226e7f520d26667b51481a,68743e17f393d1f85ee937dffacc91e081b5f6f43477111ac96aa9d44826e4d2,7fa71a7f76ef63465cfeacf58217e0b66fc71bc81d37c44380a6f572b8a3ec7a,f2b1bd703c3eb05541ff84ec375573cbdc70309ccb82aac04b72db205d718e90,a1dcdf62aafc36dd8cf64774dea80d79fb4e24ba2a82adf4d944d9186acd1cc1,e63ab6f82c711e4ecc8f5b36046eb7ea216f41eb90158165b82a6c90560ea415,b2350954b9484ae4eac42b95fae6edf7a126169d0b93d79f49d36c5e6497062a,b1c2368773259fbfef425e0bb716be958faa7e74b3282138059f511011d3afd9,b990f79ce80c24625c97810cb8f161eafdcb10f1b8d9d538df4ca9be387c35e4,168976797d5af7071df257e91fcc31ce1d6e59c72ca9e2f50c8b5b3177ad83cc,4c5555955b2e6dc55f52b0c1a3326f3d07b325b112060329c503b294208960ec,705cda7d1ace8f4adeec5502aa311620b8d6c64046a1aed2ae833e2f2835154f
- description: The known CVEs associated with the exploitation.
  key: Related_CVEs
  playbookInputQuery: null
  required: false
  value:
    simple: CVE-2019-11510, CVE-2020-8260, CVE-2020-8243, CVE-2021-22893
- description: |-
    Whether to block the indicators automatically.
    Default: False.
  key: BlockAutomatically
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: |-
    The QRadar search query used for "Hunt Activity Using QRadar".
    Please note that there aren't specified fields which may cause a longer run time.
  key: QRadarWebshellsQuery
  playbookInputQuery: null
  required: false
  value:
    simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Pulse Secure
      Pulse Connect Secure' and ( UTF8(payload) LIKE '%Licenseserverproto.cgi%' or
      UTF8(payload) LIKE '%Secid_canceltoken.cgi%' or UTF8(payload) LIKE '%compcheckresult.cgi%'
      or UTF8(payload) LIKE '%Login.cgi%' or UTF8(payload) LIKE '%Healthcheck.cgi%'
      or UTF8(payload) LIKE '%meeting_testjs.cgi%' or UTF8(payload) LIKE '%compcheckjava.cgi%')
- description: |-
    The Splunk search query used for "Hunt Activity Using Splunk".
    Please note that there are two specified fields: msg, message. the query will work for both field names.
  key: SplunkWebshellsQuery
  playbookInputQuery: null
  required: false
  value:
    simple: index=* sourcetype=pulse:connectsecure "Licenseserverproto.cgi" OR "Secid_canceltoken.cgi"
      OR "compcheckresult.cgi" OR "Healthcheck.cgi" OR "meeting_testjs.cgi" OR "compcheckjava.cgi"
- description: If you would like to skip "Hunt Activity Using Splunk" OR "Hunt Activity
    Using Qradar" please change the value to 'False'.
  key: RunWebshellsQuery
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: |-
    The name of the field for MD5 entries in QRadar.
    If not configured, QRadar Indicator Hunting may reach timeout.
  key: QRadar_MD5_Field
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    The name of the field for SHA1 entries in QRadar.
    If not configured, QRadar Indicator Hunting may reach timeout.
  key: QRadar_SHA1_Field
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    The name of the field for SHA256 entries in QRadar.
    If not configured, QRadar Indicator Hunting may reach timeout.
  key: QRadar_SHA256_Field
  playbookInputQuery: null
  required: false
  value: {}
- description: The earliest time for the Splunk search query.
  key: SplunkEarliestTime
  playbookInputQuery: null
  required: false
  value:
    simple: -30d
- description: The latest time for the Splunk search query.
  key: SplunkLatestTime
  playbookInputQuery: null
  required: false
  value:
    simple: now
- description: By default, the system does not automatically block indicators. However,
    it is possible to configure the condition to enable automatic blocking of indicators.
    This can provide an added layer of security and ensure that potentially harmful
    indicators are prevented from causing any damage. It is important to carefully
    consider the potential impact of automatic blocking before enabling this feature,
    as it may lead to legitimate indicators being blocked.
  key: AutoBlockIndicator
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: 'In order for the playbook to proceed, it is necessary for users to
    validate the relevant indicators in accordance with the provided settings. Default:
    False'
  key: UserVerification
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
name: CVE-2021-22893 - Pulse Connect Secure RCE
outputs: []
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "35"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      id: 8308f76e-de23-4b77-8c7a-0b1b2e734d5e
      iscommand: false
      name: ""
      version: -1
    taskid: 8308f76e-de23-4b77-8c7a-0b1b2e734d5e
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 770,
          "y": -270
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: ID
          root: CVE
    separatecontext: false
    skipunavailable: true
    task:
      brand: Builtin
      description: Enrich CVEs indicators
      id: 28b3f68d-e04e-4e85-8f3d-677e40a436e4
      iscommand: true
      name: Enrich CVE Indicators
      script: Builtin|||enrichIndicators
      type: regular
      version: -1
    taskid: 28b3f68d-e04e-4e85-8f3d-677e40a436e4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 540,
          "y": 230
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: MD5
          root: File
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: File.SHA1
            operator: append
          - args:
              item:
                iscontext: true
                value:
                  simple: File.SHA256
            operator: append
      retry-count:
        simple: "3"
      retry-interval:
        simple: "5"
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.enrich.indicators
      id: 9cf18652-2511-462e-8623-a41414ff940f
      iscommand: true
      name: Enrich Hash Indicators
      script: Builtin|||enrichIndicators
      type: regular
      version: -1
    taskid: 9cf18652-2511-462e-8623-a41414ff940f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 990,
          "y": 230
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9ffb88c1-032f-4403-8e5b-61bdb5cff00f
      iscommand: false
      name: Enrichment
      type: title
      version: -1
    taskid: 9ffb88c1-032f-4403-8e5b-61bdb5cff00f
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 770,
          "y": 70
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
      - "6"
      - "7"
      - "12"
      - "25"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a69b6038-bc82-43ce-800f-651e192a97f6
      iscommand: false
      name: Hunting
      type: title
      version: -1
    taskid: a69b6038-bc82-43ce-800f-651e192a97f6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 770,
          "y": 410
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
      - "37"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      id: efe4361d-334c-46f6-8877-2c206718b950
      iscommand: false
      name: SIEM Hunt
      type: title
      version: -1
    taskid: efe4361d-334c-46f6-8877-2c206718b950
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -1040,
          "y": 620
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9b4033c8-84a0-4fed-8fb0-043bb7d72bac
      iscommand: false
      name: Vulnerability Scanners Hunt
      type: title
      version: -1
    taskid: 9b4033c8-84a0-4fed-8fb0-043bb7d72bac
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -300,
          "y": 620
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      id: c4a760fc-71bf-46c1-8633-3892e4e5444b
      iscommand: false
      name: Palo Alto Networks Hunt
      type: title
      version: -1
    taskid: c4a760fc-71bf-46c1-8633-3892e4e5444b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 620
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      CVE_ID:
        complex:
          accessor: ID
          root: CVE
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: Hunt for assets with a given CVE using available tools
      id: 704f5545-b3ac-4c1e-898c-b135ddb75438
      iscommand: false
      name: Search Endpoint by CVE - Generic
      playbookId: Search Endpoint by CVE - Generic
      type: playbook
      version: -1
    taskid: 704f5545-b3ac-4c1e-898c-b135ddb75438
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -300,
          "y": 780
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      MD5:
        complex:
          accessor: MD5
          root: File
      SHA1:
        complex:
          accessor: SHA1
          root: File
      SHA256:
        complex:
          accessor: SHA256
          root: File
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: "This is a multipurpose playbook used for hunting and threat detection.
        The playbook receives inputs based on hashes, IP addresses, or domain names
        provided manually or from outputs by other playbooks. \nWith the received
        indicators, the playbook leverages data received by PANW products including,
        Cortex Data Lake, Autofocus and Pan-OS to search for IP addresses, host names
        and users related to the provided indicators.\nThe output provided by the
        playbook facilitates pivoting searches for possibly affected IP addresses
        or users."
      id: 6a1b2349-17bb-4286-8337-d962530e44d5
      iscommand: false
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      version: -1
    taskid: 6a1b2349-17bb-4286-8337-d962530e44d5
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 780
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      IndexName:
        simple: '*'
      MD5:
        complex:
          accessor: MD5
          root: File
      SHA1:
        complex:
          accessor: SHA1
          root: File
      SHA256:
        complex:
          accessor: SHA256
          root: File
      SelectFields:
        simple: source,timestamp
      earliest_time:
        complex:
          root: inputs.SplunkEarliestTime
      event_limit:
        simple: "100"
      latest_time:
        complex:
          root: inputs.SplunkLatestTime
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook queries Splunk for indicators such as file hashes,
        IP addresses, domains, or urls. It outputs detected users, ip addresses, and
        hostnames related to the indicators.
      id: 343cde81-c933-4cb0-8ede-1dfd30520d80
      iscommand: false
      name: Splunk Indicator Hunting
      playbookId: Splunk Indicator Hunting
      type: playbook
      version: -1
    taskid: 343cde81-c933-4cb0-8ede-1dfd30520d80
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -810,
          "y": 780
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Retrieve issues
      id: 992a51d5-f474-4be4-8e45-a64b0910a80c
      iscommand: false
      name: Expanse Issues Hunt
      type: title
      version: -1
    taskid: 992a51d5-f474-4be4-8e45-a64b0910a80c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2470,
          "y": 620
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      content_search:
        simple: Pulse Secure SSL VPN
      issue_type:
        simple: VPN Device
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Retrieve issues related to Pulse Secure VPN.
      id: 70a3df35-5318-4938-8124-4f92cdc581ef
      iscommand: true
      name: Search for Pulse Secure VPN Devices with an open issues
      script: '|||expanse-get-issues'
      type: regular
      version: -1
    taskid: 70a3df35-5318-4938-8124-4f92cdc581ef
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2470,
          "y": 1175
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "15"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      id: c2668048-baa6-4a58-8269-4079f1cc126e
      iscommand: false
      name: Remediation
      type: title
      version: -1
    taskid: c2668048-baa6-4a58-8269-4079f1cc126e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1350
        }
      }
  "15":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.BlockAutomatically
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "18"
      "yes":
      - "39"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check the playbook input (True/False) responsible for automatically
        block indicators.
      id: b728f187-fa54-482c-8046-4351f7f062e8
      iscommand: false
      name: Block indicators automatically?
      type: condition
      version: -1
    taskid: b728f187-fa54-482c-8046-4351f7f062e8
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1510
        }
      }
  "16":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: state
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: ExpanseV2
                root: modules
          operator: isEqualString
          right:
            value:
              simple: active
      label: "yes"
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if Expanse instance is enabled.
      id: 6bbdbffd-9407-43d3-8acb-a65e0b95375c
      iscommand: false
      name: Is Expanse Enabled?
      type: condition
      version: -1
    taskid: 6bbdbffd-9407-43d3-8acb-a65e0b95375c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 2470,
          "y": 780
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Ask the user to manually block the indicators.
      id: ef38604d-2160-4823-8db3-d52e0e775332
      iscommand: false
      name: Manually block indicators
      type: regular
      version: -1
    taskid: ef38604d-2160-4823-8db3-d52e0e775332
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1050,
          "y": 1700
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e2ff1be7-6ca6-4cb7-84d0-2de9df314da4
      iscommand: false
      name: Mitigation
      type: title
      version: -1
    taskid: e2ff1be7-6ca6-4cb7-84d0-2de9df314da4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1890
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      "No":
      - "22"
      - "23"
      "Yes":
      - "21"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check the data collected manually or automatically and decide whether
        Pulse Connect Secure is patched or not.
      id: 015fc3b3-5f1d-455f-8d1d-4008e8b05eb1
      iscommand: false
      name: Is Pulse Secure is patched?
      type: condition
      version: -1
    taskid: 015fc3b3-5f1d-455f-8d1d-4008e8b05eb1
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 770,
          "y": 2070
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "34"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Request for final review of the data collected.
      id: 32f4f8dd-9ebe-48a2-813e-b67efad4091b
      iscommand: false
      name: 'Review all data collected '
      type: regular
      version: -1
    taskid: 32f4f8dd-9ebe-48a2-813e-b67efad4091b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 770,
          "y": 2510
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Related patches and workarounds:

        [1.CVE-2021-22893](https://kb.pulsesecure.net/pkb_mobile#article/l:en_US/SA44784/s)
        [2.CVE-2020-8260](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8260)
        [3.CVE-2020-8243](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8243)
        [4.CVE-2019-11510](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11510)

        Deny access to the following URIs:
        ^/+dana/+meeting
        ^/+dana/+fb/+smb
        ^/+dana-cached/+fb/+smb
        ^/+dana-ws/+namedusers
        ^/+dana-ws/+metric

        **Note: SSL decryption is needed in order to deny access to the provided URIs.**
      id: 413d666b-858a-4dc9-8867-2209d4428bed
      iscommand: false
      name: 'Install related patches and workarounds '
      type: regular
      version: -1
    taskid: 413d666b-858a-4dc9-8867-2209d4428bed
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2310
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        This tool created by the vendor will assist with determining if systems have been impacted.

        [Pulse Connect Secure Integrity Tool ](https://kb.pulsesecure.net/articles/Pulse_Secure_Article/KB44755)
      id: 5ce15d56-9f45-47f8-899c-2b164344b655
      iscommand: false
      name: 'Run Pulse Connect Secure Integrity Tool '
      type: regular
      version: -1
    taskid: 5ce15d56-9f45-47f8-899c-2b164344b655
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 2310
        }
      }
  "24":
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "34"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        [FireEye Mandiant PulseSecure Exploitation Countermeasures](https://github.com/fireeye/pulsesecure_exploitation_countermeasures)

        These rules are provided freely to the community without warranty.

        In this GitHub repository you will find rules in multiple languages:

        Snort
        Yara
      id: 45027857-c6de-44da-8745-fce6e0a534c0
      iscommand: false
      name: Download Yara/Snort rules from FireEye Mandiant GitHub repository
      type: regular
      version: -1
    taskid: 45027857-c6de-44da-8745-fce6e0a534c0
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -40,
          "y": 2070
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "31"
      - "38"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8095b0d3-b0b0-4225-83af-81b4cbb0be56
      iscommand: false
      name: Webshell Access Attempts Hunt
      type: title
      version: -1
    taskid: 8095b0d3-b0b0-4225-83af-81b4cbb0be56
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 770,
          "y": 610
        }
      }
  "26":
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "28"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 709ce95c-f4ec-4d22-86e5-3c9f72d82031
      iscommand: false
      name: Hunt Activity Using Splunk
      type: title
      version: -1
    taskid: 709ce95c-f4ec-4d22-86e5-3c9f72d82031
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1200,
          "y": 930
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "30"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5ad6e2d8-9dc6-4197-82c2-5c0b911f7137
      iscommand: false
      name: Hunt Activity Using Qradar
      type: title
      version: -1
    taskid: 5ad6e2d8-9dc6-4197-82c2-5c0b911f7137
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 340,
          "y": 930
        }
      }
  "28":
    continueonerrortype: ""
    id: "28"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      earliest_time:
        complex:
          root: inputs.SplunkEarliestTime
      latest_time:
        complex:
          root: inputs.SplunkLatestTime
      query:
        complex:
          root: inputs.SplunkWebshellsQuery
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches Splunk for events related to the webshells names.
      id: 60f33e3c-ce34-4ccd-8b65-34d607b5c407
      iscommand: true
      name: Search access attempts in Pulse Secure Logs
      script: '|||splunk-search'
      type: regular
      version: -1
    taskid: 60f33e3c-ce34-4ccd-8b65-34d607b5c407
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1200,
          "y": 1080
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: inputs.QRadarWebshellsQuery
      timeout:
        simple: "600"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook runs a QRadar query and return its results to the
        context.
      id: 641c1d63-ed40-4cd5-83b4-31c104ef1237
      iscommand: false
      name: QRadarFullSearch
      playbookId: QRadarFullSearch
      type: playbook
      version: -1
    taskid: 641c1d63-ed40-4cd5-83b4-31c104ef1237
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 340,
          "y": 1080
        }
      }
  "31":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: inList
                    right:
                      value:
                        simple: QRadar,QRadar_v2
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.RunWebshellsQuery
          operator: isEqualString
          right:
            value:
              simple: "True"
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.QRadarWebshellsQuery
          operator: isNotEmpty
      label: "Yes"
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: SplunkPy
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "No"
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "No":
      - "14"
      "Yes":
      - "27"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Check if QRadar or Splunk instances are enabled.
      id: dbc84475-e4c2-48f4-8d45-a7ffdbb42dda
      iscommand: false
      name: Is QRadar Enabled?
      type: condition
      version: -1
    taskid: dbc84475-e4c2-48f4-8d45-a7ffdbb42dda
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 550,
          "y": 760
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Search in your Data Lake for access to one of the following URIs:\n\n*Licenseserverproto.cgi*\n*Secid_canceltoken.cgi*
        \n*compcheckresult.cgi*\n*Login.cgi*\n*Healthcheck.cgi*\n*meeting_testjs.cgi*\n*compcheckjava.cgi*\n\nLook
        at the following example of Pulse Secure Connect message:\n\n\"Unauthenticated
        request url /dana-na/meeting/meeting_testjs.cgi?id=* came from IP XX.XX.XX.XX.\""
      id: a2b23756-19bd-4649-8712-d1d1c40c9158
      iscommand: false
      name: Hunt for the webshells names in PCS logs
      type: regular
      version: -1
    taskid: a2b23756-19bd-4649-8712-d1d1c40c9158
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 770,
          "y": 970
        }
      }
  "34":
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: bc891459-9fea-4821-88d5-52e29232eabd
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: bc891459-9fea-4821-88d5-52e29232eabd
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 770,
          "y": 2730
        }
      }
  "35":
    continueonerrortype: ""
    id: "35"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    reputationcalc: 2
    scriptarguments:
      text:
        complex:
          root: inputs.Related_Hashes
          transformers:
          - args:
              item:
                value:
                  simple: ${inputs.Related_CVEs}
            operator: append
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.extract.indicators
      id: 1c5a1902-11df-431c-8106-1e72fab5fa60
      iscommand: true
      name: Extract Indicators
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: 1c5a1902-11df-431c-8106-1e72fab5fa60
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 770,
          "y": -120
        }
      }
  "37":
    continueonerrortype: ""
    id: "37"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      QradarIPfield:
        simple: sourceip,destinationip
      QradarMD5Field:
        complex:
          root: inputs.QRadar_MD5_Field
      QradarSHA1Field:
        complex:
          root: inputs.QRadar_SHA1_Field
      QradarSHA256Field:
        complex:
          root: inputs.QRadar_SHA256_Field
      TimeFrame:
        simple: LAST 7 DAYS
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: 'The Playbook queries QRadar SIEM for indicators such as file hashes,
        IP addresses, domains, or urls. '
      id: b75593b1-de06-47ad-8ca7-95ed2525e243
      iscommand: false
      name: QRadar Indicator Hunting V2
      playbookId: QRadar Indicator Hunting V2
      type: playbook
      version: -1
    taskid: b75593b1-de06-47ad-8ca7-95ed2525e243
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -1270,
          "y": 780
        }
      }
  "38":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: SplunkPy
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.RunWebshellsQuery
          operator: isEqualString
          right:
            value:
              simple: "True"
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.SplunkWebshellsQuery
          operator: isNotEmpty
      label: "Yes"
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: inList
                    right:
                      value:
                        simple: Qradar,Qradar_V2
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "No"
    continueonerrortype: ""
    id: "38"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "33"
      "No":
      - "14"
      "Yes":
      - "26"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Check if QRadar or Splunk instances are enabled.
      id: a365653d-ac37-49d5-80b2-7571d996286d
      iscommand: false
      name: Is Splunk Enabled?
      type: condition
      version: -1
    taskid: a365653d-ac37-49d5-80b2-7571d996286d
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 990,
          "y": 760
        }
      }
  "39":
    continueonerrortype: ""
    id: "39"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    scriptarguments:
      AutoBlockIndicators:
        complex:
          root: inputs.AutoBlockIndicator
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      IP:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: ip
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
      InputEnrichment:
        simple: "False"
      MD5:
        complex:
          accessor: MD5
          root: File
          transformers:
          - operator: uniq
      RuleDirection:
        simple: outbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      SHA256:
        complex:
          accessor: SHA256
          root: File
          transformers:
          - operator: uniq
      URL:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: url
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
      UserVerification:
        complex:
          root: inputs.UserVerification
      Username:
        complex:
          accessor: Indicator
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: DBotScore.Type
              operator: isEqualString
              right:
                value:
                  simple: username
          - - left:
                iscontext: true
                value:
                  simple: DBotScore.Score
              operator: greaterThanOrEqual
              right:
                value:
                  simple: "3"
          root: DBotScore
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |+
        This playbook blocks malicious Indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic v2
        - Block Account - Generic v2
        - Block IP - Generic v3
        - Block File - Generic v2
        - Block Email - Generic
        - Block Domain - Generic

      id: ee49a2cd-1098-4645-8a12-1ae93e1d2034
      iscommand: false
      name: Block Indicators - Generic v3
      playbookId: Block Indicators - Generic v3
      type: playbook
      version: -1
    taskid: ee49a2cd-1098-4645-8a12-1ae93e1d2034
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 430,
          "y": 1700
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "15_18_#default#": 0.77,
      "16_13_yes": 0.48,
      "16_14_#default#": 0.11,
      "20_22_No": 0.64,
      "31_14_No": 0.26,
      "38_14_No": 0.25,
      "38_33_#default#": 0.76
    },
    "paper": {
      "dimensions": {
        "height": 3065,
        "width": 4120,
        "x": -1270,
        "y": -270
      }
    }
  }
