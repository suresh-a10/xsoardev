contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.5.0
    itemVersion: 1.6.17
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: "On May 27, 2021, Microsoft reported a wide scale spear phishing campaign
  attributed to APT29, the same threat actor responsible for the SolarWinds campaign
  named SolarStorm. This attack had a wide range of targets for an APT spear phishing
  campaign with 3,000 email accounts targeted within 150 organizations. \nhttps://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/
  \ \nThis playbook includes the following tasks:\n- Collect IOCs to be used in your
  threat hunting process\n- Query FW, SIEMs, EDR, XDR to detect malicious hashes,
  network activity and compromised hosts \n- Block known indicators\n** Note: This
  is a beta playbook, which lets you implement and test pre-release software. Since
  the playbook is beta, it might contain bugs. Updates to the pack during the beta
  phase might include non-backward compatible features. We appreciate your feedback
  on the quality and usability of the pack to help us identify issues, fix them, and
  continually improve."
id: a8faa34e-be54-4a53-87b2-b502b8d13d3b
inputs:
- description: The EWS query to find malicious emails related to NOBELIUM spear-phishing.
  key: EWSSearchQuery
  playbookInputQuery: null
  required: false
  value:
    simple: From:*usaid.gov or From:*in.constantcontact.com
- description: Whether to automatically indicators involved with NOBELIUM spear-phishing.
  key: BlockIndicatorsAutomatically
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
name: TCS-NOBELIUM - wide scale APT29 spear-phishing v1.0_Kunl
outputs: []
sourceplaybookid: NOBELIUM - wide scale APT29 spear-phishing
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6b0ee539-71ea-4936-81b0-642d5f67045c
      iscommand: false
      name: ""
      version: -1
    taskid: 6b0ee539-71ea-4936-81b0-642d5f67045c
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 440,
          "y": -770
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 4ece0cda-b684-4456-808f-d734a5c0229d
      iscommand: false
      name: Collect Indicators of Compromise
      type: title
      version: -1
    taskid: 4ece0cda-b684-4456-808f-d734a5c0229d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 440,
          "y": -620
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      method:
        simple: GET
      saveAsFile:
        simple: "yes"
      url:
        simple: https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Detections/MultipleDataSources/NOBELIUM_IOCsMay2021.yaml
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sends http request. Returns the response as json.
      id: 8b77244b-5209-4641-887a-613ccfe151ee
      iscommand: false
      name: Retrieve IOCs file from Azure GitHub repository
      script: http
      type: regular
      version: -1
    taskid: 8b77244b-5209-4641-887a-613ccfe151ee
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 790,
          "y": -480
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      url:
        simple: https://www.volexity.com/blog/2021/05/27/suspected-apt29-operation-launches-election-fraud-themed-phishing-campaigns/
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieve parsed Volexity blog to extract indicators from
      id: d184cdaa-f397-4e4e-8594-718e445ecdae
      iscommand: false
      name: Retrieve Volexity blog
      script: RapidBreachResponseParseBlog
      type: regular
      version: -1
    taskid: d184cdaa-f397-4e4e-8594-718e445ecdae
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 110,
          "y": -480
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
      - "9"
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ce219da1-44b7-441b-8e45-95e87be85b4c
      iscommand: false
      name: Hunt Indicators
      type: title
      version: -1
    taskid: ce219da1-44b7-441b-8e45-95e87be85b4c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 680
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    scriptarguments:
      text:
        complex:
          accessor: parsedBlog
          root: http
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.extract.indicators
      id: b0803bf0-c907-4711-81a1-d3c96fb0e2a8
      iscommand: true
      name: Extract IOCS from Volexity blog
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: b0803bf0-c907-4711-81a1-d3c96fb0e2a8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 110,
          "y": -305
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    scriptarguments:
      text:
        complex:
          accessor: Body
          root: HttpRequest.Response
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.extract.indicators
      id: 7c9eaad0-5f03-462e-869f-2323e0d57732
      iscommand: true
      name: Extract IOCs from Azure GitHub repository
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: 7c9eaad0-5f03-462e-869f-2323e0d57732
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 790,
          "y": -305
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddresses:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA1:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "40"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      URLDomain:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.Domain
              operator: notContainsGeneral
              right:
                value:
                  simple: microsoft.com
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.Domain
              operator: notContainsGeneral
              right:
                value:
                  simple: github
          root: ExtractedIndicators.Domain
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: "This is a multipurpose playbook used for hunting and threat detection.
        The playbook receives inputs based on hashes, IP addresses, or domain names
        provided manually or from outputs by other playbooks. \nWith the received
        indicators, the playbook leverages data received by PANW products including,
        Cortex Data Lake, Autofocus and Pan-OS to search for IP addresses, host names
        and users related to the provided indicators.\nThe output provided by the
        playbook facilitates pivoting searches for possibly affected IP addresses
        or users."
      id: f2faaf07-d8e0-4449-8db1-b7216114244a
      iscommand: false
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookId: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      version: -1
    taskid: f2faaf07-d8e0-4449-8db1-b7216114244a
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1010
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ce574514-e99c-4472-8e9a-23ac4dae75b5
      iscommand: false
      name: SIEM Indicators Hunting
      type: title
      version: -1
    taskid: ce574514-e99c-4472-8e9a-23ac4dae75b5
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -470,
          "y": 860
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 4245690c-69e9-41a0-8666-8768d1699d98
      iscommand: false
      name: Network Activity Indicators Hunt
      type: title
      version: -1
    taskid: 4245690c-69e9-41a0-8666-8768d1699d98
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 860
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      log_type:
        simple: threat
      query:
        simple: (threatid eq 86398)
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: 'Query Panorama Logs of types: traffic, threat, url, data-filtering
        and wildfire.'
      id: 1c58e1d9-08fd-4692-8592-78abbb4f911d
      iscommand: false
      name: Panorama Query Logs
      playbookId: Panorama Query Logs
      type: playbook
      version: -1
    taskid: 1c58e1d9-08fd-4692-8592-78abbb4f911d
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 680,
          "y": 1010
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: isEqualString
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      QradarIPfield:
        simple: sourceip,destinationip
      SHA1:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "40"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      TimeFrame:
        simple: LAST 7 DAYS
      URLDomain:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.Domain
              operator: notContainsGeneral
              right:
                value:
                  simple: github
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.Domain
              operator: notContainsGeneral
              right:
                value:
                  simple: microsoft.com
          root: ExtractedIndicators.Domain
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: 'The Playbook queries QRadar SIEM for indicators such as file hashes,
        IP addresses, domains, or urls. '
      id: 01560dee-6422-4c82-860b-89454d1c145c
      iscommand: false
      name: QRadar Indicator Hunting V2
      playbookId: QRadar Indicator Hunting V2
      type: playbook
      version: -1
    taskid: 01560dee-6422-4c82-860b-89454d1c145c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -240,
          "y": 1010
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddress:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      IndexName:
        simple: '*'
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: isEqualString
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA1:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "40"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SelectFields:
        simple: source,timestamp
      URLDomain:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.Domain
              operator: notContainsGeneral
              right:
                value:
                  simple: github
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.Domain
              operator: notContainsGeneral
              right:
                value:
                  simple: microsoft.com
          root: ExtractedIndicators.Domain
          transformers:
          - operator: uniq
      earliest_time:
        simple: -1d
      event_limit:
        simple: "100"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook queries Splunk for indicators such as file hashes,
        IP addresses, domains, or urls. It outputs detected users, ip addresses, and
        hostnames related to the indicators.
      id: 8d62cbe8-aee2-4fef-8d9b-c23bcce94f0e
      iscommand: false
      name: Splunk Indicator Hunting
      playbookId: Splunk Indicator Hunting
      type: playbook
      version: -1
    taskid: 8d62cbe8-aee2-4fef-8d9b-c23bcce94f0e
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -690,
          "y": 1010
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        simple: 'xdralerts.name:"LOLBIN connecting to a rare host" '
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Searches Demisto incidents
      id: 9d6d2351-fe99-49c0-8af6-938d096027c1
      iscommand: false
      name: Search XDR incidents related to NOBELIUM
      script: SearchIncidentsV2
      type: regular
      version: -1
    taskid: 9d6d2351-fe99-49c0-8af6-938d096027c1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 1180
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "15"
      - "16"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 0f6b06a4-fb39-4c8c-872b-2641bc5e7568
      iscommand: false
      name: Endpoints Activity Hunt
      type: title
      version: -1
    taskid: 0f6b06a4-fb39-4c8c-872b-2641bc5e7568
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1380,
          "y": 860
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      MD5Hash:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA1Hash:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "40"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256Hash:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: Hunt using available tools
      id: 5790c6de-929f-425e-8e68-cee35fe4820c
      iscommand: false
      name: Search Endpoints By Hash - Generic V2
      playbookId: Search Endpoints By Hash - Generic V2
      type: playbook
      version: -1
    taskid: 5790c6de-929f-425e-8e68-cee35fe4820c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1150,
          "y": 1010
        }
      }
  "16":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: state
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Cortex XDR - IR
                root: modules
          operator: isEqualString
          right:
            value:
              simple: active
      label: "yes"
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "17"
      "yes":
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if the Cortex XDR instance is enabled.
      id: 98f99ad2-1aab-4f35-8a9a-bd5281793ecd
      iscommand: false
      name: 'Is Cortex XDR enabled? '
      type: condition
      version: -1
    taskid: 98f99ad2-1aab-4f35-8a9a-bd5281793ecd
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1610,
          "y": 1010
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "18"
      - "19"
      - "20"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: ea79bd1b-a0d0-48ca-8a06-fdde167bdccd
      iscommand: false
      name: 'Advanced Hunting '
      type: title
      version: -1
    taskid: ea79bd1b-a0d0-48ca-8a06-fdde167bdccd
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1360
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Volexity published YARA rule to detect the related malware.

        **You can find the YARA rule in their blog:**
        [Volexity blog](https://www.volexity.com/blog/2021/05/27/suspected-apt29-operation-launches-election-fraud-themed-phishing-campaigns/)
      id: fbe4f278-a24b-45ef-8b8a-e99eaac2d558
      iscommand: false
      name: Run YARA rules
      type: regular
      version: -1
    taskid: fbe4f278-a24b-45ef-8b8a-e99eaac2d558
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 910,
          "y": 1510
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Run Sigma rules to detected the related malicious activity:
        - [CobaltStrike Named Pipe](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/pipe_created/sysmon_mal_cobaltstrike.yml)
        - [Suspicious Process Start Without DLL](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_procs_req_dlls.yml)
      id: 52b36b95-5656-443c-8d06-adc0435b5a2e
      iscommand: false
      name: Run Sigma rules
      type: regular
      version: -1
    taskid: 52b36b95-5656-443c-8d06-adc0435b5a2e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1510
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Run related advanced XQL queries in Cortex XDR to find any malicious related activity.
        [Cortex XDR Hunting Blog](https://www.paloaltonetworks.com/blog/security-operations/hunting-for-apt29-spear-phishing-using-xdr/)
      id: 084b8aeb-739e-4a9b-86e5-9214de758670
      iscommand: false
      name: Cortex XDR XQL queries
      type: regular
      version: -1
    taskid: 084b8aeb-739e-4a9b-86e5-9214de758670
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1510
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: af8b1352-efa5-4ef5-831d-922c2939ab00
      iscommand: false
      name: Malicious Email Search
      type: title
      version: -1
    taskid: af8b1352-efa5-4ef5-831d-922c2939ab00
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 195
        }
      }
  "22":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: state
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: EWS V2
                root: modules
          operator: isEqualString
          right:
            value:
              simple: active
      label: "yes"
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "4"
      "yes":
      - "23"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if EWS integration enabled
      id: 82991eb1-aaf6-4669-8d39-a07c35b064e9
      iscommand: false
      name: Is EWS enabled?
      type: condition
      version: -1
    taskid: 82991eb1-aaf6-4669-8d39-a07c35b064e9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": 340
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      query:
        complex:
          root: inputs.EWSSearchQuery
    separatecontext: false
    skipunavailable: true
    task:
      brand: ""
      description: Searches for items in the specified mailbox. Specific permissions
        are needed for this operation to search in a target mailbox other than the
        default.
      id: 4af8ae05-0798-4e68-80e6-0bf7fec8f48c
      iscommand: true
      name: Search for emails from spoofed accounts
      script: '|||ews-search-mailbox'
      type: regular
      version: -1
    taskid: 4af8ae05-0798-4e68-80e6-0bf7fec8f48c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 130,
          "y": 510
        }
      }
  "24":
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 17faaf17-7b62-45fd-8689-13d4ef6118e1
      iscommand: false
      name: Block Indicators
      type: title
      version: -1
    taskid: 17faaf17-7b62-45fd-8689-13d4ef6118e1
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1700
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    scriptarguments:
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: Demisto Remediation - Malicious URLs
      IP:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      MD5:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "32"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.File
              operator: stringHasLength
              right:
                value:
                  simple: "64"
          root: ExtractedIndicators.File
          transformers:
          - operator: uniq
      URL:
        complex:
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.URL
              operator: notContainsGeneral
              right:
                value:
                  simple: github
          - - left:
                iscontext: true
                value:
                  simple: ExtractedIndicators.URL
              operator: notContainsGeneral
              right:
                value:
                  simple: microsoft.com
          root: ExtractedIndicators.URL
          transformers:
          - operator: uniq
      URLListName:
        simple: Demisto Remediation - URL EDL
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |+
        This playbook blocks malicious Indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic
        - Block Account - Generic
        - Block IP - Generic v2
        - Block File - Generic v2

      id: 227a48ce-42c6-4a9b-8e04-52ce3d876c6b
      iscommand: false
      name: Block Indicators - Generic v2
      playbookId: Block Indicators - Generic v2
      type: playbook
      version: -1
    taskid: 227a48ce-42c6-4a9b-8e04-52ce3d876c6b
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 190,
          "y": 2010
        }
      }
  "26":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.BlockIndicatorsAutomatically
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "28"
      "yes":
      - "25"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether IOCs associated with the incident can be blocked
        automatically.
      id: a6b6336c-0c78-4aaa-8935-9abfa15b790c
      iscommand: false
      name: Block indicators automatically?
      type: condition
      version: -1
    taskid: a6b6336c-0c78-4aaa-8935-9abfa15b790c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1840
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 82f89314-aa8f-4678-811a-6cd7e8ae3207
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 82f89314-aa8f-4678-811a-6cd7e8ae3207
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2180
        }
      }
  "28":
    continueonerrortype: ""
    id: "28"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manually block the IOCs in the relevant systems.
      id: 1cfbac41-61d7-4da8-8e85-8ffb7a8ac89f
      iscommand: false
      name: Block indicators manually
      type: regular
      version: -1
    taskid: 1cfbac41-61d7-4da8-8e85-8ffb7a8ac89f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 710,
          "y": 2010
        }
      }
  "29":
    continueonerrortype: ""
    id: "29"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "30"
      - "31"
      - "32"
      - "33"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 808aba14-343f-4747-8a28-c46c7f178932
      iscommand: false
      name: Tag Indicators
      type: title
      version: -1
    taskid: 808aba14-343f-4747-8a28-c46c7f178932
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 440,
          "y": -130
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: File
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      tags:
        simple: NOBELIUM, APT29
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.indicators
      id: 159f52de-3e12-4e07-8241-2b2d40a32d84
      iscommand: true
      name: Tag File indicators
      script: Builtin|||setIndicators
      type: regular
      version: -1
    taskid: 159f52de-3e12-4e07-8241-2b2d40a32d84
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1150,
          "y": 20
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: IP
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      tags:
        simple: NOBELIUM, APT29
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.indicators
      id: 0293fdc3-7007-4df1-8c12-d286d3e9cb26
      iscommand: true
      name: Tag IP indicators
      script: Builtin|||setIndicators
      type: regular
      version: -1
    taskid: 0293fdc3-7007-4df1-8c12-d286d3e9cb26
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 690,
          "y": 20
        }
      }
  "32":
    continueonerrortype: ""
    id: "32"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: Domain
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      tags:
        simple: NOBELIUM, APT29
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.indicators
      id: 12c2092c-230f-4f03-8a18-7fb78808cf60
      iscommand: true
      name: Tag Domain indicators
      script: Builtin|||setIndicators
      type: regular
      version: -1
    taskid: 12c2092c-230f-4f03-8a18-7fb78808cf60
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 200,
          "y": 20
        }
      }
  "33":
    continueonerrortype: ""
    id: "33"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: URL
          root: ExtractedIndicators
          transformers:
          - operator: uniq
      tags:
        simple: NOBELIUM, APT29
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.indicators
      id: bf6b15e8-2a95-4c21-89db-605cf61304ad
      iscommand: true
      name: Tag URL indicators
      script: Builtin|||setIndicators
      type: regular
      version: -1
    taskid: bf6b15e8-2a95-4c21-89db-605cf61304ad
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -250,
          "y": 20
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "16_13_yes": 0.61,
      "16_17_#default#": 0.11
    },
    "paper": {
      "dimensions": {
        "height": 3015,
        "width": 2870,
        "x": -690,
        "y": -770
      }
    }
  }
