category: Data Enrichment & Threat Intelligence
commonfields:
  id: Recorded Future v1
  version: -1
configuration:
- defaultvalue: https://api.recordedfuture.com/gw/xsoar/
  display: Server URL (e.g., https://api.recordedfuture.com/gw/xsoar/)
  name: server_url
  required: true
  type: 0
- display: API Token
  name: token
  required: true
  type: 4
- defaultvalue: "false"
  display: Trust any certificate (not secure)
  name: unsecure
  required: false
  type: 8
- defaultvalue: "false"
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- display: Long running instance
  name: longRunning
  required: false
  type: 8
- display: Incident type
  name: incidentType
  required: false
  type: 13
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: Unique threat intel technology that automatically serves up relevant
  insights in real time.
detaileddescription: |-
  ### Partner Contributed Integration
  #### Integration Author: Recorded Future
  Support and maintenance for this integration are provided by the author. Please use the following contact details:
  - **Email**: [support@recordedfuture.com](mailto:support@recordedfuture.com)
  - **URL**: [https://www.recordedfuture.com/support/demisto-integration/](https://www.recordedfuture.com/support/demisto-integration/)
  ***
  ## Information
  A valid API Token for XSOAR from Recorded Future needed to fetch information.
  [Get help with Recorded Future for Cortex XSOAR](https://www.recordedfuture.com/support/demisto-integration/).

  ---

  ## Configuration
  | Parameter                        | Description                                                       |
  |----------------------------------|-------------------------------------------------------------------|
  | Server URL                       | The URL to the Recorded Future ConnectAPI                         |
  | API Token                        | Valid API Token from Recorded Future                              |
  | File/IP/Domain/URL/CVE Threshold | Minimum risk score from Recorded Future needed to mark IOC as malicious when doing reputation or intelligence lookups  |
  | unsecure                         | Trust any certificate \(unsecure\)                                |
  | proxy                            | Use system proxy settings                                         |

  ---

  ## Available Actions
  * Reputation actions
      * Using the new Recorded Future SOAR Enrichment API.
      * Available actions: ip, domain, url, file(hashes), cve.
  * Intelligence action
      * Fetches full information for the entity.
      * Supports IPs, Domains, URLs, Files(hashes), vulnerabilities(cve).
  * Alert actions
      * Fetch alerting rules defined at Recorded Future.
      * Fetch alert summaries from one or more alerting rules.
  * Threat assessment action
      * Takes a context, such as phishing or malware and one or more IOC as input.
      * Outputs a verdict (true/false) and related evidence (risk rules) for this context.

  Copyright 2020 Recorded Future, Inc.

  ---
  [View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/recorded-future-v2)
display: Recorded Future v1
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAyCAYAAACXpx/YAAAAAXNSR0IArs4c6QAAC6NJREFUeAHtmH9wVNUVx+97+3Y3i0lIgOFnQiCEgEZQxB8EZyQwSrFVK85UOk5bq7VUpyJii7VOtRlFbRSdsSgF/QNELfUHrTqOtaAmtGIFxaFgtEACwfyAqCGJZLPJ7r73+jkvu0s2pomMg7Qz983c3HvPOff8+J5zf2yU0p9GQCOgEdAIaAQ0AhoBjYBGQCOgEdAIaAQ0AhoBjYBGQCOgEdAIaAQ0AhoBjYBGQCOgEdAIaAQEgZvfn6qWvJunwfj/QMA8ITdv3j7RDAQ2+6zQOrXsndAJrdXCpwSBwRN8YUWWKinP9Lwz3FGGofJdQ01RbXGPNvSmf+SqJfuDp8R7bXRQBIwBJQp/NdTIynlJ+cxu90jtVWrRkjMMZe9QpqpzbfecQNweHQ8GXlRuvNLJnrFUlRtOf/oKCwuHDhkyJEN4XV1dTjAYbK+uro72J/tN0AoKCmZgJ+PQoUP/PAF7PtZd5PP5Gg8cOLCv97opU6ZkEVPIcZwUnhJnTU1NG3Kx3rLf9Nga0GDQPxL+bGUbMeUfOUoZpq1cu2dJlPQGY6cbVrDEicZt1fJXP4zufvRl2ra9KRKJTAQA4ZudnZ3tEyZMWFNXV7eeudvPmpNKsixrMT6NwciVJ2AoZJrmPbRXWVORXFdSUpJJMtfGYrFZ0Lz4Xdc1+KLEuJwY/5aUTfZFRUWT4F8AJn9paGiIJOknox84waYl4MeV4cY944GAIsWG48RJ5qekJstVjpfwHn7/HvoJRgLaGI/H/wxAAcQW0j82adKkQ7W1tW/1v+ykUmWnpXbb17FEHBJfIbG9StE8Q3J9og+aTSGl7fSknWg0Wgrvt5wGldBOYYKTHkkfsvwq3FKrglnPGK7/oLt6a6daduVXAgkQvGA5st5PqHxv4sSJ8wlyLvNTkWAp3BM6OfLy8qSS+11DUh0SWsNu3JGIb8AOWdETpSC8HT+g8NdkfmkHFxUtCR4bErSad68Mp+n2B0y1atYXJRvm3+iPbI7uVMpRzhVfeqSN59FVOCp+rKp87kC7WsCyAcbb/hxZQYK9yO/3j6a63+NY+3fSNsfc6IyMjNnMg/B2Ju8/1mRTIHPQkQH97wcPHmyWNXL8UVBd0IV/LtfC23v37j0IvYT5Wey0XdDS3gqcJPmBQGA2azpFFzbaE/Yt3g+z8GtMd3f3HvievwnegB0FXMAOtSjqWhEkjgz0TMXOR+FwWOxn4ufl48ePb/rkk0+2FxcXj+WYb03GIUc/V9kk5tX4novvufjQDhZlYHVg3759740bN244b5s56LGIq4rTkGM1/UtP8FkrxtUagScQyVVF9/5QOdy9ya/ViKu3FkzZ44TWuc53G1VlzXVqk3U84OE7Yr6lH1xx2B+qOBy23ywpr76turwkmlwOOPmTJ08+XaqXQK6CPp7+NQLPwbm1OFlM30R/F0HfR9BP5efnn4fcBgKzWN8B7zSCXUSAR2nP0sZAj0K30fMTCmM7tLugnUkOTfTFGH8G2OdCX0U7iv1WaMPpd4tv8C5B9iF8+RT5LHjLsPvT+vr6OngPIHIt9puQ/4I2gXY8ZlHQ88mlW8QjrJT14k81CbkVeyPKy8uvpTnonwr9eXQtFBlaLglfjO1G7DRj+xFUvU5bKSopgnORfxydF6P7W9zzd7CmhfU59GvwMUIBPYnebnoXPXdAW4zfyVNS1PAe7v256hzD8n+bh1OpCvnPVDb3b/JryIizZ2e4oUApj66rVKB7lFKB4zuBIFxTXeKEMqc6VEB19FhuYqkYdwhgMY79kX4HDl3N+AaqU460GwmkCPo8ds53EL0f/t3Tp0/PA6Tb4TXwGJkNfza8HzGvZ+3dNIvdNof1pQD5MfSVpaWl8ts8A14BtOXov5AdswfaCkDaSLWfDyA/gy9HpDFt2rRchveydhM7bT40uTI6WXMLoMuO/gHtF9iWxD1COw1+2ifgQpAEL2T8KLpWICeFZ0EL8GvBu8bg+aAFE73c0w3E9z18vJqdWktsolveJ97HXDZfgN7Avg+9k4npZRJ/PmseY+398D+mqMvYuXORe5+C+QNXybAeDT1/03dwZ/Nm5YxZbpq+HMf4/A1OEZLovRmUKowEVGbra1ZH4N64pQ6rxpo6ZYXP4nLu0VRWafmjsVUqcszkJHvHDrz+WcKQgXMGPyMepfqew5Gnobfg2EvCB4QSWjvBn4dzPoLJBODstra2CYCRj8hzR44cSep6lx0cRH4GAW5ER4PoYMdvoFtNlY+EJ4Bv4QR4U3gAko/tISIP2B2QPuRI3oofI1paWkbBG8nYxvYCbCtsdzMvoC+mgOoB9VV56Y4dO3Yzsh/jZwIQ0c49Y9uSQB6ezmqOzMfw28VOmNNKEiq+pL6+c/A4vkF6iqS3vFc4shj8fNjZj3/rmpubw/KzkziLoB0QvxnLGyCO/tNJchZLjiaNpie4ZpVYXJmyWlJ+fIefxm6ftf2LuHp8da6yIq3qFVstNbzq9JRNi/i6V82VV+PPk8p79QLA51RaPUCtALyXcPJidixFpCTufIK4HBkfjkrlV5Cs/ZmZmXI0Hz9FEKbafQAthZGisy7O3CWJHviskUR6n+wYBvLbO3W0QrJZ4/GRNVk7C9pYsU+Te+w56AW0OH6lQJe5t+jLfwSHyLZt244lWVLU6HK5S90XXnhB/PUMoiOFWe8x64Segj4hbyRkmBqd3L/elYle2TQOPDaYtwOlmCxot4RCocNJH6RPT3BvTt+xa8XUmSvyDTNc1Wa5+9UHZZdRWimH+or3neOAB35TU1Mlya3C4TuRqaTJz4S9/NNhSe818ihhjY3To3vTeYxE2Z1hqrkgSadgJiIbZ0d0CBKMUyCSuGOSuI6OjnHI8zbkPw+x2AjpqfZuxCXZT2F/k9CSH/YXwRuBrhxobYzlqMoR9UmZPn3KptDxrwO9JevXr5djt4t1crr4uW46KEQR8eGHlzB2ZTenSgR5ObG8D9/ymEv1dwlBYmLu2eBkiZJs2bWvc7pU9Kzo/+9XTzAFqVxnpGG5hUTI7+DskOIw7l9tGlWckmQljzab4B8A+Ld4QFzBMfM0403cefII2kzwk5EvJrFLif9lxsvgtTL/DP4Ckvs4/RrmvycJchTJf4tuJ/gndu/e/SlAyX/MUj8/sLsP2a3QVsIbw9opjC+DvoWk1qP7NYCq4JiXZB7B/nzkd4DhFvwKw3sCOxvpF7BuOryN9KkvAbpcG2lYYudFZBciuBa779AvRbaSR9Ah9GXBG0JhPojdrYxfZv06ZB6SWJGTR9cvoT3f2Nh4FJoUSUbClmKTdELbwLrb0CVvnI/wdQ4y7cOGDavYuXOnVzjM+zyyhNL765YHhBGkBVSMBNvKcW3H7Xl8BV1lwLfEtknC+/+4IyIA9ycC/jApQZK24fzvqFKL8dvwrsHZ8cx/jcyltB08emLIPCIN3kKCuIm+DeAPkphnkbkV3jwCWwQYD3Ef3yf6sbWZVilj+aDL7lkGbQv99TS5BnhnmPIfpjhH/h3M12L7+7Tl0IZiaxeJaGLN9ciFsXEDMrsY3wX/X7TUl52dLfG9Qgy7UkQG2N1O92NaDvquS8jIKRWHJ7ISz1B0Xwovl3ifxsZt0C6kyK5h/CQnUjlysN090J9nnPqnCA+th5n/BrmLE7gVI/c2yU1dRfAH+W9O3rKQOXzUfZzytmPk3qm6ms/mlY3jZp3rtM5U864MmP6slcqNbXMePnuNKPw6H/eVvDpTP6166fLNnDnT7F2ZCZ6cDvJOSAuq17q0YVlZmVVVVfXf7lETG75+bIgOOX2+ko00g4nJIHb7LjmhmGTxALgNkuC+ps+45wIzI+NdV7n1rhE5R+0s/7yviJ7/byGQdm8M6pqvc5/r+N8wXGOvazW1DyqvBTQCGgGNgEZAI6AR0AhoBDQCGgGNgEZAI6AR0AhoBDQCGgGNgEZAI6AR0AhoBDQCGgGNgEZAI6AROCkI/Adox/h1F7lx8wAAAABJRU5ErkJggg==
name: Recorded Future v1
script:
  commands:
  - arguments: []
    description: Search for detection rules based on the provided filter.
    name: recorded-future-get-detection-rules
  dockerimage: demisto/python3:3.9.5.20070
  longRunning: true
  runonce: false
  script: |2



    ''' IMPORTS '''
    import requests
    import os
    import json
    import urllib
    from datetime import datetime

    if not demisto.params()['proxy']:
        del os.environ['HTTP_PROXY']
        del os.environ['HTTPS_PROXY']
        del os.environ['http_proxy']
        del os.environ['https_proxy']

    # disable insecure warnings
    requests.packages.urllib3.disable_warnings()

    ''' GLOBAL VARS '''
    TOKEN = demisto.params()['token']
    SERVER = demisto.params()['server_url'][:-1] if demisto.params()['server_url'].endswith('/') else demisto.params()['server_url']
    # BASE_URL = SERVER + '/v2/'
    USE_SSL = not demisto.params().get('unsecure', False)
    HEADERS = {
        'X-RFToken': TOKEN,
        'X-RF-User-Agent': 'DemistoIntegrations+v1.0'
    }

    # FETCH_TIME = demisto.params().get('triggered').strip()
    # RULE_NAMES = demisto.params().get('rule_names').strip()

    ''' HELPER FUNCTIONS '''


    def http_request(method, url_suffix, params=None, json=None):
        LOG('running request with url=%s' % (SERVER + url_suffix))

        params = params if params is not None else {}

        try:
            res = requests.request(
                method,
                SERVER + url_suffix,
                # BASE_URL + url_suffix,
                params=params,
                headers=HEADERS,
                verify=USE_SSL
            )
            if res.status_code not in {200, 404}:
                if res.status_code == 401:
                    error_str = 'Request failed with status 401 - Authentication error'
                else:
                    error_str = 'Request failed, status: ' + str(res.status_code) + ', details: ' + res.text
                return_error(error_str)
        except Exception as e:
            LOG(e.message)
            return_error(e.message)
        return res.text






    ''' FUNCTIONS '''


    def get_rules_command():
        cmd_url='/detection-rule/search'

        # try:
        #     res = requests.request(
        #         'post',
        #         SERVER + cmd_url,
        #         params={},
        #         headers=HEADERS,
        #         verify=USE_SSL
        #     )
        #     if res.status_code not in {200, 404}:
        #         if res.status_code == 401:
        #             error_str = 'Request failed with status 401 - Authentication error'
        #         else:
        #             error_str = 'Request failed, status: ' + str(res.status_code) + ', details: ' + res.text
        #         return_error(error_str)
        # except Exception as e:
        #     LOG(e.message)
        #     return_error(e.message)
        res=http_request("post", cmd_url)
        demisto.results(res)
        # if res:
        #     print("Yes")
        # else:
        #     print("No")
        # print(res.text)


    def ip_lookup():
        cmd_url = '/detection-rule-relation/entity/types'
        params={}
        # params = {
        #     'fields': 'sightings,timestamps,risk'
        # }

        response = http_request('get', cmd_url)
        return response

    ''' EXECUTION CODE '''
    LOG('command is %s' % (demisto.command(),))

    try:
        if demisto.command() == 'test-module':
            try:
                res = json.loads(ip_lookup())
                # res = json.loads(ip_lookup('8.8.8.8'))
            except Exception as ex:
                return_error('Failed to get response. The URL might be incorrect.' + str(ex))
            demisto.results('ok')


        elif demisto.command() == 'recorded-future-get-detection-rules':
            get_rules_command()

    except Exception as e:
        LOG(e.message)
        LOG.print_log()
        return_error(e.message)
  subtype: python3
  type: python
sourcemoduleid: Recorded Future v2
