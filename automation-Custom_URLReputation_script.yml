args:
- description: The indicators to which to add the reputation.
  isArray: true
  name: input
  required: true
comment: This script adds the reputation to Onion URL indicators. The script is automatically
  triggered when a Onion URL indicator is auto-extracted. For instance, if you run
  a Cortex XSOAR CLI on a valid Onion URL, the indicators are extracted automatically
  and this script is triggered for the extracted indicators.
commonfields:
  id: 5b3af989-1eec-45d9-8513-e63d51ec01be
  version: -1
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
dockerimage: demisto/python3:3.9.7.24076
enabled: true
engineinfo: {}
mainengineinfo: {}
name: Custom_URLReputation_script
pswd: ""
runas: DBotWeakRole
runonce: false
script: |2+

  def main():
      url_list = argToList(demisto.args().get('input'))
      entry_list = []

      for url in url_list:
          result = demisto.executeCommand('url-scan', {'url': url, "using":"VirusTotal (API v3)_instance_1_copy"})
          urlScanId = result[0]['EntryContext']['vtScanID']
          res = demisto.executeCommand('vt-analysis-get', {'id': urlScanId, "using":"VirusTotal (API v3)_instance_1_copy"})

          entry_list.append({
              'Type': entryTypes['note'],
              'ContentsFormat': formats['json'],
              'Contents': res[0]['Contents'],
              'HumanReadable': res[0]['HumanReadable'],
              'EntryContext': {
                  'DBotScore': {
                      'Indicator': url,
                      'Type': 'URL',
                      'Score': 3,  # suspicious
                      'Vendor': 'VirusTotal'
                  }
              }
          })

      demisto.results(entry_list)


  if __name__ in ('__main__', 'builtin', 'builtins'):
      main()



scripttarget: 0
subtype: python3
tags:
- reputation
- Enrichment
- enhancement
type: python
